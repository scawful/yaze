<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Integration Test Guide</title>
<link rel="icon" href="yaze.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.2.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2integration__test__guide.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Integration Test Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md339"></a></p>
<p>This guide explains how to use yaze's integration test suite to validate ROM loading, overworld functionality, and ensure compatibility between vanilla and ZSCustomOverworld ROMs.</p>
<h1><a class="anchor" id="autotoc_md340"></a>
Table of Contents</h1>
<ol type="1">
<li>Overview</li>
<li>Test Structure</li>
<li>Running Tests</li>
<li>Understanding Results</li>
<li>Adding New Tests</li>
<li>Debugging Failed Tests</li>
<li>Best Practices</li>
</ol>
<h1><a class="anchor" id="autotoc_md341"></a>
Overview</h1>
<p>The integration test suite validates that yaze correctly loads and processes ROM data by comparing against known values from vanilla ROMs and ensuring that ZSCustomOverworld features work as expected.</p>
<h2><a class="anchor" id="autotoc_md342"></a>
Key Components</h2>
<ul>
<li><b>Vanilla ROM Tests</b>: Validate loading of original Zelda 3 ROMs</li>
<li><b>ZSCustomOverworld Tests</b>: Validate v2/v3 feature compatibility</li>
<li><b>Sprite Position Tests</b>: Verify sprite coordinate systems</li>
<li><b>Overworld Map Tests</b>: Test map loading and property access</li>
</ul>
<h1><a class="anchor" id="autotoc_md343"></a>
Test Structure</h1>
<h2><a class="anchor" id="autotoc_md344"></a>
Test Files</h2>
<div class="fragment"><div class="line">test/zelda3/</div>
<div class="line">├── overworld_integration_test.cc     # Integration tests with real ROMs</div>
<div class="line">├── comprehensive_integration_test.cc # Full ROM validation</div>
<div class="line">├── dungeon_integration_test.cc       # Dungeon system integration tests</div>
<div class="line">├── dungeon_editor_system_integration_test.cc # Dungeon editor system tests</div>
<div class="line">└── extract_vanilla_values.cc         # Utility to extract test values</div>
<div class="line"> </div>
<div class="line">test/integration/</div>
<div class="line">├── editor_integration_test.h/cc      # Base editor integration test framework</div>
<div class="line">├── dungeon_editor_test.h             # Dungeon editor integration tests</div>
<div class="line">└── test_editor.h/cc                  # Test editor framework</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md345"></a>
Test Categories</h2>
<h3><a class="anchor" id="autotoc_md346"></a>
1. Integration Tests (<code>overworld_integration_test.cc</code>)</h3>
<p>Test with real ROM files and validate overworld functionality:</p>
<div class="fragment"><div class="line">TEST_F(OverworldIntegrationTest, VanillaROMLoading) {</div>
<div class="line">  <span class="comment">// Load vanilla ROM</span></div>
<div class="line">  <span class="keyword">auto</span> rom = LoadVanillaROM();</div>
<div class="line">  Overworld overworld(rom.get());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Test specific map properties</span></div>
<div class="line">  <span class="keyword">auto</span>* map = overworld.overworld_map(0);</div>
<div class="line">  EXPECT_EQ(map-&gt;area_graphics(), expected_graphics);</div>
<div class="line">  EXPECT_EQ(map-&gt;area_palette(), expected_palette);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md347"></a>
2. Comprehensive Integration Tests (<code>comprehensive_integration_test.cc</code>)</h3>
<p>Full ROM validation with multiple ROM types:</p>
<div class="fragment"><div class="line">TEST_F(ComprehensiveIntegrationTest, VanillaVsV3Comparison) {</div>
<div class="line">  <span class="comment">// Compare vanilla and v3 ROM features</span></div>
<div class="line">  EXPECT_NE(vanilla_overworld_, <span class="keyword">nullptr</span>);</div>
<div class="line">  EXPECT_NE(v3_overworld_, <span class="keyword">nullptr</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Test feature differences</span></div>
<div class="line">  TestFeatureDifferences();</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md348"></a>
3. Dungeon Integration Tests (<code>dungeon_integration_test.cc</code>)</h3>
<p>Test dungeon system functionality:</p>
<div class="fragment"><div class="line">TEST_F(DungeonIntegrationTest, DungeonRoomLoading) {</div>
<div class="line">  <span class="comment">// Test loading dungeon rooms</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; kNumTestRooms; i++) {</div>
<div class="line">    <span class="comment">// Test room loading and properties</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md349"></a>
4. Dungeon Editor System Tests (<code>dungeon_editor_system_integration_test.cc</code>)</h3>
<p>Test the complete dungeon editor system:</p>
<div class="fragment"><div class="line">TEST_F(DungeonEditorSystemIntegrationTest, BasicInitialization) {</div>
<div class="line">  EXPECT_NE(dungeon_editor_system_, <span class="keyword">nullptr</span>);</div>
<div class="line">  EXPECT_EQ(dungeon_editor_system_-&gt;GetROM(), rom_.get());</div>
<div class="line">  EXPECT_FALSE(dungeon_editor_system_-&gt;IsDirty());</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md350"></a>
Running Tests</h1>
<h2><a class="anchor" id="autotoc_md351"></a>
Prerequisites</h2>
<ol type="1">
<li><b>Build yaze</b>: Ensure yaze is built with test support</li>
<li><b>ROM Files</b>: Have test ROM files available</li>
<li><b>Test Data</b>: Generated test values from vanilla ROMs</li>
</ol>
<h2><a class="anchor" id="autotoc_md352"></a>
Basic Test Execution</h2>
<div class="fragment"><div class="line"># Run all tests</div>
<div class="line">cd /Users/scawful/Code/yaze/build</div>
<div class="line">./bin/yaze_test</div>
<div class="line"> </div>
<div class="line"># Run specific test suite</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;OverworldTest.*&quot;</div>
<div class="line"> </div>
<div class="line"># Run specific test</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;SpritePositionTest.SpriteCoordinateSystem&quot;</div>
<div class="line"> </div>
<div class="line"># Run with verbose output</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;OverworldIntegrationTest.*&quot; --gtest_output=xml:test_results.xml</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md353"></a>
Test Filtering</h2>
<p>Use Google Test filters to run specific tests:</p>
<div class="fragment"><div class="line"># Run only overworld tests</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;Overworld*&quot;</div>
<div class="line"> </div>
<div class="line"># Run only integration tests</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;*Integration*&quot;</div>
<div class="line"> </div>
<div class="line"># Run tests matching pattern</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;*Sprite*&quot;</div>
<div class="line"> </div>
<div class="line"># Exclude specific tests</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;OverworldTest.*:-OverworldTest.OverworldMapDestroy&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md354"></a>
Parallel Execution</h2>
<div class="fragment"><div class="line"># Run tests in parallel (faster)</div>
<div class="line">./bin/yaze_test --gtest_parallel=4</div>
<div class="line"> </div>
<div class="line"># Run with specific number of workers</div>
<div class="line">./bin/yaze_test --gtest_workers=8</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md355"></a>
Understanding Results</h1>
<h2><a class="anchor" id="autotoc_md356"></a>
Test Output Format</h2>
<div class="fragment"><div class="line">[==========] Running 3 tests from 1 test suite.</div>
<div class="line">[----------] Global test environment set-up.</div>
<div class="line">[----------] 3 tests from OverworldTest</div>
<div class="line">[ RUN      ] OverworldTest.OverworldMapInitialization</div>
<div class="line">[       OK ] OverworldTest.OverworldMapInitialization (2 ms)</div>
<div class="line">[ RUN      ] OverworldTest.AreaSizeEnumValues</div>
<div class="line">[       OK ] OverworldTest.AreaSizeEnumValues (1 ms)</div>
<div class="line">[ RUN      ] OverworldTest.OverworldMapDestroy</div>
<div class="line">[       OK ] OverworldTest.OverworldMapDestroy (1 ms)</div>
<div class="line">[----------] 3 tests from OverworldTest (4 ms total)</div>
<div class="line">[----------] Global test environment tear-down.</div>
<div class="line">[==========] 3 tests from 1 test suite ran. (4 ms total)</div>
<div class="line">[  PASSED  ] 3 tests.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md357"></a>
Success Indicators</h2>
<ul>
<li><code>[ OK ]</code>: Test passed</li>
<li><code>[ PASSED ]</code>: All tests in suite passed</li>
<li>No error messages or stack traces</li>
</ul>
<h2><a class="anchor" id="autotoc_md358"></a>
Failure Indicators</h2>
<ul>
<li><code>[ FAILED ]</code>: Test failed</li>
<li>Error messages with expected vs actual values</li>
<li>Stack traces showing failure location</li>
</ul>
<h2><a class="anchor" id="autotoc_md359"></a>
Example Failure Output</h2>
<div class="fragment"><div class="line">[ RUN      ] OverworldTest.OverworldMapInitialization</div>
<div class="line">test/zelda3/overworld_test.cc:45: Failure</div>
<div class="line">Expected equality of these values:</div>
<div class="line">  map.area_graphics()</div>
<div class="line">    Which is: 5</div>
<div class="line">  0</div>
<div class="line">[  FAILED  ] OverworldTest.OverworldMapInitialization (2 ms)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md360"></a>
Adding New Tests</h1>
<h2><a class="anchor" id="autotoc_md361"></a>
1. Unit Test Example</h2>
<div class="fragment"><div class="line"><span class="comment">// Add to overworld_test.cc</span></div>
<div class="line">TEST_F(OverworldTest, VanillaOverlayLoading) {</div>
<div class="line">  OverworldMap map(0, rom_.get());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Test vanilla overlay loading</span></div>
<div class="line">  <a class="code hl_define" href="macro_8h.html#a755e0e0d964b4d81ae730d174c5fa3ce">RETURN_IF_ERROR</a>(map.LoadVanillaOverlay());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Verify overlay data</span></div>
<div class="line">  EXPECT_TRUE(map.has_vanilla_overlay());</div>
<div class="line">  EXPECT_GT(map.vanilla_overlay_data().size(), 0);</div>
<div class="line">}</div>
<div class="ttc" id="amacro_8h_html_a755e0e0d964b4d81ae730d174c5fa3ce"><div class="ttname"><a href="macro_8h.html#a755e0e0d964b4d81ae730d174c5fa3ce">RETURN_IF_ERROR</a></div><div class="ttdeci">#define RETURN_IF_ERROR(expression)</div><div class="ttdef"><b>Definition</b> <a href="macro_8h_source.html#l00053">macro.h:53</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md362"></a>
2. Integration Test Example</h2>
<div class="fragment"><div class="line"><span class="comment">// Add to overworld_integration_test.cc</span></div>
<div class="line">TEST_F(OverworldIntegrationTest, ZSCustomOverworldV3Features) {</div>
<div class="line">  <span class="comment">// Load ZSCustomOverworld v3 ROM</span></div>
<div class="line">  <span class="keyword">auto</span> rom = LoadZSCustomOverworldV3ROM();</div>
<div class="line">  Overworld overworld(rom.get());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Test v3 features</span></div>
<div class="line">  <span class="keyword">auto</span>* map = overworld.overworld_map(0);</div>
<div class="line">  EXPECT_GT(map-&gt;subscreen_overlay(), 0);</div>
<div class="line">  EXPECT_GT(map-&gt;animated_gfx(), 0);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Test custom tile graphics</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {</div>
<div class="line">    EXPECT_GE(map-&gt;custom_tileset(i), 0);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md363"></a>
3. Performance Test Example</h2>
<div class="fragment"><div class="line">TEST_F(OverworldPerformanceTest, LargeMapLoading) {</div>
<div class="line">  <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load large number of maps</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; i++) {</div>
<div class="line">    OverworldMap map(i % 160, rom_.get());</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::now();</div>
<div class="line">  <span class="keyword">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end - start);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Ensure loading is reasonably fast</span></div>
<div class="line">  EXPECT_LT(duration.count(), 1000); <span class="comment">// Less than 1 second</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md364"></a>
Debugging Failed Tests</h1>
<h2><a class="anchor" id="autotoc_md365"></a>
1. Enable Debug Output</h2>
<div class="fragment"><div class="line"><span class="comment">// Add debug output to tests</span></div>
<div class="line">TEST_F(OverworldTest, DebugTest) {</div>
<div class="line">  OverworldMap map(0, rom_.get());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Print debug information</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Map index: &quot;</span> &lt;&lt; map.index() &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Area graphics: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(map.area_graphics()) &lt;&lt; std::endl;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Area palette: &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(map.area_palette()) &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Your assertions here</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md366"></a>
2. Use GDB for Debugging</h2>
<div class="fragment"><div class="line"># Run test with GDB</div>
<div class="line">gdb --args ./bin/yaze_test --gtest_filter=&quot;OverworldTest.DebugTest&quot;</div>
<div class="line"> </div>
<div class="line"># Set breakpoints</div>
<div class="line">(gdb) break overworld_test.cc:45</div>
<div class="line">(gdb) run</div>
<div class="line"> </div>
<div class="line"># Inspect variables</div>
<div class="line">(gdb) print map.area_graphics()</div>
<div class="line">(gdb) print map.area_palette()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md367"></a>
3. Memory Debugging</h2>
<div class="fragment"><div class="line"># Run with Valgrind (Linux)</div>
<div class="line">valgrind --leak-check=full ./bin/yaze_test --gtest_filter=&quot;OverworldTest.*&quot;</div>
<div class="line"> </div>
<div class="line"># Run with AddressSanitizer</div>
<div class="line">export ASAN_OPTIONS=detect_leaks=1</div>
<div class="line">./bin/yaze_test --gtest_filter=&quot;OverworldTest.*&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md368"></a>
4. Common Debugging Scenarios</h2>
<h3><a class="anchor" id="autotoc_md369"></a>
ROM Loading Issues</h3>
<div class="fragment"><div class="line"><span class="comment">// Check ROM version detection</span></div>
<div class="line">uint8_t asm_version = (*rom_)[zelda3::OverworldCustomASMHasBeenApplied];</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;ASM Version: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; static_cast&lt;int&gt;(asm_version) &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Verify ROM size</span></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;ROM Size: &quot;</span> &lt;&lt; rom_-&gt;size() &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md370"></a>
Map Property Issues</h3>
<div class="fragment"><div class="line"><span class="comment">// Check map loading</span></div>
<div class="line"><span class="keyword">auto</span>* map = overworld.overworld_map(current_map_);</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Map &quot;</span> &lt;&lt; current_map_ &lt;&lt; <span class="stringliteral">&quot; properties:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;  Area Graphics: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; static_cast&lt;int&gt;(map-&gt;area_graphics()) &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;  Area Palette: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; static_cast&lt;int&gt;(map-&gt;area_palette()) &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;  Main Palette: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; static_cast&lt;int&gt;(map-&gt;main_palette()) &lt;&lt; std::endl;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md371"></a>
Sprite Issues</h3>
<div class="fragment"><div class="line"><span class="comment">// Check sprite loading</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> game_state = 0; game_state &lt; 3; game_state++) {</div>
<div class="line">  <span class="keyword">auto</span>&amp; sprites = *overworld.mutable_sprites(game_state);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Game State &quot;</span> &lt;&lt; game_state &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; sprites.size() &lt;&lt; <span class="stringliteral">&quot; sprites&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; std::min(sprites.size(), <span class="keywordtype">size_t</span>(5)); i++) {</div>
<div class="line">    <span class="keyword">auto</span>&amp; sprite = sprites[i];</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  Sprite &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: Map=&quot;</span> &lt;&lt; sprite.map_id() </div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;, X=&quot;</span> &lt;&lt; sprite.x_ &lt;&lt; <span class="stringliteral">&quot;, Y=&quot;</span> &lt;&lt; sprite.y_ &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md372"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md373"></a>
1. Test Organization</h2>
<ul>
<li><b>Group related tests</b>: Use descriptive test suite names</li>
<li><b>One concept per test</b>: Each test should verify one specific behavior</li>
<li><b>Descriptive names</b>: Test names should clearly indicate what they're testing</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Good</span></div>
<div class="line">TEST_F(OverworldTest, VanillaOverlayLoadingForMap00) {</div>
<div class="line">  <span class="comment">// Test specific map&#39;s overlay loading</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Bad</span></div>
<div class="line">TEST_F(OverworldTest, Test1) {</div>
<div class="line">  <span class="comment">// Unclear what this tests</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md374"></a>
2. Test Data Management</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>OverworldTest : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="keywordtype">void</span> SetUp()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">// Initialize test data once</span></div>
<div class="line">    rom_ = std::make_unique&lt;Rom&gt;();</div>
<div class="line">    <span class="comment">// ... setup code</span></div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> TearDown()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">// Clean up after each test</span></div>
<div class="line">    rom_.reset();</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  std::unique_ptr&lt;Rom&gt; rom_;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md375"></a>
3. Error Handling in Tests</h2>
<div class="fragment"><div class="line">TEST_F(OverworldTest, ErrorHandling) {</div>
<div class="line">  <span class="comment">// Test error conditions</span></div>
<div class="line">  OverworldMap map(999, rom_.get()); <span class="comment">// Invalid map index</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Verify error handling</span></div>
<div class="line">  EXPECT_FALSE(map.is_initialized());</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md376"></a>
4. Performance Considerations</h2>
<div class="fragment"><div class="line"><span class="comment">// Use fixtures for expensive setup</span></div>
<div class="line"><span class="keyword">class </span>ExpensiveTest : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="keywordtype">void</span> SetUp()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="comment">// Expensive setup here</span></div>
<div class="line">    LoadLargeROM();</div>
<div class="line">    ProcessAllMaps();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Run expensive tests separately</span></div>
<div class="line"><a class="code hl_function" href="namespaceyaze_1_1app_1_1core_1_1anonymous__namespace_02asar__wrapper__test_8cc_03.html#a8deac63a36b0fee09bf6042daf215cef">TEST_F</a>(ExpensiveTest, FullOverworldProcessing) {</div>
<div class="line">  <span class="comment">// Test that requires expensive setup</span></div>
<div class="line">}</div>
<div class="ttc" id="anamespaceyaze_1_1app_1_1core_1_1anonymous__namespace_02asar__wrapper__test_8cc_03_html_a8deac63a36b0fee09bf6042daf215cef"><div class="ttname"><a href="namespaceyaze_1_1app_1_1core_1_1anonymous__namespace_02asar__wrapper__test_8cc_03.html#a8deac63a36b0fee09bf6042daf215cef">yaze::app::core::anonymous_namespace{asar_wrapper_test.cc}::TEST_F</a></div><div class="ttdeci">TEST_F(AsarWrapperTest, InitializationAndShutdown)</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper__test_8cc_source.html#l00080">asar_wrapper_test.cc:80</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md377"></a>
5. Continuous Integration</h2>
<p>Add tests to CI pipeline:</p>
<div class="fragment"><div class="line"># .github/workflows/tests.yml</div>
<div class="line">name: Tests</div>
<div class="line">on: [push, pull_request]</div>
<div class="line">jobs:</div>
<div class="line">  test:</div>
<div class="line">    runs-on: ubuntu-latest</div>
<div class="line">    steps:</div>
<div class="line">      - uses: actions/checkout@v2</div>
<div class="line">      - name: Build and Test</div>
<div class="line">        run: |</div>
<div class="line">          cd build</div>
<div class="line">          make -j4 yaze_test</div>
<div class="line">          ./bin/yaze_test --gtest_output=xml:test_results.xml</div>
<div class="line">      - name: Upload Test Results</div>
<div class="line">        uses: actions/upload-artifact@v2</div>
<div class="line">        with:</div>
<div class="line">          name: test-results</div>
<div class="line">          path: build/test_results.xml</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md378"></a>
Test Results Interpretation</h1>
<h2><a class="anchor" id="autotoc_md379"></a>
Viewing Results</h2>
<p>Test results are typically displayed in the terminal, but you can also generate XML reports:</p>
<div class="fragment"><div class="line"># Generate XML report</div>
<div class="line">./bin/yaze_test --gtest_output=xml:test_results.xml</div>
<div class="line"> </div>
<div class="line"># View in browser (if you have a test result viewer)</div>
<div class="line">open test_results.xml</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md380"></a>
Key Metrics</h2>
<ul>
<li><b>Test Count</b>: Number of tests run</li>
<li><b>Pass Rate</b>: Percentage of tests that passed</li>
<li><b>Execution Time</b>: How long tests took to run</li>
<li><b>Memory Usage</b>: Peak memory consumption during tests</li>
</ul>
<h2><a class="anchor" id="autotoc_md381"></a>
Performance Benchmarks</h2>
<p>Track performance over time:</p>
<div class="fragment"><div class="line"># Run with timing</div>
<div class="line">time ./bin/yaze_test --gtest_filter=&quot;OverworldPerformanceTest.*&quot;</div>
<div class="line"> </div>
<div class="line"># Profile with gprof</div>
<div class="line">gprof ./bin/yaze_test gmon.out &gt; profile.txt</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md382"></a>
Conclusion</h1>
<p>The integration test suite is essential for maintaining yaze's reliability and ensuring compatibility with different ROM types. By following this guide, you can effectively run tests, debug issues, and add new test cases to improve the overall quality of the codebase.</p>
<p>Remember to:</p><ul>
<li>Run tests regularly during development</li>
<li>Add tests for new features</li>
<li>Debug failures promptly</li>
<li>Keep tests fast and focused</li>
<li>Use appropriate test data and fixtures </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
