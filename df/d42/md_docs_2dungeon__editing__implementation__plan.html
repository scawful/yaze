<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Dungeon Editing Implementation Plan for Yaze</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('df/d42/md_docs_2dungeon__editing__implementation__plan.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Dungeon Editing Implementation Plan for Yaze</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md468"></a> <b>Status</b>: Planning Phase <br  />
 <b>Goal</b>: Implement fully functional dungeon room editing based on ZScream's proven approach <br  />
 <b>Created</b>: October 4, 2025</p>
<h1><a class="anchor" id="autotoc_md469"></a>
Executive Summary</h1>
<p>The dungeon object system in yaze currently does not work properly. ZScream's dungeon editing is fully functional and provides a proven reference implementation. This document outlines a comprehensive plan to implement working dungeon editing in yaze by analyzing ZScream's approach and adapting it to yaze's C++ architecture.</p>
<h1><a class="anchor" id="autotoc_md470"></a>
Table of Contents</h1>
<ol type="1">
<li>Current State Analysis</li>
<li>ZScream's Working Approach</li>
<li>ROM Data Structure Reference</li>
<li>Implementation Tasks</li>
<li>Technical Architecture</li>
<li>Testing Strategy</li>
<li>References</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md472"></a>
Current State Analysis</h1>
<h2><a class="anchor" id="autotoc_md473"></a>
What Works in Yaze</h2>
<ul>
<li>✅ Room header loading (basic properties: blockset, palette, spriteset)</li>
<li>✅ Room class structure exists</li>
<li>✅ RoomObject class with basic properties</li>
<li>✅ Graphics loading system (blocks, palettes)</li>
<li>✅ Room layout system for structural elements</li>
<li>✅ Sprite loading (separate from objects)</li>
<li>✅ UI framework with canvas, selectors, and viewers</li>
</ul>
<h2><a class="anchor" id="autotoc_md474"></a>
What Doesn't Work</h2>
<ul>
<li>❌ <b>Object Parsing</b>: Objects are loaded but not properly decoded</li>
<li>❌ <b>Object Drawing</b>: Objects don't render correctly on canvas</li>
<li>❌ <b>Object Placement</b>: No working system to place/edit objects</li>
<li>❌ <b>Object Encoding</b>: Can't save objects back to ROM format</li>
<li>❌ <b>Object Selection</b>: Can't select/move/delete objects properly</li>
<li>❌ <b>Layer Management</b>: Layer separation not working correctly</li>
<li>❌ <b>Door Objects</b>: Door section (0xF0 FF) not handled</li>
<li>❌ <b>Object Types</b>: Type1, Type2, Type3 distinctions not properly implemented</li>
<li>❌ <b>Tile Loading</b>: Objects don't load their tile data correctly</li>
<li>❌ <b>Collision/Properties</b>: Object-specific properties not tracked</li>
</ul>
<h2><a class="anchor" id="autotoc_md475"></a>
Key Problems Identified</h2>
<ol type="1">
<li><b>Object Data Format</b>: The 3-byte object encoding/decoding is incomplete</li>
<li><b>Layer Separation</b>: Objects on BG1, BG2, BG3 not properly separated</li>
<li><b>Object Rendering</b>: Object tile data not being loaded and drawn</li>
<li><b>Editor Integration</b>: No working UI flow for object placement</li>
<li><b>Save System</b>: No encoding of edited objects back to ROM format</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md477"></a>
ZScream's Working Approach</h1>
<h2><a class="anchor" id="autotoc_md478"></a>
Room Data Structure (ZScream)</h2>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Room</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Header Data (14 bytes at header_location)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> layout;           <span class="comment">// Byte 1 (bits 2-4)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> floor1;           <span class="comment">// Byte 0 (bits 0-3)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> floor2;           <span class="comment">// Byte 0 (bits 4-7)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> blockset;         <span class="comment">// Byte 2</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> spriteset;        <span class="comment">// Byte 3</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> palette;          <span class="comment">// Byte 1 (bits 0-5)</span></div>
<div class="line">    <span class="keyword">public</span> Background2 bg2;       <span class="comment">// Byte 0 (bits 5-7)</span></div>
<div class="line">    <span class="keyword">public</span> CollisionKey collision; <span class="comment">// Byte 0 (bits 2-4)</span></div>
<div class="line">    <span class="keyword">public</span> EffectKey effect;      <span class="comment">// Byte 4</span></div>
<div class="line">    <span class="keyword">public</span> TagKey tag1;           <span class="comment">// Byte 5</span></div>
<div class="line">    <span class="keyword">public</span> TagKey tag2;           <span class="comment">// Byte 6</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> holewarp;         <span class="comment">// Byte 9</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span>[] staircase_rooms; <span class="comment">// Bytes 10-13 (4 stairs)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span>[] staircase_plane; <span class="comment">// Byte 7-8 (plane info)</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Object Data</span></div>
<div class="line">    <span class="keyword">public</span> List&lt;Room_Object&gt; tilesObjects;  <span class="comment">// Objects in room</span></div>
<div class="line">    <span class="keyword">public</span> List&lt;Room_Object&gt; tilesLayoutObjects; <span class="comment">// Layout/structural objects</span></div>
<div class="line">    <span class="keyword">public</span> List&lt;Sprite&gt; sprites;            <span class="comment">// Sprites (separate system)</span></div>
<div class="line">    <span class="keyword">public</span> List&lt;Chest&gt; chest_list;          <span class="comment">// Chests in room</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span>[] blocks;                    <span class="comment">// 16 GFX blocks for room</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md479"></a>
Object Data Structure (ZScream)</h2>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Room_Object</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ROM Data (encoded in 3 bytes)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> X;          <span class="comment">// Position X (0-63)</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> Y;          <span class="comment">// Position Y (0-63)  </span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> Size;       <span class="comment">// Size parameter (0-15)</span></div>
<div class="line">    <span class="keyword">public</span> ushort id;       <span class="comment">// Object ID (0x000-0xFFF)</span></div>
<div class="line">    <span class="keyword">public</span> LayerType Layer; <span class="comment">// BG1, BG2, or BG3</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Rendering Data</span></div>
<div class="line">    <span class="keyword">public</span> List&lt;Tile&gt; tiles;     <span class="comment">// Tile data for drawing</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> width, height;     <span class="comment">// Computed object size</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> offsetX, offsetY;  <span class="comment">// Drawing offset</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Editor Data</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">string</span> name;           <span class="comment">// Object name for UI</span></div>
<div class="line">    <span class="keyword">public</span> ObjectOption options;  <span class="comment">// Flags: Door, Chest, Block, Torch, Stairs</span></div>
<div class="line">    <span class="keyword">public</span> DungeonLimits LimitClass; <span class="comment">// Object limits tracking</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> uniqueID;          <span class="comment">// Unique ID for undo/redo</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md480"></a>
Object Encoding Format (Critical!)</h2>
<p>ZScream uses <b>three different encoding formats</b> based on object ID range:</p>
<h3><a class="anchor" id="autotoc_md481"></a>
Type 1 Objects (ID 0x000-0x0FF) - Standard Objects</h3>
<p><b>Encoding</b>: <code>xxxxxxss yyyyyyss iiiiiiii</code></p>
<div class="fragment"><div class="line">Byte 1: (X &lt;&lt; 2) | ((Size &gt;&gt; 2) &amp; 0x03)</div>
<div class="line">Byte 2: (Y &lt;&lt; 2) | (Size &amp; 0x03)</div>
<div class="line">Byte 3: Object ID (0x00-0xFF)</div>
</div><!-- fragment --><p><b>Decoding</b>: </p><div class="fragment"><div class="line">X = (Byte1 &amp; 0xFC) &gt;&gt; 2          // Bits 2-7 = X position</div>
<div class="line">Y = (Byte2 &amp; 0xFC) &gt;&gt; 2          // Bits 2-7 = Y position</div>
<div class="line">Size = ((Byte1 &amp; 0x03) &lt;&lt; 2) | (Byte2 &amp; 0x03)  // Size 0-15</div>
<div class="line">ID = Byte3                        // Object ID</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md482"></a>
Type 2 Objects (ID 0x100-0x1FF) - Special Objects</h3>
<p><b>Encoding</b>: <code>111111xx xxxxyyyy yyiiiiii</code></p>
<div class="fragment"><div class="line">Byte 1: 0xFC | ((X &amp; 0x30) &gt;&gt; 4)        // 0xFC-0xFF</div>
<div class="line">Byte 2: ((X &amp; 0x0F) &lt;&lt; 4) | ((Y &amp; 0x3C) &gt;&gt; 2)</div>
<div class="line">Byte 3: ((Y &amp; 0x03) &lt;&lt; 6) | (ID &amp; 0x3F)</div>
</div><!-- fragment --><p><b>Decoding</b>: </p><div class="fragment"><div class="line">X = ((Byte1 &amp; 0x03) &lt;&lt; 4) | ((Byte2 &amp; 0xF0) &gt;&gt; 4)  // X position</div>
<div class="line">Y = ((Byte2 &amp; 0x0F) &lt;&lt; 2) | ((Byte3 &amp; 0xC0) &gt;&gt; 6)  // Y position</div>
<div class="line">ID = (Byte3 &amp; 0x3F) | 0x100                         // Object ID</div>
<div class="line">Size = 0  // No size parameter</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md483"></a>
Type 3 Objects (ID 0xF00-0xFFF) - Extended Objects</h3>
<p><b>Encoding</b>: <code>xxxxxxii yyyyyyii 11111iii</code></p>
<div class="fragment"><div class="line">Byte 1: (X &lt;&lt; 2) | (ID &amp; 0x03)</div>
<div class="line">Byte 2: (Y &lt;&lt; 2) | ((ID &gt;&gt; 2) &amp; 0x03)</div>
<div class="line">Byte 3: (ID &gt;&gt; 4) &amp; 0xFF              // 0xF0-0xFF</div>
</div><!-- fragment --><p><b>Decoding</b>: </p><div class="fragment"><div class="line">X = (Byte1 &amp; 0xFC) &gt;&gt; 2</div>
<div class="line">Y = (Byte2 &amp; 0xFC) &gt;&gt; 2</div>
<div class="line">ID = ((Byte3 &lt;&lt; 4) &amp; 0xF00) | ((Byte2 &amp; 0x03) &lt;&lt; 2) | (Byte1 &amp; 0x03) | 0x80</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md484"></a>
Layer and Door Markers</h2>
<p>Objects are organized in <b>layers</b> separated by special markers:</p>
<div class="fragment"><div class="line">[Floor/Layout byte]</div>
<div class="line">[Layout configuration byte]</div>
<div class="line">&lt;Layer 1 Objects&gt;</div>
<div class="line">0xFF 0xFF  &lt;- Layer 1 End</div>
<div class="line">&lt;Layer 2 Objects&gt;</div>
<div class="line">0xFF 0xFF  &lt;- Layer 2 End</div>
<div class="line">&lt;Layer 3 Objects&gt;</div>
<div class="line">[Optional Door Section]</div>
<div class="line">0xF0 0xFF  &lt;- Door Section Marker</div>
<div class="line">&lt;Door Objects (2 bytes each)&gt;</div>
<div class="line">0xFF 0xFF  &lt;- End of Room</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md485"></a>
Object Loading Process (ZScream)</h2>
<div class="fragment"><div class="line"><span class="comment">// 1. Get room object pointer (3 bytes)</span></div>
<div class="line"><span class="keywordtype">int</span> object_pointer = ROM at (room_object_pointer + room_id * 3)</div>
<div class="line"><span class="keywordtype">int</span> objects_location = <a class="code hl_function" href="../../d8/d2e/room__integration__test_8cc.html#a61a9e6bd5f106106e0aa16d549b241c8">SnesToPc</a>(object_pointer)</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 2. Read floor/layout</span></div>
<div class="line"><span class="keywordtype">byte</span> floor1 = data[objects_location] &amp; 0x0F</div>
<div class="line"><span class="keywordtype">byte</span> floor2 = (data[objects_location] &gt;&gt; 4) &amp; 0x0F</div>
<div class="line"><span class="keywordtype">byte</span> layout = (data[objects_location + 1] &gt;&gt; 2) &amp; 0x07</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3. Parse objects</span></div>
<div class="line"><span class="keywordtype">int</span> pos = objects_location + 2</div>
<div class="line"><span class="keywordtype">int</span> layer = 0</div>
<div class="line"><span class="keywordtype">bool</span> door = <span class="keyword">false</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <span class="keywordtype">byte</span> b1 = data[pos]</div>
<div class="line">    <span class="keywordtype">byte</span> b2 = data[pos + 1]</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Check for layer end</span></div>
<div class="line">    <span class="keywordflow">if</span> (b1 == 0xFF &amp;&amp; b2 == 0xFF) {</div>
<div class="line">        layer++</div>
<div class="line">        pos += 2</div>
<div class="line">        <span class="keywordflow">if</span> (layer == 3) <span class="keywordflow">break</span></div>
<div class="line">        <span class="keywordflow">continue</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Check for door section</span></div>
<div class="line">    <span class="keywordflow">if</span> (b1 == 0xF0 &amp;&amp; b2 == 0xFF) {</div>
<div class="line">        door = <span class="keyword">true</span></div>
<div class="line">        pos += 2</div>
<div class="line">        <span class="keywordflow">continue</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">byte</span> b3 = data[pos + 2]</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (!door) {</div>
<div class="line">        <span class="comment">// Decode object based on type</span></div>
<div class="line">        RoomObject obj = DecodeObject(b1, b2, b3, layer)</div>
<div class="line">        tilesObjects.Add(obj)</div>
<div class="line">        pos += 3</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Decode door (2 bytes)</span></div>
<div class="line">        door_pos = b1 &gt;&gt; 3</div>
<div class="line">        door_dir = b1 &amp; 0x07</div>
<div class="line">        door_type = b2</div>
<div class="line">        <span class="comment">// Create door object</span></div>
<div class="line">        pos += 2</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aroom__integration__test_8cc_html_a61a9e6bd5f106106e0aa16d549b241c8"><div class="ttname"><a href="../../d8/d2e/room__integration__test_8cc.html#a61a9e6bd5f106106e0aa16d549b241c8">SnesToPc</a></div><div class="ttdeci">int SnesToPc(int addr)</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d2e/room__integration__test_8cc_source.html#l00012">room_integration_test.cc:12</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md486"></a>
Object Saving Process (ZScream)</h2>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">byte</span>[] getTilesBytes()</div>
<div class="line">{</div>
<div class="line">    List&lt;byte&gt; objectsBytes = <span class="keyword">new</span> List&lt;byte&gt;();</div>
<div class="line">    List&lt;byte&gt; doorsBytes = <span class="keyword">new</span> List&lt;byte&gt;();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 1. Write floor/layout</span></div>
<div class="line">    <span class="keywordtype">byte</span> floorbyte = (byte)((floor2 &lt;&lt; 4) + floor1);</div>
<div class="line">    <span class="keywordtype">byte</span> layoutbyte = (byte)(layout &lt;&lt; 2);</div>
<div class="line">    objectsBytes.Add(floorbyte);</div>
<div class="line">    objectsBytes.Add(layoutbyte);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 2. Write Layer 1</span></div>
<div class="line">    <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> <span class="keywordflow">in</span> layer0_objects) {</div>
<div class="line">        <span class="keywordtype">byte</span>[] encoded = EncodeObject(<span class="keywordtype">object</span>);</div>
<div class="line">        objectsBytes.AddRange(encoded);</div>
<div class="line">    }</div>
<div class="line">    objectsBytes.Add(0xFF);</div>
<div class="line">    objectsBytes.Add(0xFF);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 3. Write Layer 2</span></div>
<div class="line">    <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> <span class="keywordflow">in</span> layer1_objects) {</div>
<div class="line">        <span class="keywordtype">byte</span>[] encoded = EncodeObject(<span class="keywordtype">object</span>);</div>
<div class="line">        objectsBytes.AddRange(encoded);</div>
<div class="line">    }</div>
<div class="line">    objectsBytes.Add(0xFF);</div>
<div class="line">    objectsBytes.Add(0xFF);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 4. Write Layer 3</span></div>
<div class="line">    <span class="keywordflow">foreach</span> (<span class="keywordtype">object</span> <span class="keywordflow">in</span> layer2_objects) {</div>
<div class="line">        <span class="keywordtype">byte</span>[] encoded = EncodeObject(<span class="keywordtype">object</span>);</div>
<div class="line">        objectsBytes.AddRange(encoded);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// 5. Write Doors if any</span></div>
<div class="line">    <span class="keywordflow">if</span> (has_doors) {</div>
<div class="line">        objectsBytes.Add(0xF0);</div>
<div class="line">        objectsBytes.Add(0xFF);</div>
<div class="line">        objectsBytes.AddRange(doorsBytes);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    objectsBytes.Add(0xFF);</div>
<div class="line">    objectsBytes.Add(0xFF);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> objectsBytes.ToArray();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md487"></a>
Object Tile Loading (ZScream)</h2>
<p>Each object references tile data from ROM tables:</p>
<div class="fragment"><div class="line"><span class="comment">// Get tile pointer from subtype table</span></div>
<div class="line"><span class="keywordtype">int</span> tile_ptr = GetSubtypeTablePointer(object_id);</div>
<div class="line"><span class="keywordtype">int</span> tile_pos = ROM[tile_ptr] + ROM[tile_ptr+1] &lt;&lt; 8;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Load tiles (each tile is 2 bytes: ID and properties)</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tile_count; i++) {</div>
<div class="line">    <span class="keywordtype">byte</span> tile_id = ROM[tile_pos + i*2];</div>
<div class="line">    <span class="keywordtype">byte</span> tile_prop = ROM[tile_pos + i*2 + 1];</div>
<div class="line">    </div>
<div class="line">    Tile tile = <span class="keyword">new</span> Tile(tile_id, tile_prop);</div>
<div class="line">    <span class="keywordtype">object</span>.tiles.Add(tile);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md488"></a>
Object Drawing (ZScream)</h2>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> Draw()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Calculate object dimensions based on size</span></div>
<div class="line">    width = basewidth + (sizewidth * Size);</div>
<div class="line">    height = baseheight + (sizeheight * Size);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Draw each tile at computed position</span></div>
<div class="line">    <span class="keywordflow">foreach</span> (Tile tile <span class="keywordflow">in</span> tiles) {</div>
<div class="line">        draw_tile(tile, tile_x * 8, tile_y * 8);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Tile drawing writes to background buffers</span></div>
<div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> draw_tile(Tile t, <span class="keywordtype">int</span> xx, <span class="keywordtype">int</span> yy)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> buffer_index = ((xx / 8) + offsetX + nx) + </div>
<div class="line">                       ((ny + offsetY + (yy / 8)) * 64);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (Layer == BG1) {</div>
<div class="line">        tilesBg1Buffer[buffer_index] = t.GetTileInfo();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (Layer == BG2) {</div>
<div class="line">        tilesBg2Buffer[buffer_index] = t.GetTileInfo();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md490"></a>
ROM Data Structure Reference</h1>
<h2><a class="anchor" id="autotoc_md491"></a>
Key ROM Addresses (from ALTTP Disassembly)</h2>
<div class="fragment"><div class="line"># Room Headers</div>
<div class="line">room_object_pointer         = 0x874C   # Long pointer to room object data</div>
<div class="line">room_object_layout_pointer  = 0x882D   # Pointer to layout data</div>
<div class="line">kRoomHeaderPointer          = 0xB5DD   # Long pointer to room headers</div>
<div class="line">kRoomHeaderPointerBank      = 0xB5E7   # Bank byte</div>
<div class="line"> </div>
<div class="line"># Graphics</div>
<div class="line">gfx_groups_pointer          = 0x6237   # Graphics groups</div>
<div class="line">blocks_pointer1-4           = 0x15AFA-0x15B0F  # Block data pointers</div>
<div class="line">dungeons_palettes           = 0xDD734  # Palette data</div>
<div class="line">sprite_blockset_pointer     = 0x5B57   # Sprite blocksets</div>
<div class="line"> </div>
<div class="line"># Sprites</div>
<div class="line">rooms_sprite_pointer        = 0x4C298  # 2-byte bank pointer</div>
<div class="line">sprites_data                = 0x4D8B0  # Sprite data</div>
<div class="line">sprites_end_data            = 0x4EC9E  # End of sprite data</div>
<div class="line"> </div>
<div class="line"># Chests</div>
<div class="line">chests_length_pointer       = 0xEBF6   # Chest count</div>
<div class="line">chests_data_pointer1        = 0xEBFB   # Chest data pointer</div>
<div class="line"> </div>
<div class="line"># Doors</div>
<div class="line">door_gfx_up/down/left/right = 0x4D9E-0x4EC6  # Door graphics</div>
<div class="line">door_pos_up/down/left/right = 0x197E-0x19C6  # Door positions</div>
<div class="line"> </div>
<div class="line"># Torches, Blocks, Pits</div>
<div class="line">torch_data                  = 0x2736A  # Torch data</div>
<div class="line">torches_length_pointer      = 0x88C1   # Torch count</div>
<div class="line">blocks_length               = 0x8896   # Block count</div>
<div class="line">pit_pointer                 = 0x394AB  # Pit data</div>
<div class="line">pit_count                   = 0x394A6  # Pit count</div>
<div class="line"> </div>
<div class="line"># Messages</div>
<div class="line">messages_id_dungeon         = 0x3F61D  # Message IDs</div>
<div class="line"> </div>
<div class="line"># Object Subtypes (Tile Data Tables)</div>
<div class="line">kRoomObjectSubtype1         = 0x8000   # Type 1 table</div>
<div class="line">kRoomObjectSubtype2         = 0x83F0   # Type 2 table</div>
<div class="line">kRoomObjectSubtype3         = 0x84F0   # Type 3 table</div>
<div class="line">kRoomObjectTileAddress      = 0x1B52   # Base tile address</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md492"></a>
Room Header Format (14 bytes)</h2>
<div class="fragment"><div class="line">Offset | Bits      | Description</div>
<div class="line">-------|-----------|------------------------------------------</div>
<div class="line">0      | 0-0       | Is Light (1 = light room, 0 = dark)</div>
<div class="line">0      | 2-4       | Collision type</div>
<div class="line">0      | 5-7       | Background2 type</div>
<div class="line">1      | 0-5       | Palette ID</div>
<div class="line">2      | 0-7       | Blockset ID</div>
<div class="line">3      | 0-7       | Spriteset ID</div>
<div class="line">4      | 0-7       | Effect</div>
<div class="line">5      | 0-7       | Tag 1</div>
<div class="line">6      | 0-7       | Tag 2</div>
<div class="line">7      | 2-3       | Staircase 1 plane</div>
<div class="line">7      | 4-5       | Staircase 2 plane</div>
<div class="line">7      | 6-7       | Staircase 3 plane</div>
<div class="line">8      | 0-1       | Staircase 4 plane</div>
<div class="line">9      | 0-7       | Holewarp room</div>
<div class="line">10     | 0-7       | Staircase 1 room</div>
<div class="line">11     | 0-7       | Staircase 2 room</div>
<div class="line">12     | 0-7       | Staircase 3 room</div>
<div class="line">13     | 0-7       | Staircase 4 room</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md493"></a>
Object Data Format</h2>
<div class="fragment"><div class="line">[Floor/Layout - 2 bytes]</div>
<div class="line">  Byte 0: floor1 (bits 0-3), floor2 (bits 4-7)</div>
<div class="line">  Byte 1: layout (bits 2-4)</div>
<div class="line"> </div>
<div class="line">[Layer 1 Objects]</div>
<div class="line">  For each object: 3 bytes (Type1/Type2/Type3 encoding)</div>
<div class="line"> </div>
<div class="line">[Layer 1 End Marker]</div>
<div class="line">  0xFF 0xFF</div>
<div class="line"> </div>
<div class="line">[Layer 2 Objects]</div>
<div class="line">  For each object: 3 bytes (Type1/Type2/Type3 encoding)</div>
<div class="line"> </div>
<div class="line">[Layer 2 End Marker]</div>
<div class="line">  0xFF 0xFF</div>
<div class="line"> </div>
<div class="line">[Layer 3 Objects]</div>
<div class="line">  For each object: 3 bytes (Type1/Type2/Type3 encoding)</div>
<div class="line"> </div>
<div class="line">[Optional: Door Section]</div>
<div class="line">  0xF0 0xFF (Door section marker)</div>
<div class="line">  For each door: 2 bytes</div>
<div class="line">    Byte 1: door_pos (bits 3-7), door_dir (bits 0-2)</div>
<div class="line">    Byte 2: door_type</div>
<div class="line"> </div>
<div class="line">[End Marker]</div>
<div class="line">  0xFF 0xFF</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md494"></a>
Tile Data Format</h2>
<div class="fragment"><div class="line">Each Tile16 (metatile) consists of 4 Tile8s (8x8 tiles):</div>
<div class="line">  Word 0: Top-left tile</div>
<div class="line">  Word 1: Top-right tile</div>
<div class="line">  Word 2: Bottom-left tile</div>
<div class="line">  Word 3: Bottom-right tile</div>
<div class="line"> </div>
<div class="line">Each Word encodes:</div>
<div class="line">  Bits 0-9:   Tile ID (0-1023)</div>
<div class="line">  Bit 10:     Horizontal flip</div>
<div class="line">  Bit 11:     Vertical flip</div>
<div class="line">  Bits 12-14: Palette (0-7)</div>
<div class="line">  Bit 15:     Priority</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md496"></a>
Implementation Tasks</h1>
<h2><a class="anchor" id="autotoc_md497"></a>
Phase 1: Core Object System (HIGH PRIORITY)</h2>
<h3><a class="anchor" id="autotoc_md498"></a>
Task 1.1: Object Encoding/Decoding ✅ CRITICAL</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/da0/room__object_8cc.html">src/app/zelda3/dungeon/room_object.cc</a></code>, <code><a class="el" href="../../d0/dff/room__object_8h.html">room_object.h</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Implement <code>DecodeObjectFromBytes(byte b1, byte b2, byte b3, layer)</code></li>
<li>Implement <code>EncodeObjectToBytes(RoomObject) -&gt; [byte, byte, byte]</code></li>
<li>Handle Type1, Type2, Type3 encoding schemes correctly</li>
<li>Add unit tests for encoding/decoding round-trips</li>
</ul>
<p><b>Dependencies</b>: None</p>
<p><b>Estimated Time</b>: 3-4 hours</p>
<p><b>Implementation Details</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// Add to room_object.h</span></div>
<div class="line"><span class="keyword">struct </span>ObjectBytes {</div>
<div class="line">  uint8_t b1;</div>
<div class="line">  uint8_t b2;</div>
<div class="line">  uint8_t b3;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Decode object from 3-byte ROM format</span></div>
<div class="line"><span class="keyword">static</span> RoomObject DecodeObjectFromBytes(uint8_t b1, uint8_t b2, uint8_t b3, </div>
<div class="line">                                         uint8_t layer);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Encode object to 3-byte ROM format  </span></div>
<div class="line">ObjectBytes EncodeObjectToBytes() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Determine object type from bytes</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> DetermineObjectType(uint8_t b1, uint8_t b3);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md499"></a>
Task 1.2: Enhanced Object Parsing ✅ CRITICAL</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/d1b/room_8cc.html">src/app/zelda3/dungeon/room.cc</a></code>, <code><a class="el" href="../../d9/dc0/room_8h.html">room.h</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Refactor <code>ParseObjectsFromLocation()</code> to handle all 3 layers</li>
<li>Implement door section parsing (0xF0 FF marker)</li>
<li>Track objects by layer properly</li>
<li>Handle layer end markers (0xFF FF)</li>
</ul>
<p><b>Dependencies</b>: Task 1.1</p>
<p><b>Estimated Time</b>: 4-5 hours</p>
<p><b>Implementation Details</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// Add to room.h</span></div>
<div class="line"><span class="keyword">struct </span>LayeredObjects {</div>
<div class="line">  std::vector&lt;RoomObject&gt; layer1;</div>
<div class="line">  std::vector&lt;RoomObject&gt; layer2;</div>
<div class="line">  std::vector&lt;RoomObject&gt; layer3;</div>
<div class="line">  std::vector&lt;DoorObject&gt; doors;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Enhanced parsing with layer separation</span></div>
<div class="line">absl::Status ParseLayeredObjects(<span class="keywordtype">int</span> objects_location, </div>
<div class="line">                                  LayeredObjects&amp; out_objects);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md500"></a>
Task 1.3: Object Tile Loading ✅ CRITICAL</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/da0/room__object_8cc.html">src/app/zelda3/dungeon/room_object.cc</a></code>, <code><a class="el" href="../../d5/da7/object__parser_8cc.html">object_parser.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Implement proper tile loading from subtype tables</li>
<li>Load tiles based on object ID and subtype</li>
<li>Cache tile data for performance</li>
<li>Handle animated tiles</li>
</ul>
<p><b>Dependencies</b>: Task 1.1</p>
<p><b>Estimated Time</b>: 4-5 hours</p>
<p><b>Implementation Details</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// Enhance RoomObject::EnsureTilesLoaded()</span></div>
<div class="line">absl::Status LoadTilesFromSubtypeTable(<span class="keywordtype">int</span> object_id);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get subtype table info</span></div>
<div class="line">SubtypeTableInfo GetSubtypeTable(<span class="keywordtype">int</span> object_id);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Load tile data from ROM</span></div>
<div class="line">absl::StatusOr&lt;std::vector&lt;gfx::Tile16&gt;&gt; LoadTileData(<span class="keywordtype">int</span> tile_ptr);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md501"></a>
Task 1.4: Object Drawing System ⚠️ HIGH PRIORITY</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/dc5/object__renderer_8cc.html">src/app/zelda3/dungeon/object_renderer.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Implement proper object rendering with tiles</li>
<li>Draw objects at correct positions with proper offsets</li>
<li>Handle object sizing based on Size parameter</li>
<li>Render to correct background layer (BG1/BG2/BG3)</li>
</ul>
<p><b>Dependencies</b>: Task 1.3</p>
<p><b>Estimated Time</b>: 5-6 hours</p>
<p><b>Implementation Details</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// Enhanced rendering</span></div>
<div class="line">absl::Status RenderObjectWithTiles(<span class="keyword">const</span> RoomObject&amp; <span class="keywordtype">object</span>,</div>
<div class="line">                                     <span class="keyword">const</span> gfx::SnesPalette&amp; palette,</div>
<div class="line">                                     std::vector&lt;uint8_t&gt;&amp; bg1_buffer,</div>
<div class="line">                                     std::vector&lt;uint8_t&gt;&amp; bg2_buffer);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Compute object dimensions</span></div>
<div class="line"><span class="keywordtype">void</span> ComputeObjectDimensions(RoomObject&amp; <span class="keywordtype">object</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw individual tile</span></div>
<div class="line"><span class="keywordtype">void</span> DrawTileToBuffer(<span class="keyword">const</span> gfx::Tile16&amp; tile, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y,</div>
<div class="line">                      std::vector&lt;uint8_t&gt;&amp; buffer);</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md503"></a>
Phase 2: Editor UI Integration (MEDIUM PRIORITY)</h2>
<h3><a class="anchor" id="autotoc_md504"></a>
Task 2.1: Object Placement System</h3>
<p><b>Files</b>: <code><a class="el" href="../../d8/d1f/dungeon__object__interaction_8cc.html">src/app/editor/dungeon/dungeon_object_interaction.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Implement click-to-place object system</li>
<li>Snap objects to grid</li>
<li>Show preview of object before placement</li>
<li>Validate object placement (limits, collisions)</li>
</ul>
<p><b>Dependencies</b>: Phase 1 complete</p>
<p><b>Estimated Time</b>: 4-5 hours</p>
<h3><a class="anchor" id="autotoc_md505"></a>
Task 2.2: Object Selection System</h3>
<p><b>Files</b>: <code><a class="el" href="../../d8/d1f/dungeon__object__interaction_8cc.html">src/app/editor/dungeon/dungeon_object_interaction.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Click to select objects</li>
<li>Drag to move objects</li>
<li>Multi-select with box selection</li>
<li>Show selection highlight</li>
</ul>
<p><b>Dependencies</b>: Task 2.1</p>
<p><b>Estimated Time</b>: 3-4 hours</p>
<h3><a class="anchor" id="autotoc_md506"></a>
Task 2.3: Object Properties Editor</h3>
<p><b>Files</b>: <code><a class="el" href="../../dc/dcc/dungeon__object__selector_8cc.html">src/app/editor/dungeon/dungeon_object_selector.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Show object properties in sidebar</li>
<li>Edit object properties (X, Y, Size, Layer)</li>
<li>Change object type</li>
<li>Real-time preview of changes</li>
</ul>
<p><b>Dependencies</b>: Task 2.2</p>
<p><b>Estimated Time</b>: 3-4 hours</p>
<h3><a class="anchor" id="autotoc_md507"></a>
Task 2.4: Layer Management UI</h3>
<p><b>Files</b>: <code><a class="el" href="../../da/d46/dungeon__editor_8cc.html">src/app/editor/dungeon/dungeon_editor.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Layer visibility toggles</li>
<li>Active layer selection</li>
<li>Layer opacity controls</li>
<li>Show layer indicators</li>
</ul>
<p><b>Dependencies</b>: Task 2.1</p>
<p><b>Estimated Time</b>: 2-3 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md509"></a>
Phase 3: Save System (HIGH PRIORITY)</h2>
<h3><a class="anchor" id="autotoc_md510"></a>
Task 3.1: Room Object Encoding ✅ CRITICAL</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/d1b/room_8cc.html">src/app/zelda3/dungeon/room.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Implement <code>SerializeRoomObjects() -&gt; byte[]</code></li>
<li>Encode objects by layer with proper markers</li>
<li>Handle door section separately</li>
<li>Maintain floor/layout bytes</li>
</ul>
<p><b>Dependencies</b>: Task 1.1</p>
<p><b>Estimated Time</b>: 4-5 hours</p>
<p><b>Implementation Details</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// Add to room.h</span></div>
<div class="line"><span class="keyword">struct </span>SerializedRoomData {</div>
<div class="line">  std::vector&lt;uint8_t&gt; data;</div>
<div class="line">  <span class="keywordtype">int</span> size;</div>
<div class="line">  <span class="keywordtype">int</span> original_size;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Serialize all room objects to ROM format</span></div>
<div class="line">absl::StatusOr&lt;SerializedRoomData&gt; SerializeRoomObjects();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Encode objects for one layer</span></div>
<div class="line">std::vector&lt;uint8_t&gt; EncodeLayer(<span class="keyword">const</span> std::vector&lt;RoomObject&gt;&amp; objects);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Encode door section</span></div>
<div class="line">std::vector&lt;uint8_t&gt; EncodeDoors(<span class="keyword">const</span> std::vector&lt;DoorObject&gt;&amp; doors);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md511"></a>
Task 3.2: ROM Writing System</h3>
<p><b>Files</b>: <code><a class="el" href="../../d4/d79/app_2rom_8cc.html">src/app/rom.cc</a></code>, <code><a class="el" href="../../d5/d1b/room_8cc.html">src/app/zelda3/dungeon/room.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Write serialized object data back to ROM</li>
<li>Update room pointers if size changed</li>
<li>Handle room size expansion</li>
<li>Validate written data</li>
</ul>
<p><b>Dependencies</b>: Task 3.1</p>
<p><b>Estimated Time</b>: 5-6 hours</p>
<h3><a class="anchor" id="autotoc_md512"></a>
Task 3.3: Save Validation</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/d1b/room_8cc.html">src/app/zelda3/dungeon/room.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Verify encoded data matches original format</li>
<li>Check object limits (sprites, doors, chests)</li>
<li>Validate room size constraints</li>
<li>Round-trip testing (load -&gt; save -&gt; load)</li>
</ul>
<p><b>Dependencies</b>: Task 3.2</p>
<p><b>Estimated Time</b>: 3-4 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md514"></a>
Phase 4: Advanced Features (LOW PRIORITY)</h2>
<h3><a class="anchor" id="autotoc_md515"></a>
Task 4.1: Undo/Redo System</h3>
<p><b>Files</b>: <code><a class="el" href="../../da/d13/dungeon__editor__system_8cc.html">src/app/zelda3/dungeon/dungeon_editor_system.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Track object changes</li>
<li>Implement undo stack</li>
<li>Implement redo stack</li>
<li>Handle multiple operations</li>
</ul>
<p><b>Dependencies</b>: Phase 2, Phase 3</p>
<p><b>Estimated Time</b>: 5-6 hours</p>
<h3><a class="anchor" id="autotoc_md516"></a>
Task 4.2: Copy/Paste Objects</h3>
<p><b>Files</b>: <code><a class="el" href="../../d8/d1f/dungeon__object__interaction_8cc.html">src/app/editor/dungeon/dungeon_object_interaction.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Copy selected objects</li>
<li>Paste with offset</li>
<li>Duplicate objects</li>
<li>Paste across rooms</li>
</ul>
<p><b>Dependencies</b>: Task 2.2</p>
<p><b>Estimated Time</b>: 2-3 hours</p>
<h3><a class="anchor" id="autotoc_md517"></a>
Task 4.3: Object Library/Templates</h3>
<p><b>Files</b>: <code><a class="el" href="../../dc/dcc/dungeon__object__selector_8cc.html">src/app/editor/dungeon/dungeon_object_selector.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Save common object configurations</li>
<li>Load object templates</li>
<li>Share templates across rooms</li>
<li>Import/export templates</li>
</ul>
<p><b>Dependencies</b>: Phase 2</p>
<p><b>Estimated Time</b>: 4-5 hours</p>
<h3><a class="anchor" id="autotoc_md518"></a>
Task 4.4: Room Import/Export</h3>
<p><b>Files</b>: <code><a class="el" href="../../d5/d1b/room_8cc.html">src/app/zelda3/dungeon/room.cc</a></code></p>
<p><b>Objectives</b>:</p><ul>
<li>Export room to JSON/binary</li>
<li>Import room from file</li>
<li>Batch export/import</li>
<li>Room comparison tools</li>
</ul>
<p><b>Dependencies</b>: Phase 3</p>
<p><b>Estimated Time</b>: 5-6 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md520"></a>
Technical Architecture</h1>
<h2><a class="anchor" id="autotoc_md521"></a>
Class Hierarchy</h2>
<div class="fragment"><div class="line">Rom</div>
<div class="line">├── Room (296 rooms)</div>
<div class="line">│   ├── RoomHeader (14 bytes)</div>
<div class="line">│   ├── RoomLayout (structural elements)</div>
<div class="line">│   ├── std::vector&lt;RoomObject&gt; (tile objects)</div>
<div class="line">│   │   ├── RoomObject (base)</div>
<div class="line">│   │   ├── Subtype1 (Type1 objects)</div>
<div class="line">│   │   ├── Subtype2 (Type2 objects)</div>
<div class="line">│   │   └── Subtype3 (Type3 objects)</div>
<div class="line">│   ├── std::vector&lt;DoorObject&gt; (doors)</div>
<div class="line">│   ├── std::vector&lt;Sprite&gt; (sprites)</div>
<div class="line">│   └── std::vector&lt;chest_data&gt; (chests)</div>
<div class="line">└── DungeonEditor</div>
<div class="line">    ├── DungeonEditorSystem (editing logic)</div>
<div class="line">    ├── DungeonObjectEditor (object manipulation)</div>
<div class="line">    ├── ObjectRenderer (rendering)</div>
<div class="line">    ├── ObjectParser (parsing)</div>
<div class="line">    ├── DungeonCanvasViewer (display)</div>
<div class="line">    ├── DungeonObjectSelector (object palette)</div>
<div class="line">    └── DungeonObjectInteraction (mouse/keyboard)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md522"></a>
Data Flow</h2>
<div class="fragment"><div class="line">ROM File</div>
<div class="line">    ↓</div>
<div class="line">[LoadRoomFromRom]</div>
<div class="line">    ↓</div>
<div class="line">Room Header → Room Properties</div>
<div class="line">    ↓</div>
<div class="line">[ParseObjectsFromLocation]</div>
<div class="line">    ↓</div>
<div class="line">Object Bytes (3-byte format)</div>
<div class="line">    ↓</div>
<div class="line">[DecodeObjectFromBytes]</div>
<div class="line">    ↓</div>
<div class="line">RoomObject instances</div>
<div class="line">    ↓</div>
<div class="line">[LoadTilesFromSubtypeTable]</div>
<div class="line">    ↓</div>
<div class="line">Tile data loaded</div>
<div class="line">    ↓</div>
<div class="line">[RenderObjectWithTiles]</div>
<div class="line">    ↓</div>
<div class="line">Display on Canvas</div>
<div class="line">    ↓</div>
<div class="line">User Edits</div>
<div class="line">    ↓</div>
<div class="line">[SerializeRoomObjects]</div>
<div class="line">    ↓</div>
<div class="line">Object Bytes (3-byte format)</div>
<div class="line">    ↓</div>
<div class="line">[WriteToRom]</div>
<div class="line">    ↓</div>
<div class="line">ROM File Updated</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md523"></a>
Key Algorithms</h2>
<h3><a class="anchor" id="autotoc_md524"></a>
Object Type Detection</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> DetermineObjectType(uint8_t b1, uint8_t b3) {</div>
<div class="line">  <span class="comment">// Type 3: b3 &gt;= 0xF8 or b1 &gt;= 0xFC with b3 &gt;= 0xF0</span></div>
<div class="line">  <span class="keywordflow">if</span> (b3 &gt;= 0xF8) <span class="keywordflow">return</span> 3;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Type 2: b1 &gt;= 0xFC</span></div>
<div class="line">  <span class="keywordflow">if</span> (b1 &gt;= 0xFC) <span class="keywordflow">return</span> 2;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Type 1: default</span></div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md525"></a>
Object Decoding</h3>
<div class="fragment"><div class="line">RoomObject DecodeObjectFromBytes(uint8_t b1, uint8_t b2, uint8_t b3, uint8_t layer) {</div>
<div class="line">  <span class="keywordtype">int</span> type = DetermineObjectType(b1, b3);</div>
<div class="line">  </div>
<div class="line">  uint8_t x, y, size;</div>
<div class="line">  uint16_t id;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">switch</span> (type) {</div>
<div class="line">    <span class="keywordflow">case</span> 1:  <span class="comment">// Type1: xxxxxxss yyyyyyss iiiiiiii</span></div>
<div class="line">      x = (b1 &amp; 0xFC) &gt;&gt; 2;</div>
<div class="line">      y = (b2 &amp; 0xFC) &gt;&gt; 2;</div>
<div class="line">      size = ((b1 &amp; 0x03) &lt;&lt; 2) | (b2 &amp; 0x03);</div>
<div class="line">      <span class="keywordtype">id</span> = b3;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> 2:  <span class="comment">// Type2: 111111xx xxxxyyyy yyiiiiii</span></div>
<div class="line">      x = ((b1 &amp; 0x03) &lt;&lt; 4) | ((b2 &amp; 0xF0) &gt;&gt; 4);</div>
<div class="line">      y = ((b2 &amp; 0x0F) &lt;&lt; 2) | ((b3 &amp; 0xC0) &gt;&gt; 6);</div>
<div class="line">      size = 0;</div>
<div class="line">      <span class="keywordtype">id</span> = (b3 &amp; 0x3F) | 0x100;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> 3:  <span class="comment">// Type3: xxxxxxii yyyyyyii 11111iii</span></div>
<div class="line">      x = (b1 &amp; 0xFC) &gt;&gt; 2;</div>
<div class="line">      y = (b2 &amp; 0xFC) &gt;&gt; 2;</div>
<div class="line">      size = 0;</div>
<div class="line">      <span class="keywordtype">id</span> = ((b3 &amp; 0xFF) &lt;&lt; 4) | ((b2 &amp; 0x03) &lt;&lt; 2) | (b1 &amp; 0x03) | 0x80;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> RoomObject(<span class="keywordtype">id</span>, x, y, size, layer);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md526"></a>
Object Encoding</h3>
<div class="fragment"><div class="line">ObjectBytes EncodeObjectToBytes(<span class="keyword">const</span> RoomObject&amp; obj) {</div>
<div class="line">  ObjectBytes bytes;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (obj.id_ &gt;= 0xF00) {  <span class="comment">// Type 3</span></div>
<div class="line">    bytes.b1 = (obj.x_ &lt;&lt; 2) | (obj.id_ &amp; 0x03);</div>
<div class="line">    bytes.b2 = (obj.y_ &lt;&lt; 2) | ((obj.id_ &gt;&gt; 2) &amp; 0x03);</div>
<div class="line">    bytes.b3 = (obj.id_ &gt;&gt; 4) &amp; 0xFF;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj.id_ &gt;= 0x100) {  <span class="comment">// Type 2</span></div>
<div class="line">    bytes.b1 = 0xFC | ((obj.x_ &amp; 0x30) &gt;&gt; 4);</div>
<div class="line">    bytes.b2 = ((obj.x_ &amp; 0x0F) &lt;&lt; 4) | ((obj.y_ &amp; 0x3C) &gt;&gt; 2);</div>
<div class="line">    bytes.b3 = ((obj.y_ &amp; 0x03) &lt;&lt; 6) | (obj.id_ &amp; 0x3F);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {  <span class="comment">// Type 1</span></div>
<div class="line">    bytes.b1 = (obj.x_ &lt;&lt; 2) | ((obj.size_ &gt;&gt; 2) &amp; 0x03);</div>
<div class="line">    bytes.b2 = (obj.y_ &lt;&lt; 2) | (obj.size_ &amp; 0x03);</div>
<div class="line">    bytes.b3 = obj.id_;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> bytes;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md528"></a>
Testing Strategy</h1>
<h2><a class="anchor" id="autotoc_md529"></a>
Unit Tests</h2>
<h3><a class="anchor" id="autotoc_md530"></a>
Encoding/Decoding Tests</h3>
<div class="fragment"><div class="line">TEST(RoomObjectTest, EncodeDecodeType1) {</div>
<div class="line">  <span class="comment">// Create Type1 object</span></div>
<div class="line">  RoomObject obj(0x42, 10, 20, 3, 0);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Encode</span></div>
<div class="line">  <span class="keyword">auto</span> bytes = obj.EncodeObjectToBytes();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Decode</span></div>
<div class="line">  <span class="keyword">auto</span> decoded = RoomObject::DecodeObjectFromBytes(bytes.b1, bytes.b2, bytes.b3, 0);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Verify</span></div>
<div class="line">  EXPECT_EQ(decoded.id_, obj.id_);</div>
<div class="line">  EXPECT_EQ(decoded.x_, obj.x_);</div>
<div class="line">  EXPECT_EQ(decoded.y_, obj.y_);</div>
<div class="line">  EXPECT_EQ(decoded.size_, obj.size_);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(RoomObjectTest, EncodeDecodeType2) {</div>
<div class="line">  <span class="comment">// Type2 object</span></div>
<div class="line">  RoomObject obj(0x125, 15, 30, 0, 1);</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">auto</span> bytes = obj.EncodeObjectToBytes();</div>
<div class="line">  <span class="keyword">auto</span> decoded = RoomObject::DecodeObjectFromBytes(bytes.b1, bytes.b2, bytes.b3, 1);</div>
<div class="line">  </div>
<div class="line">  EXPECT_EQ(decoded.id_, obj.id_);</div>
<div class="line">  EXPECT_EQ(decoded.x_, obj.x_);</div>
<div class="line">  EXPECT_EQ(decoded.y_, obj.y_);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../d8/d01/namespaceyaze_1_1cli_1_1anonymous__namespace_02resource__catalog__test_8cc_03.html#a8a4b8ed88b34f98740dd871905b3e979">TEST</a>(RoomObjectTest, EncodeDecodeType3) {</div>
<div class="line">  <span class="comment">// Type3 object (chest)</span></div>
<div class="line">  RoomObject obj(0xF99, 5, 10, 0, 0);</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">auto</span> bytes = obj.EncodeObjectToBytes();</div>
<div class="line">  <span class="keyword">auto</span> decoded = RoomObject::DecodeObjectFromBytes(bytes.b1, bytes.b2, bytes.b3, 0);</div>
<div class="line">  </div>
<div class="line">  EXPECT_EQ(decoded.id_, obj.id_);</div>
<div class="line">  EXPECT_EQ(decoded.x_, obj.x_);</div>
<div class="line">  EXPECT_EQ(decoded.y_, obj.y_);</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceyaze_1_1cli_1_1anonymous__namespace_02resource__catalog__test_8cc_03_html_a8a4b8ed88b34f98740dd871905b3e979"><div class="ttname"><a href="../../d8/d01/namespaceyaze_1_1cli_1_1anonymous__namespace_02resource__catalog__test_8cc_03.html#a8a4b8ed88b34f98740dd871905b3e979">yaze::cli::anonymous_namespace{resource_catalog_test.cc}::TEST</a></div><div class="ttdeci">TEST(ResourceCatalogTest, SerializeResourceIncludesReturnsArray)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d72/resource__catalog__test_8cc_source.html#l00012">resource_catalog_test.cc:12</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md531"></a>
Room Parsing Tests</h3>
<div class="fragment"><div class="line">TEST(RoomTest, ParseObjectsWithLayers) {</div>
<div class="line">  <span class="comment">// Create test data with 3 layers</span></div>
<div class="line">  std::vector&lt;uint8_t&gt; data = {</div>
<div class="line">    0x12,        <span class="comment">// floor1/floor2</span></div>
<div class="line">    0x04,        <span class="comment">// layout</span></div>
<div class="line">    <span class="comment">// Layer 1</span></div>
<div class="line">    0x28, 0x50, 0x10,  <span class="comment">// Object 1</span></div>
<div class="line">    0xFF, 0xFF,        <span class="comment">// Layer 1 end</span></div>
<div class="line">    <span class="comment">// Layer 2</span></div>
<div class="line">    0x30, 0x60, 0x20,  <span class="comment">// Object 2</span></div>
<div class="line">    0xFF, 0xFF,        <span class="comment">// Layer 2 end</span></div>
<div class="line">    0xFF, 0xFF         <span class="comment">// End</span></div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  Room room;</div>
<div class="line">  <span class="keyword">auto</span> status = room.ParseObjectsFromData(data);</div>
<div class="line">  EXPECT_TRUE(status.ok());</div>
<div class="line">  EXPECT_EQ(room.GetTileObjects().size(), 2);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md532"></a>
Integration Tests</h2>
<h3><a class="anchor" id="autotoc_md533"></a>
Round-Trip Tests</h3>
<div class="fragment"><div class="line">TEST(IntegrationTest, LoadSaveLoadRoom) {</div>
<div class="line">  Rom rom(<span class="stringliteral">&quot;test_rom.sfc&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load room</span></div>
<div class="line">  Room room1 = LoadRoomFromRom(&amp;rom, 0x001);</div>
<div class="line">  <span class="keywordtype">size_t</span> original_objects = room1.GetTileObjects().size();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Save room</span></div>
<div class="line">  <span class="keyword">auto</span> serialized = room1.SerializeRoomObjects();</div>
<div class="line">  EXPECT_TRUE(serialized.ok());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Write to ROM</span></div>
<div class="line">  <span class="keyword">auto</span> write_status = rom.WriteRoomObjects(0x001, serialized.value());</div>
<div class="line">  EXPECT_TRUE(write_status.ok());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load again</span></div>
<div class="line">  Room room2 = LoadRoomFromRom(&amp;rom, 0x001);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Verify same objects</span></div>
<div class="line">  EXPECT_EQ(room2.GetTileObjects().size(), original_objects);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; original_objects; i++) {</div>
<div class="line">    EXPECT_EQ(room2.GetTileObject(i).id_, room1.GetTileObject(i).id_);</div>
<div class="line">    EXPECT_EQ(room2.GetTileObject(i).x_, room1.GetTileObject(i).x_);</div>
<div class="line">    EXPECT_EQ(room2.GetTileObject(i).y_, room1.GetTileObject(i).y_);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md534"></a>
Manual Testing</h2>
<h3><a class="anchor" id="autotoc_md535"></a>
Test Cases</h3>
<ol type="1">
<li><b>Basic Object Loading</b><ul>
<li>Load room with various object types</li>
<li>Verify all objects appear</li>
<li>Check object positions match ZScream</li>
</ul>
</li>
<li><b>Object Placement</b><ul>
<li>Place new objects in empty room</li>
<li>Move existing objects</li>
<li>Delete objects</li>
<li>Verify changes persist</li>
</ul>
</li>
<li><b>Layer Management</b><ul>
<li>Place objects on different layers</li>
<li>Toggle layer visibility</li>
<li>Verify layer separation</li>
</ul>
</li>
<li><b>Save/Load</b><ul>
<li>Edit multiple rooms</li>
<li>Save changes</li>
<li>Reload ROM</li>
<li>Verify all changes present</li>
</ul>
</li>
<li><b>Edge Cases</b><ul>
<li>Full rooms (many objects)</li>
<li>Empty rooms</li>
<li>Rooms with only doors</li>
<li>Large objects (max size)</li>
</ul>
</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md537"></a>
References</h1>
<h2><a class="anchor" id="autotoc_md538"></a>
Documentation</h2>
<ul>
<li><b>ZScream Source Code</b>: <code>/Users/scawful/Code/ZScreamDungeon/ZeldaFullEditor/Rooms/</code></li>
<li><b>Yaze Source Code</b>: <code>/Users/scawful/Code/yaze/src/app/zelda3/dungeon/</code></li>
<li><b>ALTTP Disassembly</b>: <code>/Users/scawful/Code/yaze/assets/asm/usdasm/</code></li>
<li><b>This Document</b>: <code>/Users/scawful/Code/yaze/docs/dungeon_editing_implementation_plan.md</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md539"></a>
Key Files</h2>
<h3><a class="anchor" id="autotoc_md540"></a>
ZScream (Reference)</h3>
<ul>
<li><code>Room.cs</code> - Main room class with object loading/saving</li>
<li><code>Room_Object.cs</code> - Object class with encoding/decoding</li>
<li><code>DungeonObjectData.cs</code> - Object tile data tables</li>
<li><code>GFX.cs</code> - Graphics management</li>
</ul>
<h3><a class="anchor" id="autotoc_md541"></a>
Yaze (Implementation)</h3>
<ul>
<li><code><a class="el" href="../../d9/dc0/room_8h.html">src/app/zelda3/dungeon/room.h</a>/cc</code> - Room class</li>
<li><code><a class="el" href="../../d0/dff/room__object_8h.html">src/app/zelda3/dungeon/room_object.h</a>/cc</code> - RoomObject class</li>
<li><code><a class="el" href="../../db/da4/object__parser_8h.html">src/app/zelda3/dungeon/object_parser.h</a>/cc</code> - Object parsing</li>
<li><code><a class="el" href="../../d7/d4a/object__renderer_8h.html">src/app/zelda3/dungeon/object_renderer.h</a>/cc</code> - Object rendering</li>
<li><code><a class="el" href="../../d6/df5/dungeon__editor_8h.html">src/app/editor/dungeon/dungeon_editor.h</a>/cc</code> - Main editor</li>
<li><code><a class="el" href="../../d4/ded/dungeon__object__interaction_8h.html">src/app/editor/dungeon/dungeon_object_interaction.h</a>/cc</code> - Object interaction</li>
</ul>
<h2><a class="anchor" id="autotoc_md542"></a>
External Resources</h2>
<ul>
<li><b>ALTTP Hacking Resources</b>: <a href="https://github.com/spannerisms/z3doc">https://github.com/spannerisms/z3doc</a></li>
<li><b>ROM Map</b>: <a href="https://www.zeldacodes.org/">https://www.zeldacodes.org/</a></li>
<li><b>Disassembly</b>: <a href="https://github.com/camthesaxman/zelda3">https://github.com/camthesaxman/zelda3</a></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md544"></a>
Appendix: Object ID Reference</h1>
<h2><a class="anchor" id="autotoc_md545"></a>
Type 1 Objects (0x00-0xFF)</h2>
<p>Common objects with size parameter:</p><ul>
<li>0x00-0x09: Walls (ceiling, top, bottom)</li>
<li>0x0A-0x20: Diagonal walls</li>
<li>0x21: Platform stairs</li>
<li>0x22: Rail</li>
<li>0x23-0x2E: Pit edges</li>
<li>0x2F-0x30: Rail walls</li>
<li>0x33: Carpet</li>
<li>0x34: Carpet trim</li>
<li>0x36-0x3E: Drapes, statues, columns</li>
<li>0x3F-0x45: Water edges</li>
<li>0x50-0x5F: Dungeon-specific decorations</li>
</ul>
<h2><a class="anchor" id="autotoc_md546"></a>
Type 2 Objects (0x100-0x1FF)</h2>
<p>Special fixed-size objects:</p><ul>
<li>0x100-0x10F: Corners (concave, convex)</li>
<li>0x110-0x11F: Kinked corners</li>
<li>0x120-0x12F: Decorative objects (braziers, statues)</li>
<li>0x130-0x13F: Functional objects (blocks, stairs, chests)</li>
<li>0x140-0x14F: Interactive objects (switches, torches)</li>
</ul>
<h2><a class="anchor" id="autotoc_md547"></a>
Type 3 Objects (0xF00-0xFFF)</h2>
<p>Extended special objects:</p><ul>
<li>0xF99: Small chest</li>
<li>0xFB1: Large chest</li>
<li>0xF80-0xF8F: Various stairs</li>
<li>0xF90-0xF9F: Special effects</li>
<li>0xFA0-0xFAF: Interactive elements</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md549"></a>
Status Tracking</h1>
<h2><a class="anchor" id="autotoc_md550"></a>
Current Progress</h2>
<ul>
<li>[x] Document created</li>
<li>[ ] Phase 1: Core Object System<ul>
<li>[ ] Task 1.1: Object Encoding/Decoding</li>
<li>[ ] Task 1.2: Enhanced Object Parsing</li>
<li>[ ] Task 1.3: Object Tile Loading</li>
<li>[ ] Task 1.4: Object Drawing System</li>
</ul>
</li>
<li>[ ] Phase 2: Editor UI Integration</li>
<li>[ ] Phase 3: Save System</li>
<li>[ ] Phase 4: Advanced Features</li>
</ul>
<h2><a class="anchor" id="autotoc_md551"></a>
Next Steps</h2>
<ol type="1">
<li><b>Start with Task 1.1</b> - Implement object encoding/decoding</li>
<li><b>Create unit tests</b> - Test all three object types</li>
<li><b>Verify with ZScream</b> - Compare results with known working implementation</li>
<li><b>Proceed to Task 1.2</b> - Once encoding/decoding is solid</li>
</ol>
<h2><a class="anchor" id="autotoc_md552"></a>
Timeline Estimate</h2>
<ul>
<li><b>Phase 1</b>: 16-20 hours (CRITICAL - Must be done first)</li>
<li><b>Phase 2</b>: 12-16 hours (Required for usability)</li>
<li><b>Phase 3</b>: 12-15 hours (Required for saving)</li>
<li><b>Phase 4</b>: 16-20 hours (Nice to have)</li>
</ul>
<p><b>Total</b>: 56-71 hours (7-9 full working days)</p>
<hr  />
<p><em>Document Version: 1.0</em> <br  />
 <em>Last Updated: October 4, 2025</em> <br  />
 <em>Author: AI Assistant with scawful</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
