<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Asm Style Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d9a/md_docs_2E1-asm-style-guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Asm Style Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md652"></a> 65816 Assembly is the assembly language used by the Super Nintendo Entertainment System (SNES) and its Ricoh 5A22 processor. This style guide provides conventions and best practices for writing 65816 assembly code in the context of the yaze project. Following these guidelines will help maintain consistency and readability across the codebase.</p>
<p>This guide is based primarily on the <a href="https://github.com/scawful/Oracle-of-Secrets">Oracle of Secrets</a> codebase and is meant for the <a href="https://github.com/RPGHacker/asar">Asar</a> assembler and derives influence from the <a href="https://rpghacker.github.io/asar/asar_19/manual/">Asar 1.9 Manual</a>.</p>
<p>Custom assembly code applied to the game should be included through the <code>yaze.asm</code> file found in <code>assets/asm</code>. This file can be applied to the ROM by the editor using the Asar library or included into a projects codebase for use with the Asar assembler.</p>
<h1><a class="anchor" id="autotoc_md653"></a>
Table of Contents</h1>
<ul>
<li>File Structure</li>
<li>Labels and Symbols</li>
<li>Comments</li>
<li>Directives</li>
<li>Instructions</li>
<li>Macros</li>
<li>Loops and Branching</li>
<li>Data Structures</li>
<li>Code Organization</li>
<li>Custom Code</li>
</ul>
<h1><a class="anchor" id="autotoc_md654"></a>
File Structure</h1>
<ul>
<li><b>File Extension</b>: Use <code>.asm</code> as the file extension for 65816 assembly files.</li>
<li><b>Header Comments</b>: Include a header comment at the beginning of each file describing its purpose and the author.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">; =========================================================</div>
<div class="line">; Purpose: [Brief description of the fileâ€™s functionality]</div>
<div class="line">; Author: [Your Name]</div>
<div class="line">; =========================================================</div>
</div><!-- fragment --><ul>
<li><b>Section Headers</b>: Use clear and consistent section headers to divide code into logical blocks. Each major section (e.g., sprite properties, main logic, subroutines) should start with a delineated header.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">; =========================================================</div>
<div class="line">; Minecart Sprite Properties</div>
<div class="line">; =========================================================</div>
</div><!-- fragment --><ul>
<li><b>Macro Definitions and Includes</b>: Place macros and include directives at the beginning of the file to keep them organized and easily accessible.</li>
</ul>
<h1><a class="anchor" id="autotoc_md655"></a>
Labels and Symbols</h1>
<ul>
<li><b>Naming Conventions</b>:<ul>
<li><b>Global Labels</b>: Use descriptive names in <code>PascalCase</code> for global labels (e.g., <code>Sprite_Minecart_Main</code>).</li>
<li><b>Local Labels</b>: Prefix local labels with a dot (<code>.</code>) to indicate their limited scope (e.g., <code>.check_direction</code>).</li>
<li><b>Constants and Flags</b>: Use <code>ALL_CAPS_WITH_UNDERSCORES</code> for constants and flags (e.g., <code>!MINECART_SPEED</code>, <code>!HARVESTING_FLAG</code>).</li>
<li><b>Variables</b>: Use <code>CamelCase</code> for variable names to maintain readability (e.g., <code>LinkInCart</code>, <code>SpriteDirection</code>).</li>
</ul>
</li>
<li><b>Alignment</b>: Align labels to the left margin for better readability. Indent instructions and comments to separate them from labels.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">Sprite_Minecart_Main:</div>
<div class="line">{</div>
<div class="line">    JSR HandleTileDirections</div>
<div class="line">    JSR HandleDynamicSwitchTileDirections</div>
<div class="line">    RTS</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md656"></a>
Comments</h1>
<ul>
<li><b>Purpose</b>: Comments should explain why the code exists and what it is intended to do, especially for complex logic.</li>
<li><b>Placement</b>:<ul>
<li>Comments can be placed above the code block they describe for longer explanations.</li>
<li>Inline comments can be used for single lines of code where the purpose might not be immediately clear.</li>
</ul>
</li>
<li><b>Clarity</b>: Avoid stating the obvious. Focus on explaining the logic rather than restating the code.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">LDA $22 : SEC : SBC $3F : STA $31   ; Adjust X position for camera movement</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md657"></a>
Instructions</h1>
<ul>
<li><b>Single Line Instructions</b>: Combine multiple instructions on a single line using colons (<code>:</code>) where appropriate for related operations.</li>
<li><b>Separation</b>: Use line breaks to separate distinct sections of code logically, improving readability.</li>
<li><b>Optimization</b>: Always consider the most efficient instruction for the task at hand, especially in performance-critical sections.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">LDA #$01 : STA !LinkInCart  ; Set Link in cart flag</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md658"></a>
Macros</h1>
<ul>
<li><b>Naming</b>: Use <code>PascalCase</code> for macro names, with the first letter of each word capitalized (e.g., <code>InitMovement</code>, <code>MoveCart</code>).</li>
<li><b>Parameters</b>: Clearly define and document parameters within macros to ensure they are used correctly.</li>
<li><b>Reuse</b>: Encourage the reuse of macros to avoid code duplication and simplify maintenance.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">%macro HandlePlayerCamera</div>
<div class="line">  LDA $22 : SEC : SBC $3F : STA $31</div>
<div class="line">  LDA $20 : SEC : SBC $3E : STA $30</div>
<div class="line">  JSL Link_HandleMovingAnimation_FullLongEntry</div>
<div class="line">  JSL HandleIndoorCameraAndDoors</div>
<div class="line">  RTS</div>
<div class="line">endmacro</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md659"></a>
Loops and Branching</h1>
<ul>
<li><b>Branch Labels</b>: Use meaningful names for branch labels, prefixed with a dot (<code>.</code>) for local branches.</li>
<li><b>Optimization</b>: Minimize the number of instructions within loops and branches to improve performance.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">.loop_start</div>
<div class="line">LDA $00 : CMP #$10 : BEQ .end_loop</div>
<div class="line">  INC $00</div>
<div class="line">  BRA .loop_start</div>
<div class="line">.end_loop</div>
<div class="line">RTS</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md660"></a>
Data Structures</h1>
<ul>
<li><b>Alignment</b>: Align data tables and structures clearly, and use comments to describe the purpose and layout of each.</li>
<li><b>Access</b>: Ensure that data structures are accessed consistently, with clear boundaries between read and write operations.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">.DirectionTileLookup</div>
<div class="line">{</div>
<div class="line">  db $02, $00, $04, $00 ; North</div>
<div class="line">  db $00, $00, $03, $01 ; East</div>
<div class="line">  db $00, $02, $00, $04 ; South</div>
<div class="line">  db $03, $01, $00, $00 ; West</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><b>Structs</b>: Use structs to group related data together, improving readability and maintainability.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">struct AncillaAdd_HookshotData $099AF8</div>
<div class="line">  .speed_y: skip 4</div>
<div class="line">  .speed_x: skip 4</div>
<div class="line">  .offset_y: skip 8</div>
<div class="line">  .offset_x: skip 8</div>
<div class="line">endstruct</div>
<div class="line"> </div>
<div class="line">AncillaAdd_Hookshot:</div>
<div class="line">  ; $099AF0</div>
<div class="line">  .speed_y</div>
<div class="line">  db -64 ; up</div>
<div class="line">  db  64 ; down</div>
<div class="line">  db   0 ; left</div>
<div class="line">  db   0 ; right</div>
<div class="line">  ; $099AFC</div>
<div class="line">  .speed_x</div>
<div class="line">  db   0 ; up</div>
<div class="line">  db   0 ; down</div>
<div class="line">  db -64 ; left</div>
<div class="line">  db  64 ; right</div>
<div class="line">  ; $099B00</div>
<div class="line">  .offset_y</div>
<div class="line">  dw   4 ; up</div>
<div class="line">  dw  20 ; down</div>
<div class="line">  dw   8 ; left</div>
<div class="line">  dw   8 ; right</div>
<div class="line">  ; $099B08</div>
<div class="line">  .offset_x</div>
<div class="line">  dw   0 ; up</div>
<div class="line">  dw   0 ; down</div>
<div class="line">  dw  -4 ; left</div>
<div class="line">  dw  11 ; right</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md661"></a>
Code Organization</h1>
<ul>
<li><b>Logical Grouping</b>: Organize code into logical sections, with related routines and macros grouped together.</li>
<li><b>Separation of Concerns</b>: Ensure that each section of code is responsible for a specific task or set of related tasks, avoiding tightly coupled code.</li>
<li><b>Modularity</b>: Write code in a modular way, making it easier to reuse and maintain.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">; =========================================================</div>
<div class="line">; Minecart Sprite Logic</div>
<div class="line">; =========================================================</div>
<div class="line">Sprite_Minecart_Main:</div>
<div class="line">{</div>
<div class="line">  PHX</div>
<div class="line">  JSR HandleMinecartMovement</div>
<div class="line">  PLX</div>
<div class="line"> </div>
<div class="line">  REP #$20</div>
<div class="line">  LDA !SpriteDirection : STA $00</div>
<div class="line">  SEP #$20</div>
<div class="line">  RTS</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md662"></a>
Custom Code</h1>
<ul>
<li><b>Integration</b>: Include custom assembly code in the <code>yaze.asm</code> file to ensure it is applied correctly to the ROM. The module should include a define and conditional statement to allow users to disable the module if needed.</li>
</ul>
<p>Example:</p>
<div class="fragment"><div class="line">!YAZE_CUSTOM_MOSAIC = 1</div>
<div class="line"> </div>
<div class="line">if !YAZE_CUSTOM_MOSAIC != 0</div>
<div class="line">  incsrc &quot;mosaic_change.asm&quot;</div>
<div class="line">endif</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
