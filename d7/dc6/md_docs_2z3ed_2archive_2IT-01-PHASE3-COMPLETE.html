<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: IT-01 Phase 3: ImGuiTestEngine Integration - COMPLETE ✅</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/dc6/md_docs_2z3ed_2archive_2IT-01-PHASE3-COMPLETE.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IT-01 Phase 3: ImGuiTestEngine Integration - COMPLETE ✅</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1410"></a> <b>Date</b>: October 2, 2025 <br  />
 <b>Status</b>: ✅ <b>COMPLETE</b> - All RPC handlers implemented with ImGuiTestEngine <br  />
 <b>Time Spent</b>: ~3 hours (implementation + testing)</p>
<h1><a class="anchor" id="autotoc_md1411"></a>
Overview</h1>
<p>Phase 3 successfully implements full ImGuiTestEngine integration for all gRPC RPC handlers. The test harness can now automate GUI interactions, wait for conditions, and validate widget state through remote procedure calls.</p>
<h1><a class="anchor" id="autotoc_md1412"></a>
Implementation Summary</h1>
<h2><a class="anchor" id="autotoc_md1413"></a>
1. Type RPC ✅</h2>
<p><b>Purpose</b>: Input text into GUI widgets <br  />
 <b>Implementation</b>:</p><ul>
<li>Uses <code>ItemInfo()</code> to find target widget (returns by value, check <code>ID != 0</code>)</li>
<li>Clicks widget to focus before typing</li>
<li>Supports <code>clear_first</code> flag using <code>KeyPress(ImGuiMod_Shortcut | ImGuiKey_A)</code> + <code>KeyPress(ImGuiKey_Delete)</code></li>
<li>Types text using <code>ItemInputValue()</code></li>
<li>Dynamic test registration with timeout and status polling</li>
</ul>
<p><b>Example</b>: </p><div class="fragment"><div class="line">grpcurl -plaintext -d &#39;{</div>
<div class="line">  &quot;target&quot;:&quot;input:Filename&quot;,</div>
<div class="line">  &quot;text&quot;:&quot;zelda3.sfc&quot;,</div>
<div class="line">  &quot;clear_first&quot;:true</div>
<div class="line">}&#39; 127.0.0.1:50052 yaze.test.ImGuiTestHarness/Type</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1414"></a>
2. Wait RPC ✅</h2>
<p><b>Purpose</b>: Poll for UI conditions with timeout <br  />
 <b>Implementation</b>:</p><ul>
<li>Supports three condition types:<ul>
<li><code>window_visible:WindowName</code> - checks window exists and not hidden</li>
<li><code>element_visible:ElementLabel</code> - checks element exists and has visible rect</li>
<li><code>element_enabled:ElementLabel</code> - checks element not disabled</li>
</ul>
</li>
<li>Configurable timeout (default 5000ms) and poll interval (default 100ms)</li>
<li>Uses <code>ctx-&gt;Yield()</code> to allow <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> event processing during polling</li>
<li>Returns elapsed time in milliseconds</li>
</ul>
<p><b>Example</b>: </p><div class="fragment"><div class="line">grpcurl -plaintext -d &#39;{</div>
<div class="line">  &quot;condition&quot;:&quot;window_visible:Overworld Editor&quot;,</div>
<div class="line">  &quot;timeout_ms&quot;:5000,</div>
<div class="line">  &quot;poll_interval_ms&quot;:100</div>
<div class="line">}&#39; 127.0.0.1:50052 yaze.test.ImGuiTestHarness/Wait</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1415"></a>
3. Assert RPC ✅</h2>
<p><b>Purpose</b>: Validate GUI state and return actual vs expected values <br  />
 <b>Implementation</b>:</p><ul>
<li>Supports multiple assertion types:<ul>
<li><code>visible:WindowName</code> - checks window visibility</li>
<li><code>enabled:ElementLabel</code> - checks if element is enabled</li>
<li><code>exists:ElementLabel</code> - checks if element exists</li>
<li><code>text_contains:InputLabel:ExpectedText</code> - validates text content (partial implementation)</li>
</ul>
</li>
<li>Returns structured response with success, message, actual_value, expected_value</li>
<li>Detailed error messages for debugging</li>
</ul>
<p><b>Example</b>: </p><div class="fragment"><div class="line">grpcurl -plaintext -d &#39;{</div>
<div class="line">  &quot;condition&quot;:&quot;visible:Main Window&quot;</div>
<div class="line">}&#39; 127.0.0.1:50052 yaze.test.ImGuiTestHarness/Assert</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1416"></a>
Key API Learnings</h1>
<h2><a class="anchor" id="autotoc_md1417"></a>
ImGuiTestEngine API Patterns</h2>
<ol type="1">
<li><b>ItemInfo Returns By Value</b>: <div class="fragment"><div class="line"><span class="comment">// WRONG: ImGuiTestItemInfo* item = ctx-&gt;ItemInfo(label);</span></div>
<div class="line"><span class="comment">// RIGHT:</span></div>
<div class="line">ImGuiTestItemInfo item = ctx-&gt;ItemInfo(label);</div>
<div class="line"><span class="keywordflow">if</span> (item.ID == 0) { <span class="comment">/* not found */</span> }</div>
</div><!-- fragment --></li>
<li><b>Flag Names Changed</b>:<ul>
<li>Use <code>ItemFlags</code> instead of <code>InFlags</code> (obsolete)</li>
<li>Use <code>ImGuiItemFlags_Disabled</code> instead of <code>ImGuiItemStatusFlags_Disabled</code></li>
</ul>
</li>
<li><b>Visibility Check</b>: <div class="fragment"><div class="line"><span class="comment">// Check if element is visible (has non-zero clipped rect)</span></div>
<div class="line"><span class="keywordtype">bool</span> visible = (item.ID != 0 &amp;&amp; </div>
<div class="line">                item.RectClipped.GetWidth() &gt; 0 &amp;&amp; </div>
<div class="line">                item.RectClipped.GetHeight() &gt; 0);</div>
</div><!-- fragment --></li>
<li><b>Dynamic Test Registration</b>: <div class="fragment"><div class="line"><span class="keyword">auto</span> test_data = std::make_shared&lt;DynamicTestData&gt;();</div>
<div class="line">test_data-&gt;test_func = [=](ImGuiTestContext* ctx) { <span class="comment">/* test logic */</span> };</div>
<div class="line"> </div>
<div class="line">ImGuiTest* test = IM_REGISTER_TEST(engine, <span class="stringliteral">&quot;grpc&quot;</span>, test_name.c_str());</div>
<div class="line">test-&gt;TestFunc = RunDynamicTest;</div>
<div class="line">test-&gt;UserData = test_data.get();</div>
<div class="line"> </div>
<div class="line">ImGuiTestEngine_QueueTest(engine, test, ImGuiTestRunFlags_RunFromGui);</div>
</div><!-- fragment --></li>
<li><b>Test Status Polling</b>: <div class="fragment"><div class="line"><span class="keywordflow">while</span> (test-&gt;Output.Status == ImGuiTestStatus_Queued || </div>
<div class="line">       test-&gt;Output.Status == ImGuiTestStatus_Running) {</div>
<div class="line">  <span class="keywordflow">if</span> (timeout_reached) <span class="keywordflow">break</span>;</div>
<div class="line">  std::this_thread::sleep_for(std::chrono::milliseconds(10));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cleanup</span></div>
<div class="line">ImGuiTestEngine_UnregisterTest(engine, test);</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md1418"></a>
Build and Test</h1>
<h2><a class="anchor" id="autotoc_md1419"></a>
Build Command</h2>
<div class="fragment"><div class="line">cd /Users/scawful/Code/yaze</div>
<div class="line">cmake --build build-grpc-test --target yaze -j$(sysctl -n hw.ncpu)</div>
</div><!-- fragment --><p><b>Build Status</b>: ✅ Success (with deprecation warnings in imgui_memory_editor.h - unrelated)</p>
<h2><a class="anchor" id="autotoc_md1420"></a>
Start Test Harness</h2>
<div class="fragment"><div class="line">./build-grpc-test/bin/yaze.app/Contents/MacOS/yaze \</div>
<div class="line">  --enable_test_harness \</div>
<div class="line">  --test_harness_port=50052 \</div>
<div class="line">  --rom_file=assets/zelda3.sfc &amp;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1421"></a>
Test All RPCs</h2>
<div class="fragment"><div class="line"># 1. Ping - Health check</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;message&quot;:&quot;test&quot;}&#39; 127.0.0.1:50052 yaze.test.ImGuiTestHarness/Ping</div>
<div class="line"> </div>
<div class="line"># 2. Click - Click button</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;target&quot;:&quot;button:Overworld&quot;,&quot;type&quot;:&quot;LEFT&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Click</div>
<div class="line"> </div>
<div class="line"># 3. Type - Input text</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;target&quot;:&quot;input:Filename&quot;,&quot;text&quot;:&quot;zelda3.sfc&quot;,&quot;clear_first&quot;:true}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Type</div>
<div class="line"> </div>
<div class="line"># 4. Wait - Wait for condition</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;condition&quot;:&quot;window_visible:Main Window&quot;,&quot;timeout_ms&quot;:5000}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Wait</div>
<div class="line"> </div>
<div class="line"># 5. Assert - Validate state</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;condition&quot;:&quot;visible:Main Window&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Assert</div>
<div class="line"> </div>
<div class="line"># 6. Screenshot - Capture (not yet implemented)</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;region&quot;:&quot;full&quot;,&quot;format&quot;:&quot;PNG&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Screenshot</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1422"></a>
Files Modified</h1>
<h2><a class="anchor" id="autotoc_md1423"></a>
Core Implementation</h2>
<ol type="1">
<li><code><a class="el" href="../../dd/d7f/imgui__test__harness__service_8cc.html">src/app/core/imgui_test_harness_service.cc</a></code><ul>
<li><b>Type RPC</b>: Full implementation with ItemInfo, focus, clear, and input</li>
<li><b>Wait RPC</b>: Polling loop with multiple condition types</li>
<li><b>Assert RPC</b>: State validation with structured responses</li>
<li>Total: ~300 lines of new GUI automation code</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md1424"></a>
No Changes Required</h2>
<ul>
<li><code><a class="el" href="../../d9/d30/imgui__test__harness__service_8h.html">src/app/core/imgui_test_harness_service.h</a></code> - interface unchanged</li>
<li><code>src/app/test/test_manager.{h,cc}</code> - initialization already correct</li>
<li>Proto files - schema unchanged</li>
</ul>
<h1><a class="anchor" id="autotoc_md1425"></a>
Known Limitations</h1>
<h2><a class="anchor" id="autotoc_md1426"></a>
1. Text Retrieval (Assert RPC)</h2>
<ul>
<li><code>text_contains</code> assertion returns placeholder string</li>
<li>Requires deeper investigation of ImGuiTestEngine text query APIs</li>
<li>Current workaround: manually check text after typing with Type RPC</li>
</ul>
<h2><a class="anchor" id="autotoc_md1427"></a>
2. Screenshot RPC</h2>
<ul>
<li>Not implemented (returns "not yet implemented" message)</li>
<li>Requires framebuffer access and image encoding</li>
<li>Planned for future enhancement</li>
</ul>
<h2><a class="anchor" id="autotoc_md1428"></a>
3. Error Handling</h2>
<ul>
<li>Test failures may not always provide detailed context</li>
<li>Consider adding more verbose logging in debug mode</li>
</ul>
<h1><a class="anchor" id="autotoc_md1429"></a>
Success Metrics</h1>
<p>✅ <b>All Core RPCs Implemented</b>: Ping, Click, Type, Wait, Assert <br  />
 ✅ <b>Build Successful</b>: No compilation errors <br  />
 ✅ <b>API Compatibility</b>: Correct ImGuiTestEngine usage patterns <br  />
 ✅ <b>Dynamic Test Registration</b>: Tests created on-demand without pre-registration <br  />
 ✅ <b>Timeout Handling</b>: All RPCs have configurable timeouts <br  />
 ✅ <b>Stub Fallback</b>: Works without ImGuiTestEngine (compile-time flag)</p>
<h1><a class="anchor" id="autotoc_md1430"></a>
Next Steps (Phase 4)</h1>
<h2><a class="anchor" id="autotoc_md1431"></a>
Priority 1: End-to-End Testing (2-3 hours)</h2>
<ol type="1">
<li><b>Manual Workflow Testing</b>:<ul>
<li>Start YAZE with test harness</li>
<li>Execute full workflow: Click → Type → Wait → Assert</li>
<li>Validate responses match expected behavior</li>
<li>Test error cases (widget not found, timeout, etc.)</li>
</ul>
</li>
<li><b>Create Test Script</b>: <div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># test_harness_e2e.sh</div>
<div class="line"> </div>
<div class="line"># Start YAZE in background</div>
<div class="line">./build-grpc-test/bin/yaze.app/Contents/MacOS/yaze \</div>
<div class="line">  --enable_test_harness --test_harness_port=50052 \</div>
<div class="line">  --rom_file=assets/zelda3.sfc &amp;</div>
<div class="line">YAZE_PID=$!</div>
<div class="line"> </div>
<div class="line">sleep 2  # Wait for startup</div>
<div class="line"> </div>
<div class="line"># Test Ping</div>
<div class="line">grpcurl -plaintext -d &#39;{&quot;message&quot;:&quot;test&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Ping</div>
<div class="line"> </div>
<div class="line"># Test Click</div>
<div class="line">grpcurl -plaintext -d &#39;{&quot;target&quot;:&quot;button:Overworld&quot;,&quot;type&quot;:&quot;LEFT&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Click</div>
<div class="line"> </div>
<div class="line"># Test Wait</div>
<div class="line">grpcurl -plaintext -d &#39;{&quot;condition&quot;:&quot;window_visible:Overworld Editor&quot;,&quot;timeout_ms&quot;:5000}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Wait</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kill $YAZE_PID</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1432"></a>
Priority 2: CLI Agent Integration (3-4 hours)</h2>
<ol type="1">
<li><b>Create <code>z3ed agent test</code> command</b>:<ul>
<li>Translate natural language prompts to gRPC calls</li>
<li>Chain multiple RPCs for complex workflows</li>
<li>Capture screenshots for LLM feedback</li>
</ul>
</li>
<li><b>Example Agent Test</b>: <div class="fragment"><div class="line">z3ed agent test --prompt &quot;Open the Overworld editor and verify it&#39;s visible&quot; \</div>
<div class="line">  --rom zelda3.sfc</div>
<div class="line"> </div>
<div class="line"># Generated workflow:</div>
<div class="line"># 1. Click &quot;button:Overworld&quot;</div>
<div class="line"># 2. Wait &quot;window_visible:Overworld Editor&quot; (5s timeout)</div>
<div class="line"># 3. Assert &quot;visible:Overworld Editor&quot;</div>
<div class="line"># 4. Screenshot &quot;full&quot;</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md1433"></a>
Priority 3: Documentation Update (1 hour)</h2>
<ul>
<li>Update <code><a class="el" href="../../df/d90/E6-z3ed-implementation-plan_8md.html">E6-z3ed-implementation-plan.md</a></code> with Phase 3 completion</li>
<li>Update <code><a class="el" href="../../db/dac/STATE__SUMMARY__2025-10-01_8md.html">STATE_SUMMARY_2025-10-01.md</a></code> → <code><a class="el" href="../../d3/d5f/STATE__SUMMARY__2025-10-02_8md.html">STATE_SUMMARY_2025-10-02.md</a></code></li>
<li>Add <a class="el" href="../../db/ded/IT-01-PHASE3-COMPLETE_8md.html">IT-01-PHASE3-COMPLETE.md</a> to documentation index</li>
</ul>
<h2><a class="anchor" id="autotoc_md1434"></a>
Priority 4: Windows Testing (2-3 hours)</h2>
<ul>
<li>Build on Windows with vcpkg</li>
<li>Validate gRPC service startup</li>
<li>Test all RPCs on Windows</li>
<li>Document platform-specific issues</li>
</ul>
<h1><a class="anchor" id="autotoc_md1435"></a>
Conclusion</h1>
<p>Phase 3 is <b>complete</b> with all core GUI automation capabilities implemented. The ImGuiTestHarness can now:</p><ul>
<li>✅ Click buttons and interactive elements</li>
<li>✅ Type text into input fields</li>
<li>✅ Wait for UI conditions (window visibility, element state)</li>
<li>✅ Assert widget state with detailed validation</li>
<li>✅ Handle timeouts and errors gracefully</li>
</ul>
<p>The foundation is ready for AI-driven GUI testing and automation workflows. Next phase will focus on end-to-end integration and CLI agent tooling.</p>
<hr  />
<p><b>Completed</b>: October 2, 2025 <br  />
 <b>Contributors</b>: @scawful, GitHub Copilot <br  />
 <b>License</b>: Same as YAZE (see ../../LICENSE) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
