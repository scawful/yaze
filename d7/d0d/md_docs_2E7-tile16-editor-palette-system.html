<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Tile16 Editor Palette System</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d0d/md_docs_2E7-tile16-editor-palette-system.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tile16 Editor Palette System</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md615"></a> <b>Status: Work in Progress</b> - Documentation for the ongoing Tile16 Editor palette system redesign, implementation, and refactoring improvements.</p>
<h1><a class="anchor" id="autotoc_md616"></a>
Executive Summary</h1>
<p>The tile16 editor palette system is undergoing a complete redesign to resolve critical crashes and ensure proper color alignment between the tile16 editor and overworld display. Significant progress has been made addressing fundamental architectural issues with palette mapping, implementing crash fixes, and creating an improved three-column layout. However, palette handling for the tile8 source canvas and palette button functionality remain works in progress.</p>
<h1><a class="anchor" id="autotoc_md617"></a>
Problem Analysis</h1>
<h2><a class="anchor" id="autotoc_md618"></a>
Critical Issues Identified</h2>
<ol type="1">
<li><b>SIGBUS Crash in SnesColor::rgb()</b><ul>
<li><b>Root Cause</b>: <code>SetPaletteWithTransparent()</code> method used incorrect <code>index * 7</code> calculation</li>
<li><b>Impact</b>: Crashes when selecting palette buttons 4-7 due to out-of-bounds memory access</li>
<li><b>Location</b>: <code><a class="el" href="../../d4/d13/bitmap_8cc.html">bitmap.cc</a>:371</code> - <code>start_index = index * 7</code></li>
</ul>
</li>
<li><b>Fundamental Architecture Misunderstanding</b><ul>
<li><b>Root Cause</b>: Attempting to use <code>SetPaletteWithTransparent()</code> instead of <code>SetPalette()</code></li>
<li><b>Impact</b>: Broke the 256-color palette system that the overworld relies on</li>
<li><b>Reality</b>: Overworld system uses complete 256-color palettes with <code>SetPalette()</code></li>
</ul>
</li>
<li><b>Color Mapping Misunderstanding</b><ul>
<li><b>Root Cause</b>: Confusion about how color mapping works in the graphics system</li>
<li><b>Impact</b>: Incorrect palette handling in tile16 editor</li>
<li><b>Reality</b>: Pixel data already contains correct color indices for the 256-color palette</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md619"></a>
Solution Architecture</h1>
<h2><a class="anchor" id="autotoc_md620"></a>
Core Design Principles</h2>
<ol type="1">
<li><b>Use Same Palette System as Overworld</b>: Use <code>SetPalette()</code> with complete 256-color palette</li>
<li><b>Direct Color Mapping</b>: The pixel data in graphics already contains correct color indices that map to the 256-color palette</li>
<li><b>Proper Bounds Checking</b>: Prevent out-of-bounds memory access in palette operations</li>
<li><b>Consistent Architecture</b>: Match overworld editor's palette handling exactly</li>
</ol>
<h2><a class="anchor" id="autotoc_md621"></a>
256-Color Overworld Palette Structure</h2>
<p>Based on analysis of <code>SetColorsPalette()</code> in <code><a class="el" href="../../d8/d3e/overworld__map_8cc.html">overworld_map.cc</a></code>:</p>
<div class="fragment"><div class="line">Row 0-1:  HUD palette (32 colors)          - Slots 0-31</div>
<div class="line">Row 2-6:  MAIN palette (35 colors)         - Slots 32-87 (rows 2-6, cols 1-7)  </div>
<div class="line">Row 7:    ANIMATED palette (7 colors)      - Slots 112-118 (row 7, cols 1-7)</div>
<div class="line">Row 8:    Sprite AUX1 + AUX3 (14 colors)  - Slots 128-141</div>
<div class="line">Row 9-12: Global sprites (60 colors)       - Slots 144-203</div>
<div class="line">Row 13:   Sprite palette 1 (7 colors)     - Slots 208-214</div>
<div class="line">Row 14:   Sprite palette 2 (7 colors)     - Slots 224-230  </div>
<div class="line">Row 15:   Armor palettes (15 colors)      - Slots 240-254</div>
<div class="line"> </div>
<div class="line">Right side (cols 9-15):</div>
<div class="line">Row 2-4:  AUX1 palette (21 colors)        - Slots 136-151</div>
<div class="line">Row 5-7:  AUX2 palette (21 colors)        - Slots 152-167</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md622"></a>
Sheet-to-Palette Mapping</h2>
<div class="fragment"><div class="line">Sheet 0,3,4:  → AUX1 region (slots 136-151)</div>
<div class="line">Sheet 5,6:    → AUX2 region (slots 152-167)</div>
<div class="line">Sheet 1,2:    → MAIN region (slots 32-87)</div>
<div class="line">Sheet 7:      → ANIMATED region (slots 112-118)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md623"></a>
Palette Button Mapping</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Button   </th><th class="markdownTableHeadNone">Sheet 0,3,4 (AUX1)   </th><th class="markdownTableHeadNone">Sheet 1,2 (MAIN)   </th><th class="markdownTableHeadNone">Sheet 5,6 (AUX2)   </th><th class="markdownTableHeadNone">Sheet 7 (ANIMATED)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">136   </td><td class="markdownTableBodyNone">32   </td><td class="markdownTableBodyNone">152   </td><td class="markdownTableBodyNone">112    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">138   </td><td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">154   </td><td class="markdownTableBodyNone">113    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">140   </td><td class="markdownTableBodyNone">46   </td><td class="markdownTableBodyNone">156   </td><td class="markdownTableBodyNone">114    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">142   </td><td class="markdownTableBodyNone">53   </td><td class="markdownTableBodyNone">158   </td><td class="markdownTableBodyNone">115    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">144   </td><td class="markdownTableBodyNone">60   </td><td class="markdownTableBodyNone">160   </td><td class="markdownTableBodyNone">116    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">146   </td><td class="markdownTableBodyNone">67   </td><td class="markdownTableBodyNone">162   </td><td class="markdownTableBodyNone">117    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">148   </td><td class="markdownTableBodyNone">74   </td><td class="markdownTableBodyNone">164   </td><td class="markdownTableBodyNone">118    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">150   </td><td class="markdownTableBodyNone">81   </td><td class="markdownTableBodyNone">166   </td><td class="markdownTableBodyNone">119   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md624"></a>
Implementation Details</h1>
<h2><a class="anchor" id="autotoc_md625"></a>
1. Fixed SetPaletteWithTransparent Method</h2>
<p><b>File</b>: <code><a class="el" href="../../d4/d13/bitmap_8cc.html">src/app/gfx/bitmap.cc</a></code></p>
<p><b>Before</b>: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> start_index = index * 7;  <span class="comment">// WRONG: Creates invalid indices for buttons 4-7</span></div>
</div><!-- fragment --><p><b>After</b>: </p><div class="fragment"><div class="line"><span class="comment">// Extract 8-color sub-palette starting at the specified index</span></div>
<div class="line"><span class="comment">// Always start with transparent color (index 0)</span></div>
<div class="line">colors.push_back(ImVec4(0, 0, 0, 0));</div>
<div class="line"><span class="comment">// Extract up to 7 colors from the palette starting at index</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 7 &amp;&amp; (index + i) &lt; palette.size(); ++i) {</div>
<div class="line">    <span class="keyword">auto</span> &amp;pal_color = palette[index + i];</div>
<div class="line">    colors.push_back(pal_color.rgb());</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md626"></a>
2. Corrected Tile16 Editor Palette System</h2>
<p><b>File</b>: <code><a class="el" href="../../d6/ddd/tile16__editor_8cc.html">src/app/editor/overworld/tile16_editor.cc</a></code></p>
<p><b>Before</b>: </p><div class="fragment"><div class="line"><span class="comment">// WRONG: Trying to extract 8-color sub-palettes</span></div>
<div class="line">current_gfx_individual_[i].SetPaletteWithTransparent(display_palette, base_palette_slot, 8);</div>
</div><!-- fragment --><p><b>After</b>: </p><div class="fragment"><div class="line"><span class="comment">// CORRECT: Use complete 256-color palette (same as overworld system)</span></div>
<div class="line"><span class="comment">// The pixel data already contains correct color indices for the 256-color palette</span></div>
<div class="line">current_gfx_individual_[i].SetPalette(display_palette);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md627"></a>
3. Palette Coordination Flow</h2>
<div class="fragment"><div class="line">Overworld System:</div>
<div class="line">  ProcessGraphicsBuffer() → adds 0x88 offset to sheets 0,3,4,5</div>
<div class="line">  BuildTiles16Gfx() → combines with palette info</div>
<div class="line">  current_gfx_bmp_ → contains properly offset pixel data</div>
<div class="line"> </div>
<div class="line">Tile16 Editor:</div>
<div class="line">  Initialize() → receives current_gfx_bmp_ with correct data</div>
<div class="line">  LoadTile8() → extracts tiles with existing pixel values</div>
<div class="line">  SetPalette() → applies complete 256-color palette</div>
<div class="line">  Display → correct colors shown automatically</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md628"></a>
UI/UX Refactoring</h1>
<h2><a class="anchor" id="autotoc_md629"></a>
New Three-Column Layout</h2>
<p>The tile16 editor layout was completely restructured into a unified 3-column table for better space utilization:</p>
<p><b>Column 1: Tile16 Blockset</b> (35% width)</p><ul>
<li>Complete 512-tile blockset display</li>
<li>Integrated zoom slider (0.5x - 4.0x)</li>
<li>Zoom in/out buttons for quick adjustments</li>
<li>Click to select tiles for editing</li>
<li>Full vertical scrolling support</li>
</ul>
<p><b>Column 2: Tile8 Source Tileset</b> (35% width)</p><ul>
<li>All 8x8 source tiles</li>
<li>Palette group selector (OW Main, OW Aux, etc.)</li>
<li>Integrated zoom slider (1.0x - 8.0x)</li>
<li>Click to select tiles for painting</li>
<li>Full vertical scrolling support</li>
</ul>
<p><b>Column 3: Editor &amp; Controls</b> (30% width)</p><ul>
<li>Tile16 editor canvas with dynamic zoom (2.0x - 8.0x)</li>
<li>Canvas size adjusts automatically with zoom level</li>
<li>All controls in compact vertical layout:<ul>
<li>Tile8 preview and ID</li>
<li>Flip controls (X, Y, Priority)</li>
<li>Palette selector (8 buttons)</li>
<li>Action buttons (Clear, Copy, Paste)</li>
<li>Save/Discard changes</li>
<li>Undo button</li>
<li>Advanced controls (collapsible)</li>
<li>Debug information (collapsible)</li>
</ul>
</li>
</ul>
<p><b>Benefits</b>:</p><ul>
<li>Better space utilization - all three main components visible simultaneously</li>
<li>Improved workflow - blockset, source tiles, and editor all in one view</li>
<li>Resizable columns allow users to adjust layout to preference</li>
</ul>
<h2><a class="anchor" id="autotoc_md630"></a>
Canvas Context Menu Fixes</h2>
<p><b>Problem</b>: The "Advanced Canvas Properties" and "Scaling Controls" popup dialogs were not appearing when selected from the context menu.</p>
<p><b>Solution</b>:</p><ul>
<li>Changed popup windows from modal popups to regular windows</li>
<li>Added boolean flags <code>show_advanced_properties_</code> and <code>show_scaling_controls_</code> to track window state</li>
<li>Windows now appear as floating windows instead of modal dialogs</li>
<li>Added public accessor methods:<ul>
<li><code>OpenAdvancedProperties()</code></li>
<li><code>OpenScalingControls()</code></li>
<li><code>CloseAdvancedProperties()</code></li>
<li><code>CloseScalingControls()</code></li>
</ul>
</li>
</ul>
<p><b>Files Modified</b>:</p><ul>
<li><code><a class="el" href="../../da/dbb/canvas_8cc.html">src/app/gui/canvas.cc</a></code> - Updated popup implementation</li>
<li><code><a class="el" href="../../d4/dcf/canvas_8h.html">src/app/gui/canvas.h</a></code> - Added boolean flags and accessor methods</li>
</ul>
<h2><a class="anchor" id="autotoc_md631"></a>
Dynamic Zoom Controls</h2>
<p>Each canvas now has independent zoom control with real-time feedback:</p>
<p><b>Tile16 Blockset Zoom</b>:</p><ul>
<li>Range: 0.5x to 4.0x</li>
<li>Slider control with +/- buttons</li>
<li>Properly scales mouse coordinate calculations</li>
</ul>
<p><b>Tile8 Source Zoom</b>:</p><ul>
<li>Range: 1.0x to 8.0x</li>
<li>Essential for viewing small pixel details</li>
<li>Correctly accounts for zoom in tile selection</li>
</ul>
<p><b>Tile16 Editor Zoom</b>:</p><ul>
<li>Range: 2.0x to 8.0x</li>
<li>Canvas size dynamically adjusts with zoom</li>
<li>Grid scales proportionally</li>
<li>Mouse coordinates properly transformed</li>
</ul>
<p><b>Implementation Details</b>: </p><div class="fragment"><div class="line"><span class="comment">// Mouse coordinate calculations account for dynamic zoom</span></div>
<div class="line"><span class="keywordtype">int</span> tile_x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(mouse_pos.x / (8 * tile8_zoom));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Grid drawing scaled with zoom</span></div>
<div class="line">tile16_edit_canvas_.DrawGrid(8.0F * tile16_zoom / 4.0F);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Canvas display size calculated dynamically</span></div>
<div class="line"><span class="keywordtype">float</span> canvas_display_size = 16 * tile16_zoom + 4;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md632"></a>
Testing Protocol</h1>
<h2><a class="anchor" id="autotoc_md633"></a>
Crash Prevention Testing</h2>
<ol type="1">
<li><b>Load ROM</b> and open tile16 editor</li>
<li><b>Test all palette buttons 0-7</b> - should not crash</li>
<li><b>Verify color display</b> - should match overworld appearance</li>
<li><b>Test different graphics sheets</b> - should use appropriate palette regions</li>
</ol>
<h2><a class="anchor" id="autotoc_md634"></a>
Color Alignment Testing</h2>
<ol type="1">
<li><b>Select tile16 in overworld</b> - note colors displayed</li>
<li><b>Open tile16 editor</b> - load same tile</li>
<li><b>Test palette buttons 0-7</b> - colors should match overworld</li>
<li><b>Verify sheet-specific behavior</b> - different sheets should show different colors</li>
</ol>
<h2><a class="anchor" id="autotoc_md635"></a>
UI/UX Testing</h2>
<ol type="1">
<li><b>Canvas Popups</b>: Right-click on each canvas → verify "Advanced Properties" and "Scaling Controls" open correctly</li>
<li><b>Zoom Controls</b>: Test each zoom slider and button for all three canvases</li>
<li><b>Tile Selection</b>: Verify clicking works at various zoom levels for blockset, tile8 source, and tile16 editor</li>
<li><b>Layout Responsiveness</b>: Resize window and columns to verify proper behavior</li>
<li><b>Workflow</b>: Test complete tile editing workflow from selection to save</li>
</ol>
<h1><a class="anchor" id="autotoc_md636"></a>
Error Handling</h1>
<h2><a class="anchor" id="autotoc_md637"></a>
Bounds Checking</h2>
<ul>
<li><b>Palette Index Validation</b>: Ensure palette indices don't exceed palette size</li>
<li><b>Sheet Index Validation</b>: Ensure sheet indices are within valid range (0-7)</li>
<li><b>Surface Validation</b>: Ensure SDL surface exists before palette operations</li>
</ul>
<h2><a class="anchor" id="autotoc_md638"></a>
Fallback Mechanisms</h2>
<ul>
<li><b>Default Palette</b>: Use MAIN region if sheet detection fails</li>
<li><b>Safe Indices</b>: Clamp palette indices to valid ranges</li>
<li><b>Error Logging</b>: Comprehensive logging for debugging</li>
</ul>
<h1><a class="anchor" id="autotoc_md639"></a>
Debug Information Display</h1>
<p>The debug panel (collapsible by default) shows:</p>
<ol type="1">
<li><b>Current State</b>: Tile16 ID, Tile8 ID, selected palette button</li>
<li><b>Mapping Info</b>: Sheet index, actual palette slot</li>
<li><b>Reference Table</b>: Complete button-to-slot mapping for all sheets</li>
<li><b>Color Preview</b>: Visual display of actual colors being used</li>
</ol>
<h1><a class="anchor" id="autotoc_md640"></a>
Known Issues and Ongoing Work</h1>
<h2><a class="anchor" id="autotoc_md641"></a>
Completed Items ✅</h2>
<ul>
<li>✅ <b>No Crashes</b>: Fixed SIGBUS errors - palette buttons 0-7 work without crashing</li>
<li>✅ <b>Three-Column Layout</b>: Unified layout with blockset, tile8 source, and editor</li>
<li>✅ <b>Dynamic Zoom Controls</b>: Independent zoom for all three canvases</li>
<li>✅ <b>Canvas Popup Fixes</b>: Advanced properties and scaling controls now working</li>
<li>✅ <b>Stable Memory</b>: No memory leaks or corruption</li>
<li>✅ <b>Code Architecture</b>: Proper bounds checking and error handling</li>
</ul>
<h2><a class="anchor" id="autotoc_md642"></a>
Active Issues ⚠️</h2>
<p><b>1. Tile8 Source Canvas Palette Issues</b></p><ul>
<li><b>Problem</b>: The tile8 source canvas (displaying current area graphics) does not show correct colors</li>
<li><b>Impact</b>: Source tiles appear with incorrect palette, making it difficult to preview how tiles will look</li>
<li><b>Root Cause</b>: Area graphics not receiving proper palette application</li>
<li><b>Status</b>: Under investigation - may be related to graphics buffer processing</li>
</ul>
<p><b>2. Palette Button Functionality</b></p><ul>
<li><b>Problem</b>: Palette buttons (0-7) do not properly update the displayed colors</li>
<li><b>Impact</b>: Cannot switch between different palette groups as intended</li>
<li><b>Expected Behavior</b>: Clicking palette buttons should change the active palette for tile8 graphics</li>
<li><b>Actual Behavior</b>: Button clicks do not trigger palette updates correctly</li>
<li><b>Status</b>: Needs implementation of proper palette switching logic</li>
</ul>
<p><b>3. Color Alignment Between Canvases</b></p><ul>
<li><b>Problem</b>: Colors in tile8 source canvas don't match tile16 editor canvas</li>
<li><b>Impact</b>: Inconsistent visual feedback during tile editing</li>
<li><b>Related To</b>: Issues #1 and #2 above</li>
<li><b>Status</b>: Blocked by palette button functionality</li>
</ul>
<h2><a class="anchor" id="autotoc_md643"></a>
Current Status Summary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Status   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Crash Prevention   </td><td class="markdownTableBodyNone">✅ Complete   </td><td class="markdownTableBodyNone">No SIGBUS errors    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Three-Column Layout   </td><td class="markdownTableBodyNone">✅ Complete   </td><td class="markdownTableBodyNone">Fully functional    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Zoom Controls   </td><td class="markdownTableBodyNone">✅ Complete   </td><td class="markdownTableBodyNone">All canvases working    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Tile16 Editor Palette   </td><td class="markdownTableBodyNone">✅ Complete   </td><td class="markdownTableBodyNone">Shows correct colors    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Tile8 Source Palette   </td><td class="markdownTableBodyNone">⚠️ In Progress   </td><td class="markdownTableBodyNone">Incorrect colors displayed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Palette Button Updates   </td><td class="markdownTableBodyNone">⚠️ In Progress   </td><td class="markdownTableBodyNone">Not updating palettes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Sheet-Aware Logic   </td><td class="markdownTableBodyNone">⚠️ Partial   </td><td class="markdownTableBodyNone">Foundation in place, needs fixes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Overall Color System   </td><td class="markdownTableBodyNone">⚠️ In Progress   </td><td class="markdownTableBodyNone">Ongoing development   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md644"></a>
Future Enhancements</h2>
<ol type="1">
<li><b>Zoom Presets</b>: Add preset buttons (1x, 2x, 4x) for quick zoom levels</li>
<li><b>Zoom Sync</b>: Option to sync zoom levels across related canvases</li>
<li><b>Canvas Layout Persistence</b>: Save user's preferred column widths and zoom levels</li>
<li><b>Keyboard Shortcuts</b>: Add +/- keys for zoom control</li>
<li><b>Mouse Wheel Zoom</b>: Ctrl+Wheel to zoom canvases</li>
<li><b>Performance Optimization</b>: Cache palette calculations for frequently used combinations</li>
<li><b>Extended Debug Tools</b>: Add pixel-level color comparison tools</li>
<li><b>Palette Preview</b>: Real-time preview of palette changes before applying</li>
<li><b>Batch Operations</b>: Apply palette changes to multiple tiles simultaneously</li>
</ol>
<h1><a class="anchor" id="autotoc_md645"></a>
Maintenance Notes</h1>
<ol type="1">
<li><b>Palette Structure Changes</b>: Update <code>GetActualPaletteSlot()</code> if overworld palette structure changes</li>
<li><b>Sheet Detection</b>: Verify <code>GetSheetIndexForTile8()</code> logic if graphics organization changes</li>
<li><b>ProcessGraphicsBuffer</b>: Monitor for changes in pixel data offset logic</li>
<li><b>Static Zoom Variables</b>: User preferences preserved across sessions</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md647"></a>
Next Steps</h1>
<h2><a class="anchor" id="autotoc_md648"></a>
Immediate Priorities</h2>
<ol type="1">
<li><b>Fix Tile8 Source Canvas Palette Application</b><ul>
<li>Investigate graphics buffer processing for area graphics</li>
<li>Ensure consistent palette application across all graphics sources</li>
<li>Test with different area graphics combinations</li>
</ul>
</li>
<li><b>Implement Palette Button Update Logic</b><ul>
<li>Add proper event handling for palette button clicks</li>
<li>Trigger palette refresh for tile8 source canvas</li>
<li>Update visual feedback to show active palette</li>
</ul>
</li>
<li><b>Verify Color Consistency</b><ul>
<li>Ensure tile8 source colors match tile16 editor</li>
<li>Test sheet-specific palette regions</li>
<li>Validate color mapping for all graphics sheets</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md649"></a>
Investigation Areas</h2>
<ul>
<li>Review <code>current_gfx_individual_</code> palette application</li>
<li>Check palette group management for tile8 source</li>
<li>Verify graphics buffer offset logic for area graphics</li>
<li>Test palette switching across different overworld areas</li>
</ul>
<hr  />
<p><em>Development Status: January 2025</em> <br  />
 <em>Status: Partial implementation - UI complete, palette system in progress</em> <br  />
 <em>Not yet ready for production use - active development ongoing</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
