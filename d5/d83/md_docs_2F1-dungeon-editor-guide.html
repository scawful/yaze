<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: F2: Dungeon Editor v2 - Complete Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d5/d83/md_docs_2F1-dungeon-editor-guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">F2: Dungeon Editor v2 - Complete Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md734"></a> <b>Last Updated</b>: October 10, 2025 <br  />
 <b>Related</b>: <a class="el" href="../../d5/d18/md_docs_2E2-development-guide.html">E2-development-guide.md</a>, <a class="el" href="../../de/dc5/md_docs_2E5-debugging-guide.html">E5-debugging-guide.md</a></p>
<hr  />
<h1><a class="anchor" id="autotoc_md736"></a>
Overview</h1>
<p>The Dungeon Editor uses a modern card-based architecture (DungeonEditorV2) with self-contained room rendering. This guide covers the architecture, recent refactoring work, and next development steps.</p>
<h2><a class="anchor" id="autotoc_md737"></a>
Key Features</h2>
<ul>
<li>✅ <b>Visual room editing</b> with 512x512 canvas per room</li>
<li>✅ <b>Object position visualization</b> - Colored outlines by layer (Red/Green/Blue)</li>
<li>✅ <b>Per-room settings</b> - Independent BG1/BG2 visibility and layer types</li>
<li>✅ <b>Flexible docking</b> - EditorCard system for custom workspace layouts</li>
<li>✅ <b>Self-contained rooms</b> - Each room owns its bitmaps and palettes</li>
<li>✅ <b>Overworld integration</b> - Double-click entrances to open dungeon rooms</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md739"></a>
Architecture Improvements ✅</h2>
<ol type="1">
<li><b>Room Buffers Decoupled</b> - No dependency on Arena graphics sheets</li>
<li><b>ObjectRenderer Removed</b> - Standardized on ObjectDrawer (~1000 lines deleted)</li>
<li><b>LoadGraphicsSheetsIntoArena Removed</b> - Using per-room graphics (~66 lines)</li>
<li><b>Old Tab System Removed</b> - EditorCard is the standard</li>
<li><b>Texture Atlas Infrastructure</b> - Future-proof stub created</li>
<li><b>Test Suite Cleaned</b> - Deleted 1270 lines of redundant tests</li>
</ol>
<h2><a class="anchor" id="autotoc_md740"></a>
UI Improvements ✅</h2>
<ul>
<li>Room ID in card title: <code>[003] Room Name</code></li>
<li>Properties reorganized into clean 4-column table</li>
<li>Compact layer controls (1 row instead of 3)</li>
<li>Room graphics canvas height fixed (1025px → 257px)</li>
<li>Object count in status bar</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md742"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md743"></a>
Component Overview</h2>
<div class="fragment"><div class="line">DungeonEditorV2 (UI Layer)</div>
<div class="line">├─ Card-based UI system</div>
<div class="line">├─ Room window management  </div>
<div class="line">├─ Component coordination</div>
<div class="line">└─ Lazy loading</div>
<div class="line"> </div>
<div class="line">DungeonEditorSystem (Backend Layer)</div>
<div class="line">├─ Sprite/Item/Entrance/Door/Chest management</div>
<div class="line">├─ Undo/Redo functionality</div>
<div class="line">├─ Room properties management</div>
<div class="line">└─ Dungeon-wide operations</div>
<div class="line"> </div>
<div class="line">Room (Data Layer)</div>
<div class="line">├─ Self-contained buffers (bg1_buffer_, bg2_buffer_)</div>
<div class="line">├─ Object storage (tile_objects_)</div>
<div class="line">├─ Graphics loading</div>
<div class="line">└─ Rendering pipeline</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md744"></a>
Room Rendering Pipeline</h2>
<p>TODO: Update this to latest code.</p>
<div class="fragment"><div class="line">1. LoadRoomGraphics(blockset)</div>
<div class="line">   └─&gt; Reads blocks[] from ROM</div>
<div class="line">   └─&gt; Loads blockset data → current_gfx16_</div>
<div class="line"> </div>
<div class="line">2. LoadObjects()</div>
<div class="line">   └─&gt; Parses object data from ROM</div>
<div class="line">   └─&gt; Creates tile_objects_[]</div>
<div class="line">   └─&gt; SETS floor1_graphics_, floor2_graphics_ ← CRITICAL!</div>
<div class="line"> </div>
<div class="line">3. RenderRoomGraphics() [SELF-CONTAINED]</div>
<div class="line">   ├─&gt; DrawFloor(floor1_graphics_, floor2_graphics_)</div>
<div class="line">   ├─&gt; DrawBackground(current_gfx16_)</div>
<div class="line">   ├─&gt; SetPalette(full_90_color_dungeon_palette)</div>
<div class="line">   ├─&gt; RenderObjectsToBackground()</div>
<div class="line">   │   └─&gt; ObjectDrawer::DrawObjectList()</div>
<div class="line">   └─&gt; QueueTextureCommand(UPDATE/CREATE)</div>
<div class="line"> </div>
<div class="line">4. DrawRoomBackgroundLayers(room_id)</div>
<div class="line">   └─&gt; ProcessTextureQueue() → GPU textures</div>
<div class="line">   └─&gt; canvas_.DrawBitmap(bg1, bg2)</div>
<div class="line"> </div>
<div class="line">5. DrawObjectPositionOutlines(room)</div>
<div class="line">   └─&gt; Colored rectangles by layer</div>
<div class="line">   └─&gt; Object ID labels</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md745"></a>
Room Structure (Bottom to Top)</h2>
<p>Understanding ALTTP dungeon composition is critical:</p>
<div class="fragment"><div class="line">Room Composition:</div>
<div class="line">├─ Room Layout (BASE LAYER - immovable)</div>
<div class="line">│  ├─ Walls (structural boundaries, 7 configurations of squares in 2x2 grid)</div>
<div class="line">│  ├─ Floors (walkable areas, repeated tile pattern set to BG1/BG2)</div>
<div class="line">├─ Layer 0 Objects (floor decorations, some walls)</div>
<div class="line">├─ Layer 1 Objects (chests, decorations)</div>
<div class="line">└─ Layer 2 Objects (stairs, transitions)</div>
<div class="line"> </div>
<div class="line">Doors: Positioned at room edges to connect rooms</div>
</div><!-- fragment --><p><b>Key Insight</b>: Layouts are immovable base structure. Objects are placed ON TOP and can be moved/edited. This allows for large rooms, 4-quadrant rooms, tall/wide rooms, etc.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md747"></a>
Next Development Steps</h1>
<h2><a class="anchor" id="autotoc_md748"></a>
High Priority (Must Do)</h2>
<h3><a class="anchor" id="autotoc_md749"></a>
1. Door Rendering at Room Edges</h3>
<p><b>What</b>: Render doors with proper patterns at room connections</p>
<p><b>Pattern Reference</b>: ZScream's door drawing patterns</p>
<p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> DungeonCanvasViewer::DrawDoors(<span class="keyword">const</span> zelda3::Room&amp; room) {</div>
<div class="line">  <span class="comment">// Doors stored in room data</span></div>
<div class="line">  <span class="comment">// Position at room edges (North/South/East/West)</span></div>
<div class="line">  <span class="comment">// Use current_gfx16_ graphics data</span></div>
<div class="line">  </div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md751"></a>
2. Object Name Labels from String Array</h3>
<p><b>File</b>: <code><a class="el" href="../../d1/d35/dungeon__canvas__viewer_8cc.html">dungeon_canvas_viewer.cc</a>:416</code> (DrawObjectPositionOutlines)</p>
<p><b>What</b>: Show real object names instead of just IDs</p>
<p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="comment">// Instead of:</span></div>
<div class="line">std::string label = absl::StrFormat(<span class="stringliteral">&quot;0x%02X&quot;</span>, obj.id_);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use:</span></div>
<div class="line">std::string object_name = GetObjectName(obj.id_);</div>
<div class="line">std::string label = absl::StrFormat(<span class="stringliteral">&quot;%s\n0x%02X&quot;</span>, object_name.c_str(), obj.id_);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Helper function:</span></div>
<div class="line">std::string GetObjectName(int16_t object_id) {</div>
<div class="line">  <span class="comment">// Example: 0x10 → &quot;Wall (North)&quot;</span></div>
<div class="line">  <span class="keywordflow">return</span> <span class="stringliteral">&quot;Object&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md753"></a>
4. Fix Plus Button to Select Any Room</h3>
<p><b>File</b>: <code><a class="el" href="../../d0/d0d/dungeon__editor__v2_8cc.html">dungeon_editor_v2.cc</a>:228</code> (DrawToolset)</p>
<p><b>Current Issue</b>: Opens Room 0x00 (Ganon) always</p>
<p><b>Fix</b>: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (toolbar.AddAction(<a class="code hl_define" href="../../de/dbf/icons_8h.html#a9db9587cd41970cdc44e0b730c504e6f">ICON_MD_ADD</a>, <span class="stringliteral">&quot;Open Room&quot;</span>)) {</div>
<div class="line">  <span class="comment">// Show room selector dialog instead of opening room 0</span></div>
<div class="line">  show_room_selector_ = <span class="keyword">true</span>;</div>
<div class="line">  <span class="comment">// Or: show room picker popup</span></div>
<div class="line">  ImGui::OpenPopup(<span class="stringliteral">&quot;SelectRoomToOpen&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add popup:</span></div>
<div class="line"><span class="keywordflow">if</span> (ImGui::BeginPopup(<span class="stringliteral">&quot;SelectRoomToOpen&quot;</span>)) {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> selected_room = 0;</div>
<div class="line">  ImGui::InputInt(<span class="stringliteral">&quot;Room ID&quot;</span>, &amp;selected_room);</div>
<div class="line">  <span class="keywordflow">if</span> (ImGui::Button(<span class="stringliteral">&quot;Open&quot;</span>)) {</div>
<div class="line">    OnRoomSelected(selected_room);</div>
<div class="line">    ImGui::CloseCurrentPopup();</div>
<div class="line">  }</div>
<div class="line">  ImGui::EndPopup();</div>
<div class="line">}</div>
<div class="ttc" id="aicons_8h_html_a9db9587cd41970cdc44e0b730c504e6f"><div class="ttname"><a href="../../de/dbf/icons_8h.html#a9db9587cd41970cdc44e0b730c504e6f">ICON_MD_ADD</a></div><div class="ttdeci">#define ICON_MD_ADD</div><div class="ttdef"><b>Definition</b> <a href="../../de/dbf/icons_8h_source.html#l00084">icons.h:84</a></div></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md755"></a>
Medium Priority (Should Do)</h2>
<h3><a class="anchor" id="autotoc_md756"></a>
6. Fix InputHexByte +/- Button Events</h3>
<p><b>File</b>: <code><a class="el" href="../../de/d4c/input_8cc.html">src/app/gui/input.cc</a></code> (likely)</p>
<p><b>Issue</b>: Buttons don't respond to clicks</p>
<p><b>Investigation Needed</b>:</p><ul>
<li>Check if button click events are being captured</li>
<li>Verify event logic matches working examples</li>
<li>Keep existing event style if it works elsewhere</li>
</ul>
<h2><a class="anchor" id="autotoc_md757"></a>
Lower Priority (Nice to Have)</h2>
<h3><a class="anchor" id="autotoc_md758"></a>
9. Move Backend Logic to DungeonEditorSystem</h3>
<p><b>What</b>: Separate UI (V2) from data operations (System)</p>
<p><b>Migration</b>:</p><ul>
<li>Sprite management → DungeonEditorSystem</li>
<li>Item management → DungeonEditorSystem</li>
<li>Entrance/Door/Chest → DungeonEditorSystem</li>
<li>Undo/Redo → DungeonEditorSystem</li>
</ul>
<p><b>Result</b>: DungeonEditorV2 becomes pure UI coordinator</p>
<hr  />
<h1><a class="anchor" id="autotoc_md760"></a>
Quick Start</h1>
<h2><a class="anchor" id="autotoc_md761"></a>
Build &amp; Run</h2>
<div class="fragment"><div class="line">cd /Users/scawful/Code/yaze</div>
<div class="line">cmake --preset mac-ai -B build_ai</div>
<div class="line">cmake --build build_ai --target yaze -j12</div>
<div class="line"> </div>
<div class="line"># Run dungeon editor</div>
<div class="line">./build_ai/bin/yaze.app/Contents/MacOS/yaze --rom_file=zelda3.sfc --editor=Dungeon</div>
<div class="line"> </div>
<div class="line"># Open specific room</div>
<div class="line">./build_ai/bin/yaze.app/Contents/MacOS/yaze --rom_file=zelda3.sfc --editor=Dungeon --cards=&quot;Room 0x00&quot;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md763"></a>
Testing &amp; Verification</h1>
<h2><a class="anchor" id="autotoc_md764"></a>
Debug Commands</h2>
<div class="fragment"><div class="line"># Verify floor values load correctly</div>
<div class="line">./build_ai/bin/yaze.app/Contents/MacOS/yaze --rom_file=zelda3.sfc --editor=Dungeon 2&gt;&amp;1 | grep &quot;floor1=&quot;</div>
<div class="line"> </div>
<div class="line"># Expected: floor1=4, floor2=8 (NOT 0!)</div>
<div class="line"> </div>
<div class="line"># Check object rendering</div>
<div class="line">./build_ai/bin/yaze.app/Contents/MacOS/yaze --rom_file=zelda3.sfc --editor=Dungeon 2&gt;&amp;1 | grep &quot;Drawing.*objects&quot;</div>
<div class="line"> </div>
<div class="line"># Check object drawing details</div>
<div class="line">./build_ai/bin/yaze.app/Contents/MacOS/yaze --rom_file=zelda3.sfc --editor=Dungeon 2&gt;&amp;1 | grep &quot;Writing Tile16&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md765"></a>
Related Documentation</h1>
<ul>
<li><b><a class="el" href="../../de/dfd/E2-development-guide_8md.html">E2-development-guide.md</a></b> - Core architectural patterns</li>
<li><b><a class="el" href="../../d4/d51/E5-debugging-guide_8md.html">E5-debugging-guide.md</a></b> - Debugging workflows</li>
<li><b><a class="el" href="../../d9/d6b/F1-dungeon-editor-guide_8md.html">F1-dungeon-editor-guide.md</a></b> - Original dungeon guide (may be outdated)</li>
</ul>
<hr  />
<p><b>Last Updated</b>: October 10, 2025 <br  />
 <b>Contributors</b>: Dungeon Editor Refactoring Session </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
