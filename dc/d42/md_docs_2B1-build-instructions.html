<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Build Instructions</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dc/d42/md_docs_2B1-build-instructions.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build Instructions</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md148"></a> yaze uses a modern CMake build system with presets for easy configuration. This guide covers how to build yaze on macOS, Linux, and Windows.</p>
<h1><a class="anchor" id="autotoc_md149"></a>
1. Environment Verification</h1>
<p><b>Before your first build</b>, run the verification script to ensure your environment is configured correctly.</p>
<h2><a class="anchor" id="autotoc_md150"></a>
Windows (PowerShell)</h2>
<div class="fragment"><div class="line">.\scripts\verify-build-environment.ps1</div>
<div class="line"> </div>
<div class="line"># With automatic fixes</div>
<div class="line">.\scripts\verify-build-environment.ps1 -FixIssues</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md151"></a>
macOS &amp; Linux (Bash)</h2>
<div class="fragment"><div class="line">./scripts/verify-build-environment.sh</div>
<div class="line"> </div>
<div class="line"># With automatic fixes</div>
<div class="line">./scripts\verify-build-environment.sh --fix</div>
</div><!-- fragment --><p>The script checks for required tools like CMake, a C++23 compiler, and platform-specific dependencies.</p>
<h1><a class="anchor" id="autotoc_md152"></a>
2. Quick Start: Building with Presets</h1>
<p>We use CMake Presets for simple, one-command builds. See the <a class="el" href="../../d7/d51/md_docs_2B3-build-presets.html">CMake Presets Guide</a> for a full list.</p>
<h2><a class="anchor" id="autotoc_md153"></a>
macOS</h2>
<div class="fragment"><div class="line"># Configure a debug build (Apple Silicon)</div>
<div class="line">cmake --preset mac-dbg</div>
<div class="line"> </div>
<div class="line"># Build the project</div>
<div class="line">cmake --build --preset mac-dbg</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md154"></a>
Linux</h2>
<div class="fragment"><div class="line"># Configure a debug build</div>
<div class="line">cmake --preset lin-dbg</div>
<div class="line"> </div>
<div class="line"># Build the project</div>
<div class="line">cmake --build --preset lin-dbg</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md155"></a>
Windows</h2>
<div class="fragment"><div class="line"># Configure a debug build for Visual Studio (x64)</div>
<div class="line">cmake --preset win-dbg</div>
<div class="line"> </div>
<div class="line"># Build the project</div>
<div class="line">cmake --build --preset win-dbg</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md156"></a>
AI-Enabled Build (All Platforms)</h2>
<p>To build with the <code>z3ed</code> AI agent features: </p><div class="fragment"><div class="line"># macOS</div>
<div class="line">cmake --preset mac-ai</div>
<div class="line">cmake --build --preset mac-ai</div>
<div class="line"> </div>
<div class="line"># Windows</div>
<div class="line">cmake --preset win-ai</div>
<div class="line">cmake --build --preset win-ai</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md157"></a>
3. Dependencies</h1>
<ul>
<li><b>Required</b>: CMake 3.16+, C++23 Compiler (GCC 13+, Clang 16+, MSVC 2019+), Git.</li>
<li><b>Bundled</b>: All other dependencies (SDL2, <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a>, Abseil, Asar, GoogleTest, etc.) are included as Git submodules or managed by CMake's <code>FetchContent</code>. No external package manager is required for a basic build.</li>
<li><b>Optional</b>:<ul>
<li><b>gRPC</b>: For GUI test automation. Can be enabled with <code>-DYAZE_WITH_GRPC=ON</code>.</li>
<li><b>vcpkg (Windows)</b>: Can be used for dependency management, but is not required.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md158"></a>
4. Platform Setup</h1>
<h2><a class="anchor" id="autotoc_md159"></a>
macOS</h2>
<div class="fragment"><div class="line"># Install Xcode Command Line Tools</div>
<div class="line">xcode-select --install</div>
<div class="line"> </div>
<div class="line"># Recommended: Install build tools via Homebrew</div>
<div class="line">brew install cmake pkg-config</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md160"></a>
Linux (Ubuntu/Debian)</h2>
<div class="fragment"><div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install -y build-essential cmake ninja-build pkg-config \</div>
<div class="line">  libgtk-3-dev libdbus-1-dev</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md161"></a>
Windows</h2>
<ul>
<li><b>Visual Studio 2022</b> is required, with the "Desktop development with C++" workload.</li>
<li>The <code>verify-build-environment.ps1</code> script will help identify any missing components.</li>
<li>For building with gRPC, see the "Windows Build Optimization" section below.</li>
</ul>
<h1><a class="anchor" id="autotoc_md162"></a>
5. Testing</h1>
<p>The project uses CTest and GoogleTest. Tests are organized into categories using labels. See the <a class="el" href="../../d6/d10/md_docs_2A1-testing-guide.html">Testing Guide</a> for details.</p>
<h2><a class="anchor" id="autotoc_md163"></a>
Running Tests with Presets</h2>
<p>The easiest way to run tests is with <code>ctest</code> presets.</p>
<div class="fragment"><div class="line"># Configure a development build (enables ROM-dependent tests)</div>
<div class="line">cmake --preset mac-dev -DYAZE_TEST_ROM_PATH=/path/to/your/zelda3.sfc</div>
<div class="line"> </div>
<div class="line"># Build the tests</div>
<div class="line">cmake --build --preset mac-dev --target yaze_test</div>
<div class="line"> </div>
<div class="line"># Run stable tests (fast, run in CI)</div>
<div class="line">ctest --preset dev</div>
<div class="line"> </div>
<div class="line"># Run all tests, including ROM-dependent and experimental</div>
<div class="line">ctest --preset all</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md164"></a>
Running Tests Manually</h2>
<p>You can also run tests by invoking the test executable directly or using CTest with labels.</p>
<div class="fragment"><div class="line"># Run all tests via the executable</div>
<div class="line">./build/bin/yaze_test</div>
<div class="line"> </div>
<div class="line"># Run only stable tests using CTest labels</div>
<div class="line">ctest --test-dir build --label-regex &quot;STABLE&quot;</div>
<div class="line"> </div>
<div class="line"># Run tests matching a name</div>
<div class="line">ctest --test-dir build -R &quot;AsarWrapperTest&quot;</div>
<div class="line"> </div>
<div class="line"># Exclude ROM-dependent tests</div>
<div class="line">ctest --test-dir build --label-exclude &quot;ROM_DEPENDENT&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md165"></a>
6. IDE Integration</h1>
<h2><a class="anchor" id="autotoc_md166"></a>
VS Code (Recommended)</h2>
<ol type="1">
<li>Install the <b>CMake Tools</b> extension.</li>
<li>Open the project folder.</li>
<li>Select a preset from the status bar (e.g., <code>mac-ai</code>).</li>
<li>Press F5 to build and debug.</li>
<li>After changing presets, run <code>cp build/compile_commands.json .</code> to update IntelliSense.</li>
</ol>
<h2><a class="anchor" id="autotoc_md167"></a>
Visual Studio (Windows)</h2>
<ol type="1">
<li>Select <b>File → Open → Folder</b> and choose the <code>yaze</code> directory.</li>
<li>Visual Studio will automatically detect <code>CMakePresets.json</code>.</li>
<li>Select the desired preset (e.g., <code>win-dbg</code> or <code>win-ai</code>) from the configuration dropdown.</li>
<li>Press F5 to build and run.</li>
</ol>
<h2><a class="anchor" id="autotoc_md168"></a>
Xcode (macOS)</h2>
<div class="fragment"><div class="line"># Generate an Xcode project from a preset</div>
<div class="line">cmake --preset mac-dbg -G Xcode</div>
<div class="line"> </div>
<div class="line"># Open the project</div>
<div class="line">open build/yaze.xcodeproj</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md169"></a>
7. Windows Build Optimization</h1>
<h2><a class="anchor" id="autotoc_md170"></a>
GitHub Actions / CI Builds</h2>
<p><b>Current Configuration (Optimized):</b></p><ul>
<li><b>Compilers</b>: Both clang-cl and MSVC supported (matrix)</li>
<li><b>vcpkg</b>: Only fast packages (SDL2, yaml-cpp) - 2 minutes</li>
<li><b>gRPC</b>: Built via FetchContent (v1.67.1) - cached after first build</li>
<li><b>Caching</b>: Aggressive multi-tier caching (vcpkg + FetchContent + sccache)</li>
<li><b>Expected time</b>:<ul>
<li>First build: ~10-15 minutes</li>
<li>Cached build: ~3-5 minutes</li>
</ul>
</li>
</ul>
<p><b>Why Not vcpkg for gRPC?</b></p><ul>
<li>vcpkg's latest gRPC (v1.71.0) has no pre-built binaries</li>
<li>Building from source via vcpkg: 45-90 minutes</li>
<li>FetchContent with caching: 10-15 minutes first time, &lt;1 min cached</li>
<li>Better control over gRPC version (v1.75.1 with Windows fixes)</li>
<li>BoringSSL ASM disabled on Windows for clang-cl compatibility</li>
<li>zlib conflict: gRPC's FetchContent builds its own zlib, conflicts with vcpkg's</li>
</ul>
<h2><a class="anchor" id="autotoc_md171"></a>
Local Development</h2>
<h3><a class="anchor" id="autotoc_md172"></a>
Fast Build (Recommended)</h3>
<p>Use FetchContent for all dependencies (matches CI): </p><div class="fragment"><div class="line"># Configure (first time: ~15 min, subsequent: ~2 min)</div>
<div class="line">cmake -B build -G &quot;Visual Studio 17 2022&quot; -A x64</div>
<div class="line"> </div>
<div class="line"># Build</div>
<div class="line">cmake --build build --config RelWithDebInfo --parallel</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md173"></a>
Using vcpkg (Optional)</h3>
<p>If you prefer vcpkg for local development: </p><div class="fragment"><div class="line"># Install ONLY the fast packages</div>
<div class="line">vcpkg install sdl2:x64-windows yaml-cpp:x64-windows</div>
<div class="line"> </div>
<div class="line"># Let CMake use FetchContent for gRPC</div>
<div class="line">cmake -B build -DCMAKE_TOOLCHAIN_FILE=vcpkg/scripts/buildsystems/vcpkg.cmake</div>
</div><!-- fragment --><p>**DO NOT** install grpc or zlib via vcpkg:</p><ul>
<li>gRPC v1.71.0 has no pre-built binaries (45-90 min build)</li>
<li>zlib conflicts with gRPC's bundled zlib</li>
</ul>
<h2><a class="anchor" id="autotoc_md174"></a>
Compiler Support</h2>
<p>**clang-cl (Recommended):**</p><ul>
<li>Used in both CI and release workflows</li>
<li>Better diagnostics than MSVC</li>
<li>Fully compatible with MSVC libraries</li>
</ul>
<p>**MSVC:**</p><ul>
<li>Also tested in CI matrix</li>
<li>Fallback option if clang-cl issues occur</li>
</ul>
<p>**Compiler Flags (Applied Automatically):**</p><ul>
<li>`/bigobj` - Large object files (required for gRPC)</li>
<li>`/permissive-` - Standards conformance</li>
<li>`/wd4267 /wd4244` - Suppress harmless conversion warnings</li>
<li>`/constexpr:depth2048` - Template instantiation depth</li>
</ul>
<h1><a class="anchor" id="autotoc_md175"></a>
8. Troubleshooting</h1>
<p>Build issues, especially on Windows, often stem from environment misconfiguration. Before anything else, run the verification script.</p>
<div class="fragment"><div class="line"># Run the verification script in PowerShell</div>
<div class="line">.\scripts\verify-build-environment.ps1</div>
</div><!-- fragment --><p>This script is your primary diagnostic tool and can detect most common problems.</p>
<h2><a class="anchor" id="autotoc_md176"></a>
Automatic Fixes</h2>
<p>If the script finds issues, you can often fix them automatically by running it with the `-FixIssues` flag. This can:</p><ul>
<li>Synchronize Git submodules.</li>
<li>Correct Git `core.autocrlf` and `core.longpaths` settings, which are critical for cross-platform compatibility on Windows.</li>
<li>Prompt to clean stale CMake caches.</li>
</ul>
<div class="fragment"><div class="line"># Attempt to fix detected issues automatically</div>
<div class="line">.\scripts\verify-build-environment.ps1 -FixIssues</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md177"></a>
Cleaning Stale Builds</h2>
<p>After pulling major changes or switching branches, your build directory can become "stale," leading to strange compiler or linker errors. The verification script will warn you about old build files. You can clean them manually or use the `-CleanCache` flag.</p>
<p>**This will delete all `build*` and `out` directories.**</p>
<div class="fragment"><div class="line"># Clean all build artifacts to start fresh</div>
<div class="line">.\scripts\verify-build-environment.ps1 -CleanCache</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md178"></a>
Common Issues</h2>
<h3><a class="anchor" id="autotoc_md179"></a>
"nlohmann/json.hpp: No such file or directory"</h3>
<p>**Cause**: You are building code that requires AI features without using an AI-enabled preset, or your Git submodules are not initialized. **Solution**:</p><ol type="1">
<li>Use an AI preset like `win-ai` or `mac-ai`.</li>
<li>Ensure submodules are present by running `git submodule update --init --recursive`.</li>
</ol>
<h3><a class="anchor" id="autotoc_md180"></a>
"Cannot open file 'yaze.exe': Permission denied"</h3>
<p>**Cause**: A previous instance of `yaze.exe` is still running in the background. **Solution**: Close it using Task Manager or run: </p><div class="fragment"><div class="line">taskkill /F /IM yaze.exe</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md181"></a>
"C++ standard 'cxx_std_23' not supported"</h3>
<p>**Cause**: Your compiler is too old. **Solution**: Update your tools. You need Visual Studio 2022 17.4+, GCC 13+, or Clang 16+. The verification script checks this.</p>
<h3><a class="anchor" id="autotoc_md182"></a>
Visual Studio Can't Find Presets</h3>
<p>**Cause**: VS failed to parse `CMakePresets.json` or its cache is corrupt. **Solution**:</p><ol type="1">
<li>Close and reopen the folder (`File -&gt; Close Folder<code>).</code></li>
<li><code> Check the "CMake" pane in the Output window for specific JSON parsing errors.</code></li>
<li><code> Delete the hidden</code>.vs` directory in the project root to force Visual Studio to re-index the project.</li>
</ol>
<h3><a class="anchor" id="autotoc_md183"></a>
Git Line Ending (CRLF) Issues</h3>
<p><b>Cause</b>: Git may be automatically converting line endings, which can break shell scripts and other assets. <b>Solution</b>: The verification script checks for this. Use the <code>-FixIssues</code> flag or run <code>git config --global core.autocrlf false</code> to prevent this behavior.</p>
<h3><a class="anchor" id="autotoc_md184"></a>
File Path Length Limit on Windows</h3>
<p><b>Cause</b>: By default, Windows has a 260-character path limit, which can be exceeded by nested dependencies. <b>Solution</b>: The verification script checks for this. Use the <code>-FixIssues</code> flag or run <code>git config --global core.longpaths true</code> to enable long path support. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
