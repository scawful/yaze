<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: z3ed: AI-Powered CLI for YAZE</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/d63/md_docs_2z3ed_2README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">z3ed: AI-Powered CLI for YAZE</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md459"></a> <b>Version</b>: 0.1.0-alpha <b>Last Updated</b>: October 4, 2025</p>
<h1><a class="anchor" id="autotoc_md460"></a>
1. Overview</h1>
<p>This document is the <b>source of truth</b> for the z3ed CLI architecture, design, and roadmap. It outlines the evolution of <code>z3ed</code> into a powerful, scriptable, and extensible tool for both manual and AI-driven ROM hacking.</p>
<p><code>z3ed</code> has successfully implemented its core infrastructure and is <b>production-ready on macOS</b>.</p>
<h2><a class="anchor" id="autotoc_md461"></a>
Core Capabilities</h2>
<ol type="1">
<li><b>Conversational Agent</b>: Chat with an AI (Ollama or Gemini) to explore ROM contents and plan changes using natural language—available from the CLI, terminal UI, and now directly within the YAZE editor.</li>
<li><b>GUI Test Automation</b>: A gRPC-based test harness allows for widget discovery, test recording/replay, and introspection for debugging and AI-driven validation.</li>
<li><b>Proposal System</b>: A safe, sandboxed editing workflow where all changes are tracked as "proposals" that require human review and acceptance.</li>
<li><b>Resource-Oriented CLI</b>: A clean <code>z3ed &lt;resource&gt; &lt;action&gt;</code> command structure that is both human-readable and machine-parsable.</li>
</ol>
<h1><a class="anchor" id="autotoc_md462"></a>
2. Quick Start</h1>
<h2><a class="anchor" id="autotoc_md463"></a>
Build</h2>
<p>A single <code>Z3ED_AI=ON</code> CMake flag enables all AI features, including JSON, YAML, and httplib dependencies. This simplifies the build process.</p>
<div class="fragment"><div class="line"># Build with AI features (RECOMMENDED)</div>
<div class="line">cmake -B build -DZ3ED_AI=ON</div>
<div class="line">cmake --build build --target z3ed</div>
<div class="line"> </div>
<div class="line"># For GUI automation features, also include gRPC</div>
<div class="line">cmake -B build -DZ3ED_AI=ON -DYAZE_WITH_GRPC=ON</div>
<div class="line">cmake --build build --target z3ed</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md464"></a>
AI Setup</h2>
<p><b>Ollama (Recommended for Development)</b>: </p><div class="fragment"><div class="line">brew install ollama              # macOS</div>
<div class="line">ollama pull qwen2.5-coder:7b    # Pull recommended model</div>
<div class="line">ollama serve                     # Start server</div>
</div><!-- fragment --><p><b>Gemini (Cloud API)</b>: </p><div class="fragment"><div class="line"># Get API key from https://aistudio.google.com/apikey</div>
<div class="line">export GEMINI_API_KEY=&quot;your-key-here&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md465"></a>
Example Commands</h2>
<p><b>Conversational Agent</b>: </p><div class="fragment"><div class="line"># Interactive chat (FTXUI)</div>
<div class="line">z3ed agent chat --rom zelda3.sfc</div>
<div class="line"> </div>
<div class="line"># Simple text mode (better for AI/automation)</div>
<div class="line">z3ed agent simple-chat --rom zelda3.sfc</div>
<div class="line"> </div>
<div class="line"># Batch mode</div>
<div class="line">z3ed agent simple-chat --file queries.txt --rom zelda3.sfc</div>
</div><!-- fragment --><p><b>Proposal Workflow</b>: </p><div class="fragment"><div class="line"># Generate from prompt</div>
<div class="line">z3ed agent run --prompt &quot;Place tree at 10,10&quot; --rom zelda3.sfc --sandbox</div>
<div class="line"> </div>
<div class="line"># List proposals</div>
<div class="line">z3ed agent list</div>
<div class="line"> </div>
<div class="line"># Review</div>
<div class="line">z3ed agent diff --proposal-id &lt;id&gt;</div>
<div class="line"> </div>
<div class="line"># Accept</div>
<div class="line">z3ed agent accept --proposal-id &lt;id&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md466"></a>
3. Architecture</h1>
<p>The z3ed system is composed of several layers, from the high-level AI agent down to the YAZE GUI and test harness.</p>
<h2><a class="anchor" id="autotoc_md467"></a>
System Components Diagram</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────┐</div>
<div class="line">│ AI Agent Layer (LLM: Ollama, Gemini)                    │</div>
<div class="line">└────────────────────┬────────────────────────────────────┘</div>
<div class="line">                     │</div>
<div class="line">┌────────────────────▼────────────────────────────────────┐</div>
<div class="line">│ z3ed CLI (Command-Line Interface)                       │</div>
<div class="line">│  ├─ agent run/plan/diff/test/list/describe              │</div>
<div class="line">│  └─ rom/palette/overworld/dungeon commands              │</div>
<div class="line">└────────────────────┬────────────────────────────────────┘</div>
<div class="line">                     │</div>
<div class="line">┌────────────────────▼────────────────────────────────────┐</div>
<div class="line">│ Service Layer (Singleton Services)                      │</div>
<div class="line">│  ├─ ProposalRegistry (Proposal Tracking)                │</div>
<div class="line">│  ├─ RomSandboxManager (Isolated ROM Copies)             │</div>
<div class="line">│  ├─ ResourceCatalog (Machine-Readable API Specs)        │</div>
<div class="line">│  └─ ConversationalAgentService (Chat &amp; Tool Dispatch)   │</div>
<div class="line">└────────────────────┬────────────────────────────────────┘</div>
<div class="line">                     │</div>
<div class="line">┌────────────────────▼────────────────────────────────────┐</div>
<div class="line">│ ImGuiTestHarness (gRPC Server in YAZE)                  │</div>
<div class="line">│  ├─ Ping, Click, Type, Wait, Assert, Screenshot         │</div>
<div class="line">│  └─ Introspection &amp; Discovery RPCs                      │</div>
<div class="line">└────────────────────┬────────────────────────────────────┘</div>
<div class="line">                     │</div>
<div class="line">┌────────────────────▼────────────────────────────────────┐</div>
<div class="line">│ YAZE GUI (ImGui Application)                            │</div>
<div class="line">│  └─ ProposalDrawer &amp; Editor Windows                     │</div>
<div class="line">└─────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md468"></a>
4. Agentic &amp; Generative Workflow (MCP)</h1>
<p>The <code>z3ed</code> CLI is the foundation for an AI-driven Model-Code-Program (MCP) loop, where the AI agent's "program" is a script of <code>z3ed</code> commands.</p>
<ol type="1">
<li><b>Model (Planner)</b>: The agent receives a natural language prompt and leverages an LLM to create a plan, which is a sequence of <code>z3ed</code> commands.</li>
<li><b>Code (Generation)</b>: The LLM returns the plan as a structured JSON object containing actions.</li>
<li><b>Program (Execution)</b>: The <code>z3ed agent</code> parses the plan and executes each command sequentially in a sandboxed ROM environment.</li>
<li><b>Verification (Tester)</b>: The <code>ImGuiTestHarness</code> is used to run automated GUI tests to verify that the changes were applied correctly.</li>
</ol>
<h1><a class="anchor" id="autotoc_md469"></a>
5. Command Reference</h1>
<h2><a class="anchor" id="autotoc_md470"></a>
Agent Commands</h2>
<ul>
<li><code>agent run --prompt "..."</code>: Executes an AI-driven ROM modification in a sandbox.</li>
<li><code>agent plan --prompt "..."</code>: Shows the sequence of commands the AI plans to execute.</li>
<li><code>agent list</code>: Shows all proposals and their status.</li>
<li><code>agent diff [--proposal-id &lt;id&gt;]</code>: Shows the changes, logs, and metadata for a proposal.</li>
<li><code>agent describe [--resource &lt;name&gt;]</code>: Exports machine-readable API specifications for AI consumption.</li>
<li><code>agent chat</code>: Opens an interactive terminal chat (TUI) with the AI agent.</li>
<li><code>agent simple-chat</code>: A lightweight, non-TUI chat mode for scripting and automation.</li>
<li><code>agent test ...</code>: Commands for running and managing automated GUI tests.</li>
<li><code>agent learn ...</code>: <b>NEW</b>: Manage learned knowledge (preferences, ROM patterns, project context, conversation memory).</li>
</ul>
<h2><a class="anchor" id="autotoc_md471"></a>
Resource Commands</h2>
<ul>
<li><code>rom info|validate|diff</code>: Commands for ROM file inspection and comparison.</li>
<li><code>palette export|import|list</code>: Commands for palette manipulation.</li>
<li><code>overworld get-tile|find-tile|set-tile</code>: Commands for overworld editing.</li>
<li><code>dungeon list-sprites|list-rooms</code>: Commands for dungeon inspection.</li>
</ul>
<h1><a class="anchor" id="autotoc_md472"></a>
6. Chat Modes</h1>
<h2><a class="anchor" id="autotoc_md473"></a>
FTXUI Chat (&lt;tt&gt;agent chat&lt;/tt&gt;)</h2>
<p>Full-screen interactive terminal with table rendering, syntax highlighting, and scrollable history. Best for manual exploration.</p>
<h2><a class="anchor" id="autotoc_md474"></a>
Simple Chat (&lt;tt&gt;agent simple-chat&lt;/tt&gt;)</h2>
<p>Lightweight, scriptable text-based REPL that supports single messages, interactive sessions, piped input, and batch files.</p>
<h2><a class="anchor" id="autotoc_md475"></a>
GUI Chat Widget (Editor Integration)</h2>
<p>Accessible from <b>Debug → Agent Chat</b> inside YAZE. Provides the same conversation loop as the CLI, including streaming history, JSON/table inspection, and ROM-aware tool dispatch.</p>
<p><b>✨ New Features:</b></p><ul>
<li><b>Persistent Chat History</b>: Chat conversations are automatically saved and restored</li>
<li><b>Collaborative Sessions</b>: Multiple users can join the same session and share a chat history</li>
<li><b>Multimodal Vision</b>: Capture screenshots of your ROM editor and ask Gemini to analyze them</li>
</ul>
<h1><a class="anchor" id="autotoc_md476"></a>
7. AI Provider Configuration</h1>
<p>Z3ED supports multiple AI providers. Configuration is resolved with command-line flags taking precedence over environment variables.</p>
<ul>
<li><code>--ai_provider=&lt;provider&gt;</code>: Selects the AI provider (<code>mock</code>, <code>ollama</code>, <code>gemini</code>).</li>
<li><code>--ai_model=&lt;model&gt;</code>: Specifies the model name (e.g., <code>qwen2.5-coder:7b</code>, <code>gemini-2.5-flash</code>).</li>
<li><code>--gemini_api_key=&lt;key&gt;</code>: Your Gemini API key.</li>
<li><code>--ollama_host=&lt;url&gt;</code>: The URL for your Ollama server (default: <code><a href="http://localhost:11434">http://localhost:11434</a></code>).</li>
</ul>
<h2><a class="anchor" id="autotoc_md477"></a>
System Prompt Versions</h2>
<p>Z3ED includes multiple system prompt versions for different use cases:</p>
<ul>
<li><b>v1 (default)</b>: Original reactive prompt with basic tool calling</li>
<li><b>v2</b>: Enhanced with better JSON formatting and error handling</li>
<li><b>v3 (latest)</b>: Proactive prompt with intelligent tool chaining and implicit iteration - <b>RECOMMENDED</b></li>
</ul>
<p>To use v3 prompt: Set environment variable <code>Z3ED_PROMPT_VERSION=v3</code> or it will be auto-selected for Gemini 2.0+ models.</p>
<h1><a class="anchor" id="autotoc_md478"></a>
8. Learn Command - Knowledge Management</h1>
<p>The learn command enables the AI agent to remember preferences, patterns, and context across sessions.</p>
<h2><a class="anchor" id="autotoc_md479"></a>
Basic Usage</h2>
<div class="fragment"><div class="line"># Store a preference</div>
<div class="line">z3ed agent learn --preference &quot;default_palette=2&quot;</div>
<div class="line"> </div>
<div class="line"># Get a preference</div>
<div class="line">z3ed agent learn --get-preference default_palette</div>
<div class="line"> </div>
<div class="line"># List all preferences</div>
<div class="line">z3ed agent learn --list-preferences</div>
<div class="line"> </div>
<div class="line"># View statistics</div>
<div class="line">z3ed agent learn --stats</div>
<div class="line"> </div>
<div class="line"># Export all learned data</div>
<div class="line">z3ed agent learn --export my_learned_data.json</div>
<div class="line"> </div>
<div class="line"># Import learned data</div>
<div class="line">z3ed agent learn --import my_learned_data.json</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md480"></a>
Project Context</h2>
<p>Store project-specific information that the agent can reference:</p>
<div class="fragment"><div class="line"># Save project context</div>
<div class="line">z3ed agent learn --project &quot;myrom&quot; --context &quot;Vanilla+ difficulty hack, focus on dungeon redesign&quot;</div>
<div class="line"> </div>
<div class="line"># List projects</div>
<div class="line">z3ed agent learn --list-projects</div>
<div class="line"> </div>
<div class="line"># Get project details</div>
<div class="line">z3ed agent learn --get-project &quot;myrom&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md481"></a>
Conversation Memory</h2>
<p>The agent automatically stores summaries of conversations for future reference:</p>
<div class="fragment"><div class="line"># View recent memories</div>
<div class="line">z3ed agent learn --recent-memories 10</div>
<div class="line"> </div>
<div class="line"># Search memories by topic</div>
<div class="line">z3ed agent learn --search-memories &quot;room 5&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md482"></a>
Storage Location</h2>
<p>All learned data is stored in <code>~/.yaze/agent/</code>:</p><ul>
<li><code>preferences.json</code>: User preferences</li>
<li><code>patterns.json</code>: Learned ROM patterns</li>
<li><code>projects.json</code>: Project contexts</li>
<li><code>memories.json</code>: Conversation summaries</li>
</ul>
<h1><a class="anchor" id="autotoc_md483"></a>
9. CLI Output &amp; Help System</h1>
<p>The <code>z3ed</code> CLI features a modernized output system designed to be clean for users and informative for developers.</p>
<h2><a class="anchor" id="autotoc_md484"></a>
Verbose Logging</h2>
<p>By default, <code>z3ed</code> provides clean, user-facing output. For detailed debugging, including API calls and internal state, use the <code>--verbose</code> flag.</p>
<p><b>Default (Clean):</b> </p><div class="fragment"><div class="line">🤖 AI Provider: gemini</div>
<div class="line">   Model: gemini-2.5-flash</div>
<div class="line">⠋ Thinking...</div>
<div class="line">🔧 Calling tool: resource-list (type=room)</div>
<div class="line">✓ Tool executed successfully</div>
</div><!-- fragment --><p><b>Verbose Mode:</b> </p><div class="fragment"><div class="line"># z3ed agent simple-chat &quot;What is room 5?&quot; --verbose</div>
<div class="line">🤖 AI Provider: gemini</div>
<div class="line">   Model: gemini-2.5-flash</div>
<div class="line">[DEBUG] Initializing Gemini service...</div>
<div class="line">[DEBUG] Function calling: disabled</div>
<div class="line">[DEBUG] Using curl for HTTPS request...</div>
<div class="line">⠋ Thinking...</div>
<div class="line">[DEBUG] Parsing response...</div>
<div class="line">🔧 Calling tool: resource-list (type=room)</div>
<div class="line">✓ Tool executed successfully</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md485"></a>
Hierarchical Help System</h2>
<p>The help system is organized by category for easy navigation.</p>
<ul>
<li><b>Main Help</b>: <code>z3ed --help</code> or <code>z3ed -h</code> shows a high-level overview of command categories.</li>
<li><b>Category Help</b>: <code>z3ed help &lt;category&gt;</code> provides detailed information for a specific group of commands (e.g., <code>agent</code>, <code>patch</code>, <code>rom</code>).</li>
</ul>
<h1><a class="anchor" id="autotoc_md486"></a>
10. Collaborative Sessions &amp; Multimodal Vision</h1>
<h2><a class="anchor" id="autotoc_md487"></a>
Overview</h2>
<p>YAZE supports real-time collaboration for ROM hacking through dual modes: <b>Local</b> (filesystem-based) for same-machine collaboration, and <b>Network</b> (WebSocket-based via yaze-server v2.0) for internet-based collaboration with advanced features including ROM synchronization, snapshot sharing, and AI agent integration.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md489"></a>
Local Collaboration Mode</h2>
<p>Perfect for multiple YAZE instances on the same machine or cloud-synced folders (Dropbox, iCloud).</p>
<h3><a class="anchor" id="autotoc_md490"></a>
How to Use</h3>
<ol type="1">
<li>Open YAZE → <b>Debug → Agent Chat</b></li>
<li>Select **"Local"** mode</li>
<li><b>Host a Session:</b><ul>
<li>Enter session name: <code>Evening ROM Hack</code></li>
<li>Click **"Host Session"**</li>
<li>Share the 6-character code (e.g., <code>ABC123</code>)</li>
</ul>
</li>
<li><b>Join a Session:</b><ul>
<li>Enter the session code</li>
<li>Click **"Join Session"**</li>
<li>Chat history syncs automatically</li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md491"></a>
Features</h3>
<ul>
<li><b>Shared History</b>: <code>~/.yaze/agent/sessions/&lt;code&gt;_history.json</code></li>
<li><b>Auto-Sync</b>: 2-second polling for new messages</li>
<li><b>Participant Tracking</b>: Real-time participant list</li>
<li><b>Toast Notifications</b>: Get notified when collaborators send messages</li>
<li><b>Zero Setup</b>: No server required</li>
</ul>
<h3><a class="anchor" id="autotoc_md492"></a>
Cloud Folder Workaround</h3>
<p>Enable internet collaboration without a server:</p>
<div class="fragment"><div class="line"># Link your sessions directory to Dropbox/iCloud</div>
<div class="line">ln -s ~/Dropbox/yaze-sessions ~/.yaze/agent/sessions</div>
<div class="line"> </div>
<div class="line"># Have your collaborator do the same</div>
<div class="line"># Now you can collaborate through cloud sync!</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md494"></a>
Network Collaboration Mode (yaze-server v2.0)</h2>
<p>Real-time collaboration over the internet with advanced features powered by the yaze-server v2.0.</p>
<h3><a class="anchor" id="autotoc_md495"></a>
Requirements</h3>
<ul>
<li><b>Server</b>: Node.js 18+ with yaze-server running</li>
<li><b>Client</b>: YAZE built with <code>-DYAZE_WITH_GRPC=ON</code> and <code>-DZ3ED_AI=ON</code></li>
<li><b>Network</b>: Connectivity between collaborators</li>
</ul>
<h3><a class="anchor" id="autotoc_md496"></a>
Server Setup</h3>
<p><b>Option 1: Using z3ed CLI</b> </p><div class="fragment"><div class="line">z3ed collab start [--port=8765]</div>
</div><!-- fragment --><p><b>Option 2: Manual Launch</b> </p><div class="fragment"><div class="line">cd /path/to/yaze-server</div>
<div class="line">npm install</div>
<div class="line">npm start</div>
<div class="line"> </div>
<div class="line"># Server starts on http://localhost:8765</div>
<div class="line"># Health check: curl http://localhost:8765/health</div>
</div><!-- fragment --><p><b>Option 3: Docker</b> </p><div class="fragment"><div class="line">docker build -t yaze-server .</div>
<div class="line">docker run -p 8765:8765 yaze-server</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md497"></a>
Client Connection</h3>
<ol type="1">
<li>Open YAZE → <b>Debug → Agent Chat</b></li>
<li>Select **"Network"** mode</li>
<li>Enter server URL: <code>ws://localhost:8765</code> (or remote server)</li>
<li>Click **"Connect to Server"**</li>
<li>Host or join sessions like local mode</li>
</ol>
<h3><a class="anchor" id="autotoc_md498"></a>
Core Features</h3>
<p><b>Session Management:</b></p><ul>
<li>Unique 6-character session codes</li>
<li>Participant tracking with join/leave notifications</li>
<li>Real-time message broadcasting</li>
<li>Persistent chat history</li>
</ul>
<p><b>Connection Management:</b></p><ul>
<li>Health monitoring endpoints (<code>/health</code>, <code>/metrics</code>)</li>
<li>Graceful shutdown notifications</li>
<li>Automatic cleanup of inactive sessions</li>
<li>Rate limiting (100 messages/minute per IP)</li>
</ul>
<h3><a class="anchor" id="autotoc_md499"></a>
Advanced Features (v2.0)</h3>
<p><b>🎮 ROM Synchronization</b> Share ROM edits in real-time:</p><ul>
<li>Send base64-encoded diffs to all participants</li>
<li>Automatic ROM hash tracking</li>
<li>Size limit: 5MB per diff</li>
<li>Conflict detection via hash comparison</li>
</ul>
<p><b>📸 Multimodal Snapshot Sharing</b> Share screenshots and images:</p><ul>
<li>Capture and share specific editor views</li>
<li>Support for multiple snapshot types (overworld, dungeon, sprite, etc.)</li>
<li>Base64 encoding for efficient transfer</li>
<li>Size limit: 10MB per snapshot</li>
</ul>
<p><b>💡 Proposal Management</b> Collaborative proposal workflow:</p><ul>
<li>Share AI-generated proposals with all participants</li>
<li>Track proposal status: pending, accepted, rejected</li>
<li>Real-time status updates broadcast to all users</li>
<li>Proposal history tracked in server database</li>
</ul>
<p><b>🤖 AI Agent Integration</b> Server-routed AI queries:</p><ul>
<li>Send queries through the collaboration server</li>
<li>Shared AI responses visible to all participants</li>
<li>Query history tracked in database</li>
<li>Optional: Disable AI per session</li>
</ul>
<h3><a class="anchor" id="autotoc_md500"></a>
Protocol Reference</h3>
<p>The server uses JSON WebSocket messages over HTTP/WebSocket transport.</p>
<p><b>Client → Server Messages:</b></p>
<div class="fragment"><div class="line">// Host Session (v2.0 with optional ROM hash and AI control)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;host_session&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;session_name&quot;: &quot;My Session&quot;,</div>
<div class="line">    &quot;username&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;rom_hash&quot;: &quot;abc123...&quot;,  // optional</div>
<div class="line">    &quot;ai_enabled&quot;: true         // optional, default true</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Join Session</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;join_session&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;session_code&quot;: &quot;ABC123&quot;,</div>
<div class="line">    &quot;username&quot;: &quot;bob&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Chat Message (v2.0 with metadata support)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;chat_message&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;message&quot;: &quot;Hello!&quot;,</div>
<div class="line">    &quot;message_type&quot;: &quot;chat&quot;,    // optional: chat, system, ai</div>
<div class="line">    &quot;metadata&quot;: {...}          // optional metadata</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// ROM Sync (NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;rom_sync&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;diff_data&quot;: &quot;base64_encoded_diff...&quot;,</div>
<div class="line">    &quot;rom_hash&quot;: &quot;sha256_hash&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Snapshot Share (NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;snapshot_share&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;snapshot_data&quot;: &quot;base64_encoded_image...&quot;,</div>
<div class="line">    &quot;snapshot_type&quot;: &quot;overworld_editor&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Proposal Share (NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;proposal_share&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;proposal_data&quot;: {</div>
<div class="line">      &quot;title&quot;: &quot;Add new sprite&quot;,</div>
<div class="line">      &quot;description&quot;: &quot;...&quot;,</div>
<div class="line">      &quot;changes&quot;: [...]</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Proposal Update (NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;proposal_update&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;proposal_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;status&quot;: &quot;accepted&quot;  // pending, accepted, rejected</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// AI Query (NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;ai_query&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;username&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;query&quot;: &quot;What enemies are in the eastern palace?&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Leave Session</div>
<div class="line">{ &quot;type&quot;: &quot;leave_session&quot; }</div>
<div class="line"> </div>
<div class="line">// Ping</div>
<div class="line">{ &quot;type&quot;: &quot;ping&quot; }</div>
</div><!-- fragment --><p><b>Server → Client Messages:</b></p>
<div class="fragment"><div class="line">// Session Hosted</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;session_hosted&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;session_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;session_code&quot;: &quot;ABC123&quot;,</div>
<div class="line">    &quot;session_name&quot;: &quot;My Session&quot;,</div>
<div class="line">    &quot;participants&quot;: [&quot;alice&quot;],</div>
<div class="line">    &quot;rom_hash&quot;: &quot;abc123...&quot;,</div>
<div class="line">    &quot;ai_enabled&quot;: true</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Session Joined</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;session_joined&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;session_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;session_code&quot;: &quot;ABC123&quot;,</div>
<div class="line">    &quot;session_name&quot;: &quot;My Session&quot;,</div>
<div class="line">    &quot;participants&quot;: [&quot;alice&quot;, &quot;bob&quot;],</div>
<div class="line">    &quot;messages&quot;: [...]</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Chat Message (broadcast)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;chat_message&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;message&quot;: &quot;Hello!&quot;,</div>
<div class="line">    &quot;timestamp&quot;: 1709567890123,</div>
<div class="line">    &quot;message_type&quot;: &quot;chat&quot;,</div>
<div class="line">    &quot;metadata&quot;: null</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// ROM Sync (broadcast, NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;rom_sync&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;sync_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;diff_data&quot;: &quot;base64...&quot;,</div>
<div class="line">    &quot;rom_hash&quot;: &quot;sha256...&quot;,</div>
<div class="line">    &quot;timestamp&quot;: 1709567890123</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Snapshot Shared (broadcast, NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;snapshot_shared&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;snapshot_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;snapshot_data&quot;: &quot;base64...&quot;,</div>
<div class="line">    &quot;snapshot_type&quot;: &quot;overworld_editor&quot;,</div>
<div class="line">    &quot;timestamp&quot;: 1709567890123</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Proposal Shared (broadcast, NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;proposal_shared&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;proposal_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;sender&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;proposal_data&quot;: {...},</div>
<div class="line">    &quot;status&quot;: &quot;pending&quot;,</div>
<div class="line">    &quot;timestamp&quot;: 1709567890123</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Proposal Updated (broadcast, NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;proposal_updated&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;proposal_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;status&quot;: &quot;accepted&quot;,</div>
<div class="line">    &quot;timestamp&quot;: 1709567890123</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// AI Response (broadcast, NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;ai_response&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;query_id&quot;: &quot;uuid&quot;,</div>
<div class="line">    &quot;username&quot;: &quot;alice&quot;,</div>
<div class="line">    &quot;query&quot;: &quot;What enemies are in the eastern palace?&quot;,</div>
<div class="line">    &quot;response&quot;: &quot;The eastern palace contains...&quot;,</div>
<div class="line">    &quot;timestamp&quot;: 1709567890123</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Participant Events</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;participant_joined&quot;,  // or &quot;participant_left&quot;</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;username&quot;: &quot;bob&quot;,</div>
<div class="line">    &quot;participants&quot;: [&quot;alice&quot;, &quot;bob&quot;]</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Server Shutdown (NEW in v2.0)</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;server_shutdown&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;message&quot;: &quot;Server is shutting down. Please reconnect later.&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Pong</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;pong&quot;,</div>
<div class="line">  &quot;payload&quot;: { &quot;timestamp&quot;: 1709567890123 }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Error</div>
<div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;error&quot;,</div>
<div class="line">  &quot;payload&quot;: { &quot;error&quot;: &quot;Session ABC123 not found&quot; }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md501"></a>
Server Configuration</h3>
<p><b>Environment Variables:</b></p><ul>
<li><code>PORT</code> - Server port (default: 8765)</li>
<li><code>ENABLE_AI_AGENT</code> - Enable AI agent integration (default: true)</li>
<li><code>AI_AGENT_ENDPOINT</code> - External AI agent endpoint URL</li>
</ul>
<p><b>Rate Limiting:</b></p><ul>
<li>Window: 60 seconds</li>
<li>Max messages: 100 per IP per window</li>
<li>Max snapshot size: 10 MB</li>
<li>Max ROM diff size: 5 MB</li>
</ul>
<h3><a class="anchor" id="autotoc_md502"></a>
Database Schema (Server v2.0)</h3>
<p>The server uses SQLite with the following tables:</p>
<ul>
<li><b>sessions</b>: Session metadata, ROM hash, AI enabled flag</li>
<li><b>participants</b>: User tracking with last_seen timestamps</li>
<li><b>messages</b>: Chat history with message types and metadata</li>
<li><b>rom_syncs</b>: ROM diff history with hashes</li>
<li><b>snapshots</b>: Shared screenshots and images</li>
<li><b>proposals</b>: AI proposal tracking with status</li>
<li><b>agent_interactions</b>: AI query and response history</li>
</ul>
<h3><a class="anchor" id="autotoc_md503"></a>
Deployment</h3>
<p><b>Heroku:</b> </p><div class="fragment"><div class="line">cd /path/to/yaze-server</div>
<div class="line">heroku create yaze-collab</div>
<div class="line">git push heroku main</div>
<div class="line">heroku config:set ENABLE_AI_AGENT=true</div>
</div><!-- fragment --><p><b>VPS (with PM2):</b> </p><div class="fragment"><div class="line">git clone https://github.com/scawful/yaze-server</div>
<div class="line">   cd yaze-server</div>
<div class="line">   npm install</div>
<div class="line">npm install -g pm2</div>
<div class="line">pm2 start server.js --name yaze-collab</div>
<div class="line">pm2 startup</div>
<div class="line">pm2 save</div>
</div><!-- fragment --><p><b>Docker:</b> </p><div class="fragment"><div class="line">docker build -t yaze-server .</div>
<div class="line">docker run -p 8765:8765 -e ENABLE_AI_AGENT=true yaze-server</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md504"></a>
Testing</h3>
<p><b>Health Check:</b> </p><div class="fragment"><div class="line">curl http://localhost:8765/health</div>
<div class="line">curl http://localhost:8765/metrics</div>
</div><!-- fragment --><p><b>Test with wscat:</b> </p><div class="fragment"><div class="line">npm install -g wscat</div>
<div class="line">wscat -c ws://localhost:8765</div>
<div class="line"> </div>
<div class="line"># Host session</div>
<div class="line">&gt; {&quot;type&quot;:&quot;host_session&quot;,&quot;payload&quot;:{&quot;session_name&quot;:&quot;Test&quot;,&quot;username&quot;:&quot;alice&quot;,&quot;ai_enabled&quot;:true}}</div>
<div class="line"> </div>
<div class="line"># Join session (in another terminal)</div>
<div class="line">&gt; {&quot;type&quot;:&quot;join_session&quot;,&quot;payload&quot;:{&quot;session_code&quot;:&quot;ABC123&quot;,&quot;username&quot;:&quot;bob&quot;}}</div>
<div class="line"> </div>
<div class="line"># Send message</div>
<div class="line">&gt; {&quot;type&quot;:&quot;chat_message&quot;,&quot;payload&quot;:{&quot;sender&quot;:&quot;alice&quot;,&quot;message&quot;:&quot;Hello!&quot;}}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md505"></a>
Security Considerations</h3>
<p><b>Current Implementation:</b> ⚠️ Basic security - suitable for trusted networks</p><ul>
<li>No authentication or encryption by default</li>
<li>Plain text message transmission</li>
<li>Session codes are the only access control</li>
</ul>
<p><b>Recommended for Production:</b></p><ol type="1">
<li><b>SSL/TLS</b>: Use <code>wss://</code> with valid certificates</li>
<li><b>Authentication</b>: Implement JWT tokens or OAuth</li>
<li><b>Session Passwords</b>: Optional per-session passwords</li>
<li><b>Persistent Storage</b>: Use PostgreSQL/MySQL for production</li>
<li><b>Monitoring</b>: Add logging to CloudWatch/Datadog</li>
<li><b>Backup</b>: Regular database backups</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md507"></a>
Multimodal Vision (Gemini)</h2>
<p>Analyze screenshots of your ROM editor using Gemini's vision capabilities for visual feedback and suggestions.</p>
<h3><a class="anchor" id="autotoc_md508"></a>
Requirements</h3>
<ul>
<li><code>GEMINI_API_KEY</code> environment variable set</li>
<li>YAZE built with <code>-DYAZE_WITH_GRPC=ON</code> and <code>-DZ3ED_AI=ON</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md509"></a>
Capture Modes</h3>
<p><b>Full Window</b>: Captures the entire YAZE application window</p>
<p><b>Active Editor</b> (default): Captures only the currently focused editor window</p>
<p><b>Specific Window</b>: Captures a named window (e.g., "Overworld Editor")</p>
<h3><a class="anchor" id="autotoc_md510"></a>
How to Use</h3>
<ol type="1">
<li>Open <b>Debug → Agent Chat</b></li>
<li>Expand **"Gemini Multimodal (Preview)"** panel</li>
<li>Select capture mode:<ul>
<li>○ Full Window</li>
<li>● Active Editor (default)</li>
<li>○ Specific Window</li>
</ul>
</li>
<li>If Specific Window, enter window name: <code>Overworld Editor</code></li>
<li>Click **"Capture Snapshot"**</li>
<li>Enter prompt: <code>"What issues do you see with this layout?"</code></li>
<li>Click **"Send to Gemini"**</li>
</ol>
<h3><a class="anchor" id="autotoc_md511"></a>
Example Prompts</h3>
<ul>
<li>"Analyze the tile placement in this overworld screen"</li>
<li>"What's wrong with the palette colors in this screenshot?"</li>
<li>"Suggest improvements for this dungeon room layout"</li>
<li>"Does this screen follow good level design practices?"</li>
<li>"Are there any visual glitches or tile conflicts?"</li>
<li>"How can I improve the composition of this room?"</li>
</ul>
<p>The AI response appears in your chat history and can reference specific details from the screenshot. In network collaboration mode, multimodal snapshots can be shared with all participants.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md513"></a>
Architecture</h2>
<div class="fragment"><div class="line">┌──────────────────────────────────────────────────────┐</div>
<div class="line">│                    YAZE Editor                       │</div>
<div class="line">│                                                      │</div>
<div class="line">│  ┌─────────────────────────────────────────────┐   │</div>
<div class="line">│  │         Agent Chat Widget (ImGui)           │   │</div>
<div class="line">│  │                                             │   │</div>
<div class="line">│  │  [Collaboration Panel]                      │   │</div>
<div class="line">│  │  ├─ Local Mode (filesystem)  ✓ Working     │   │</div>
<div class="line">│  │  └─ Network Mode (websocket) ✓ Working     │   │</div>
<div class="line">│  │                                             │   │</div>
<div class="line">│  │  [Multimodal Panel]                         │   │</div>
<div class="line">│  │  ├─ Capture Mode Selection   ✓ Working     │   │</div>
<div class="line">│  │  ├─ Screenshot Capture        ✓ Working     │   │</div>
<div class="line">│  │  └─ Send to Gemini           ✓ Working     │   │</div>
<div class="line">│  └─────────────────────────────────────────────┘   │</div>
<div class="line">│           │                    │                    │</div>
<div class="line">│           ▼                    ▼                    │</div>
<div class="line">│  ┌──────────────────┐  ┌──────────────────┐       │</div>
<div class="line">│  │  Collaboration   │  │  Screenshot      │       │</div>
<div class="line">│  │  Coordinators    │  │  Utils           │       │</div>
<div class="line">│  └──────────────────┘  └──────────────────┘       │</div>
<div class="line">│           │                    │                    │</div>
<div class="line">└───────────┼────────────────────┼────────────────────┘</div>
<div class="line">            │                    │</div>
<div class="line">            ▼                    ▼</div>
<div class="line">┌──────────────────┐    ┌──────────────────┐</div>
<div class="line">│  ~/.yaze/agent/  │    │  Gemini Vision   │</div>
<div class="line">│    sessions/     │    │      API         │</div>
<div class="line">└──────────────────┘    └──────────────────┘</div>
<div class="line">            │</div>
<div class="line">            ▼</div>
<div class="line">┌──────────────────────────────────────────┐</div>
<div class="line">│         yaze-server v2.0                 │</div>
<div class="line">│  - WebSocket Server (Node.js)            │</div>
<div class="line">│  - SQLite Database                       │</div>
<div class="line">│  - Session Management                    │</div>
<div class="line">│  - ROM Sync                              │</div>
<div class="line">│  - Snapshot Sharing                      │</div>
<div class="line">│  - Proposal Management                   │</div>
<div class="line">│  - AI Agent Integration                  │</div>
<div class="line">└──────────────────────────────────────────┘</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md515"></a>
Troubleshooting</h2>
<p>**"Failed to start collaboration server"**</p><ul>
<li>Ensure Node.js is installed: <code>node --version</code></li>
<li>Check port availability: <code>lsof -i :8765</code></li>
<li>Verify server directory exists</li>
</ul>
<p>**"Not connected to collaboration server"**</p><ul>
<li>Verify server is running: <code>curl <a href="http://localhost:8765/health">http://localhost:8765/health</a></code></li>
<li>Check firewall settings</li>
<li>Confirm server URL is correct</li>
</ul>
<p>**"Session not found"**</p><ul>
<li>Verify session code is correct (case-insensitive)</li>
<li>Check if session expired (server restart clears sessions)</li>
<li>Try hosting a new session</li>
</ul>
<p>**"Rate limit exceeded"**</p><ul>
<li>Server enforces 100 messages per minute per IP</li>
<li>Wait 60 seconds and try again</li>
</ul>
<p><b>Participants not updating</b></p><ul>
<li>Click "Refresh Session" button</li>
<li>Check network connectivity</li>
<li>Verify server logs for errors</li>
</ul>
<p><b>Messages not broadcasting</b></p><ul>
<li>Ensure all clients are in the same session</li>
<li>Check session code matches exactly</li>
<li>Verify network connectivity between client and server</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md517"></a>
References</h2>
<ul>
<li><b>Server Repository</b>: <a href="https://github.com/scawful/yaze-server">yaze-server</a></li>
<li><b>Agent Editor Docs</b>: <code><a class="el" href="../../de/dc6/src_2app_2editor_2agent_2README_8md.html">src/app/editor/agent/README.md</a></code></li>
<li><b>Integration Guide</b>: <code>docs/z3ed/YAZE_SERVER_V2_INTEGRATION.md</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md518"></a>
11. Roadmap &amp; Implementation Status</h1>
<p><b>Last Updated</b>: October 4, 2025</p>
<h2><a class="anchor" id="autotoc_md519"></a>
✅ Completed</h2>
<ul>
<li><b>Core Infrastructure</b>: Resource-oriented CLI, proposal workflow, sandbox manager, and resource catalog are all production-ready.</li>
<li><b>AI Backends</b>: Both Ollama (local) and Gemini (cloud) are operational.</li>
<li><b>Conversational Agent</b>: The agent service, tool dispatcher (with 5 read-only tools), TUI/simple chat interfaces, and <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> editor chat widget with persistent history.</li>
<li><b>GUI Test Harness</b>: A comprehensive GUI testing platform with introspection, widget discovery, recording/replay, and CI integration support.</li>
<li><b>Collaborative Sessions</b>:<ul>
<li>Local filesystem-based collaborative editing with shared chat history</li>
<li>Network WebSocket-based collaboration via yaze-server v2.0</li>
<li>Dual-mode support (Local/Network) with seamless switching</li>
</ul>
</li>
<li><b>Multimodal Vision</b>: Gemini vision API integration with multiple capture modes (Full Window, Active Editor, Specific Window).</li>
<li><b>yaze-server v2.0</b>: Production-ready Node.js WebSocket server with:<ul>
<li>ROM synchronization with diff broadcasting</li>
<li>Multimodal snapshot sharing</li>
<li>Collaborative proposal management</li>
<li>AI agent integration and query routing</li>
<li>Health monitoring and metrics endpoints</li>
<li>Rate limiting and security features</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md520"></a>
🚧 Active &amp; Next Steps</h2>
<ol type="1">
<li><b>Live LLM Testing (1-2h)</b>: Verify function calling with real models (Ollama/Gemini).</li>
<li><b>Expand Tool Coverage (8-10h)</b>: Add new read-only tools for inspecting dialogue, sprites, and regions.</li>
<li><b>Full WebSocket Protocol (2-3 days)</b>: Upgrade from HTTP polling to true WebSocket frames using ixwebsocket or websocketpp.</li>
<li><b>Collaboration UI Enhancements (1 day)</b>: Add UI elements for ROM sync, snapshot sharing, and proposal management in the Agent Chat widget.</li>
<li><b>Windows Cross-Platform Testing (8-10h)</b>: Validate <code>z3ed</code> and the test harness on Windows.</li>
</ol>
<h2><a class="anchor" id="autotoc_md521"></a>
✅ Recently Completed (v0.2.0-alpha - October 5, 2025)</h2>
<ul>
<li><b>Enhanced System Prompt (v3)</b>: Proactive tool chaining with implicit iteration to minimize back-and-forth conversations</li>
<li><b>Learn Command</b>: Full implementation with preferences, ROM patterns, project context, and conversation memory storage</li>
<li><b>Native Gemini Function Calling</b>: Upgraded from manual curl to native function calling API with automatic tool schema generation</li>
<li><b>Multimodal Vision Testing</b>: Comprehensive test suite for Gemini vision capabilities with screenshot integration</li>
<li><b>AI-Controlled GUI Automation</b>: Natural language parsing (<code>AIActionParser</code>) and test script generation (<code>GuiActionGenerator</code>) for automated tile placement</li>
<li><b>gRPC Windows Build Optimization</b>: vcpkg integration for 10-20x faster Windows builds, removed abseil-cpp submodule <br  />
</li>
<li><b>Collaboration UI Panel</b>: New <code>CollaborationPanel</code> widget with ROM sync history, snapshot gallery, and proposal management</li>
<li><b>Improved Documentation</b>: Consolidated architecture, enhancement plans, and build instructions with JSON-first approach</li>
</ul>
<h1><a class="anchor" id="autotoc_md522"></a>
12. Troubleshooting</h1>
<ul>
<li>**"Build with -DZ3ED_AI=ON" warning**: AI features are disabled. Rebuild with the flag to enable them.</li>
<li>**"gRPC not available" error**: GUI testing is disabled. Rebuild with <code>-DYAZE_WITH_GRPC=ON</code>.</li>
<li><b>AI generates invalid commands</b>: The prompt may be vague. Use specific coordinates, tile IDs, and map context.</li>
<li><b>Chat mode freezes</b>: Use <code>agent simple-chat</code> instead of the FTXUI-based <code>agent chat</code> for better stability, especially in scripts. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
