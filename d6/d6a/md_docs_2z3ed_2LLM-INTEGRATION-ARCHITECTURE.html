<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: LLM Integration Architecture</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/d6a/md_docs_2z3ed_2LLM-INTEGRATION-ARCHITECTURE.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">LLM Integration Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1606"></a> <b>Visual Overview of z3ed Agent System with LLM Providers</b></p>
<h1><a class="anchor" id="autotoc_md1607"></a>
System Architecture</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                         User / Developer                             │</div>
<div class="line">└────────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             │ Natural Language Prompt</div>
<div class="line">                             │ &quot;Make soldier armor red&quot;</div>
<div class="line">                             ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                       z3ed CLI (Entry Point)                         │</div>
<div class="line">│                                                                       │</div>
<div class="line">│  ┌────────────────────────────────────────────────────────────┐     │</div>
<div class="line">│  │  z3ed agent run --prompt &quot;...&quot; --rom zelda3.sfc --sandbox  │     │</div>
<div class="line">│  └────────────────────────────────────────────────────────────┘     │</div>
<div class="line">└────────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             │ Invoke</div>
<div class="line">                             ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                    Agent Command Handler                             │</div>
<div class="line">│                  (src/cli/handlers/agent/)                           │</div>
<div class="line">│                                                                       │</div>
<div class="line">│  • Parse arguments                                                   │</div>
<div class="line">│  • Create proposal                                                   │</div>
<div class="line">│  • Select AI service ◄────────── Environment Variables              │</div>
<div class="line">│  • Execute commands                                                  │</div>
<div class="line">│  • Track in registry                                                 │</div>
<div class="line">└────────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             │ Get Commands</div>
<div class="line">                             ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                      AI Service Factory                              │</div>
<div class="line">│                   (CreateAIService() helper)                         │</div>
<div class="line">│                                                                       │</div>
<div class="line">│  Environment Detection:                                              │</div>
<div class="line">│  • YAZE_AI_PROVIDER=ollama   → OllamaAIService                       │</div>
<div class="line">│  • GEMINI_API_KEY set        → GeminiAIService                       │</div>
<div class="line">│  • CLAUDE_API_KEY set        → ClaudeAIService                       │</div>
<div class="line">│  • Default                   → MockAIService                         │</div>
<div class="line">└─────────┬───────────────────┬────────────────┬───────────────────────┘</div>
<div class="line">          │                   │                │</div>
<div class="line">          │                   │                │</div>
<div class="line">          ▼                   ▼                ▼</div>
<div class="line">┌──────────────────┐ ┌──────────────┐ ┌─────────────────┐</div>
<div class="line">│ OllamaAIService  │ │ GeminiAI     │ │ ClaudeAIService │</div>
<div class="line">│                  │ │ Service      │ │                 │</div>
<div class="line">│ • Local LLM     │ │ • Remote API │ │ • Remote API    │</div>
<div class="line">│ • Free          │ │ • API Key    │ │ • API Key       │</div>
<div class="line">│ • Private       │ │ • $0.10/1M   │ │ • Free tier     │</div>
<div class="line">│ • Fast          │ │   tokens     │ │ • Best quality  │</div>
<div class="line">└────────┬─────────┘ └──────┬───────┘ └────────┬────────┘</div>
<div class="line">         │                  │                   │</div>
<div class="line">         │                  │                   │</div>
<div class="line">         ▼                  ▼                   ▼</div>
<div class="line">┌──────────────────────────────────────────────────────────┐</div>
<div class="line">│              AIService Interface                          │</div>
<div class="line">│                                                            │</div>
<div class="line">│  virtual absl::StatusOr&lt;vector&lt;string&gt;&gt;                   │</div>
<div class="line">│      GetCommands(const string&amp; prompt) = 0;               │</div>
<div class="line">└────────────────────────────┬──────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             │ Return Commands</div>
<div class="line">                             ▼</div>
<div class="line">                   [&quot;rom validate --rom zelda3.sfc&quot;,</div>
<div class="line">                    &quot;palette export --group sprites ...&quot;,</div>
<div class="line">                    &quot;palette set-color --file ... --color FF0000&quot;]</div>
<div class="line">                             │</div>
<div class="line">                             ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                    Command Execution Engine                          │</div>
<div class="line">│                                                                       │</div>
<div class="line">│  For each command:                                                   │</div>
<div class="line">│  1. Parse command string                                             │</div>
<div class="line">│  2. Lookup handler in ModernCLI registry                            │</div>
<div class="line">│  3. Execute in sandbox ROM                                           │</div>
<div class="line">│  4. Log to ProposalRegistry                                          │</div>
<div class="line">│  5. Capture output/errors                                            │</div>
<div class="line">└────────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                      Proposal Registry                               │</div>
<div class="line">│                 (Cross-session persistence)                          │</div>
<div class="line">│                                                                       │</div>
<div class="line">│  • Proposal metadata (ID, timestamp, prompt)                        │</div>
<div class="line">│  • Execution logs (commands, status, duration)                      │</div>
<div class="line">│  • ROM diff (before/after sandbox state)                            │</div>
<div class="line">│  • Status (pending, accepted, rejected)                             │</div>
<div class="line">└────────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             ▼</div>
<div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                    Human Review (GUI)                                │</div>
<div class="line">│                 YAZE Editor → Debug → Agent Proposals                │</div>
<div class="line">│                                                                       │</div>
<div class="line">│  • View proposal details                                             │</div>
<div class="line">│  • Inspect ROM diff visually                                         │</div>
<div class="line">│  • Test in GUI editors                                               │</div>
<div class="line">│  • Accept → Merge to main ROM                                        │</div>
<div class="line">│  • Reject → Discard sandbox                                          │</div>
<div class="line">└─────────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1608"></a>
LLM Provider Flow</h1>
<h2><a class="anchor" id="autotoc_md1609"></a>
Ollama (Local)</h2>
<div class="fragment"><div class="line">User Prompt</div>
<div class="line">     │</div>
<div class="line">     ▼</div>
<div class="line">OllamaAIService</div>
<div class="line">     │</div>
<div class="line">     ├─► Check Health (http://localhost:11434/api/tags)</div>
<div class="line">     │   └─► Model Available? ────No──► Error: &quot;Pull qwen2.5-coder:7b&quot;</div>
<div class="line">     │                          └─Yes</div>
<div class="line">     │</div>
<div class="line">     ├─► Build System Prompt</div>
<div class="line">     │   • Load z3ed-resources.yaml</div>
<div class="line">     │   • Add few-shot examples</div>
<div class="line">     │   • Inject ROM context</div>
<div class="line">     │</div>
<div class="line">     ├─► POST /api/generate</div>
<div class="line">     │   {</div>
<div class="line">     │     &quot;model&quot;: &quot;qwen2.5-coder:7b&quot;,</div>
<div class="line">     │     &quot;prompt&quot;: &quot;&lt;system&gt; + &lt;user&gt;&quot;,</div>
<div class="line">     │     &quot;temperature&quot;: 0.1,</div>
<div class="line">     │     &quot;format&quot;: &quot;json&quot;</div>
<div class="line">     │   }</div>
<div class="line">     │</div>
<div class="line">     ├─► Parse Response</div>
<div class="line">     │   [&quot;command1&quot;, &quot;command2&quot;, ...]</div>
<div class="line">     │</div>
<div class="line">     └─► Return to Agent Handler</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1610"></a>
Gemini (Remote)</h2>
<div class="fragment"><div class="line">User Prompt</div>
<div class="line">     │</div>
<div class="line">     ▼</div>
<div class="line">GeminiAIService</div>
<div class="line">     │</div>
<div class="line">     ├─► Check API Key</div>
<div class="line">     │   └─► Not Set? ────► Error: &quot;Set GEMINI_API_KEY&quot;</div>
<div class="line">     │</div>
<div class="line">     ├─► Build Request</div>
<div class="line">     │   {</div>
<div class="line">     │     &quot;contents&quot;: [{</div>
<div class="line">     │       &quot;role&quot;: &quot;user&quot;,</div>
<div class="line">     │       &quot;parts&quot;: [{&quot;text&quot;: &quot;&lt;system&gt; + &lt;prompt&gt;&quot;}]</div>
<div class="line">     │     }],</div>
<div class="line">     │     &quot;generationConfig&quot;: {</div>
<div class="line">     │       &quot;temperature&quot;: 0.1,</div>
<div class="line">     │       &quot;maxOutputTokens&quot;: 2048</div>
<div class="line">     │     }</div>
<div class="line">     │   }</div>
<div class="line">     │</div>
<div class="line">     ├─► POST https://generativelanguage.googleapis.com/</div>
<div class="line">     │         v1beta/models/gemini-2.5-flash:generateContent</div>
<div class="line">     │</div>
<div class="line">     ├─► Parse Response</div>
<div class="line">     │   • Extract text from nested JSON</div>
<div class="line">     │   • Strip markdown code blocks if present</div>
<div class="line">     │   • Parse JSON array</div>
<div class="line">     │</div>
<div class="line">     └─► Return Commands</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1611"></a>
Claude (Remote)</h2>
<div class="fragment"><div class="line">User Prompt</div>
<div class="line">     │</div>
<div class="line">     ▼</div>
<div class="line">ClaudeAIService</div>
<div class="line">     │</div>
<div class="line">     ├─► Check API Key</div>
<div class="line">     │   └─► Not Set? ────► Error: &quot;Set CLAUDE_API_KEY&quot;</div>
<div class="line">     │</div>
<div class="line">     ├─► Build Request</div>
<div class="line">     │   {</div>
<div class="line">     │     &quot;model&quot;: &quot;claude-3-5-sonnet-20241022&quot;,</div>
<div class="line">     │     &quot;max_tokens&quot;: 2048,</div>
<div class="line">     │     &quot;temperature&quot;: 0.1,</div>
<div class="line">     │     &quot;system&quot;: &quot;&lt;system instructions&gt;&quot;,</div>
<div class="line">     │     &quot;messages&quot;: [{</div>
<div class="line">     │       &quot;role&quot;: &quot;user&quot;,</div>
<div class="line">     │       &quot;content&quot;: &quot;&lt;prompt&gt;&quot;</div>
<div class="line">     │     }]</div>
<div class="line">     │   }</div>
<div class="line">     │</div>
<div class="line">     ├─► POST https://api.anthropic.com/v1/messages</div>
<div class="line">     │</div>
<div class="line">     ├─► Parse Response</div>
<div class="line">     │   • Extract text from content[0].text</div>
<div class="line">     │   • Strip markdown if present</div>
<div class="line">     │   • Parse JSON array</div>
<div class="line">     │</div>
<div class="line">     └─► Return Commands</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1612"></a>
Prompt Engineering Pipeline</h1>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────────┐</div>
<div class="line">│                         PromptBuilder                                │</div>
<div class="line">│                   (Comprehensive System Prompt)                      │</div>
<div class="line">└────────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                             │</div>
<div class="line">                             ├─► 1. Load Resource Catalogue</div>
<div class="line">                             │   Source: docs/api/z3ed-resources.yaml</div>
<div class="line">                             │   • All command schemas</div>
<div class="line">                             │   • Argument types &amp; descriptions</div>
<div class="line">                             │   • Expected effects &amp; returns</div>
<div class="line">                             │</div>
<div class="line">                             ├─► 2. Add Few-Shot Examples</div>
<div class="line">                             │   Proven prompt → command pairs:</div>
<div class="line">                             │   • &quot;Validate ROM&quot; → [&quot;rom validate ...&quot;]</div>
<div class="line">                             │   • &quot;Red armor&quot; → [&quot;palette export ...&quot;, ...]</div>
<div class="line">                             │</div>
<div class="line">                             ├─► 3. Inject ROM Context</div>
<div class="line">                             │   Current state from application:</div>
<div class="line">                             │   • Loaded ROM path</div>
<div class="line">                             │   • Open editors (Overworld, Dungeon)</div>
<div class="line">                             │   • Recently modified assets</div>
<div class="line">                             │</div>
<div class="line">                             ├─► 4. Set Output Format Rules</div>
<div class="line">                             │   • MUST return JSON array of strings</div>
<div class="line">                             │   • Each string is executable z3ed command</div>
<div class="line">                             │   • No explanations or markdown</div>
<div class="line">                             │</div>
<div class="line">                             └─► 5. Combine into Final Prompt</div>
<div class="line">                                 System Prompt (~2K tokens) + User Prompt</div>
<div class="line">                                      │</div>
<div class="line">                                      ▼</div>
<div class="line">                              Sent to LLM Provider</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1613"></a>
Error Handling &amp; Fallback Chain</h1>
<div class="fragment"><div class="line">User Request</div>
<div class="line">     │</div>
<div class="line">     ▼</div>
<div class="line">Select Provider (YAZE_AI_PROVIDER)</div>
<div class="line">     │</div>
<div class="line">     ├─► Ollama Selected</div>
<div class="line">     │   │</div>
<div class="line">     │   ├─► Health Check</div>
<div class="line">     │   │   └─► Failed? ────► Warn + Fallback to MockAIService</div>
<div class="line">     │   │                     &quot;⚠️ Ollama unavailable, using mock&quot;</div>
<div class="line">     │   │</div>
<div class="line">     │   └─► Model Check</div>
<div class="line">     │       └─► Missing? ───► Error + Suggestion</div>
<div class="line">     │                         &quot;Pull model: ollama pull qwen2.5-coder:7b&quot;</div>
<div class="line">     │</div>
<div class="line">     ├─► Gemini Selected</div>
<div class="line">     │   │</div>
<div class="line">     │   ├─► API Key Check</div>
<div class="line">     │   │   └─► Missing? ───► Fallback to MockAIService</div>
<div class="line">     │   │                     &quot;Set GEMINI_API_KEY or use Ollama&quot;</div>
<div class="line">     │   │</div>
<div class="line">     │   └─► API Call</div>
<div class="line">     │       ├─► Network Error? ───► Retry (3x with backoff)</div>
<div class="line">     │       └─► Rate Limit? ──────► Error + Wait Suggestion</div>
<div class="line">     │</div>
<div class="line">     └─► Claude Selected</div>
<div class="line">         │</div>
<div class="line">         └─► Similar to Gemini</div>
<div class="line">             (API key check → Fallback → Retry logic)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1614"></a>
File Structure</h1>
<div class="fragment"><div class="line">yaze/</div>
<div class="line">├── src/cli/service/</div>
<div class="line">│   ├── ai_service.h              # Base interface</div>
<div class="line">│   ├── ai_service.cc             # MockAIService implementation</div>
<div class="line">│   ├── ollama_ai_service.h       # 🆕 Ollama integration</div>
<div class="line">│   ├── ollama_ai_service.cc      # 🆕 Implementation</div>
<div class="line">│   ├── gemini_ai_service.h       # Existing (needs fixes)</div>
<div class="line">│   ├── gemini_ai_service.cc      # Existing (needs fixes)</div>
<div class="line">│   ├── claude_ai_service.h       # 🆕 Claude integration</div>
<div class="line">│   ├── claude_ai_service.cc      # 🆕 Implementation</div>
<div class="line">│   ├── prompt_builder.h          # 🆕 Prompt engineering utility</div>
<div class="line">│   └── prompt_builder.cc         # 🆕 Implementation</div>
<div class="line">│</div>
<div class="line">├── src/cli/handlers/agent/</div>
<div class="line">│   └── general_commands.cc       # 🔧 Add CreateAIService() factory</div>
<div class="line">│</div>
<div class="line">├── docs/z3ed/</div>
<div class="line">│   ├── LLM-INTEGRATION-PLAN.md           # 📋 Complete guide (this file)</div>
<div class="line">│   ├── LLM-IMPLEMENTATION-CHECKLIST.md   # ✅ Task checklist</div>
<div class="line">│   ├── LLM-INTEGRATION-SUMMARY.md        # 📄 Executive summary</div>
<div class="line">│   ├── LLM-INTEGRATION-ARCHITECTURE.md   # 🏗️ Visual diagrams (this file)</div>
<div class="line">│   └── AI-SERVICE-SETUP.md               # 📖 User guide (future)</div>
<div class="line">│</div>
<div class="line">└── scripts/</div>
<div class="line">    ├── quickstart_ollama.sh      # 🚀 Automated setup test</div>
<div class="line">    └── test_ai_services.sh       # 🧪 Integration tests</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1615"></a>
Data Flow Example: "Make soldier armor red"</h1>
<div class="fragment"><div class="line">1. User Input</div>
<div class="line">   $ z3ed agent run --prompt &quot;Make soldier armor red&quot; --rom zelda3.sfc --sandbox</div>
<div class="line"> </div>
<div class="line">2. Agent Handler</div>
<div class="line">   • Create proposal (ID: agent_20251003_143022)</div>
<div class="line">   • Create sandbox (/tmp/yaze_sandbox_abc123/zelda3.sfc)</div>
<div class="line">   • Select AI service (Ollama detected)</div>
<div class="line"> </div>
<div class="line">3. Ollama Service</div>
<div class="line">   • Check health: ✓ Running on localhost:11434</div>
<div class="line">   • Check model: ✓ qwen2.5-coder:7b available</div>
<div class="line">   • Build prompt:</div>
<div class="line">     System: &quot;&lt;full resource catalogue&gt; + &lt;few-shot examples&gt;&quot;</div>
<div class="line">     User: &quot;Make soldier armor red&quot;</div>
<div class="line">   • Call API: POST /api/generate</div>
<div class="line">   • Response: </div>
</div><!-- fragment --><p> json { "response": "[\"palette export &amp;ndash;group sprites &amp;ndash;id soldier &amp;ndash;to /tmp/soldier.pal\", \"palette set-color &amp;ndash;file /tmp/soldier.pal &amp;ndash;index 5 &amp;ndash;color FF0000\", \"palette import &amp;ndash;group sprites &amp;ndash;id soldier &amp;ndash;from /tmp/soldier.pal\"]" } </p><div class="fragment"><div class="line">   • Parse: Extract 3 commands</div>
<div class="line"> </div>
<div class="line">4. Command Execution</div>
<div class="line">   ┌────────────────────────────────────────────────────────┐</div>
<div class="line">   │ Command 1: palette export --group sprites --id soldier │</div>
<div class="line">   │ Handler: PaletteHandler::HandleExport()                │</div>
<div class="line">   │ Status: ✓ Success (wrote /tmp/soldier.pal)             │</div>
<div class="line">   │ Duration: 45ms                                          │</div>
<div class="line">   ├────────────────────────────────────────────────────────┤</div>
<div class="line">   │ Command 2: palette set-color --file /tmp/soldier.pal   │</div>
<div class="line">   │ Handler: PaletteHandler::HandleSetColor()              │</div>
<div class="line">   │ Status: ✓ Success (modified index 5 → #FF0000)         │</div>
<div class="line">   │ Duration: 12ms                                          │</div>
<div class="line">   ├────────────────────────────────────────────────────────┤</div>
<div class="line">   │ Command 3: palette import --group sprites --id soldier │</div>
<div class="line">   │ Handler: PaletteHandler::HandleImport()                │</div>
<div class="line">   │ Status: ✓ Success (applied to sandbox ROM)             │</div>
<div class="line">   │ Duration: 78ms                                          │</div>
<div class="line">   └────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">5. Proposal Registry</div>
<div class="line">   • Log all commands</div>
<div class="line">   • Calculate ROM diff (before/after)</div>
<div class="line">   • Set status: PENDING_REVIEW</div>
<div class="line"> </div>
<div class="line">6. Output to User</div>
<div class="line">   ✅ Agent run completed successfully.</div>
<div class="line">      Proposal ID: agent_20251003_143022</div>
<div class="line">      Sandbox: /tmp/yaze_sandbox_abc123/zelda3.sfc</div>
<div class="line">      Use &#39;z3ed agent diff&#39; to review changes</div>
<div class="line"> </div>
<div class="line">7. User Review</div>
<div class="line">   $ z3ed agent diff</div>
<div class="line">   </div>
<div class="line">   Proposal: agent_20251003_143022</div>
<div class="line">   Prompt: &quot;Make soldier armor red&quot;</div>
<div class="line">   Status: pending</div>
<div class="line">   Created: 2025-10-03 14:30:22</div>
<div class="line">   </div>
<div class="line">   Executed Commands:</div>
<div class="line">     1. palette export --group sprites --id soldier --to /tmp/soldier.pal</div>
<div class="line">     2. palette set-color --file /tmp/soldier.pal --index 5 --color FF0000</div>
<div class="line">     3. palette import --group sprites --id soldier --from /tmp/soldier.pal</div>
<div class="line">   </div>
<div class="line">   ROM Diff:</div>
<div class="line">     Modified palettes: [sprites/soldier]</div>
<div class="line">     Changed bytes: 6</div>
<div class="line">     Offset 0x12345: [old] 00 7C 00 → [new] 00 00 FF</div>
<div class="line"> </div>
<div class="line">8. GUI Review</div>
<div class="line">   Open YAZE → Debug → Agent Proposals</div>
<div class="line">   • Visual diff shows red soldier sprite</div>
<div class="line">   • Click &quot;Accept&quot; → Merge sandbox to main ROM</div>
<div class="line">   • Or &quot;Reject&quot; → Discard sandbox</div>
<div class="line"> </div>
<div class="line">9. Finalization</div>
<div class="line">   $ z3ed agent commit</div>
<div class="line">   ✅ Proposal accepted and merged to zelda3.sfc</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1616"></a>
Comparison Matrix</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Ollama   </th><th class="markdownTableHeadNone">Gemini   </th><th class="markdownTableHeadNone">Claude   </th><th class="markdownTableHeadNone">Mock    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Cost</b>   </td><td class="markdownTableBodyNone">Free   </td><td class="markdownTableBodyNone">$0.10/1M tokens   </td><td class="markdownTableBodyNone">Free tier   </td><td class="markdownTableBodyNone">Free    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Privacy</b>   </td><td class="markdownTableBodyNone">✅ Local   </td><td class="markdownTableBodyNone">❌ Remote   </td><td class="markdownTableBodyNone">❌ Remote   </td><td class="markdownTableBodyNone">✅ Local    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Setup</b>   </td><td class="markdownTableBodyNone"><code>brew install</code>   </td><td class="markdownTableBodyNone">API key   </td><td class="markdownTableBodyNone">API key   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Speed</b>   </td><td class="markdownTableBodyNone">Fast (~1-2s)   </td><td class="markdownTableBodyNone">Medium (~2-4s)   </td><td class="markdownTableBodyNone">Medium (~2-4s)   </td><td class="markdownTableBodyNone">Instant    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Quality</b>   </td><td class="markdownTableBodyNone">Good (7B-70B)   </td><td class="markdownTableBodyNone">Excellent   </td><td class="markdownTableBodyNone">Excellent   </td><td class="markdownTableBodyNone">Hardcoded    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Internet</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Rate Limits</b>   </td><td class="markdownTableBodyNone">None   </td><td class="markdownTableBodyNone">60 req/min   </td><td class="markdownTableBodyNone">5 req/min   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Model Choice</b>   </td><td class="markdownTableBodyNone">Many   </td><td class="markdownTableBodyNone">Fixed   </td><td class="markdownTableBodyNone">Fixed   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Use Case</b>   </td><td class="markdownTableBodyNone">Development   </td><td class="markdownTableBodyNone">Production   </td><td class="markdownTableBodyNone">Premium   </td><td class="markdownTableBodyNone">Testing   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1617"></a>
Next Steps</h1>
<ol type="1">
<li><b>Read</b>: <a class="el" href="../../de/da5/md_docs_2z3ed_2LLM-INTEGRATION-PLAN.html">LLM-INTEGRATION-PLAN.md</a> for implementation details</li>
<li><b>Follow</b>: <a class="el" href="../../d2/d74/md_docs_2z3ed_2LLM-IMPLEMENTATION-CHECKLIST.html">LLM-IMPLEMENTATION-CHECKLIST.md</a> step-by-step</li>
<li><b>Test</b>: Run <code>./scripts/quickstart_ollama.sh</code> when ready</li>
<li><b>Document</b>: Update this architecture diagram as system evolves</li>
</ol>
<hr  />
<p><b>Last Updated</b>: October 3, 2025 <br  />
 <b>Status</b>: Documentation Complete | Ready to Implement </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
