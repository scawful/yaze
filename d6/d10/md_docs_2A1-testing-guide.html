<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: A1 - Testing Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/d10/md_docs_2A1-testing-guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">A1 - Testing Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md9"></a> This guide provides a comprehensive overview of the testing framework for the yaze project, including the test organization, execution methods, and the end-to-end GUI automation system.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
1. Test Organization</h1>
<p>The test suite is organized into a clear directory structure that separates tests by their purpose and dependencies. This is the primary way to understand the nature of a test.</p>
<div class="fragment"><div class="line">test/</div>
<div class="line">├── unit/                    # Unit tests for individual components</div>
<div class="line">│   ├── core/                # Core functionality (asar, hex utils)</div>
<div class="line">│   ├── cli/                 # Command-line interface tests</div>
<div class="line">│   ├── emu/                 # Emulator component tests</div>
<div class="line">│   ├── gfx/                 # Graphics system (tiles, palettes)</div>
<div class="line">│   ├── gui/                 # GUI widget tests</div>
<div class="line">│   ├── rom/                 # ROM data structure tests</div>
<div class="line">│   └── zelda3/              # Game-specific logic tests</div>
<div class="line">├── integration/             # Tests for interactions between components</div>
<div class="line">│   ├── ai/                  # AI agent and vision tests</div>
<div class="line">│   ├── editor/              # Editor integration tests</div>
<div class="line">│   └── zelda3/              # Game-specific integration tests (ROM-dependent)</div>
<div class="line">├── e2e/                     # End-to-end user workflow tests (GUI-driven)</div>
<div class="line">│   ├── rom_dependent/       # E2E tests requiring a ROM</div>
<div class="line">│   └── zscustomoverworld/   # ZSCustomOverworld upgrade E2E tests</div>
<div class="line">├── benchmarks/              # Performance benchmarks</div>
<div class="line">├── mocks/                   # Mock objects for isolating tests</div>
<div class="line">└── assets/                  # Test assets (patches, data)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
2. Test Categories</h1>
<p>Based on the directory structure, tests fall into the following categories:</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Unit Tests (&lt;tt&gt;unit/&lt;/tt&gt;)</h2>
<ul>
<li><b>Purpose</b>: To test individual classes or functions in isolation.</li>
<li><b>Characteristics</b>:<ul>
<li>Fast, self-contained, and reliable.</li>
<li>No external dependencies (e.g., ROM files, running GUI).</li>
<li>Form the core of the CI/CD validation pipeline.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Integration Tests (&lt;tt&gt;integration/&lt;/tt&gt;)</h2>
<ul>
<li><b>Purpose</b>: To verify that different components of the application work together correctly.</li>
<li><b>Characteristics</b>:<ul>
<li>May require a real ROM file (especially those in <code>integration/zelda3/</code>). These are considered "ROM-dependent".</li>
<li>Test interactions between modules, such as the <code>asar</code> wrapper and the <code>Rom</code> class, or AI services with the GUI controller.</li>
<li>Slower than unit tests but crucial for catching bugs at module boundaries.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md14"></a>
End-to-End (E2E) Tests (&lt;tt&gt;e2e/&lt;/tt&gt;)</h2>
<ul>
<li><b>Purpose</b>: To simulate a full user workflow from start to finish.</li>
<li><b>Characteristics</b>:<ul>
<li>Driven by the <b><a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> Test Engine</b>.</li>
<li>Almost always require a running GUI and often a real ROM.</li>
<li>The slowest but most comprehensive tests, validating the user experience.</li>
<li>Includes smoke tests, canvas interactions, and complex workflows like ZSCustomOverworld upgrades.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Benchmarks (&lt;tt&gt;benchmarks/&lt;/tt&gt;)</h2>
<ul>
<li><b>Purpose</b>: To measure and track the performance of critical code paths, particularly in the graphics system.</li>
<li><b>Characteristics</b>:<ul>
<li>Not focused on correctness but on speed and efficiency.</li>
<li>Run manually or in specialized CI jobs to prevent performance regressions.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
3. Running Tests</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Using the Enhanced Test Runner (&lt;tt&gt;yaze_test&lt;/tt&gt;)</h2>
<p>The most flexible way to run tests is by using the <code>yaze_test</code> executable directly. It provides flags to filter tests by category, which is ideal for development and AI agent workflows.</p>
<div class="fragment"><div class="line"># First, build the test executable</div>
<div class="line">cmake --build build_ai --target yaze_test</div>
<div class="line"> </div>
<div class="line"># Run all tests</div>
<div class="line">./build_ai/bin/yaze_test</div>
<div class="line"> </div>
<div class="line"># Run only unit tests</div>
<div class="line">./build_ai/bin/yaze_test --unit</div>
<div class="line"> </div>
<div class="line"># Run only integration tests</div>
<div class="line">./build_ai/bin/yaze_test --integration</div>
<div class="line"> </div>
<div class="line"># Run E2E tests (requires a GUI)</div>
<div class="line">./build_ai/bin/yaze_test --e2e --show-gui</div>
<div class="line"> </div>
<div class="line"># Run ROM-dependent tests with a specific ROM</div>
<div class="line">./build_ai/bin/yaze_test --rom-dependent --rom-path /path/to/zelda3.sfc</div>
<div class="line"> </div>
<div class="line"># Run tests matching a specific pattern (e.g., all Asar tests)</div>
<div class="line">./build_ai/bin/yaze_test &quot;*Asar*&quot;</div>
<div class="line"> </div>
<div class="line"># Get a full list of options</div>
<div class="line">./build_ai/bin/yaze_test --help</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Using CTest and CMake Presets</h2>
<p>For CI/CD or a more traditional workflow, you can use <code>ctest</code> with CMake presets.</p>
<div class="fragment"><div class="line"># Configure a development build (enables ROM-dependent tests)</div>
<div class="line">cmake --preset mac-dev -DYAZE_TEST_ROM_PATH=/path/to/your/zelda3.sfc</div>
<div class="line"> </div>
<div class="line"># Build the tests</div>
<div class="line">cmake --build --preset mac-dev --target yaze_test</div>
<div class="line"> </div>
<div class="line"># Run stable tests (fast, primarily unit tests)</div>
<div class="line">ctest --preset dev</div>
<div class="line"> </div>
<div class="line"># Run all tests, including ROM-dependent and E2E</div>
<div class="line">ctest --preset all</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
4. Writing Tests</h1>
<p>When adding new tests, place them in the appropriate directory based on their purpose and dependencies.</p>
<ul>
<li><b>New class <code>MyClass</code>?</b> Add <code>test/unit/my_class_test.cc</code>.</li>
<li><b>Testing <code>MyClass</code> with a real ROM?</b> Add <code>test/integration/my_class_rom_test.cc</code>.</li>
<li><b>Testing a full UI workflow involving <code>MyClass</code>?</b> Add <code>test/e2e/my_class_workflow_test.cc</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
5. E2E GUI Testing Framework</h1>
<p>The E2E framework uses <code>ImGuiTestEngine</code> to automate UI interactions.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Architecture</h2>
<ul>
<li>**<code><a class="el" href="../../de/d3d/yaze__test_8cc.html">test/yaze_test.cc</a></code>**: The main test runner that can initialize a GUI for E2E tests.</li>
<li>**<code>test/e2e/</code>**: Contains all E2E test files, such as:<ul>
<li><code><a class="el" href="../../da/d8d/framework__smoke__test_8cc.html">framework_smoke_test.cc</a></code>: Basic infrastructure verification.</li>
<li><code><a class="el" href="../../d2/d5c/canvas__selection__test_8cc.html">canvas_selection_test.cc</a></code>: Canvas interaction tests.</li>
<li><code><a class="el" href="../../db/d49/dungeon__editor__tests_8cc.html">dungeon_editor_tests.cc</a></code>: UI tests for the dungeon editor.</li>
</ul>
</li>
<li>**<code><a class="el" href="../../df/dfd/test__utils_8h.html">test/test_utils.h</a></code>**: Provides high-level helper functions for common actions like loading a ROM (<code>LoadRomInTest</code>) or opening an editor (<code>OpenEditorInTest</code>).</li>
</ul>
<h2><a class="anchor" id="autotoc_md22"></a>
Running GUI Tests</h2>
<p>To run E2E tests and see the GUI interactions, use the <code>--show-gui</code> flag.</p>
<div class="fragment"><div class="line"># Run all E2E tests with the GUI visible</div>
<div class="line">./build_ai/bin/yaze_test --e2e --show-gui</div>
<div class="line"> </div>
<div class="line"># Run a specific E2E test by name</div>
<div class="line">./build_ai/bin/yaze_test --show-gui --gtest_filter=&quot;*DungeonEditorSmokeTest&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Widget Discovery and AI Integration</h2>
<p>The GUI testing framework is designed for AI agent automation. All major UI elements are registered with stable IDs, allowing an agent to "discover" and interact with them programmatically via the <code>z3ed</code> CLI.</p>
<p>Refer to the <code>z3ed</code> agent guide for details on using commands like <code>z3ed gui discover</code>, <code>z3ed gui click</code>, and <code>z3ed agent test replay</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
