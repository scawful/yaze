<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: SDL2 to SDL3 Migration and Rendering Abstraction Plan</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/df2/md_docs_2G2-renderer-migration-plan.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SDL2 to SDL3 Migration and Rendering Abstraction Plan</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md855"></a> </p>
<h1><a class="anchor" id="autotoc_md856"></a>
1. Introduction</h1>
<p>This document outlines a strategic plan to refactor the rendering architecture of the <code>yaze</code> application. The primary goals are:</p>
<ol type="1">
<li><b>Decouple the application from the SDL2 rendering API.</b></li>
<li><b>Create a clear and straightforward path for migrating to SDL3.</b></li>
<li><b>Enable support for multiple rendering backends</b> (e.g., OpenGL, Metal, DirectX) to improve cross-platform performance and leverage modern graphics APIs.</li>
</ol>
<h1><a class="anchor" id="autotoc_md857"></a>
2. Current State Analysis</h1>
<p>The current architecture exhibits tight coupling with the SDL2 rendering API.</p>
<ul>
<li><b>Direct Dependency:</b> Components like <code>gfx::Bitmap</code>, <code>gfx::Arena</code>, and <code>gfx::AtlasRenderer</code> directly accept or call functions using an <code>SDL_Renderer*</code>.</li>
<li><b>Singleton Pattern:</b> The <code>core::Renderer</code> singleton in <code><a class="el" href="../../d3/df1/window_8h.html">src/app/core/window.h</a></code> provides global access to the <code>SDL_Renderer</code>, making it difficult to manage, replace, or mock.</li>
<li><b>Dual Rendering Pipelines:</b> The main application (<code><a class="el" href="../../df/d84/yaze_8cc.html">yaze.cc</a></code>, <code><a class="el" href="../../d2/dcf/app__delegate_8mm.html">app_delegate.mm</a></code>) and the standalone emulator (<code><a class="el" href="../../d8/d5b/emu_8cc.html">app/emu/emu.cc</a></code>) both perform their own separate, direct SDL initialization and rendering loops. This code duplication makes maintenance and migration efforts more complex.</li>
</ul>
<p>This tight coupling makes it brittle, difficult to maintain, and nearly impossible to adapt to newer rendering APIs like SDL3 or other backends without a major, project-wide rewrite.</p>
<h1><a class="anchor" id="autotoc_md858"></a>
3. Proposed Architecture: The &lt;tt&gt;Renderer&lt;/tt&gt; Abstraction</h1>
<p>The core of this plan is to introduce a <code>Renderer</code> interface (an abstract base class) that defines a set of rendering primitives. The application will be refactored to program against this interface, not a concrete SDL2 implementation.</p>
<h2><a class="anchor" id="autotoc_md859"></a>
3.1. The &lt;tt&gt;IRenderer&lt;/tt&gt; Interface</h2>
<p>A new interface, <code>IRenderer</code>, will be created. It will define the contract for all rendering operations.</p>
<p><b>File:</b> <code>src/app/gfx/irenderer.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;SDL.h&gt;</span> <span class="comment">// For SDL_Rect, SDL_Color, etc.</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../da/dcb/bitmap_8h.html">app/gfx/bitmap.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="../../dc/d46/namespaceyaze.html">yaze</a> {</div>
<div class="line"><span class="keyword">namespace </span>gfx {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Forward declarations</span></div>
<div class="line"><span class="keyword">class </span>Bitmap;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// A handle to a texture, abstracting away the underlying implementation</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> = <span class="keywordtype">void</span>*;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>IRenderer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a48a3f874f869b63c0985b4343f6e2023">~IRenderer</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --- Initialization and Lifecycle ---</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a1c76494f211d5539be924f9c788aded9">Initialize</a>(SDL_Window* window) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a9f0f351897cb6a83d40a74694005969d">Shutdown</a>() = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --- Texture Management ---</span></div>
<div class="line">    <span class="keyword">virtual</span> <a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a0c7628e8d85b52be66fa417503c24747">CreateTexture</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a26dd982d1249f3bcbad832927a5edf4a">UpdateTexture</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture, <span class="keyword">const</span> Bitmap&amp; bitmap) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aa6af4ae256b62659ce1222b20e3d695e">DestroyTexture</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --- Rendering Primitives ---</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aa33a03441c12a133e0b1ce566a98fe51">Clear</a>() = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aa1f7e877060de9715bf06d51d460ce56">Present</a>() = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a8b713bb1b3a446ba8e5aa2f2d529efe3">RenderCopy</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture, <span class="keyword">const</span> SDL_Rect* srcrect, <span class="keyword">const</span> SDL_Rect* dstrect) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aede7fef874a2970c2e365c660f701b78">SetRenderTarget</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture) = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a9e6ebcff29e82e62d271b6fe4d68b73d">SetDrawColor</a>(SDL_Color color) = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --- Backend-specific Access ---</span></div>
<div class="line">    <span class="comment">// Provides an escape hatch for libraries like ImGui that need the concrete renderer.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span>* <a class="code hl_function" href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a23f4e2c0617b575a226b46085deaf081">GetBackendRenderer</a>() = 0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace gfx</span></div>
<div class="line">} <span class="comment">// namespace yaze</span></div>
<div class="ttc" id="abitmap_8h_html"><div class="ttname"><a href="../../da/dcb/bitmap_8h.html">bitmap.h</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a0c7628e8d85b52be66fa417503c24747"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a0c7628e8d85b52be66fa417503c24747">yaze::gfx::IRenderer::CreateTexture</a></div><div class="ttdeci">virtual TextureHandle CreateTexture(int width, int height)=0</div><div class="ttdoc">Creates a new, empty texture.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a1c76494f211d5539be924f9c788aded9"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a1c76494f211d5539be924f9c788aded9">yaze::gfx::IRenderer::Initialize</a></div><div class="ttdeci">virtual bool Initialize(SDL_Window *window)=0</div><div class="ttdoc">Initializes the renderer with a given window.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a23f4e2c0617b575a226b46085deaf081"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a23f4e2c0617b575a226b46085deaf081">yaze::gfx::IRenderer::GetBackendRenderer</a></div><div class="ttdeci">virtual void * GetBackendRenderer()=0</div><div class="ttdoc">Provides an escape hatch to get the underlying, concrete renderer object.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a26dd982d1249f3bcbad832927a5edf4a"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a26dd982d1249f3bcbad832927a5edf4a">yaze::gfx::IRenderer::UpdateTexture</a></div><div class="ttdeci">virtual void UpdateTexture(TextureHandle texture, const Bitmap &amp;bitmap)=0</div><div class="ttdoc">Updates a texture with the pixel data from a Bitmap.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a48a3f874f869b63c0985b4343f6e2023"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a48a3f874f869b63c0985b4343f6e2023">yaze::gfx::IRenderer::~IRenderer</a></div><div class="ttdeci">virtual ~IRenderer()=default</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a8b713bb1b3a446ba8e5aa2f2d529efe3"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a8b713bb1b3a446ba8e5aa2f2d529efe3">yaze::gfx::IRenderer::RenderCopy</a></div><div class="ttdeci">virtual void RenderCopy(TextureHandle texture, const SDL_Rect *srcrect, const SDL_Rect *dstrect)=0</div><div class="ttdoc">Copies a portion of a texture to the current render target.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a9e6ebcff29e82e62d271b6fe4d68b73d"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a9e6ebcff29e82e62d271b6fe4d68b73d">yaze::gfx::IRenderer::SetDrawColor</a></div><div class="ttdeci">virtual void SetDrawColor(SDL_Color color)=0</div><div class="ttdoc">Sets the color used for drawing operations (e.g., Clear).</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_a9f0f351897cb6a83d40a74694005969d"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#a9f0f351897cb6a83d40a74694005969d">yaze::gfx::IRenderer::Shutdown</a></div><div class="ttdeci">virtual void Shutdown()=0</div><div class="ttdoc">Shuts down the renderer and releases all associated resources.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_aa1f7e877060de9715bf06d51d460ce56"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aa1f7e877060de9715bf06d51d460ce56">yaze::gfx::IRenderer::Present</a></div><div class="ttdeci">virtual void Present()=0</div><div class="ttdoc">Presents the back buffer to the screen, making the rendered content visible.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_aa33a03441c12a133e0b1ce566a98fe51"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aa33a03441c12a133e0b1ce566a98fe51">yaze::gfx::IRenderer::Clear</a></div><div class="ttdeci">virtual void Clear()=0</div><div class="ttdoc">Clears the entire render target with the current draw color.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_aa6af4ae256b62659ce1222b20e3d695e"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aa6af4ae256b62659ce1222b20e3d695e">yaze::gfx::IRenderer::DestroyTexture</a></div><div class="ttdeci">virtual void DestroyTexture(TextureHandle texture)=0</div><div class="ttdoc">Destroys a texture and frees its associated resources.</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1IRenderer_html_aede7fef874a2970c2e365c660f701b78"><div class="ttname"><a href="../../d0/dca/classyaze_1_1gfx_1_1IRenderer.html#aede7fef874a2970c2e365c660f701b78">yaze::gfx::IRenderer::SetRenderTarget</a></div><div class="ttdeci">virtual void SetRenderTarget(TextureHandle texture)=0</div><div class="ttdoc">Sets the render target for subsequent drawing operations.</div></div>
<div class="ttc" id="anamespaceyaze_1_1gfx_html_a64ee784c94d274a56a4a536b6a0cf41a"><div class="ttname"><a href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">yaze::gfx::TextureHandle</a></div><div class="ttdeci">void * TextureHandle</div><div class="ttdoc">An abstract handle representing a texture.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d18/irenderer_8h_source.html#l00024">irenderer.h:24</a></div></div>
<div class="ttc" id="anamespaceyaze_html"><div class="ttname"><a href="../../dc/d46/namespaceyaze.html">yaze</a></div><div class="ttdoc">Main namespace for the application.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d17/asar__wrapper_8cc_source.html#l00014">asar_wrapper.cc:14</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md860"></a>
3.2. The &lt;tt&gt;SDL2Renderer&lt;/tt&gt; Implementation</h2>
<p>A concrete class, <code>SDL2Renderer</code>, will be the first implementation of the <code>IRenderer</code> interface. It will encapsulate all the existing SDL2-specific rendering logic.</p>
<p><b>File:</b> <code>src/app/gfx/sdl2_renderer.h</code> &amp; <code>src/app/gfx/sdl2_renderer.cc</code></p>
<div class="fragment"><div class="line"><span class="comment">// sdl2_renderer.h</span></div>
<div class="line"><span class="preprocessor">#include &quot;app/gfx/irenderer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd7/sdl__deleter_8h.html">util/sdl_deleter.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="../../dc/d46/namespaceyaze.html">yaze</a> {</div>
<div class="line"><span class="keyword">namespace </span>gfx {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>SDL2Renderer : <span class="keyword">public</span> IRenderer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#ac6ff25b90de752006c5be72f2f003711">SDL2Renderer</a>();</div>
<div class="line">    <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a0f57d2a7eafb88e6077ce299a07909cd">~SDL2Renderer</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a2a1fae5e224a3523c87d28c1bd957fee">Initialize</a>(SDL_Window* window) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#aee79e8a635bebffcfd82a3a8bef52fee">Shutdown</a>() <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a8cbbdff4f361c4bcff5ddb4eca133459">CreateTexture</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a5e01d7fb8304e31dcd1311bb19ef4da2">UpdateTexture</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture, <span class="keyword">const</span> Bitmap&amp; bitmap) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a4bb3baf94701ab87f949aba00be59ab6">DestroyTexture</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#aaa1f87619659cc62d96ebee415cadb38">Clear</a>() <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#aaa16c5efe5ade6e705a7b28ae59775f9">Present</a>() <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#afda73b515b45619cee74930b5ee058bf">RenderCopy</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture, <span class="keyword">const</span> SDL_Rect* srcrect, <span class="keyword">const</span> SDL_Rect* dstrect) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a6bd0e83eb2a17aedbb01949488f6fbfb">SetRenderTarget</a>(<a class="code hl_typedef" href="../../d0/d27/namespaceyaze_1_1gfx.html#a64ee784c94d274a56a4a536b6a0cf41a">TextureHandle</a> texture) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a048d7204f6eaba4e7b351a1ecdfb410a">SetDrawColor</a>(SDL_Color color) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span>* <a class="code hl_function" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a75b81e03fd39a5649700922355d071ef">GetBackendRenderer</a>()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a104c93093448b3fff2ada0615dee1b89">renderer_</a>.get(); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::unique_ptr&lt;SDL_Renderer, util::SDL_Deleter&gt; <a class="code hl_variable" href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a104c93093448b3fff2ada0615dee1b89">renderer_</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace gfx</span></div>
<div class="line">} <span class="comment">// namespace yaze</span></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a048d7204f6eaba4e7b351a1ecdfb410a"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a048d7204f6eaba4e7b351a1ecdfb410a">yaze::gfx::SDL2Renderer::SetDrawColor</a></div><div class="ttdeci">void SetDrawColor(SDL_Color color) override</div><div class="ttdoc">Sets the draw color.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00140">sdl2_renderer.cc:140</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a0f57d2a7eafb88e6077ce299a07909cd"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a0f57d2a7eafb88e6077ce299a07909cd">yaze::gfx::SDL2Renderer::~SDL2Renderer</a></div><div class="ttdeci">~SDL2Renderer() override</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00010">sdl2_renderer.cc:10</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a104c93093448b3fff2ada0615dee1b89"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a104c93093448b3fff2ada0615dee1b89">yaze::gfx::SDL2Renderer::renderer_</a></div><div class="ttdeci">std::unique_ptr&lt; SDL_Renderer, util::SDL_Deleter &gt; renderer_</div><div class="ttdef"><b>Definition</b> <a href="../../da/d74/sdl2__renderer_8h_source.html#l00052">sdl2_renderer.h:52</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a2a1fae5e224a3523c87d28c1bd957fee"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a2a1fae5e224a3523c87d28c1bd957fee">yaze::gfx::SDL2Renderer::Initialize</a></div><div class="ttdeci">bool Initialize(SDL_Window *window) override</div><div class="ttdoc">Initializes the SDL2 renderer. This function creates an accelerated SDL2 renderer and attaches it to ...</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00018">sdl2_renderer.cc:18</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a4bb3baf94701ab87f949aba00be59ab6"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a4bb3baf94701ab87f949aba00be59ab6">yaze::gfx::SDL2Renderer::DestroyTexture</a></div><div class="ttdeci">void DestroyTexture(TextureHandle texture) override</div><div class="ttdoc">Destroys an SDL_Texture.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00095">sdl2_renderer.cc:95</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a5e01d7fb8304e31dcd1311bb19ef4da2"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a5e01d7fb8304e31dcd1311bb19ef4da2">yaze::gfx::SDL2Renderer::UpdateTexture</a></div><div class="ttdeci">void UpdateTexture(TextureHandle texture, const Bitmap &amp;bitmap) override</div><div class="ttdoc">Updates an SDL_Texture with data from a Bitmap. This involves converting the bitmap's surface to the ...</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00067">sdl2_renderer.cc:67</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a6bd0e83eb2a17aedbb01949488f6fbfb"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a6bd0e83eb2a17aedbb01949488f6fbfb">yaze::gfx::SDL2Renderer::SetRenderTarget</a></div><div class="ttdeci">void SetRenderTarget(TextureHandle texture) override</div><div class="ttdoc">Sets the render target.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00133">sdl2_renderer.cc:133</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a75b81e03fd39a5649700922355d071ef"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a75b81e03fd39a5649700922355d071ef">yaze::gfx::SDL2Renderer::GetBackendRenderer</a></div><div class="ttdeci">void * GetBackendRenderer() override</div><div class="ttdoc">Provides access to the underlying SDL_Renderer*.</div><div class="ttdef"><b>Definition</b> <a href="../../da/d74/sdl2__renderer_8h_source.html#l00048">sdl2_renderer.h:48</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_a8cbbdff4f361c4bcff5ddb4eca133459"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#a8cbbdff4f361c4bcff5ddb4eca133459">yaze::gfx::SDL2Renderer::CreateTexture</a></div><div class="ttdeci">TextureHandle CreateTexture(int width, int height) override</div><div class="ttdoc">Creates an SDL_Texture. The texture is created with streaming access, which is suitable for textures ...</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00046">sdl2_renderer.cc:46</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_aaa16c5efe5ade6e705a7b28ae59775f9"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#aaa16c5efe5ade6e705a7b28ae59775f9">yaze::gfx::SDL2Renderer::Present</a></div><div class="ttdeci">void Present() override</div><div class="ttdoc">Presents the rendered frame to the screen.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00119">sdl2_renderer.cc:119</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_aaa1f87619659cc62d96ebee415cadb38"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#aaa1f87619659cc62d96ebee415cadb38">yaze::gfx::SDL2Renderer::Clear</a></div><div class="ttdeci">void Clear() override</div><div class="ttdoc">Clears the screen with the current draw color.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00112">sdl2_renderer.cc:112</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_ac6ff25b90de752006c5be72f2f003711"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#ac6ff25b90de752006c5be72f2f003711">yaze::gfx::SDL2Renderer::SDL2Renderer</a></div><div class="ttdeci">SDL2Renderer()</div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_aee79e8a635bebffcfd82a3a8bef52fee"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#aee79e8a635bebffcfd82a3a8bef52fee">yaze::gfx::SDL2Renderer::Shutdown</a></div><div class="ttdeci">void Shutdown() override</div><div class="ttdoc">Shuts down the renderer. The underlying SDL_Renderer is managed by a unique_ptr, so its destruction i...</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00038">sdl2_renderer.cc:38</a></div></div>
<div class="ttc" id="aclassyaze_1_1gfx_1_1SDL2Renderer_html_afda73b515b45619cee74930b5ee058bf"><div class="ttname"><a href="../../d9/dfe/classyaze_1_1gfx_1_1SDL2Renderer.html#afda73b515b45619cee74930b5ee058bf">yaze::gfx::SDL2Renderer::RenderCopy</a></div><div class="ttdeci">void RenderCopy(TextureHandle texture, const SDL_Rect *srcrect, const SDL_Rect *dstrect) override</div><div class="ttdoc">Copies a texture to the render target.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dac/sdl2__renderer_8cc_source.html#l00126">sdl2_renderer.cc:126</a></div></div>
<div class="ttc" id="asdl__deleter_8h_html"><div class="ttname"><a href="../../d5/dd7/sdl__deleter_8h.html">sdl_deleter.h</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md861"></a>
4. Migration Plan</h1>
<p>The migration will be executed in phases to ensure stability and minimize disruption.</p>
<h2><a class="anchor" id="autotoc_md862"></a>
Phase 1: Implement the Abstraction Layer</h2>
<ol type="1">
<li><b>Create <code>IRenderer</code> and <code>SDL2Renderer</code>:</b> Implement the interface and concrete class as defined above.</li>
<li><b>Refactor <code>core::Renderer</code> Singleton:</b> The existing <code>core::Renderer</code> singleton will be deprecated and removed. A new central mechanism (e.g., a service locator or passing the <code>IRenderer</code> instance) will provide access to the active renderer.</li>
<li><b>Update Application Entry Points:</b><ul>
<li>In <code><a class="el" href="../../da/d0c/controller_8cc.html">app/core/controller.cc</a></code> (for the main editor) and <code><a class="el" href="../../d8/d5b/emu_8cc.html">app/emu/emu.cc</a></code> (for the emulator), instantiate <code>SDL2Renderer</code> during initialization. The <code>Controller</code> will own the <code>unique_ptr&lt;IRenderer&gt;</code>.</li>
<li>This immediately unifies the rendering pipeline initialization for both application modes.</li>
</ul>
</li>
<li><b>Refactor <code>gfx</code> Library:</b><ul>
<li>**<code>gfx::Bitmap</code>:** Modify <code>CreateTexture</code> and <code>UpdateTexture</code> to accept an <code>IRenderer*</code> instead of an <code>SDL_Renderer*</code>. The <code>SDL_Texture*</code> will be replaced with the abstract <code>TextureHandle</code>.</li>
<li>**<code>gfx::Arena</code>:** The <code>AllocateTexture</code> method will now call <code>renderer-&gt;CreateTexture()</code>. The internal pools will store <code>TextureHandle</code>s.</li>
<li>**<code>gfx::AtlasRenderer</code>:** The <code>Initialize</code> method will take an <code>IRenderer*</code>. All calls to <code>SDL_RenderCopy</code>, <code>SDL_SetRenderTarget</code>, etc., will be replaced with calls to the corresponding methods on the <code>IRenderer</code> interface.</li>
</ul>
</li>
<li><b>Update <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> Integration:</b><ul>
<li>The <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> backend requires the concrete <code>SDL_Renderer*</code>. The <code>GetBackendRenderer()</code> method on the interface provides a type-erased <code>void*</code> for this purpose.</li>
<li><p class="startli">The <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> initialization code will be modified as follows: ```cpp // Before ImGui_ImplSDLRenderer2_Init(sdl_renderer_ptr);</p>
<p class="startli">// After auto backend_renderer = renderer-&gt;GetBackendRenderer(); ImGui_ImplSDLRenderer2_Init(static_cast&lt;SDL_Renderer*&gt;(backend_renderer)); ```</p>
</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md863"></a>
Phase 2: Migrate to SDL3</h2>
<p>With the abstraction layer in place, migrating to SDL3 becomes significantly simpler.</p>
<ol type="1">
<li><b>Create <code>SDL3Renderer</code>:</b> A new class, <code>SDL3Renderer</code>, will be created that implements the <code>IRenderer</code> interface using SDL3's rendering functions.<ul>
<li>This class will handle the differences in the SDL3 API (e.g., <code>SDL_CreateRendererWithProperties</code>, float-based rendering functions, etc.) internally.</li>
<li>The <code>TextureHandle</code> will now correspond to an <code>SDL_Texture*</code> from SDL3.</li>
</ul>
</li>
<li><b>Update Build System:</b> The CMake files will be updated to link against SDL3 instead of SDL2.</li>
<li><b>Switch Implementation:</b> The application entry points (<code><a class="el" href="../../da/d0c/controller_8cc.html">controller.cc</a></code>, <code><a class="el" href="../../d8/d5b/emu_8cc.html">emu.cc</a></code>) will be changed to instantiate <code>SDL3Renderer</code> instead of <code>SDL2Renderer</code>.</li>
</ol>
<p>The rest of the application, which only knows about the <code>IRenderer</code> interface, will require <b>no changes</b>.</p>
<h2><a class="anchor" id="autotoc_md864"></a>
Phase 3: Support for Multiple Rendering Backends</h2>
<p>The <code>IRenderer</code> interface makes adding new backends a modular task.</p>
<ol type="1">
<li><b>Implement New Backends:</b> Create new classes like <code>OpenGLRenderer</code>, <code>MetalRenderer</code>, or <code>VulkanRenderer</code>. Each will implement the <code>IRenderer</code> interface using the corresponding graphics API.</li>
<li><b>Backend Selection:</b> Implement a factory function or a strategy in the main controller to select and create the desired renderer at startup, based on platform, user configuration, or command-line flags.</li>
<li><b><a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> Backend Alignment:</b> When a specific backend is chosen for <code>yaze</code>, the corresponding <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> backend implementation must also be used (e.g., <code>ImGui_ImplOpenGL3_Init</code>, <code>ImGui_ImplMetal_Init</code>). The <code>GetBackendRenderer()</code> method will provide the necessary context (e.g., <code>ID3D11Device*</code>, <code>MTLDevice*</code>) for each implementation.</li>
</ol>
<h1><a class="anchor" id="autotoc_md865"></a>
5. Conclusion</h1>
<p>This plan transforms the rendering system from a tightly coupled, monolithic design into a flexible, modular, and future-proof architecture.</p>
<p><b>Benefits:</b></p>
<ul>
<li><b>Maintainability:</b> Rendering logic is centralized and isolated, making it easier to debug and maintain.</li>
<li><b>Extensibility:</b> Adding support for new rendering APIs (like SDL3, Vulkan, Metal) becomes a matter of implementing a new interface, not refactoring the entire application.</li>
<li><b>Testability:</b> The rendering interface can be mocked, allowing for unit testing of graphics components without a live rendering context.</li>
<li><b>Future-Proofing:</b> The application is no longer tied to a specific version of SDL, ensuring a smooth transition to future graphics technologies. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
