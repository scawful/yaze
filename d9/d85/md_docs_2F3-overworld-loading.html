<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Overworld Loading Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/d85/md_docs_2F3-overworld-loading.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overworld Loading Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md341"></a> This document provides a comprehensive guide to understanding how overworld loading works in both ZScream (C#) and yaze (C++), including the differences between vanilla ROMs and ZSCustomOverworld v2/v3 ROMs.</p>
<h1><a class="anchor" id="autotoc_md342"></a>
Table of Contents</h1>
<ol type="1">
<li>Overview</li>
<li>ROM Types and Versions</li>
<li>Overworld Map Structure</li>
<li>Loading Process</li>
<li>ZScream Implementation</li>
<li>Yaze Implementation</li>
<li>Key Differences</li>
<li>Common Issues and Solutions</li>
</ol>
<h1><a class="anchor" id="autotoc_md343"></a>
Overview</h1>
<p>Both ZScream and yaze are Zelda 3 ROM editors that support editing overworld maps. They handle three main types of ROMs:</p>
<ul>
<li><b>Vanilla ROMs</b>: Original Zelda 3 ROMs without modifications</li>
<li><b>ZSCustomOverworld v2</b>: ROMs with expanded overworld features</li>
<li><b>ZSCustomOverworld v3</b>: ROMs with additional features like overlays and custom background colors</li>
</ul>
<h1><a class="anchor" id="autotoc_md344"></a>
ROM Types and Versions</h1>
<h2><a class="anchor" id="autotoc_md345"></a>
Version Detection</h2>
<p>Both editors detect the ROM version using the same constant:</p>
<div class="fragment"><div class="line"><span class="comment">// Address: 0x140145</span></div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">int</span> OverworldCustomASMHasBeenApplied = 0x140145;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Version values:</span></div>
<div class="line"><span class="comment">// 0xFF = Vanilla ROM</span></div>
<div class="line"><span class="comment">// 0x02 = ZSCustomOverworld v2</span></div>
<div class="line"><span class="comment">// 0x03 = ZSCustomOverworld v3</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md346"></a>
Feature Support by Version</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Vanilla   </th><th class="markdownTableHeadNone">v2   </th><th class="markdownTableHeadNone">v3    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Basic Overworld Maps   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Area Size Enum   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Main Palette   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Custom Background Colors   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Subscreen Overlays   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Animated GFX   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Custom Tile Graphics   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">✅    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Vanilla Overlays   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td></tr>
</table>
<p><b>Note:</b> Subscreen overlays are visual effects (fog, rain, backgrounds, etc.) that are shared between vanilla ROMs and ZSCustomOverworld. ZSCustomOverworld v2+ expands on this by adding support for custom overlay configurations and additional overlay types.</p>
<h1><a class="anchor" id="autotoc_md347"></a>
Overworld Map Structure</h1>
<h2><a class="anchor" id="autotoc_md348"></a>
Core Properties</h2>
<p>Each overworld map contains the following core properties:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>OverworldMap {</div>
<div class="line">  <span class="comment">// Basic properties</span></div>
<div class="line">  uint8_t index_;                    <span class="comment">// Map index (0-159)</span></div>
<div class="line">  uint8_t parent_;                   <span class="comment">// Parent map ID</span></div>
<div class="line">  uint8_t world_;                    <span class="comment">// World type (0=LW, 1=DW, 2=SW)</span></div>
<div class="line">  uint8_t game_state_;               <span class="comment">// Game state (0=Beginning, 1=Zelda, 2=Agahnim)</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Graphics and palettes</span></div>
<div class="line">  uint8_t area_graphics_;            <span class="comment">// Area graphics ID</span></div>
<div class="line">  uint8_t area_palette_;             <span class="comment">// Area palette ID</span></div>
<div class="line">  uint8_t main_palette_;             <span class="comment">// Main palette ID (v2+)</span></div>
<div class="line">  std::array&lt;uint8_t, 3&gt; sprite_graphics_;  <span class="comment">// Sprite graphics IDs</span></div>
<div class="line">  std::array&lt;uint8_t, 3&gt; sprite_palette_;   <span class="comment">// Sprite palette IDs</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Map properties</span></div>
<div class="line">  uint16_t message_id_;              <span class="comment">// Message ID</span></div>
<div class="line">  <span class="keywordtype">bool</span> mosaic_;                      <span class="comment">// Mosaic effect enabled</span></div>
<div class="line">  <span class="keywordtype">bool</span> large_map_;                   <span class="comment">// Is large map (vanilla)</span></div>
<div class="line">  AreaSizeEnum area_size_;           <span class="comment">// Area size (v3)</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Custom features (v2/v3)</span></div>
<div class="line">  uint16_t area_specific_bg_color_;  <span class="comment">// Custom background color</span></div>
<div class="line">  uint16_t subscreen_overlay_;       <span class="comment">// Subscreen overlay ID (references special area maps)</span></div>
<div class="line">  uint8_t animated_gfx_;             <span class="comment">// Animated graphics ID</span></div>
<div class="line">  std::array&lt;uint8_t, 8&gt; custom_gfx_ids_;  <span class="comment">// Custom tile graphics</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Overlay support (vanilla and custom)</span></div>
<div class="line">  uint16_t vanilla_overlay_id_;      <span class="comment">// Vanilla overlay ID</span></div>
<div class="line">  <span class="keywordtype">bool</span> has_vanilla_overlay_;         <span class="comment">// Has vanilla overlay data</span></div>
<div class="line">  std::vector&lt;uint8_t&gt; vanilla_overlay_data_;  <span class="comment">// Raw overlay data</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md349"></a>
Overlays and Special Area Maps</h1>
<h2><a class="anchor" id="autotoc_md350"></a>
Understanding Overlays</h2>
<p>Overlays in Zelda 3 are <b>visual effects</b> that are displayed over or behind the main overworld map. They include effects like fog, rain, canopy, backgrounds, and other atmospheric elements. Overlays are collections of tile positions and tile IDs that specify where to place specific graphics on the map.</p>
<h2><a class="anchor" id="autotoc_md351"></a>
Special Area Maps (0x80-0x9F)</h2>
<p>The special area maps (0x80-0x9F) contain the actual tile data for overlays. These maps store the graphics that overlays reference and use to create visual effects:</p>
<ul>
<li><b>0x80-0x8F</b>: Various special area maps containing overlay graphics</li>
<li><b>0x90-0x9F</b>: Additional special area maps including more overlay graphics</li>
</ul>
<h2><a class="anchor" id="autotoc_md352"></a>
Overlay ID Mappings</h2>
<p>Overlay IDs directly correspond to special area map indices. Common overlay mappings:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Overlay ID   </th><th class="markdownTableHeadNone">Special Area Map   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x0093   </td><td class="markdownTableBodyNone">0x93   </td><td class="markdownTableBodyNone">Triforce Room Curtain    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x0094   </td><td class="markdownTableBodyNone">0x94   </td><td class="markdownTableBodyNone">Under the Bridge    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x0095   </td><td class="markdownTableBodyNone">0x95   </td><td class="markdownTableBodyNone">Sky Background (LW Death Mountain)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x0096   </td><td class="markdownTableBodyNone">0x96   </td><td class="markdownTableBodyNone">Pyramid Background    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x0097   </td><td class="markdownTableBodyNone">0x97   </td><td class="markdownTableBodyNone">First Fog Overlay (Master Sword Area)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x009C   </td><td class="markdownTableBodyNone">0x9C   </td><td class="markdownTableBodyNone">Lava Background (DW Death Mountain)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x009D   </td><td class="markdownTableBodyNone">0x9D   </td><td class="markdownTableBodyNone">Second Fog Overlay (Lost Woods/Skull Woods)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x009E   </td><td class="markdownTableBodyNone">0x9E   </td><td class="markdownTableBodyNone">Tree Canopy (Forest)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x009F   </td><td class="markdownTableBodyNone">0x9F   </td><td class="markdownTableBodyNone">Rain Effect (Misery Mire)   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md353"></a>
Drawing Order</h2>
<p>Overlays are drawn in a specific order based on their type:</p>
<ul>
<li><b>Background Overlays</b> (0x95, 0x96, 0x9C): Drawn behind the main map tiles</li>
<li><b>Foreground Overlays</b> (0x9D, 0x97, 0x93, 0x94, 0x9E, 0x9F): Drawn on top of the main map tiles with transparency</li>
</ul>
<h2><a class="anchor" id="autotoc_md354"></a>
Vanilla Overlay Loading</h2>
<p>In vanilla ROMs, overlays are loaded by parsing SNES assembly-like commands that specify tile positions and IDs:</p>
<div class="fragment"><div class="line">absl::Status LoadVanillaOverlay() {</div>
<div class="line">  uint8_t asm_version = (*rom_)[OverworldCustomASMHasBeenApplied];</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Only load vanilla overlays for vanilla ROMs</span></div>
<div class="line">  <span class="keywordflow">if</span> (asm_version != 0xFF) {</div>
<div class="line">    has_vanilla_overlay_ = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">return</span> absl::OkStatus();</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load overlay pointer for this map</span></div>
<div class="line">  <span class="keywordtype">int</span> address = (kOverlayPointersBank &lt;&lt; 16) +</div>
<div class="line">                ((*rom_)[kOverlayPointers + (index_ * 2) + 1] &lt;&lt; 8) +</div>
<div class="line">                (*rom_)[kOverlayPointers + (index_ * 2)];</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Parse overlay commands:</span></div>
<div class="line">  <span class="comment">// LDA #$xxxx - Load tile ID into accumulator</span></div>
<div class="line">  <span class="comment">// LDX #$xxxx - Load position into X register  </span></div>
<div class="line">  <span class="comment">// STA $xxxx - Store tile at position</span></div>
<div class="line">  <span class="comment">// STA $xxxx,x - Store tile at position + X</span></div>
<div class="line">  <span class="comment">// INC A - Increment accumulator (for sequential tiles)</span></div>
<div class="line">  <span class="comment">// JMP $xxxx - Jump to another overlay routine</span></div>
<div class="line">  <span class="comment">// END (0x60) - End of overlay data</span></div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> absl::OkStatus();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md355"></a>
Special Area Graphics Loading</h2>
<p>Special area maps require special handling for graphics loading:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> LoadAreaInfo() {</div>
<div class="line">  <span class="keywordflow">if</span> (parent_ &gt;= kSpecialWorldMapIdStart) {</div>
<div class="line">    <span class="comment">// Special World (SW) areas</span></div>
<div class="line">    <span class="keywordflow">if</span> (asm_version &gt;= 3 &amp;&amp; asm_version != 0xFF) {</div>
<div class="line">      <span class="comment">// Use expanded sprite tables for v3</span></div>
<div class="line">      sprite_graphics_[0] = (*rom_)[kOverworldSpecialSpriteGfxGroupExpandedTemp + </div>
<div class="line">                                     parent_ - kSpecialWorldMapIdStart];</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">// Use original sprite tables for v2/vanilla</span></div>
<div class="line">      sprite_graphics_[0] = (*rom_)[kOverworldSpecialGfxGroup + </div>
<div class="line">                                     parent_ - kSpecialWorldMapIdStart];</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Handle special cases for specific maps</span></div>
<div class="line">    <span class="keywordflow">if</span> (index_ == 0x88 || index_ == 0x93) {</div>
<div class="line">      area_graphics_ = 0x51;</div>
<div class="line">      area_palette_ = 0x00;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index_ == 0x95) {</div>
<div class="line">      <span class="comment">// Make this the same GFX as LW death mountain areas</span></div>
<div class="line">      area_graphics_ = (*rom_)[<a class="code hl_variable" href="../../d5/d1f/namespaceyaze_1_1zelda3.html#a019f5467220daa0ae5321ff21e96b7d4">kAreaGfxIdPtr</a> + 0x03];</div>
<div class="line">      area_palette_ = (*rom_)[<a class="code hl_variable" href="../../d5/d1f/namespaceyaze_1_1zelda3.html#af2dc32a6554416090637ef571345e19c">kOverworldMapPaletteIds</a> + 0x03];</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index_ == 0x96) {</div>
<div class="line">      <span class="comment">// Make this the same GFX as pyramid areas</span></div>
<div class="line">      area_graphics_ = (*rom_)[<a class="code hl_variable" href="../../d5/d1f/namespaceyaze_1_1zelda3.html#a019f5467220daa0ae5321ff21e96b7d4">kAreaGfxIdPtr</a> + 0x5B];</div>
<div class="line">      area_palette_ = (*rom_)[<a class="code hl_variable" href="../../d5/d1f/namespaceyaze_1_1zelda3.html#af2dc32a6554416090637ef571345e19c">kOverworldMapPaletteIds</a> + 0x5B];</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index_ == 0x9C) {</div>
<div class="line">      <span class="comment">// Make this the same GFX as DW death mountain areas</span></div>
<div class="line">      area_graphics_ = (*rom_)[<a class="code hl_variable" href="../../d5/d1f/namespaceyaze_1_1zelda3.html#a019f5467220daa0ae5321ff21e96b7d4">kAreaGfxIdPtr</a> + 0x43];</div>
<div class="line">      area_palette_ = (*rom_)[<a class="code hl_variable" href="../../d5/d1f/namespaceyaze_1_1zelda3.html#af2dc32a6554416090637ef571345e19c">kOverworldMapPaletteIds</a> + 0x43];</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceyaze_1_1zelda3_html_a019f5467220daa0ae5321ff21e96b7d4"><div class="ttname"><a href="../../d5/d1f/namespaceyaze_1_1zelda3.html#a019f5467220daa0ae5321ff21e96b7d4">yaze::zelda3::kAreaGfxIdPtr</a></div><div class="ttdeci">constexpr int kAreaGfxIdPtr</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d9c/overworld_8h_source.html#l00040">overworld.h:40</a></div></div>
<div class="ttc" id="anamespaceyaze_1_1zelda3_html_af2dc32a6554416090637ef571345e19c"><div class="ttname"><a href="../../d5/d1f/namespaceyaze_1_1zelda3.html#af2dc32a6554416090637ef571345e19c">yaze::zelda3::kOverworldMapPaletteIds</a></div><div class="ttdeci">constexpr int kOverworldMapPaletteIds</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d9c/overworld_8h_source.html#l00030">overworld.h:30</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md356"></a>
Loading Process</h1>
<h2><a class="anchor" id="autotoc_md357"></a>
1. Version Detection</h2>
<p>Both editors first detect the ROM version:</p>
<div class="fragment"><div class="line">uint8_t asm_version = rom[OverworldCustomASMHasBeenApplied];</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md358"></a>
2. Map Initialization</h2>
<p>For each of the 160 overworld maps (0x00-0x9F):</p>
<div class="fragment"><div class="line"><span class="comment">// ZScream</span></div>
<div class="line">var map = <span class="keyword">new</span> OverworldMap(index, overworld);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Yaze</span></div>
<div class="line">OverworldMap map(index, rom);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md359"></a>
3. Property Loading</h2>
<p>The loading process varies by ROM version:</p>
<h3><a class="anchor" id="autotoc_md360"></a>
Vanilla ROMs (asm_version == 0xFF)</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> LoadAreaInfo() {</div>
<div class="line">  <span class="comment">// Load from vanilla tables</span></div>
<div class="line">  message_id_ = rom[kOverworldMessageIds + index_ * 2];</div>
<div class="line">  area_graphics_ = rom[kOverworldMapGfx + index_];</div>
<div class="line">  area_palette_ = rom[kOverworldMapPaletteIds + index_];</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Determine large map status</span></div>
<div class="line">  large_map_ = (rom[kOverworldMapSize + index_] != 0);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load vanilla overlay</span></div>
<div class="line">  LoadVanillaOverlay();</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md361"></a>
ZSCustomOverworld v2/v3</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> LoadAreaInfo() {</div>
<div class="line">  <span class="comment">// Use expanded tables for v3</span></div>
<div class="line">  <span class="keywordflow">if</span> (asm_version &gt;= 3) {</div>
<div class="line">    message_id_ = rom[kOverworldMessagesExpanded + index_ * 2];</div>
<div class="line">    area_size_ = <span class="keyword">static_cast&lt;</span>AreaSizeEnum<span class="keyword">&gt;</span>(rom[kOverworldScreenSize + index_]);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    message_id_ = rom[kOverworldMessageIds + index_ * 2];</div>
<div class="line">    area_size_ = large_map_ ? LargeArea : SmallArea;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load custom overworld data</span></div>
<div class="line">  LoadCustomOverworldData();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md362"></a>
4. Custom Data Loading</h2>
<p>For ZSCustomOverworld ROMs:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> LoadCustomOverworldData() {</div>
<div class="line">  <span class="comment">// Load main palette</span></div>
<div class="line">  main_palette_ = rom[OverworldCustomMainPaletteArray + index_];</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load custom background color</span></div>
<div class="line">  <span class="keywordflow">if</span> (rom[OverworldCustomAreaSpecificBGEnabled] != 0) {</div>
<div class="line">    area_specific_bg_color_ = rom[OverworldCustomAreaSpecificBGPalette + index_ * 2];</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load v3 features</span></div>
<div class="line">  <span class="keywordflow">if</span> (asm_version &gt;= 3) {</div>
<div class="line">    subscreen_overlay_ = rom[OverworldCustomSubscreenOverlayArray + index_ * 2];</div>
<div class="line">    animated_gfx_ = rom[OverworldCustomAnimatedGFXArray + index_];</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Load custom tile graphics (8 sheets)</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {</div>
<div class="line">      custom_gfx_ids_[i] = rom[OverworldCustomTileGFXGroupArray + index_ * 8 + i];</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md363"></a>
ZScream Implementation</h1>
<h2><a class="anchor" id="autotoc_md364"></a>
OverworldMap Constructor</h2>
<div class="fragment"><div class="line"><span class="keyword">public</span> OverworldMap(<span class="keywordtype">byte</span> index, Overworld overworld) {</div>
<div class="line">    Index = index;</div>
<div class="line">    this.overworld = overworld;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Load area info</span></div>
<div class="line">    LoadAreaInfo();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Load custom data if available</span></div>
<div class="line">    <span class="keywordflow">if</span> (ROM.DATA[Constants.OverworldCustomASMHasBeenApplied] != 0xFF) {</div>
<div class="line">        LoadCustomOverworldData();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Build graphics and palette</span></div>
<div class="line">    BuildMap();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md365"></a>
Key Methods</h2>
<ul>
<li><code>LoadAreaInfo()</code>: Loads basic map properties from ROM</li>
<li><code>LoadCustomOverworldData()</code>: Loads ZSCustomOverworld features</li>
<li><code>LoadPalette()</code>: Loads and processes palette data</li>
<li><code>BuildMap()</code>: Constructs the final map bitmap</li>
</ul>
<p><b>Note</b>: ZScream is the original C# implementation that yaze is designed to be compatible with.</p>
<h1><a class="anchor" id="autotoc_md366"></a>
Yaze Implementation</h1>
<h2><a class="anchor" id="autotoc_md367"></a>
OverworldMap Constructor</h2>
<div class="fragment"><div class="line">OverworldMap::OverworldMap(<span class="keywordtype">int</span> index, Rom* rom) : index_(index), rom_(rom) {</div>
<div class="line">  LoadAreaInfo();</div>
<div class="line">  LoadCustomOverworldData();</div>
<div class="line">  SetupCustomTileset(asm_version);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md368"></a>
Key Methods</h2>
<ul>
<li><code>LoadAreaInfo()</code>: Loads basic map properties</li>
<li><code>LoadCustomOverworldData()</code>: Loads ZSCustomOverworld features <br  />
</li>
<li><code>LoadVanillaOverlay()</code>: Loads vanilla overlay data</li>
<li><code>LoadPalette()</code>: Loads and processes palette data</li>
<li><code>BuildTileset()</code>: Constructs graphics tileset</li>
<li><code>BuildBitmap()</code>: Creates the final map bitmap</li>
</ul>
<h2><a class="anchor" id="autotoc_md369"></a>
Current Status</h2>
<p>✅ <b>ZSCustomOverworld v2/v3 Support</b>: Fully implemented and tested ✅ <b>Vanilla ROM Support</b>: Complete compatibility maintained ✅ <b>Overlay System</b>: Both vanilla and custom overlays supported ✅ <b>Map Properties System</b>: Integrated with UI components ✅ <b>Graphics Loading</b>: Optimized with caching and performance monitoring</p>
<h1><a class="anchor" id="autotoc_md370"></a>
Key Differences</h1>
<h2><a class="anchor" id="autotoc_md371"></a>
1. Language and Architecture</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Aspect   </th><th class="markdownTableHeadNone">ZScream   </th><th class="markdownTableHeadNone">Yaze    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Language   </td><td class="markdownTableBodyNone">C#   </td><td class="markdownTableBodyNone">C++    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Memory Management   </td><td class="markdownTableBodyNone">Garbage Collected   </td><td class="markdownTableBodyNone">Manual (RAII)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Graphics   </td><td class="markdownTableBodyNone">System.Drawing   </td><td class="markdownTableBodyNone">Custom OpenGL    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UI Framework   </td><td class="markdownTableBodyNone">WinForms   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md372"></a>
2. Data Structures</h2>
<p><b>ZScream:</b> </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>OverworldMap {</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> Index { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="keyword">public</span> AreaSizeEnum AreaSize { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="keyword">public</span> Bitmap GFXBitmap { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="comment">// ... other properties</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Yaze:</b> </p><div class="fragment"><div class="line"><span class="keyword">class </span>OverworldMap {</div>
<div class="line">  uint8_t index_;</div>
<div class="line">  AreaSizeEnum area_size_;</div>
<div class="line">  std::vector&lt;uint8_t&gt; bitmap_data_;</div>
<div class="line">  <span class="comment">// ... other member variables</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md373"></a>
3. Error Handling</h2>
<p><b>ZScream:</b> Uses exceptions and try-catch blocks <b>Yaze:</b> Uses <code>absl::Status</code> return values and <code>RETURN_IF_ERROR</code> macros</p>
<h2><a class="anchor" id="autotoc_md374"></a>
4. Graphics Processing</h2>
<p><b>ZScream:</b> Uses .NET's <code>Bitmap</code> class and GDI+ <b>Yaze:</b> Uses custom <code>gfx::Bitmap</code> class with OpenGL textures</p>
<h1><a class="anchor" id="autotoc_md375"></a>
Common Issues and Solutions</h1>
<h2><a class="anchor" id="autotoc_md376"></a>
1. Version Detection Issues</h2>
<p><b>Problem:</b> ROM not recognized as ZSCustomOverworld <b>Solution:</b> Check that <code>OverworldCustomASMHasBeenApplied</code> is set correctly</p>
<h2><a class="anchor" id="autotoc_md377"></a>
2. Palette Loading Errors</h2>
<p><b>Problem:</b> Maps appear with wrong colors <b>Solution:</b> Verify palette group addresses and 0xFF fallback handling</p>
<h2><a class="anchor" id="autotoc_md378"></a>
3. Graphics Not Loading</h2>
<p><b>Problem:</b> Blank textures or missing graphics <b>Solution:</b> Check graphics buffer bounds and ProcessGraphicsBuffer implementation</p>
<h2><a class="anchor" id="autotoc_md379"></a>
4. Overlay Issues</h2>
<p><b>Problem:</b> Vanilla overlays not displaying <b>Solution:</b></p><ul>
<li>Verify overlay pointer addresses and SNES-to-PC conversion</li>
<li>Ensure special area maps (0x80-0x9F) are properly loaded with correct graphics</li>
<li>Check that overlay ID mappings are correct (e.g., 0x009D → map 0x9D)</li>
<li>Verify that overlay preview shows the actual bitmap of the referenced special area map</li>
</ul>
<p><b>Problem:</b> Overlay preview showing incorrect information <b>Solution:</b> Ensure overlay preview correctly maps overlay IDs to special area map indices and displays the appropriate bitmap from the special area maps (0x80-0x9F)</p>
<h2><a class="anchor" id="autotoc_md380"></a>
5. Large Map Problems</h2>
<p><b>Problem:</b> Large maps not rendering correctly <b>Solution:</b> Check parent-child relationships and large map detection logic</p>
<h2><a class="anchor" id="autotoc_md381"></a>
6. Special Area Graphics Issues</h2>
<p><b>Problem:</b> Special area maps (0x80-0x9F) showing blank or incorrect graphics <b>Solution:</b></p><ul>
<li>Verify special area graphics loading in <code>LoadAreaInfo()</code></li>
<li>Check that special cases for maps like 0x88, 0x93, 0x95, 0x96, 0x9C are handled correctly</li>
<li>Ensure proper sprite graphics table selection for v2 vs v3 ROMs</li>
<li>Verify that special area maps use the correct graphics from referenced LW/DW maps</li>
</ul>
<h1><a class="anchor" id="autotoc_md382"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md383"></a>
1. Version-Specific Code</h2>
<p>Always check the ASM version before accessing version-specific features:</p>
<div class="fragment"><div class="line">uint8_t asm_version = (*rom_)[OverworldCustomASMHasBeenApplied];</div>
<div class="line"><span class="keywordflow">if</span> (asm_version &gt;= 3) {</div>
<div class="line">    <span class="comment">// v3 features</span></div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (asm_version == 0xFF) {</div>
<div class="line">    <span class="comment">// Vanilla features</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md384"></a>
2. Error Handling</h2>
<p>Use proper error handling for ROM operations:</p>
<div class="fragment"><div class="line">absl::Status LoadPalette() {</div>
<div class="line">    <a class="code hl_define" href="../../d4/d9e/macro_8h.html#a755e0e0d964b4d81ae730d174c5fa3ce">RETURN_IF_ERROR</a>(LoadPaletteData());</div>
<div class="line">    <a class="code hl_define" href="../../d4/d9e/macro_8h.html#a755e0e0d964b4d81ae730d174c5fa3ce">RETURN_IF_ERROR</a>(ProcessPalette());</div>
<div class="line">    <span class="keywordflow">return</span> absl::OkStatus();</div>
<div class="line">}</div>
<div class="ttc" id="amacro_8h_html_a755e0e0d964b4d81ae730d174c5fa3ce"><div class="ttname"><a href="../../d4/d9e/macro_8h.html#a755e0e0d964b4d81ae730d174c5fa3ce">RETURN_IF_ERROR</a></div><div class="ttdeci">#define RETURN_IF_ERROR(expression)</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d9e/macro_8h_source.html#l00053">macro.h:53</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md385"></a>
3. Memory Management</h2>
<p>Be careful with memory management in C++:</p>
<div class="fragment"><div class="line"><span class="comment">// Good: RAII and smart pointers</span></div>
<div class="line">std::vector&lt;uint8_t&gt; data;</div>
<div class="line">std::unique_ptr&lt;OverworldMap&gt; map;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Bad: Raw pointers without cleanup</span></div>
<div class="line">uint8_t* raw_data = <span class="keyword">new</span> uint8_t[size];</div>
<div class="line">OverworldMap* map = <span class="keyword">new</span> OverworldMap();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md386"></a>
4. Thread Safety</h2>
<p>Both editors use threading for performance:</p>
<div class="fragment"><div class="line"><span class="comment">// Yaze: Use std::async for parallel processing</span></div>
<div class="line"><span class="keyword">auto</span> future = std::async(std::launch::async, [<span class="keyword">this</span>](<span class="keywordtype">int</span> map_index) {</div>
<div class="line">    RefreshChildMap(map_index);</div>
<div class="line">}, map_index);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md387"></a>
Conclusion</h1>
<p>Understanding the differences between ZScream and yaze implementations is crucial for maintaining compatibility and adding new features. Both editors follow similar patterns but use different approaches due to their respective languages and architectures.</p>
<p>The key is to maintain the same ROM data structure understanding while adapting to each editor's specific implementation patterns. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
