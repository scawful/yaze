<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: IT-10: Collaborative Editing &amp; Multiplayer Sessions</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/d5d/md_docs_2z3ed_2IT-10-COLLABORATIVE-EDITING.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IT-10: Collaborative Editing &amp; Multiplayer Sessions</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1468"></a> <b>Priority</b>: P2 (High value, non-blocking) <br  />
 <b>Status</b>: 📋 Planned <br  />
 <b>Estimated Effort</b>: 12-15 hours <br  />
 <b>Dependencies</b>: IT-05 (Test Introspection), IT-08 (Screenshot Capture) <br  />
 <b>Target</b>: Enable real-time collaborative ROM editing with AI assistance</p>
<hr  />
<h1><a class="anchor" id="autotoc_md1470"></a>
Vision</h1>
<p>Enable multiple users to connect to the same YAZE session, see each other's edits in real-time, and collaborate with AI agents together. Think "Google Docs for ROM hacking" where users can:</p>
<ul>
<li><b>Connect to each other's sessions</b> over the network</li>
<li><b>See real-time edits</b> (tiles, sprites, map changes)</li>
<li><b>Share AI assistance</b> (one user asks AI, all users see results)</li>
<li><b>Coordinate workflows</b> (e.g., one user edits dungeons, another edits overworld)</li>
<li><b>Review changes together</b> with live cursors and annotations</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1472"></a>
User Stories</h1>
<h2><a class="anchor" id="autotoc_md1473"></a>
US-1: Session Host &amp; Join</h2>
<p><b>As a ROM hacker</b>, I want to host a collaborative editing session so my teammates can join and work together.</p>
<div class="fragment"><div class="line"># Host creates a session</div>
<div class="line">$ z3ed collab host --port 5000 --password &quot;dev123&quot;</div>
<div class="line">✅ Collaborative session started</div>
<div class="line">   Session ID: yaze-collab-f3a9b2c1</div>
<div class="line">   URL: yaze://connect/localhost:5000?session=yaze-collab-f3a9b2c1</div>
<div class="line">   Password: dev123</div>
<div class="line">   </div>
<div class="line">👥 Waiting for collaborators...</div>
<div class="line"> </div>
<div class="line"># Remote user joins</div>
<div class="line">$ z3ed collab join yaze://connect/192.168.1.100:5000?session=yaze-collab-f3a9b2c1</div>
<div class="line">🔐 Enter session password: ***</div>
<div class="line">✅ Connected to session (Host: Alice)</div>
<div class="line">👥 Active users: Alice (host), Bob (you)</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p><ul>
<li>Host can create session with optional password</li>
<li>Clients can discover and join sessions</li>
<li>Connection state visible in GUI status bar</li>
<li>Maximum 8 concurrent users per session</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1475"></a>
US-2: Real-Time Edit Synchronization</h2>
<p><b>As a collaborator</b>, I want to see other users' edits in real-time so we stay synchronized.</p>
<p><b>Scenario</b>: Alice edits a tile in Overworld Editor </p><div class="fragment"><div class="line">Alice&#39;s GUI:</div>
<div class="line">  - Draws tile at (10, 15) → Sends edit event to all clients</div>
<div class="line">  </div>
<div class="line">Bob&#39;s GUI (auto-update):</div>
<div class="line">  - Receives edit event → Redraws tile at (10, 15)</div>
<div class="line">  - Shows Alice&#39;s cursor/selection indicator</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p><ul>
<li>Edits appear on all clients within 100ms</li>
<li>Conflict resolution for simultaneous edits</li>
<li>Undo/redo synchronized across sessions</li>
<li>Cursor positions visible for all users</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1477"></a>
US-3: Shared AI Agent</h2>
<p><b>As a team lead</b>, I want to use AI agents with my team so we can all benefit from automation.</p>
<div class="fragment"><div class="line"># Alice (host) runs an AI agent test</div>
<div class="line">$ z3ed agent test --prompt &quot;Add treasure chest to room 12&quot; --share</div>
<div class="line"> </div>
<div class="line">🤖 AI Agent: Analyzing request...</div>
<div class="line">   Action: Click &quot;Dungeon Editor&quot; tab</div>
<div class="line">   Action: Select Room 12</div>
<div class="line">   Action: Add object type 0x12 (treasure chest) at (5, 8)</div>
<div class="line">   </div>
<div class="line">✅ Proposal generated (ID: prop_3f8a)</div>
<div class="line"> </div>
<div class="line"># All connected users see the proposal in their GUI</div>
<div class="line">Bob&#39;s Screen:</div>
<div class="line">  ┌─────────────────────────────────────────┐</div>
<div class="line">  │ 🤖 AI Proposal from Alice               │</div>
<div class="line">  │                                         │</div>
<div class="line">  │ Add treasure chest to room 12           │</div>
<div class="line">  │   • Click &quot;Dungeon Editor&quot; tab          │</div>
<div class="line">  │   • Select Room 12                      │</div>
<div class="line">  │   • Add treasure chest at (5, 8)        │</div>
<div class="line">  │                                         │</div>
<div class="line">  │ [Accept] [Reject] [Discuss]             │</div>
<div class="line">  └─────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line"># Team vote: 2/3 accept → Proposal executes for all users</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p><ul>
<li>AI agent results broadcast to all session members</li>
<li>Proposals require majority approval (configurable threshold)</li>
<li>All users see agent execution in real-time</li>
<li>Failed operations rollback for all users</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1479"></a>
US-4: Live Cursors &amp; Annotations</h2>
<p><b>As a collaborator</b>, I want to see where other users are working so we don't conflict.</p>
<p><b>Visual Indicators</b>: </p><div class="fragment"><div class="line">┌─────────────────────────────────────────────┐</div>
<div class="line">│ Overworld Editor                            │</div>
<div class="line">│                                             │</div>
<div class="line">│   🟦 (Alice&#39;s cursor at map 0x40)           │</div>
<div class="line">│   🟩 (Bob&#39;s cursor at map 0x41)             │</div>
<div class="line">│   🟥 (Charlie editing palette)              │</div>
<div class="line">│                                             │</div>
<div class="line">│ Active Editors:                             │</div>
<div class="line">│   • Alice: Overworld (read-write)           │</div>
<div class="line">│   • Bob: Overworld (read-write)             │</div>
<div class="line">│   • Charlie: Palette Editor (read-only)     │</div>
<div class="line">└─────────────────────────────────────────────┘</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p><ul>
<li>Each user has unique color-coded cursor</li>
<li>Active editor window highlighted for each user</li>
<li>Text chat overlay for quick communication</li>
<li>Annotation tools (pins, comments, highlights)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1481"></a>
US-5: Session Recording &amp; Replay</h2>
<p><b>As a project manager</b>, I want to record collaborative sessions so we can review work later.</p>
<div class="fragment"><div class="line"># Host enables session recording</div>
<div class="line">$ z3ed collab host --record session_2025_10_02.yaml</div>
<div class="line"> </div>
<div class="line"># Recording captures:</div>
<div class="line"># - All edit operations (tiles, sprites, maps)</div>
<div class="line"># - AI agent proposals and votes</div>
<div class="line"># - Chat messages and annotations</div>
<div class="line"># - User join/leave events</div>
<div class="line"># - Timestamps for audit trail</div>
<div class="line"> </div>
<div class="line"># Later: Replay the session</div>
<div class="line">$ z3ed collab replay session_2025_10_02.yaml --speed 2x</div>
<div class="line"> </div>
<div class="line"># Replay shows:</div>
<div class="line"># - Timeline of all edits</div>
<div class="line"># - User activity heatmap</div>
<div class="line"># - Decision points (proposals accepted/rejected)</div>
<div class="line"># - Final ROM state comparison</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p><ul>
<li>All session activity recorded in structured format (YAML/JSON)</li>
<li>Replay supports speed control (0.5x - 10x)</li>
<li>Export to video format (optional, uses screenshots)</li>
<li>Audit log for compliance/review</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1483"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md1484"></a>
Components</h2>
<h3><a class="anchor" id="autotoc_md1485"></a>
1. Collaboration Server (New)</h3>
<p><b>Location</b>: <code>src/app/core/collab/collab_server.{h,cc}</code></p>
<p><b>Responsibilities</b>:</p><ul>
<li>Manage WebSocket connections from clients</li>
<li>Broadcast edit events to all connected clients</li>
<li>Handle session authentication (password, tokens)</li>
<li>Enforce access control (read-only vs read-write)</li>
<li>Maintain session state (active users, current ROM)</li>
</ul>
<p><b>Technology</b>:</p><ul>
<li><b>WebSocket</b> for low-latency bidirectional communication</li>
<li><b>Protocol Buffers</b> for efficient serialization</li>
<li><b>JWT tokens</b> for session authentication</li>
<li><b>Redis</b> (optional) for distributed sessions</li>
</ul>
<p><b>Key APIs</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>CollabServer {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Start server on specified port</span></div>
<div class="line">  absl::Status Start(<span class="keywordtype">int</span> port, <span class="keyword">const</span> std::string&amp; password);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Handle new client connection</span></div>
<div class="line">  <span class="keywordtype">void</span> OnClientConnected(ClientConnection* client);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Broadcast edit event to all clients</span></div>
<div class="line">  <span class="keywordtype">void</span> BroadcastEdit(<span class="keyword">const</span> EditEvent&amp; event, ClientConnection* sender);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Handle AI proposal from client</span></div>
<div class="line">  <span class="keywordtype">void</span> BroadcastProposal(<span class="keyword">const</span> AgentProposal&amp; proposal);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Get active users in session</span></div>
<div class="line">  std::vector&lt;UserInfo&gt; GetActiveUsers() <span class="keyword">const</span>;</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  std::unique_ptr&lt;WebSocketServer&gt; ws_server_;</div>
<div class="line">  absl::Mutex clients_mutex_;</div>
<div class="line">  std::vector&lt;std::unique_ptr&lt;ClientConnection&gt;&gt; clients_;</div>
<div class="line">  SessionState session_state_;</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md1487"></a>
2. Collaboration Client (New)</h3>
<p><b>Location</b>: <code>src/app/core/collab/collab_client.{h,cc}</code></p>
<p><b>Responsibilities</b>:</p><ul>
<li>Connect to remote collaboration server</li>
<li>Send local edits to server</li>
<li>Receive and apply remote edits</li>
<li>Sync ROM state on join</li>
<li>Handle disconnection/reconnection</li>
</ul>
<p><b>Key APIs</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>CollabClient {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Connect to session</span></div>
<div class="line">  absl::Status Connect(<span class="keyword">const</span> std::string&amp; url, <span class="keyword">const</span> std::string&amp; password);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Send local edit to server</span></div>
<div class="line">  <span class="keywordtype">void</span> SendEdit(<span class="keyword">const</span> EditEvent&amp; event);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Callback when remote edit received</span></div>
<div class="line">  <span class="keywordtype">void</span> OnRemoteEdit(<span class="keyword">const</span> EditEvent&amp; event);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Get list of active users</span></div>
<div class="line">  std::vector&lt;UserInfo&gt; GetUsers() <span class="keyword">const</span>;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Disconnect from session</span></div>
<div class="line">  <span class="keywordtype">void</span> Disconnect();</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  std::unique_ptr&lt;WebSocketClient&gt; ws_client_;</div>
<div class="line">  CollabEventHandler* event_handler_;</div>
<div class="line">  SessionInfo session_info_;</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md1489"></a>
3. Edit Event Protocol (New)</h3>
<p><b>Location</b>: <code>src/app/core/proto/collab_events.proto</code></p>
<p><b>Message Definitions</b>: </p><div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">package yaze.collab;</div>
<div class="line"> </div>
<div class="line">// Generic edit event</div>
<div class="line">message EditEvent {</div>
<div class="line">  string event_id = 1;        // Unique event ID</div>
<div class="line">  string user_id = 2;         // User who made the edit</div>
<div class="line">  int64 timestamp_ms = 3;     // Unix timestamp</div>
<div class="line">  </div>
<div class="line">  oneof event_type {</div>
<div class="line">    TileEdit tile_edit = 10;</div>
<div class="line">    SpriteEdit sprite_edit = 11;</div>
<div class="line">    PaletteEdit palette_edit = 12;</div>
<div class="line">    MapEdit map_edit = 13;</div>
<div class="line">    ObjectEdit object_edit = 14;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Tile edit (Tile16 Editor, Tilemap)</div>
<div class="line">message TileEdit {</div>
<div class="line">  string editor = 1;          // &quot;tile16&quot;, &quot;tilemap&quot;</div>
<div class="line">  int32 x = 2;</div>
<div class="line">  int32 y = 3;</div>
<div class="line">  int32 layer = 4;</div>
<div class="line">  bytes tile_data = 5;        // Tile pixel data or ID</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Sprite edit</div>
<div class="line">message SpriteEdit {</div>
<div class="line">  int32 sprite_id = 1;</div>
<div class="line">  int32 x = 2;</div>
<div class="line">  int32 y = 3;</div>
<div class="line">  bytes sprite_data = 4;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Map edit (Overworld/Dungeon)</div>
<div class="line">message MapEdit {</div>
<div class="line">  string map_type = 1;        // &quot;overworld&quot;, &quot;dungeon&quot;</div>
<div class="line">  int32 map_id = 2;</div>
<div class="line">  bytes map_data = 3;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// User cursor position</div>
<div class="line">message CursorEvent {</div>
<div class="line">  string user_id = 1;</div>
<div class="line">  string editor = 2;          // Active editor window</div>
<div class="line">  int32 x = 3;</div>
<div class="line">  int32 y = 4;</div>
<div class="line">  string color = 5;           // Cursor color (hex)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// AI proposal event</div>
<div class="line">message ProposalEvent {</div>
<div class="line">  string proposal_id = 1;</div>
<div class="line">  string user_id = 2;         // User who initiated agent</div>
<div class="line">  string prompt = 3;</div>
<div class="line">  repeated ProposalAction actions = 4;</div>
<div class="line">  </div>
<div class="line">  enum ProposalStatus {</div>
<div class="line">    PENDING = 0;</div>
<div class="line">    ACCEPTED = 1;</div>
<div class="line">    REJECTED = 2;</div>
<div class="line">    EXECUTING = 3;</div>
<div class="line">    COMPLETED = 4;</div>
<div class="line">  }</div>
<div class="line">  ProposalStatus status = 5;</div>
<div class="line">  </div>
<div class="line">  // Voting</div>
<div class="line">  map&lt;string, bool&gt; votes = 6;  // user_id -&gt; accept/reject</div>
<div class="line">  int32 votes_needed = 7;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">message ProposalAction {</div>
<div class="line">  string action_type = 1;     // &quot;click&quot;, &quot;type&quot;, &quot;edit&quot;</div>
<div class="line">  map&lt;string, string&gt; params = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Session state</div>
<div class="line">message SessionState {</div>
<div class="line">  string session_id = 1;</div>
<div class="line">  string host_user_id = 2;</div>
<div class="line">  repeated UserInfo users = 3;</div>
<div class="line">  bytes rom_checksum = 4;     // SHA256 of ROM</div>
<div class="line">  int64 session_start_ms = 5;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">message UserInfo {</div>
<div class="line">  string user_id = 1;</div>
<div class="line">  string username = 2;</div>
<div class="line">  string color = 3;           // User&#39;s cursor color</div>
<div class="line">  bool is_host = 4;</div>
<div class="line">  bool read_only = 5;</div>
<div class="line">  string active_editor = 6;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md1491"></a>
4. Conflict Resolution System</h3>
<p><b>Challenge</b>: Multiple users edit the same tile/sprite simultaneously</p>
<p><b>Solution</b>: Operational Transformation (OT) with timestamps</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ConflictResolver {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Resolve conflicting edits</span></div>
<div class="line">  EditEvent ResolveConflict(<span class="keyword">const</span> EditEvent&amp; local, </div>
<div class="line">                            <span class="keyword">const</span> EditEvent&amp; remote);</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <span class="comment">// Last-write-wins with timestamp</span></div>
<div class="line">  EditEvent LastWriteWins(<span class="keyword">const</span> EditEvent&amp; e1, <span class="keyword">const</span> EditEvent&amp; e2);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Merge edits if possible (e.g., different layers)</span></div>
<div class="line">  std::optional&lt;EditEvent&gt; TryMerge(<span class="keyword">const</span> EditEvent&amp; e1, </div>
<div class="line">                                     <span class="keyword">const</span> EditEvent&amp; e2);</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Conflict Resolution Rules</b>:</p><ol type="1">
<li><b>Same tile, different times</b>: Last write wins (based on timestamp)</li>
<li><b>Same tile, same time (&lt;100ms)</b>: Host user wins (host authority)</li>
<li><b>Different tiles</b>: No conflict, apply both</li>
<li><b>Different layers</b>: No conflict, apply both</li>
<li><b>Undo/Redo</b>: Undo takes precedence (explicit user intent)</li>
</ol>
<hr  />
<h3><a class="anchor" id="autotoc_md1493"></a>
5. GUI Integration</h3>
<p><b>Status Bar Indicator</b>: </p><div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────┐</div>
<div class="line">│ File  Edit  View  Tools  Help          👥 3 users connected │</div>
<div class="line">│                                         🟢 Alice (Host)      │</div>
<div class="line">│                                         🔵 Bob               │</div>
<div class="line">│                                         🟣 Charlie           │</div>
<div class="line">└─────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><p><b>Collaboration Panel</b>: </p><div class="fragment"><div class="line">┌─────────────────────────────────┐</div>
<div class="line">│ Collaboration                   │</div>
<div class="line">├─────────────────────────────────┤</div>
<div class="line">│ Session: yaze-collab-f3a9b2c1   │</div>
<div class="line">│ Status: 🟢 Connected            │</div>
<div class="line">│                                 │</div>
<div class="line">│ Users (3):                      │</div>
<div class="line">│  🟢 Alice (Host) - Dungeon      │</div>
<div class="line">│  🔵 Bob (You) - Overworld       │</div>
<div class="line">│  🟣 Charlie - Palette           │</div>
<div class="line">│                                 │</div>
<div class="line">│ Activity:                       │</div>
<div class="line">│  • Alice edited room 12         │</div>
<div class="line">│  • Bob added sprite #23         │</div>
<div class="line">│  • Charlie changed palette 2    │</div>
<div class="line">│                                 │</div>
<div class="line">│ [Chat] [Proposals] [Disconnect] │</div>
<div class="line">└─────────────────────────────────┘</div>
</div><!-- fragment --><p><b>Cursor Overlay</b>: </p><div class="fragment"><div class="line"><span class="comment">// In canvas rendering</span></div>
<div class="line"><span class="keywordtype">void</span> OverworldCanvas::DrawCollaborativeCursors() {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; user : collab_client_-&gt;GetUsers()) {</div>
<div class="line">    <span class="keywordflow">if</span> (user.active_editor == <span class="stringliteral">&quot;overworld&quot;</span> &amp;&amp; user.user_id != my_user_id) {</div>
<div class="line">      ImVec2 cursor_pos = TileToScreen(user.cursor_x, user.cursor_y);</div>
<div class="line">      ImU32 color = ImGui::GetColorU32(user.color);</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Draw cursor indicator</span></div>
<div class="line">      draw_list-&gt;AddCircleFilled(cursor_pos, 5.0f, color);</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Draw username label</span></div>
<div class="line">      draw_list-&gt;AddText(cursor_pos + ImVec2(10, -5), color, user.username.c_str());</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1495"></a>
CLI Commands</h1>
<h2><a class="anchor" id="autotoc_md1496"></a>
Session Management</h2>
<div class="fragment"><div class="line"># Host a session</div>
<div class="line">z3ed collab host [options]</div>
<div class="line">  --port &lt;port&gt;           Port to listen on (default: 5000)</div>
<div class="line">  --password &lt;password&gt;   Session password (optional)</div>
<div class="line">  --max-users &lt;n&gt;         Maximum concurrent users (default: 8)</div>
<div class="line">  --read-only &lt;users&gt;     Comma-separated list of read-only users</div>
<div class="line">  --record &lt;file&gt;         Record session to file</div>
<div class="line">  </div>
<div class="line"># Join a session</div>
<div class="line">z3ed collab join &lt;url&gt; [options]</div>
<div class="line">  --password &lt;password&gt;   Session password</div>
<div class="line">  --username &lt;name&gt;       Display name (default: system username)</div>
<div class="line">  --read-only             Join in read-only mode</div>
<div class="line">  </div>
<div class="line"># List active sessions (LAN discovery)</div>
<div class="line">z3ed collab list</div>
<div class="line">  </div>
<div class="line"># Disconnect from session</div>
<div class="line">z3ed collab disconnect</div>
<div class="line"> </div>
<div class="line"># Kick user (host only)</div>
<div class="line">z3ed collab kick &lt;user-id&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1497"></a>
Session Replay</h2>
<div class="fragment"><div class="line"># Replay recorded session</div>
<div class="line">z3ed collab replay &lt;file&gt; [options]</div>
<div class="line">  --speed &lt;n&gt;             Playback speed multiplier (default: 1.0)</div>
<div class="line">  --start-time &lt;time&gt;     Start at specific timestamp</div>
<div class="line">  --end-time &lt;time&gt;       End at specific timestamp</div>
<div class="line">  --export-video &lt;file&gt;   Export to video (requires ffmpeg)</div>
<div class="line">  </div>
<div class="line"># Export session timeline</div>
<div class="line">z3ed collab export &lt;file&gt; [options]</div>
<div class="line">  --format &lt;format&gt;       Output format: json, yaml, csv (default: json)</div>
<div class="line">  --include-chat          Include chat messages</div>
<div class="line">  --include-proposals     Include AI proposals</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1499"></a>
Implementation Plan</h1>
<h2><a class="anchor" id="autotoc_md1500"></a>
Phase 1: Core Networking (4-5 hours)</h2>
<p><b>Tasks</b>:</p><ol type="1">
<li>Set up WebSocket server (using <code>libwebsockets</code> or <code>Boost.Beast</code>)</li>
<li>Implement client connection handling</li>
<li>Define <code>EditEvent</code> protobuf messages</li>
<li>Implement basic message routing (send/receive)</li>
<li>Test with 2 clients: edit on one, see on other</li>
</ol>
<p><b>Deliverables</b>:</p><ul>
<li><code>collab_server.{h,cc}</code> with basic WebSocket handling</li>
<li><code>collab_client.{h,cc}</code> with connection management</li>
<li><code>collab_events.proto</code> with edit event definitions</li>
</ul>
<p><b>Validation</b>:</p><ul>
<li>Client A connects to host</li>
<li>Client A sends test edit event</li>
<li>Host receives and broadcasts to Client B</li>
<li>Client B receives edit event</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1502"></a>
Phase 2: Edit Synchronization (3-4 hours)</h2>
<p><b>Tasks</b>:</p><ol type="1">
<li>Hook into editor event system (Overworld, Dungeon, Tile16, Palette)</li>
<li>Capture local edits and convert to <code>EditEvent</code> messages</li>
<li>Apply remote <code>EditEvent</code> messages to local ROM</li>
<li>Implement conflict resolution (last-write-wins)</li>
<li>Add undo/redo synchronization</li>
</ol>
<p><b>Deliverables</b>:</p><ul>
<li>Edit event capture hooks in all editors</li>
<li>Edit event application logic</li>
<li>Conflict resolver implementation</li>
</ul>
<p><b>Validation</b>:</p><ul>
<li>User A edits tile → User B sees tile change</li>
<li>User A edits palette → User B sees palette change</li>
<li>Simultaneous edits resolve correctly (no data corruption)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1504"></a>
Phase 3: GUI Integration (2-3 hours)</h2>
<p><b>Tasks</b>:</p><ol type="1">
<li>Add status bar indicator (connected users count)</li>
<li>Create Collaboration panel (<a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> window)</li>
<li>Implement live cursor rendering</li>
<li>Add user color assignment (unique per user)</li>
<li>Display active editor for each user</li>
</ol>
<p><b>Deliverables</b>:</p><ul>
<li>Status bar widget showing connection status</li>
<li>Collaboration panel showing user list and activity</li>
<li>Cursor overlay in canvas editors</li>
</ul>
<p><b>Validation</b>:</p><ul>
<li>User can see who's connected</li>
<li>User can see other users' cursor positions</li>
<li>User can see what editor others are using</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1506"></a>
Phase 4: AI Agent Sharing (2-3 hours)</h2>
<p><b>Tasks</b>:</p><ol type="1">
<li>Broadcast AI proposals to all session members</li>
<li>Implement proposal voting system (majority rule)</li>
<li>Synchronize agent execution across clients</li>
<li>Handle proposal rejection/timeout</li>
<li>Add proposal history to Collaboration panel</li>
</ol>
<p><b>Deliverables</b>:</p><ul>
<li><code>ProposalEvent</code> protobuf messages</li>
<li>Voting UI in GUI (Accept/Reject/Discuss buttons)</li>
<li>Proposal broadcast and execution logic</li>
</ul>
<p><b>Validation</b>:</p><ul>
<li>User A runs agent → All users see proposal</li>
<li>Users vote on proposal → Executes if majority accepts</li>
<li>Proposal execution synchronized (all users see same result)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1508"></a>
Phase 5: Session Recording &amp; Replay (1-2 hours)</h2>
<p><b>Tasks</b>:</p><ol type="1">
<li>Implement session recorder (capture all events to file)</li>
<li>Create replay engine (read events from file, re-apply)</li>
<li>Add timeline UI for replay (seek, pause, speed control)</li>
<li>Export session to JSON/YAML for analysis</li>
</ol>
<p><b>Deliverables</b>:</p><ul>
<li><code>session_recorder.{h,cc}</code> with file I/O</li>
<li><code>session_player.{h,cc}</code> with playback control</li>
<li>CLI commands for replay</li>
</ul>
<p><b>Validation</b>:</p><ul>
<li>Record session → All events captured</li>
<li>Replay session → ROM state matches original</li>
<li>Seek/speed control works correctly</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1510"></a>
Security &amp; Safety Considerations</h1>
<h2><a class="anchor" id="autotoc_md1511"></a>
Authentication</h2>
<p><b>Password Protection</b>:</p><ul>
<li>Session host sets optional password</li>
<li>Clients must provide password to join</li>
<li>Passwords hashed with bcrypt (never transmitted in plaintext)</li>
</ul>
<p><b>Token-Based Auth</b> (Future):</p><ul>
<li>Host generates JWT tokens for trusted users</li>
<li>Tokens expire after session ends</li>
<li>Revocation list for kicked users</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1513"></a>
Authorization</h2>
<p><b>Access Levels</b>:</p><ol type="1">
<li><b>Host</b>: Full control (read-write, kick users, end session)</li>
<li><b>Editor</b>: Read-write access to ROM</li>
<li><b>Viewer</b>: Read-only access (can see edits, can't make edits)</li>
</ol>
<p><b>Permission Model</b>: </p><div class="fragment"><div class="line"><span class="keyword">enum class</span> AccessLevel {</div>
<div class="line">  kHost,       <span class="comment">// Full control</span></div>
<div class="line">  kEditor,     <span class="comment">// Read-write</span></div>
<div class="line">  kViewer      <span class="comment">// Read-only</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>SessionPermissions {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">bool</span> CanEdit(<span class="keyword">const</span> std::string&amp; user_id) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> CanKick(<span class="keyword">const</span> std::string&amp; user_id) <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> CanEndSession(<span class="keyword">const</span> std::string&amp; user_id) <span class="keyword">const</span>;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> SetAccessLevel(<span class="keyword">const</span> std::string&amp; user_id, AccessLevel level);</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md1515"></a>
Data Integrity</h2>
<p><b>ROM Checksum Verification</b>:</p><ul>
<li>Host broadcasts ROM checksum (SHA256) on session start</li>
<li>Clients verify their ROM matches host's ROM</li>
<li>Mismatched ROMs rejected (prevents desyncs)</li>
</ul>
<p><b>Edit Validation</b>:</p><ul>
<li>Server validates edit events before broadcasting</li>
<li>Invalid edits rejected (e.g., out-of-bounds tile index)</li>
<li>Clients trust server's validation (reduces client-side checks)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1517"></a>
Network Security</h2>
<p><b>Encryption</b> (Optional, for public internet sessions):</p><ul>
<li>Use WSS (WebSocket Secure) with TLS/SSL</li>
<li>Self-signed certificates for LAN (trust on first use)</li>
<li>Let's Encrypt certificates for public servers</li>
</ul>
<p><b>Rate Limiting</b>:</p><ul>
<li>Max 100 edit events per second per user</li>
<li>Max 10 AI proposals per minute per session</li>
<li>Prevents spam/DOS attacks</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1519"></a>
Testing Strategy</h1>
<h2><a class="anchor" id="autotoc_md1520"></a>
Unit Tests</h2>
<p><b>Conflict Resolution</b>: </p><div class="fragment"><div class="line">TEST(ConflictResolverTest, LastWriteWins) {</div>
<div class="line">  ConflictResolver resolver;</div>
<div class="line">  </div>
<div class="line">  EditEvent e1 = MakeTileEdit(10, 15, <span class="comment">/*timestamp=*/</span>1000);</div>
<div class="line">  EditEvent e2 = MakeTileEdit(10, 15, <span class="comment">/*timestamp=*/</span>2000);</div>
<div class="line">  </div>
<div class="line">  EditEvent resolved = resolver.ResolveConflict(e1, e2);</div>
<div class="line">  </div>
<div class="line">  EXPECT_EQ(resolved.timestamp_ms(), 2000);  <span class="comment">// e2 wins</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(ConflictResolverTest, MergeDifferentLayers) {</div>
<div class="line">  ConflictResolver resolver;</div>
<div class="line">  </div>
<div class="line">  EditEvent e1 = MakeTileEdit(10, 15, <span class="comment">/*layer=*/</span>0, <span class="comment">/*timestamp=*/</span>1000);</div>
<div class="line">  EditEvent e2 = MakeTileEdit(10, 15, <span class="comment">/*layer=*/</span>1, <span class="comment">/*timestamp=*/</span>1000);</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">auto</span> merged = resolver.TryMerge(e1, e2);</div>
<div class="line">  </div>
<div class="line">  ASSERT_TRUE(merged.has_value());</div>
<div class="line">  <span class="comment">// Both edits should be applied (different layers)</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md1522"></a>
Integration Tests</h2>
<p><b>Session Connection</b>: </p><div class="fragment"><div class="line">TEST(CollabServerTest, ClientConnection) {</div>
<div class="line">  CollabServer server;</div>
<div class="line">  server.Start(5000, <span class="stringliteral">&quot;password123&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  CollabClient client;</div>
<div class="line">  <span class="keyword">auto</span> status = client.Connect(<span class="stringliteral">&quot;ws://localhost:5000&quot;</span>, <span class="stringliteral">&quot;password123&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  EXPECT_TRUE(status.ok());</div>
<div class="line">  EXPECT_EQ(server.GetActiveUsers().size(), 1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(CollabServerTest, EditBroadcast) {</div>
<div class="line">  CollabServer server;</div>
<div class="line">  server.Start(5000, <span class="stringliteral">&quot;password123&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  CollabClient client1, client2;</div>
<div class="line">  client1.Connect(<span class="stringliteral">&quot;ws://localhost:5000&quot;</span>, <span class="stringliteral">&quot;password123&quot;</span>);</div>
<div class="line">  client2.Connect(<span class="stringliteral">&quot;ws://localhost:5000&quot;</span>, <span class="stringliteral">&quot;password123&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Client 1 sends edit</span></div>
<div class="line">  EditEvent edit = MakeTileEdit(10, 15, 1000);</div>
<div class="line">  client1.SendEdit(edit);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Wait for broadcast</span></div>
<div class="line">  std::this_thread::sleep_for(std::chrono::milliseconds(100));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Client 2 should receive edit</span></div>
<div class="line">  EXPECT_TRUE(client2.HasReceivedEdit(edit.event_id()));</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md1524"></a>
E2E Tests</h2>
<p><b>Collaborative Workflow</b>: </p><div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># tests/e2e/test_collab_workflow.sh</div>
<div class="line"> </div>
<div class="line"># Start host in background</div>
<div class="line">z3ed collab host --port 5000 --password test &amp;</div>
<div class="line">HOST_PID=$!</div>
<div class="line">sleep 2</div>
<div class="line"> </div>
<div class="line"># Client 1 joins</div>
<div class="line">z3ed collab join ws://localhost:5000 --password test --username Alice &amp;</div>
<div class="line">CLIENT1_PID=$!</div>
<div class="line">sleep 1</div>
<div class="line"> </div>
<div class="line"># Client 2 joins</div>
<div class="line">z3ed collab join ws://localhost:5000 --password test --username Bob &amp;</div>
<div class="line">CLIENT2_PID=$!</div>
<div class="line">sleep 1</div>
<div class="line"> </div>
<div class="line"># Verify 3 users connected (host + 2 clients)</div>
<div class="line">USERS=$(z3ed collab users --json | jq &#39;. | length&#39;)</div>
<div class="line">if [ &quot;$USERS&quot; -ne 3 ]; then</div>
<div class="line">  echo &quot;❌ Expected 3 users, got $USERS&quot;</div>
<div class="line">  exit 1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Client 1 makes edit via CLI</div>
<div class="line">z3ed project overworld edit --map 0x40 --tile-x 10 --tile-y 15 --tile-id 0x123</div>
<div class="line"> </div>
<div class="line"># Wait for sync</div>
<div class="line">sleep 0.5</div>
<div class="line"> </div>
<div class="line"># Verify edit appeared on Client 2</div>
<div class="line">TILE_ID=$(z3ed project overworld get --map 0x40 --tile-x 10 --tile-y 15 --json | jq &#39;.tile_id&#39;)</div>
<div class="line">if [ &quot;$TILE_ID&quot; != &quot;0x123&quot; ]; then</div>
<div class="line">  echo &quot;❌ Edit not synchronized&quot;</div>
<div class="line">  exit 1</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">echo &quot;✅ Collaborative workflow test passed&quot;</div>
<div class="line"> </div>
<div class="line"># Cleanup</div>
<div class="line">kill $HOST_PID $CLIENT1_PID $CLIENT2_PID</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1526"></a>
Performance Considerations</h1>
<h2><a class="anchor" id="autotoc_md1527"></a>
Bandwidth Usage</h2>
<p><b>Typical Edit Event Size</b>:</p><ul>
<li>TileEdit: ~50 bytes (protobuf encoded)</li>
<li>CursorEvent: ~30 bytes</li>
<li>ProposalEvent: ~500 bytes (with actions)</li>
</ul>
<p><b>Estimated Bandwidth</b> (3 users, moderate activity):</p><ul>
<li>Edit events: 10/sec × 50 bytes = 500 bytes/sec</li>
<li>Cursor updates: 30/sec × 30 bytes = 900 bytes/sec</li>
<li><b>Total</b>: ~1.4 KB/sec per client (~11 Kbps)</li>
</ul>
<p><b>Optimization</b>:</p><ul>
<li>Batch cursor updates (send every 50ms instead of every frame)</li>
<li>Delta compression for tile data (send only changed pixels)</li>
<li>Message prioritization (edits &gt; cursors &gt; chat)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1529"></a>
Latency Targets</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Metric   </th><th class="markdownTableHeadNone">Target   </th><th class="markdownTableHeadNone">Acceptable   </th><th class="markdownTableHeadNone">Critical    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Edit propagation   </td><td class="markdownTableBodyNone">&lt;50ms   </td><td class="markdownTableBodyNone">&lt;100ms   </td><td class="markdownTableBodyNone">&gt;200ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Cursor update   </td><td class="markdownTableBodyNone">&lt;16ms   </td><td class="markdownTableBodyNone">&lt;33ms   </td><td class="markdownTableBodyNone">&gt;100ms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Proposal broadcast   </td><td class="markdownTableBodyNone">&lt;100ms   </td><td class="markdownTableBodyNone">&lt;200ms   </td><td class="markdownTableBodyNone">&gt;500ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Connection timeout   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">&gt;5s   </td></tr>
</table>
<p><b>Optimization Strategies</b>:</p><ul>
<li>WebSocket for low-latency bidirectional communication</li>
<li>Protobuf for efficient serialization (vs JSON)</li>
<li>Message batching for cursor updates</li>
<li>Predictive rendering (interpolate remote cursors)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1531"></a>
Future Enhancements</h1>
<h2><a class="anchor" id="autotoc_md1532"></a>
Voice Chat Integration</h2>
<p><b>Idea</b>: Embed WebRTC voice chat for real-time communication</p>
<div class="fragment"><div class="line">z3ed collab host --voice --voice-codec opus</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Faster coordination than text chat</li>
<li>Enhances team collaboration</li>
<li>Optional (users can disable if not needed)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1534"></a>
Persistent Sessions</h2>
<p><b>Idea</b>: Sessions persist across host disconnects (using Redis)</p>
<p><b>Architecture</b>: </p><div class="fragment"><div class="line">┌──────────┐     ┌───────────┐     ┌──────────┐</div>
<div class="line">│ Client A ├────►│ Redis     │◄────┤ Client B │</div>
<div class="line">└──────────┘     │ (session  │     └──────────┘</div>
<div class="line">                 │  state)   │</div>
<div class="line">┌──────────┐     │           │     ┌──────────┐</div>
<div class="line">│ Client C ├────►│           │◄────┤ Client D │</div>
<div class="line">└──────────┘     └───────────┘     └──────────┘</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Host can disconnect without ending session</li>
<li>Any user can become new host (elected automatically)</li>
<li>Session state preserved (users, edits, proposals)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1536"></a>
Cloud-Hosted Sessions</h2>
<p><b>Idea</b>: Deploy collab server to cloud for public access</p>
<div class="fragment"><div class="line"># Deploy to AWS/GCP/Azure</div>
<div class="line">z3ed collab deploy --provider aws --region us-east-1</div>
<div class="line"> </div>
<div class="line"># Join cloud session</div>
<div class="line">z3ed collab join wss://yaze-collab.example.com/session/abc123</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>No port forwarding required</li>
<li>Better uptime and reliability</li>
<li>Centralized session management</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1538"></a>
Integration with Version Control</h2>
<p><b>Idea</b>: Auto-commit edits to Git during collaborative sessions</p>
<div class="fragment"><div class="line">z3ed collab host --git-auto-commit --git-interval 5m</div>
</div><!-- fragment --><p><b>Behavior</b>:</p><ul>
<li>Every 5 minutes, commit current ROM state to Git</li>
<li>Commit message includes user activity summary</li>
<li>Creates audit trail for rollback/review</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1540"></a>
Success Metrics</h1>
<h2><a class="anchor" id="autotoc_md1541"></a>
Adoption Metrics</h2>
<ul>
<li><b>Active Sessions</b>: 50+ concurrent sessions within 3 months</li>
<li><b>User Retention</b>: 60% of users who try collab use it again</li>
<li><b>Session Duration</b>: Average 30+ minutes per session</li>
</ul>
<h2><a class="anchor" id="autotoc_md1542"></a>
Technical Metrics</h2>
<ul>
<li><b>Edit Latency</b>: &lt;100ms p99 (99th percentile)</li>
<li>**Uptime**: &gt;99.5% (excluding client disconnects)</li>
<li><b>Conflict Rate</b>: &lt;1% of edits result in conflicts</li>
<li><b>Bandwidth</b>: &lt;5 KB/sec per client average</li>
</ul>
<h2><a class="anchor" id="autotoc_md1543"></a>
User Satisfaction</h2>
<ul>
<li>**NPS Score**: 40+ (Net Promoter Score)</li>
<li>**Bug Reports**: &lt;5 critical bugs per 1000 sessions</li>
<li>**Support Tickets**: &lt;10 per month related to collab features</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1545"></a>
Risks &amp; Mitigation</h1>
<h2><a class="anchor" id="autotoc_md1546"></a>
Risk 1: Network Latency</h2>
<p><b>Impact</b>: High latency (&gt;200ms) degrades user experience</p>
<p><b>Mitigation</b>:</p><ul>
<li>Implement client-side prediction (apply edits immediately, rollback if rejected)</li>
<li>Show latency indicator in GUI (yellow/red warning)</li>
<li>Suggest LAN-only for high-latency users</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1548"></a>
Risk 2: Data Corruption</h2>
<p><b>Impact</b>: Conflicting edits corrupt ROM data</p>
<p><b>Mitigation</b>:</p><ul>
<li>Validate all edits server-side before broadcasting</li>
<li>Implement robust conflict resolution (last-write-wins with timestamps)</li>
<li>Periodic checksum verification (every 60 seconds)</li>
<li>Auto-save backups every 5 minutes (local + server)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1550"></a>
Risk 3: Security Vulnerabilities</h2>
<p><b>Impact</b>: Malicious users could inject invalid edits or DOS the server</p>
<p><b>Mitigation</b>:</p><ul>
<li>Rate limiting (100 edits/sec per user)</li>
<li>Input validation (all edit events validated before broadcast)</li>
<li>Optional authentication (password or JWT tokens)</li>
<li>Audit logging (all events logged for forensics)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md1552"></a>
Risk 4: Scalability</h2>
<p><b>Impact</b>: Server struggles with 8+ concurrent users</p>
<p><b>Mitigation</b>:</p><ul>
<li>Load testing with 20+ simulated users</li>
<li>Message batching (reduce per-message overhead)</li>
<li>Horizontal scaling with Redis (future enhancement)</li>
<li>Hard cap at 8 users per session (prevents overload)</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1554"></a>
Summary</h1>
<p>IT-10 brings <b>real-time collaborative editing</b> to YAZE, enabling teams to work together on ROM hacks with AI assistance. Key features:</p>
<p>✅ <b>Session Hosting</b>: Host collaborative sessions with password protection <br  />
 ✅ <b>Real-Time Sync</b>: Edits appear on all clients within 100ms <br  />
 ✅ <b>Shared AI Agents</b>: Team votes on AI proposals before execution <br  />
 ✅ <b>Live Cursors</b>: See where teammates are working <br  />
 ✅ <b>Session Recording</b>: Replay sessions for review and audit <br  />
</p>
<p><b>Estimated Effort</b>: 12-15 hours <br  />
 <b>Dependencies</b>: IT-05 (Introspection), IT-08 (Screenshot Capture) <br  />
 <b>Priority</b>: P2 (High value, but not blocking other work)</p>
<p><b>Recommended Timeline</b>:</p><ul>
<li><b>After IT-09 Complete</b>: Once CI/CD integration is done</li>
<li><b>Before Agent Workflow (Phase A3)</b>: Collab enhances agent workflows (team AI usage)</li>
</ul>
<p><b>Next Steps</b>:</p><ol type="1">
<li>Finalize IT-08 (Enhanced Error Reporting)</li>
<li>Complete IT-09 (CI/CD Integration)</li>
<li>Prototype collab server with 2-client test</li>
<li>Gather user feedback on collaborative workflows</li>
</ol>
<hr  />
<p><b>Document Created</b>: October 2, 2025 <br  />
 <b>Author</b>: GitHub Copilot (AI Assistant) <br  />
 <b>Project</b>: YAZE - Yet Another Zelda3 Editor <br  />
 <b>Component</b>: z3ed CLI Tool - Collaborative Editing </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
