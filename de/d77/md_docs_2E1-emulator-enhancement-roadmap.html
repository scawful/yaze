<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: YAZE Emulator Enhancement Roadmap</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/d77/md_docs_2E1-emulator-enhancement-roadmap.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">YAZE Emulator Enhancement Roadmap</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md373"></a> <b>Version</b>: 1.0 <br  />
 <b>Date</b>: October 8, 2025 <br  />
 <b>Status</b>: Planning Phase <br  />
 <b>Target</b>: Mesen2-Level Debugging + AI Integration</p>
<hr  />
<h1><a class="anchor" id="autotoc_md375"></a>
üìã Executive Summary</h1>
<p>This document outlines the roadmap for evolving YAZE's SNES emulator from a basic runtime into a <b>world-class debugging platform</b> with AI agent integration. The goal is to achieve feature parity with Mesen2's advanced debugging capabilities while adding unique AI-powered features through the z3ed CLI system.</p>
<h2><a class="anchor" id="autotoc_md376"></a>
Core Objectives</h2>
<ol type="1">
<li><b>Advanced Debugger</b> - Breakpoints, watchpoints, memory inspection, trace logging</li>
<li><b>Performance Optimization</b> - Cycle-accurate timing, dynarec, frame pacing</li>
<li><b>Audio System Fix</b> - SDL2 audio output currently broken, needs investigation</li>
<li><b>AI Integration</b> - z3ed agent can read/write emulator state, automate testing</li>
<li><b>SPC700 Debugger</b> - Full audio CPU debugging with APU state inspection</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md378"></a>
üéØ Current State Analysis</h1>
<h2><a class="anchor" id="autotoc_md379"></a>
What Works ‚úÖ</h2>
<ul>
<li><b>CPU Emulation</b>: 65816 core functional, runs games</li>
<li><b>PPU Rendering</b>: Display works, texture updates to SDL2</li>
<li><b>ROM Loading</b>: Can load and execute SNES ROMs</li>
<li><b>Basic Controls</b>: Start/stop/pause/reset functionality</li>
<li><b>Memory Access</b>: Read/write to CPU memory space</li>
<li><b>Renderer Integration</b>: Now using <code>IRenderer</code> interface (SDL3-ready!)</li>
<li><b>Stability</b>: Emulator pauses during window resize (macOS protection)</li>
</ul>
<h2><a class="anchor" id="autotoc_md380"></a>
What's Broken ‚ùå</h2>
<ul>
<li><b>Audio Output</b>: SDL2 audio device initialized but no sound plays</li>
<li><b>SPC700 Debugging</b>: No inspection tools for audio CPU</li>
<li><b>Performance</b>: Not cycle-accurate, timing issues</li>
<li><b>Debugging Tools</b>: Minimal breakpoint support, no watchpoints</li>
<li><b>Memory Viewer</b>: Basic hex view, no structured inspection</li>
<li><b>Trace Logging</b>: No execution tracing capability</li>
</ul>
<h2><a class="anchor" id="autotoc_md381"></a>
What's Missing üöß</h2>
<ul>
<li><b>Advanced Breakpoints</b>: Conditional, access-based, CPU/SPC700</li>
<li><b>Memory Watchpoints</b>: Track reads/writes to specific addresses</li>
<li><b>Disassembly View</b>: Real-time code annotation</li>
<li><b>Performance Profiling</b>: Hotspot analysis, cycle counting</li>
<li><b>Event Viewer</b>: Track NMI, IRQ, DMA events</li>
<li><b>PPU Inspector</b>: VRAM, OAM, palette debugging</li>
<li><b>APU Inspector</b>: DSP state, sample buffer, channel visualization</li>
<li><b>AI Integration</b>: z3ed agent can't access emulator yet</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md383"></a>
üîß Phase 1: Audio System Fix (Priority: CRITICAL)</h1>
<h2><a class="anchor" id="autotoc_md384"></a>
Problem Analysis</h2>
<p><b>Current State</b>: </p><div class="fragment"><div class="line"><span class="comment">// controller.cc:31-33</span></div>
<div class="line">editor_manager_.emulator().set_audio_buffer(window_.audio_buffer_.get());</div>
<div class="line">editor_manager_.emulator().set_audio_device_id(window_.audio_device_);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// window.cc:114-130</span></div>
<div class="line">window.audio_device_ = SDL_OpenAudioDevice(NULL, 0, &amp;want, &amp;have, 0);</div>
<div class="line">SDL_PauseAudioDevice(window.audio_device_, 0);  <span class="comment">// Unpause</span></div>
</div><!-- fragment --><p><b>The Issue</b>: Audio device is initialized and unpaused, but <code>SDL_QueueAudio()</code> in emulator isn't producing sound.</p>
<h2><a class="anchor" id="autotoc_md385"></a>
Investigation Steps</h2>
<ol type="1">
<li><b>Verify Audio Device State</b> <div class="fragment"><div class="line"><span class="comment">// Add to Emulator::Run()</span></div>
<div class="line"><span class="keywordflow">if</span> (frame_count_ % 60 == 0) {  <span class="comment">// Every second</span></div>
<div class="line">  uint32_t queued = SDL_GetQueuedAudioSize(audio_device_);</div>
<div class="line">  SDL_AudioStatus status = SDL_GetAudioDeviceStatus(audio_device_);</div>
<div class="line">  printf(<span class="stringliteral">&quot;[AUDIO] Queued: %u bytes, Status: %d (1=playing, 2=paused)\n&quot;</span>, </div>
<div class="line">         queued, status);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><b>Check SPC700 Sample Generation</b> <div class="fragment"><div class="line"><span class="comment">// Verify snes_.SetSamples() is producing valid data</span></div>
<div class="line">snes_.SetSamples(audio_buffer_, wanted_samples_);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Debug output</span></div>
<div class="line">int16_t* samples = audio_buffer_;</div>
<div class="line"><span class="keywordtype">bool</span> has_audio = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; wanted_samples_ * 2; i++) {</div>
<div class="line">  <span class="keywordflow">if</span> (samples[i] != 0) {</div>
<div class="line">    has_audio = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (!has_audio &amp;&amp; frame_count_ % 60 == 0) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;[AUDIO] Warning: All samples are zero!\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><b>Validate Audio Format Compatibility</b> <div class="fragment"><div class="line"><span class="comment">// window.cc - Check if requested format matches obtained format</span></div>
<div class="line">SDL_AudioSpec want, have;</div>
<div class="line"><span class="comment">// ... (existing code)</span></div>
<div class="line">window.audio_device_ = SDL_OpenAudioDevice(NULL, 0, &amp;want, &amp;have, 0);</div>
<div class="line"> </div>
<div class="line">printf(<span class="stringliteral">&quot;[AUDIO] Requested: %dHz, %d channels, format=%d\n&quot;</span>, </div>
<div class="line">       want.freq, want.channels, want.format);</div>
<div class="line">printf(<span class="stringliteral">&quot;[AUDIO] Obtained:  %dHz, %d channels, format=%d\n&quot;</span>, </div>
<div class="line">       have.freq, have.channels, have.format);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (have.freq != want.freq || have.channels != want.channels) {</div>
<div class="line">  <a class="code hl_define" href="../../d7/d7f/log_8h.html#a81229895d58d7ea5d7b6fa913cc417fc">LOG_ERROR</a>(<span class="stringliteral">&quot;Audio&quot;</span>, <span class="stringliteral">&quot;Audio spec mismatch - may need resampling&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="alog_8h_html_a81229895d58d7ea5d7b6fa913cc417fc"><div class="ttname"><a href="../../d7/d7f/log_8h.html#a81229895d58d7ea5d7b6fa913cc417fc">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR(category, format,...)</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d7f/log_8h_source.html#l00097">log.h:97</a></div></div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md386"></a>
Likely Fixes</h2>
<p><b>Fix 1: Audio Device Paused State</b> </p><div class="fragment"><div class="line"><span class="comment">// The audio device might be re-pausing itself</span></div>
<div class="line"><span class="comment">// Try forcing unpause in the emulator loop</span></div>
<div class="line"><span class="keywordflow">if</span> (frame_count_ % 60 == 0) {</div>
<div class="line">  SDL_PauseAudioDevice(audio_device_, 0);  <span class="comment">// Ensure unpaused</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Fix 2: Sample Format Conversion</b> </p><div class="fragment"><div class="line"><span class="comment">// SPC700 might be outputting wrong format</span></div>
<div class="line"><span class="comment">// Ensure AUDIO_S16 (signed 16-bit) matches emulator output</span></div>
<div class="line"><span class="keywordtype">void</span> Snes::SetSamples(int16_t* buffer, <span class="keywordtype">int</span> count) {</div>
<div class="line">  <span class="comment">// Verify apu_.GetSamples() returns int16_t, not float or uint16_t</span></div>
<div class="line">  apu_.GetSamples(buffer, count);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Debug: Check for clipping or DC offset</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count * 2; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (buffer[i] &lt; -32768 || buffer[i] &gt; 32767) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;[AUDIO] Sample %d out of range: %d\n&quot;</span>, i, buffer[i]);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Fix 3: Buffer Size Mismatch</b> </p><div class="fragment"><div class="line"><span class="comment">// Ensure buffer allocation matches usage</span></div>
<div class="line"><span class="comment">// window.cc:128</span></div>
<div class="line">window.audio_buffer_ = std::make_shared&lt;int16_t&gt;(audio_frequency / 50 * 4);</div>
<div class="line"><span class="comment">// This allocates: 48000 / 50 * 4 = 3840 int16_t samples</span></div>
<div class="line"><span class="comment">// Emulator uses: wanted_samples_ * 4 bytes = (48000/60) * 4 = 3200 bytes</span></div>
<div class="line"><span class="comment">// = 1600 int16_t samples (800 per channel)</span></div>
<div class="line"><span class="comment">// MISMATCH! Should be:</span></div>
<div class="line">window.audio_buffer_ = std::make_shared&lt;int16_t&gt;(audio_frequency / 50 * 2);  <span class="comment">// Stereo</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md387"></a>
Quick Win Actions</h2>
<p><b>File</b>: <code><a class="el" href="../../d7/d60/window_8cc.html">window.cc</a></code> <b>Line</b>: 128 <b>Change</b>: </p><div class="fragment"><div class="line"><span class="comment">// Before:</span></div>
<div class="line">window.audio_buffer_ = std::make_shared&lt;int16_t&gt;(audio_frequency / 50 * 4);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// After:</span></div>
<div class="line"><span class="comment">// Allocate for stereo at 60Hz (worst case)</span></div>
<div class="line"><span class="comment">// 48000Hz / 60 FPS = 800 samples/frame * 2 channels = 1600 int16_t</span></div>
<div class="line">window.audio_buffer_ = std::make_shared&lt;int16_t&gt;((audio_frequency / 50) * 2);</div>
</div><!-- fragment --><p><b>File</b>: <code><a class="el" href="../../d3/d87/emulator_8cc.html">emulator.cc</a></code> <br  />
 <b>After Line</b>: 216 <b>Add</b>: </p><div class="fragment"><div class="line"><span class="comment">// Debug audio output</span></div>
<div class="line"><span class="keywordflow">if</span> (frame_count_ % 300 == 0) {  <span class="comment">// Every 5 seconds</span></div>
<div class="line">  uint32_t queued = SDL_GetQueuedAudioSize(audio_device_);</div>
<div class="line">  SDL_AudioStatus status = SDL_GetAudioDeviceStatus(audio_device_);</div>
<div class="line">  printf(<span class="stringliteral">&quot;[AUDIO] Status=%d, Queued=%u, WantedSamples=%d\n&quot;</span>, </div>
<div class="line">         status, queued, wanted_samples_);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Estimated Fix Time</b>: 2-4 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md389"></a>
üêõ Phase 2: Advanced Debugger (Mesen2 Feature Parity)</h1>
<h2><a class="anchor" id="autotoc_md390"></a>
Feature Comparison: YAZE vs Mesen2</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Mesen2   </th><th class="markdownTableHeadNone">YAZE Current   </th><th class="markdownTableHeadNone">YAZE Target    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU Breakpoints   </td><td class="markdownTableBodyNone">‚úÖ Execute/Read/Write   </td><td class="markdownTableBodyNone">‚ö†Ô∏è Basic Execute   </td><td class="markdownTableBodyNone">‚úÖ Full Support    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Memory Watchpoints   </td><td class="markdownTableBodyNone">‚úÖ Conditional   </td><td class="markdownTableBodyNone">‚ùå None   </td><td class="markdownTableBodyNone">‚úÖ Conditional    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Disassembly View   </td><td class="markdownTableBodyNone">‚úÖ Live Annotated   </td><td class="markdownTableBodyNone">‚ùå Static   </td><td class="markdownTableBodyNone">‚úÖ Live + Labels    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Memory Viewer   </td><td class="markdownTableBodyNone">‚úÖ Multi-region   </td><td class="markdownTableBodyNone">‚ö†Ô∏è Basic Hex   </td><td class="markdownTableBodyNone">‚úÖ Structured    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Trace Logger   </td><td class="markdownTableBodyNone">‚úÖ CPU/SPC/DMA   </td><td class="markdownTableBodyNone">‚ùå None   </td><td class="markdownTableBodyNone">‚úÖ All Channels    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Event Viewer   </td><td class="markdownTableBodyNone">‚úÖ IRQ/NMI/DMA   </td><td class="markdownTableBodyNone">‚ùå None   </td><td class="markdownTableBodyNone">‚úÖ Full Timeline    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Performance   </td><td class="markdownTableBodyNone">‚úÖ Cycle Accurate   </td><td class="markdownTableBodyNone">‚ùå Approximate   </td><td class="markdownTableBodyNone">‚úÖ Cycle Accurate    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Save States   </td><td class="markdownTableBodyNone">‚ö†Ô∏è Limited   </td><td class="markdownTableBodyNone">‚ö†Ô∏è Basic   </td><td class="markdownTableBodyNone">‚úÖ Full State    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PPU Debugger   </td><td class="markdownTableBodyNone">‚úÖ Layer Viewer   </td><td class="markdownTableBodyNone">‚ùå None   </td><td class="markdownTableBodyNone">‚úÖ VRAM Inspector    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">APU Debugger   </td><td class="markdownTableBodyNone">‚úÖ DSP Viewer   </td><td class="markdownTableBodyNone">‚ùå None   </td><td class="markdownTableBodyNone">‚úÖ Channel Mixer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Scripting   </td><td class="markdownTableBodyNone">‚úÖ Lua   </td><td class="markdownTableBodyNone">‚ùå None   </td><td class="markdownTableBodyNone">‚úÖ z3ed + AI!   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md391"></a>
2.1 Breakpoint System</h2>
<p><b>Architecture</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/app/emu/debug/breakpoint_manager.h</span></div>
<div class="line"><span class="keyword">class </span>BreakpointManager {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">enum class</span> Type {</div>
<div class="line">    EXECUTE,     <span class="comment">// Break when PC reaches address</span></div>
<div class="line">    READ,        <span class="comment">// Break when address is read</span></div>
<div class="line">    WRITE,       <span class="comment">// Break when address is written</span></div>
<div class="line">    ACCESS,      <span class="comment">// Break on read OR write</span></div>
<div class="line">    CONDITIONAL  <span class="comment">// Break when condition is true</span></div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">struct </span>Breakpoint {</div>
<div class="line">    uint32_t address;</div>
<div class="line">    Type type;</div>
<div class="line">    <span class="keywordtype">bool</span> enabled;</div>
<div class="line">    std::string condition;  <span class="comment">// Lua expression or simple comparison</span></div>
<div class="line">    uint32_t hit_count;</div>
<div class="line">    std::function&lt;bool()&gt; callback;  <span class="comment">// Optional custom logic</span></div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  uint32_t AddBreakpoint(uint32_t address, Type type, </div>
<div class="line">                         <span class="keyword">const</span> std::string&amp; condition = <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  <span class="keywordtype">void</span> RemoveBreakpoint(uint32_t <span class="keywordtype">id</span>);</div>
<div class="line">  <span class="keywordtype">bool</span> ShouldBreak(uint32_t address, Type access_type);</div>
<div class="line">  std::vector&lt;Breakpoint&gt; ListBreakpoints();</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::unordered_map&lt;uint32_t, Breakpoint&gt; breakpoints_;</div>
<div class="line">  uint32_t next_id_ = 1;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>CPU Integration</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/app/emu/cpu/cpu.cc</span></div>
<div class="line"><span class="keywordtype">void</span> CPU::RunOpcode() {</div>
<div class="line">  <span class="comment">// Check execute breakpoint BEFORE running</span></div>
<div class="line">  <span class="keywordflow">if</span> (breakpoint_mgr_-&gt;ShouldBreak(PC, BreakpointType::EXECUTE)) {</div>
<div class="line">    emulator_-&gt;OnBreakpointHit(PC, BreakpointType::EXECUTE);</div>
<div class="line">    <span class="keywordflow">return</span>;  <span class="comment">// Pause execution</span></div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Run instruction...</span></div>
<div class="line">  ExecuteInstruction();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Memory access breakpoints handled in Read()/Write()</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint8_t CPU::Read(uint32_t address) {</div>
<div class="line">  <span class="keywordflow">if</span> (breakpoint_mgr_-&gt;ShouldBreak(address, BreakpointType::READ)) {</div>
<div class="line">    emulator_-&gt;OnBreakpointHit(address, BreakpointType::READ);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> memory_-&gt;Read(address);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>z3ed Integration</b>: </p><div class="fragment"><div class="line"># CLI commands</div>
<div class="line">z3ed emu breakpoint add --address 0x00FFD9 --type execute</div>
<div class="line">z3ed emu breakpoint add --address 0x7E0010 --type write --condition &quot;value &gt; 100&quot;</div>
<div class="line">z3ed emu breakpoint list</div>
<div class="line">z3ed emu breakpoint remove --id 1</div>
<div class="line"> </div>
<div class="line"># AI agent can use these</div>
<div class="line">&quot;Set a breakpoint at the Link damage handler&quot;</div>
<div class="line">‚Üí Agent finds damage code address ‚Üí z3ed emu breakpoint add</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 8-12 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md393"></a>
2.2 Memory Watchpoints</h2>
<p><b>Features</b>:</p><ul>
<li>Track specific memory regions</li>
<li>Log all accesses with stack traces</li>
<li>Detect buffer overflows</li>
<li>Find data corruption sources</li>
</ul>
<p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/app/emu/debug/watchpoint_manager.h</span></div>
<div class="line"><span class="keyword">class </span>WatchpointManager {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">struct </span>Watchpoint {</div>
<div class="line">    uint32_t start_address;</div>
<div class="line">    uint32_t end_address;</div>
<div class="line">    <span class="keywordtype">bool</span> track_reads;</div>
<div class="line">    <span class="keywordtype">bool</span> track_writes;</div>
<div class="line">    std::vector&lt;AccessLog&gt; history;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">struct </span>AccessLog {</div>
<div class="line">    uint32_t pc;           <span class="comment">// Where the access happened</span></div>
<div class="line">    uint32_t address;      <span class="comment">// What address was accessed</span></div>
<div class="line">    uint8_t old_value;     <span class="comment">// Value before write</span></div>
<div class="line">    uint8_t new_value;     <span class="comment">// Value after write</span></div>
<div class="line">    <span class="keywordtype">bool</span> is_write;</div>
<div class="line">    uint64_t cycle_count;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> AddWatchpoint(uint32_t start, uint32_t end, <span class="keywordtype">bool</span> reads, <span class="keywordtype">bool</span> writes);</div>
<div class="line">  <span class="keywordtype">void</span> OnMemoryAccess(uint32_t pc, uint32_t address, <span class="keywordtype">bool</span> is_write, </div>
<div class="line">                      uint8_t old_val, uint8_t new_val);</div>
<div class="line">  std::vector&lt;AccessLog&gt; GetHistory(uint32_t address, <span class="keywordtype">int</span> max_entries = 100);</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Use Cases</b>:</p><ul>
<li>Find where Link's HP is being modified</li>
<li>Track item collection bugs</li>
<li>Debug event flag corruption</li>
<li>Detect unintended memory writes</li>
</ul>
<p><b>z3ed Commands</b>: </p><div class="fragment"><div class="line">z3ed emu watch add --start 0x7E0000 --end 0x7E1FFF --reads --writes</div>
<div class="line">z3ed emu watch history --address 0x7E0010</div>
<div class="line">z3ed emu watch export --format csv</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 6-8 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md395"></a>
2.3 Live Disassembly Viewer</h2>
<p><b>Mesen2 Inspiration</b>:</p><ul>
<li>Scrollable code view with current PC highlighted</li>
<li>Labels from ROM labels file</li>
<li>Inline comments</li>
<li>Jump target visualization</li>
<li>Hot code highlighting (most-executed instructions)</li>
</ul>
<p><b>Architecture</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/app/emu/debug/disassembly_viewer.h (already exists!)</span></div>
<div class="line"><span class="comment">// Enhance existing viewer</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>DisassemblyViewer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">struct </span>DisassembledInstruction {</div>
<div class="line">    uint32_t address;</div>
<div class="line">    std::string mnemonic;</div>
<div class="line">    std::string operands;</div>
<div class="line">    std::string comment;</div>
<div class="line">    uint32_t execution_count;  <span class="comment">// NEW: Hotspot tracking</span></div>
<div class="line">    <span class="keywordtype">bool</span> is_breakpoint;</div>
<div class="line">    <span class="keywordtype">bool</span> is_current_pc;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> Update(CPU&amp; cpu);</div>
<div class="line">  <span class="keywordtype">void</span> RenderWindow();</div>
<div class="line">  <span class="keywordtype">void</span> JumpToAddress(uint32_t address);</div>
<div class="line">  <span class="keywordtype">void</span> ToggleBreakpoint(uint32_t address);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// NEW: Hotspot profiling</span></div>
<div class="line">  <span class="keywordtype">void</span> EnableProfiling(<span class="keywordtype">bool</span> enable);</div>
<div class="line">  std::vector&lt;uint32_t&gt; GetHotspots(<span class="keywordtype">int</span> top_n = 10);</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::unordered_map&lt;uint32_t, uint32_t&gt; execution_counts_;</div>
<div class="line">  std::shared_ptr&lt;ResourceLabel&gt; labels_;  <span class="comment">// From ROM</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b><a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> Integration</b>: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Emulator::RenderDisassemblyWindow() {</div>
<div class="line">  <span class="keywordflow">if</span> (ImGui::Begin(<span class="stringliteral">&quot;Disassembly&quot;</span>, &amp;show_disassembly_)) {</div>
<div class="line">    <span class="comment">// Scrollable list</span></div>
<div class="line">    ImGui::BeginChild(<span class="stringliteral">&quot;DisasmScroll&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Show ¬±50 instructions around PC</span></div>
<div class="line">    uint32_t pc = snes_.cpu().PC;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = -50; offset &lt;= 50; offset++) {</div>
<div class="line">      <span class="keyword">auto</span> instr = disassembly_viewer_.GetInstruction(pc + offset);</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Highlight current PC</span></div>
<div class="line">      <span class="keywordflow">if</span> (offset == 0) {</div>
<div class="line">        ImGui::PushStyleColor(ImGuiCol_Text, ImVec4(1,1,0,1));</div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Show execution count for hotspots</span></div>
<div class="line">      <span class="keywordflow">if</span> (instr.execution_count &gt; 1000) {</div>
<div class="line">        ImGui::TextColored(ImVec4(1,0.5,0,1), <span class="stringliteral">&quot;üî•&quot;</span>);  <span class="comment">// Hot code</span></div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      ImGui::Text(<span class="stringliteral">&quot;%06X  %s  %s  ; %s&quot;</span>, </div>
<div class="line">                  instr.address, instr.mnemonic.c_str(), </div>
<div class="line">                  instr.operands.c_str(), instr.comment.c_str());</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span> (offset == 0) ImGui::PopStyleColor();</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Click to toggle breakpoint</span></div>
<div class="line">      <span class="keywordflow">if</span> (ImGui::IsItemClicked()) {</div>
<div class="line">        disassembly_viewer_.ToggleBreakpoint(instr.address);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    ImGui::EndChild();</div>
<div class="line">  }</div>
<div class="line">  ImGui::End();</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 10-12 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md397"></a>
2.4 Enhanced Memory Viewer</h2>
<p><b>Multi-Region Support</b>: </p><div class="fragment"><div class="line"><span class="keyword">enum class</span> MemoryRegion {</div>
<div class="line">  WRAM,        <span class="comment">// 0x7E0000-0x7FFFFF (128KB)</span></div>
<div class="line">  SRAM,        <span class="comment">// Cartridge RAM</span></div>
<div class="line">  VRAM,        <span class="comment">// PPU video RAM</span></div>
<div class="line">  CGRAM,       <span class="comment">// PPU palette RAM</span></div>
<div class="line">  OAM,         <span class="comment">// PPU sprite RAM</span></div>
<div class="line">  ARAM,        <span class="comment">// SPC700 audio RAM</span></div>
<div class="line">  ROM,         <span class="comment">// Cartridge ROM</span></div>
<div class="line">  REGISTERS    <span class="comment">// Hardware registers</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Structured Views</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>MemoryViewer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">void</span> RenderHexView(MemoryRegion region);</div>
<div class="line">  <span class="keywordtype">void</span> RenderStructView(uint32_t address, <span class="keyword">const</span> std::string&amp; struct_name);</div>
<div class="line">  <span class="keywordtype">void</span> RenderDiffView(uint32_t address, <span class="keyword">const</span> uint8_t* reference);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// NEW: ROM label integration</span></div>
<div class="line">  <span class="keywordtype">void</span> SetLabels(std::shared_ptr&lt;ResourceLabel&gt; labels);</div>
<div class="line">  std::string GetLabelForAddress(uint32_t address);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// NEW: Goto functionality</span></div>
<div class="line">  <span class="keywordtype">void</span> GotoAddress(uint32_t address);</div>
<div class="line">  <span class="keywordtype">void</span> GotoLabel(<span class="keyword">const</span> std::string&amp; label);</div>
<div class="line">};</div>
</div><!-- fragment --><p><b><a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> Layout</b>: </p><div class="fragment"><div class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
<div class="line">‚îÇ Memory Viewer                                  ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ Region: [WRAM ‚ñº] | Goto: [0x7E0010] [Find]   ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ Addr    +0 +1 +2 +3 +4 +5 +6 +7  ASCII        ‚îÇ</div>
<div class="line">‚îÇ 7E0000  00 05 3C 00 00 00 00 00  ..&lt;.....      ‚îÇ ‚Üê Link&#39;s HP</div>
<div class="line">‚îÇ 7E0008  1F 00 00 00 00 00 00 00  ........      ‚îÇ</div>
<div class="line">‚îÇ ...                                            ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ Watchpoints: [Add] [Clear All]                ‚îÇ</div>
<div class="line">‚îÇ ‚Ä¢ 0x7E0000-0x7E0010 (R/W) - Link stats        ‚îÇ</div>
<div class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 6-8 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md399"></a>
üöÄ Phase 3: Performance Optimizations</h1>
<h2><a class="anchor" id="autotoc_md400"></a>
3.1 Cycle-Accurate Timing</h2>
<p><b>Current Issue</b>: Emulator runs on frame timing, not cycle timing</p>
<p><b>Mesen2 Approach</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>CPU {</div>
<div class="line">  <span class="keywordtype">void</span> RunCycle() {</div>
<div class="line">    <span class="keywordflow">if</span> (cycles_until_next_instruction_ == 0) {</div>
<div class="line">      ExecuteInstruction();  <span class="comment">// Sets cycles_until_next_instruction_</span></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      cycles_until_next_instruction_--;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Other components run per-cycle</span></div>
<div class="line">    ppu_.RunCycle();</div>
<div class="line">    apu_.RunCycle();</div>
<div class="line">    dma_.RunCycle();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Emulator loop</span></div>
<div class="line"><span class="keywordtype">void</span> Emulator::RunFrame() {</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> cycles_per_frame = snes_.memory().pal_timing() ? 1538400 : 1789773;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cycles_per_frame; i++) {</div>
<div class="line">    snes_.RunCycle();  <span class="comment">// ONE cycle at a time</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Accurate mid-scanline effects</li>
<li>Proper DMA timing</li>
<li>Correct PPU rendering edge cases</li>
<li>Deterministic emulation</li>
</ul>
<p><b>Estimated Effort</b>: 20-30 hours (major refactor)</p>
<hr  />
<h2><a class="anchor" id="autotoc_md402"></a>
3.2 Dynamic Recompilation (Dynarec)</h2>
<p><b>Why</b>: Cycle-accurate interpretation is slow (~30 FPS). Dynarec can hit 60 FPS.</p>
<p><b>Strategy</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>Dynarec {</div>
<div class="line">  <span class="comment">// Compile frequently-executed code blocks to native ARM/x64</span></div>
<div class="line">  <span class="keywordtype">void</span>* CompileBlock(uint32_t start_pc);</div>
<div class="line">  <span class="keywordtype">void</span> InvalidateBlock(uint32_t address);  <span class="comment">// When code changes</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Cache compiled blocks</span></div>
<div class="line">  std::unordered_map&lt;uint32_t, void*&gt; code_cache_;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> CPU::RunOpcode() {</div>
<div class="line">  <span class="keywordflow">if</span> (dynarec_enabled_) {</div>
<div class="line">    <span class="comment">// Check if block is compiled</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span>* block = dynarec_.GetBlock(PC)) {</div>
<div class="line">      <span class="keywordflow">return</span> ((BlockFunc)block)();  <span class="comment">// Execute native code</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Fallback to interpreter</span></div>
<div class="line">  ExecuteInstruction();</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Complexity</b>: Very high - requires assembly code generation</p>
<p><b>Alternative</b>: Use existing dynarec library like <code>bsnes-jit</code></p>
<p><b>Estimated Effort</b>: 40-60 hours (or use library: 10 hours)</p>
<hr  />
<h2><a class="anchor" id="autotoc_md404"></a>
3.3 Frame Pacing Improvements</h2>
<p><b>Current Issue</b>: SDL_Delay(1) is too coarse</p>
<p><b>Better Approach</b>: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> Emulator::RunFrame() {</div>
<div class="line">  <span class="keyword">auto</span> frame_start = std::chrono::high_resolution_clock::now();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Run SNES frame</span></div>
<div class="line">  snes_.RunFrame();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Calculate how long to wait</span></div>
<div class="line">  <span class="keyword">auto</span> frame_end = std::chrono::high_resolution_clock::now();</div>
<div class="line">  <span class="keyword">auto</span> frame_duration = std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(</div>
<div class="line">      frame_end - frame_start);</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">auto</span> target_duration = std::chrono::microseconds(</div>
<div class="line">      <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(wanted_frames_ * 1&#39;000&#39;000));</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (frame_duration &lt; target_duration) {</div>
<div class="line">    <span class="keyword">auto</span> sleep_time = target_duration - frame_duration;</div>
<div class="line">    std::this_thread::sleep_for(sleep_time);  <span class="comment">// Precise sleep</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 2-3 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md406"></a>
üéÆ Phase 4: SPC700 Audio CPU Debugger</h1>
<h2><a class="anchor" id="autotoc_md407"></a>
4.1 APU Inspector Window</h2>
<p><b>Layout</b>: </p><div class="fragment"><div class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
<div class="line">‚îÇ APU Debugger                                            ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ SPC700 CPU State:                                       ‚îÇ</div>
<div class="line">‚îÇ   PC: 0x1234  A: 0x00  X: 0x05  Y: 0xFF  PSW: 0x02     ‚îÇ</div>
<div class="line">‚îÇ   SP: 0xEF    Cycles: 12,345,678                        ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ DSP Registers:  [Channel 0‚ñº]                           ‚îÇ</div>
<div class="line">‚îÇ   VOL_L: 127    VOL_R: 127    PITCH: 2048              ‚îÇ</div>
<div class="line">‚îÇ   ADSR: 0xBE7F  GAIN: 0x7F    ENVX: 45  OUTX: 78       ‚îÇ</div>
<div class="line">‚îÇ                                                         ‚îÇ</div>
<div class="line">‚îÇ Waveform: [‚ñà‚ñà‚ñà‚ñà‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë] (live)      ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ Audio RAM (64KB):                                       ‚îÇ</div>
<div class="line">‚îÇ 0000  BRR BRR BRR BRR ...  (sample data)               ‚îÇ</div>
<div class="line">‚îÇ ...                                                     ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ Channel Mixer:                                          ‚îÇ</div>
<div class="line">‚îÇ 0: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë (75%)  1: ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë (0%)     ‚îÇ</div>
<div class="line">‚îÇ 2: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë (45%)  3: ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë (0%)     ‚îÇ</div>
<div class="line">‚îÇ ...                                                     ‚îÇ</div>
<div class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
</div><!-- fragment --><p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/app/emu/debug/apu_inspector.h</span></div>
<div class="line"><span class="keyword">class </span>ApuInspector {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">void</span> RenderWindow(Snes&amp; snes);</div>
<div class="line">  <span class="keywordtype">void</span> RenderChannelMixer();</div>
<div class="line">  <span class="keywordtype">void</span> RenderWaveform(<span class="keywordtype">int</span> channel);</div>
<div class="line">  <span class="keywordtype">void</span> RenderDspRegisters();</div>
<div class="line">  <span class="keywordtype">void</span> RenderAudioRam();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Sample buffer visualization</span></div>
<div class="line">  <span class="keywordtype">void</span> UpdateWaveformData(<span class="keyword">const</span> int16_t* samples, <span class="keywordtype">int</span> count);</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::array&lt;std::vector&lt;float&gt;, 8&gt; channel_waveforms_;</div>
<div class="line">  <span class="keywordtype">int</span> selected_channel_ = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>z3ed Commands</b>: </p><div class="fragment"><div class="line">z3ed emu apu status</div>
<div class="line">z3ed emu apu channel --id 0</div>
<div class="line">z3ed emu apu dump-ram --output audio_ram.bin</div>
<div class="line">z3ed emu apu export-samples --channel 0 --format wav</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 12-15 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md409"></a>
4.2 Audio Sample Export</h2>
<p><b>Feature</b>: Export audio samples to WAV for analysis</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>AudioExporter {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">void</span> StartRecording(<span class="keywordtype">int</span> channel = -1);  <span class="comment">// -1 = all channels</span></div>
<div class="line">  <span class="keywordtype">void</span> StopRecording();</div>
<div class="line">  <span class="keywordtype">void</span> ExportToWav(<span class="keyword">const</span> std::string&amp; filename);</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::vector&lt;int16_t&gt; recorded_samples_;</div>
<div class="line">  <span class="keywordtype">bool</span> recording_ = <span class="keyword">false</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Use Cases</b>:</p><ul>
<li>Debug why sound effects aren't playing</li>
<li>Export game music for analysis</li>
<li>Compare with real SNES hardware recordings</li>
</ul>
<p><b>Estimated Effort</b>: 4-6 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md411"></a>
ü§ñ Phase 5: z3ed AI Agent Integration</h1>
<h2><a class="anchor" id="autotoc_md412"></a>
5.1 Emulator State Access</h2>
<p><b>Add to ConversationalAgentService</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/cli/service/agent/conversational_agent_service.h</span></div>
<div class="line"><span class="keyword">class </span>ConversationalAgentService {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// NEW: Emulator access</span></div>
<div class="line">  <span class="keywordtype">void</span> SetEmulator(emu::Emulator* emulator);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Tool: Get emulator state</span></div>
<div class="line">  std::string HandleEmulatorState();</div>
<div class="line">  std::string HandleCpuState();</div>
<div class="line">  std::string HandleMemoryRead(uint32_t address, <span class="keywordtype">int</span> count);</div>
<div class="line">  std::string HandleMemoryWrite(uint32_t address, <span class="keyword">const</span> std::vector&lt;uint8_t&gt;&amp; data);</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  emu::Emulator* emulator_ = <span class="keyword">nullptr</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>z3ed Tool Schema</b>: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-read-memory&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;Read emulator memory at a specific address&quot;,</div>
<div class="line">  &quot;parameters&quot;: {</div>
<div class="line">    &quot;address&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;description&quot;: &quot;Memory address (e.g., 0x7E0010)&quot;},</div>
<div class="line">    &quot;count&quot;: {&quot;type&quot;: &quot;integer&quot;, &quot;description&quot;: &quot;Number of bytes to read&quot;},</div>
<div class="line">    &quot;region&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;enum&quot;: [&quot;wram&quot;, &quot;sram&quot;, &quot;rom&quot;, &quot;aram&quot;]}</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example AI Queries</b>: </p><div class="fragment"><div class="line">User: &quot;What is Link&#39;s current HP?&quot;</div>
<div class="line">Agent: [calls emulator-read-memory address=0x7E0000 count=1]</div>
<div class="line">       ‚Üí Response: &quot;Link has 6 hearts (0x60 = 96 health points)&quot;</div>
<div class="line"> </div>
<div class="line">User: &quot;Set Link to full health&quot;</div>
<div class="line">Agent: [calls emulator-write-memory address=0x7E0000 data=[0xA0]]</div>
<div class="line">       ‚Üí Response: &quot;Link&#39;s HP set to 160 (full health)&quot;</div>
<div class="line"> </div>
<div class="line">User: &quot;Where is the game stuck?&quot;</div>
<div class="line">Agent: [calls emulator-cpu-state]</div>
<div class="line">       ‚Üí Response: &quot;PC=$00:8234 - Infinite loop in NMI handler&quot;</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md414"></a>
5.2 Automated Test Generation</h2>
<p><b>Use Case</b>: AI generates emulator tests from natural language</p>
<p><b>Example Flow</b>: </p><div class="fragment"><div class="line">z3ed agent test-scenario --prompt &quot;Test that Link takes damage from enemies&quot;</div>
<div class="line"> </div>
<div class="line"># AI generates:</div>
<div class="line">{</div>
<div class="line">  &quot;steps&quot;: [</div>
<div class="line">    {&quot;action&quot;: &quot;load-state&quot;, &quot;file&quot;: &quot;link_at_full_hp.sfc&quot;},</div>
<div class="line">    {&quot;action&quot;: &quot;run-frames&quot;, &quot;count&quot;: 60},</div>
<div class="line">    {&quot;action&quot;: &quot;assert-memory&quot;, &quot;address&quot;: &quot;0x7E0000&quot;, &quot;value&quot;: &quot;0xA0&quot;},</div>
<div class="line">    {&quot;action&quot;: &quot;move-link&quot;, &quot;direction&quot;: &quot;right&quot;, &quot;frames&quot;: 30},</div>
<div class="line">    {&quot;action&quot;: &quot;assert-memory-decreased&quot;, &quot;address&quot;: &quot;0x7E0000&quot;},</div>
<div class="line">    {&quot;action&quot;: &quot;screenshot&quot;, &quot;name&quot;: &quot;link_damaged.png&quot;}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="comment">// src/cli/commands/agent/test_scenario_runner.h</span></div>
<div class="line"><span class="keyword">class </span>TestScenarioRunner {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">struct </span>TestStep {</div>
<div class="line">    std::string action;</div>
<div class="line">    absl::flat_hash_map&lt;std::string, std::string&gt; params;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  absl::Status RunScenario(<span class="keyword">const</span> std::vector&lt;TestStep&gt;&amp; steps);</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> ExecuteLoadState(<span class="keyword">const</span> std::string&amp; file);</div>
<div class="line">  <span class="keywordtype">void</span> ExecuteRunFrames(<span class="keywordtype">int</span> count);</div>
<div class="line">  <span class="keywordtype">void</span> ExecuteAssertMemory(uint32_t address, uint8_t expected);</div>
<div class="line">  <span class="keywordtype">void</span> ExecuteMoveLink(<span class="keyword">const</span> std::string&amp; direction, <span class="keywordtype">int</span> frames);</div>
<div class="line">  <span class="keywordtype">void</span> ExecuteScreenshot(<span class="keyword">const</span> std::string&amp; filename);</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 8-10 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md416"></a>
5.3 Memory Map Learning</h2>
<p><b>Feature</b>: AI learns ROM's memory layout from debugging sessions</p>
<p><b>Architecture</b>: </p><div class="fragment"><div class="line"><span class="comment">// Extends existing learn command</span></div>
<div class="line">z3ed agent learn --memory-map <span class="stringliteral">&quot;0x7E0000&quot;</span> --label <span class="stringliteral">&quot;link_hp&quot;</span> --type <span class="stringliteral">&quot;uint8&quot;</span></div>
<div class="line">z3ed agent learn --memory-map <span class="stringliteral">&quot;0x7E0010&quot;</span> --label <span class="stringliteral">&quot;link_x_pos&quot;</span> --type <span class="stringliteral">&quot;uint16&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// AI can then use this knowledge</span></div>
<div class="line">User: <span class="stringliteral">&quot;What is Link&#39;s position?&quot;</span></div>
<div class="line">Agent: [checks learned memory map]</div>
<div class="line">       [calls emulator-read-memory address=0x7E0010 count=2 type=uint16]</div>
</div><!-- fragment --><p><b>Storage</b>: </p><div class="fragment"><div class="line">// ~/.yaze/agent/memory_maps/zelda3.json</div>
<div class="line">{</div>
<div class="line">  &quot;rom_hash&quot;: &quot;abc123...&quot;,</div>
<div class="line">  &quot;symbols&quot;: {</div>
<div class="line">    &quot;0x7E0000&quot;: {&quot;name&quot;: &quot;link_hp&quot;, &quot;type&quot;: &quot;uint8&quot;, &quot;description&quot;: &quot;Link&#39;s health&quot;},</div>
<div class="line">    &quot;0x7E0010&quot;: {&quot;name&quot;: &quot;link_x_pos&quot;, &quot;type&quot;: &quot;uint16&quot;, &quot;description&quot;: &quot;Link X coordinate&quot;},</div>
<div class="line">    &quot;0x7E0012&quot;: {&quot;name&quot;: &quot;link_y_pos&quot;, &quot;type&quot;: &quot;uint16&quot;, &quot;description&quot;: &quot;Link Y coordinate&quot;}</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 6-8 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md418"></a>
üìä Phase 6: Performance Profiling</h1>
<h2><a class="anchor" id="autotoc_md419"></a>
6.1 Cycle Counter &amp; Profiler</h2>
<p><b>Mesen2 Feature</b>: Shows which code is hot, helps optimize hacks</p>
<p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>PerformanceProfiler {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">struct </span>FunctionProfile {</div>
<div class="line">    uint32_t start_address;</div>
<div class="line">    uint32_t end_address;</div>
<div class="line">    std::string name;</div>
<div class="line">    uint64_t total_cycles;</div>
<div class="line">    uint32_t call_count;</div>
<div class="line">    <span class="keywordtype">float</span> percentage;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> StartProfiling();</div>
<div class="line">  <span class="keywordtype">void</span> StopProfiling();</div>
<div class="line">  std::vector&lt;FunctionProfile&gt; GetHotFunctions(<span class="keywordtype">int</span> top_n = 20);</div>
<div class="line">  <span class="keywordtype">void</span> ExportFlameGraph(<span class="keyword">const</span> std::string&amp; filename);</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::unordered_map&lt;uint32_t, uint64_t&gt; address_cycle_counts_;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b><a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a> Visualization</b>: </p><div class="fragment"><div class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
<div class="line">‚îÇ Performance Profiler                           ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ Function           Cycles      Calls    %      ‚îÇ</div>
<div class="line">‚îÇ NMI Handler        2,456,789   1,234   15.2%  ‚îÇ</div>
<div class="line">‚îÇ Link Update        1,987,654   3,600   12.3%  ‚îÇ</div>
<div class="line">‚îÇ PPU Transfer       1,234,567   890     7.6%   ‚îÇ</div>
<div class="line">‚îÇ ...                                            ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ [Start Profiling] [Stop] [Export Flame Graph] ‚îÇ</div>
<div class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
</div><!-- fragment --><p><b>z3ed Commands</b>: </p><div class="fragment"><div class="line">z3ed emu profile start</div>
<div class="line"># ... run game for a bit ...</div>
<div class="line">z3ed emu profile stop</div>
<div class="line">z3ed emu profile report --top 20</div>
<div class="line">z3ed emu profile export --format flamegraph --output profile.svg</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 10-12 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md421"></a>
6.2 Frame Time Analysis</h2>
<p><b>Track frame timing issues</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>FrameTimeAnalyzer {</div>
<div class="line">  <span class="keyword">struct </span>FrameStats {</div>
<div class="line">    <span class="keywordtype">float</span> cpu_time_ms;</div>
<div class="line">    <span class="keywordtype">float</span> ppu_time_ms;</div>
<div class="line">    <span class="keywordtype">float</span> apu_time_ms;</div>
<div class="line">    <span class="keywordtype">float</span> total_time_ms;</div>
<div class="line">    <span class="keywordtype">int</span> dropped_frames;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> RecordFrame();</div>
<div class="line">  FrameStats GetAverageStats(<span class="keywordtype">int</span> last_n_frames = 60);</div>
<div class="line">  std::vector&lt;float&gt; GetFrameTimeGraph(<span class="keywordtype">int</span> frames = 300);  <span class="comment">// 5 seconds</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Visualization</b>: Real-time graph showing frame time spikes</p>
<p><b>Estimated Effort</b>: 4-6 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md423"></a>
üéØ Phase 7: Event System &amp; Timeline</h1>
<h2><a class="anchor" id="autotoc_md424"></a>
7.1 Event Logger</h2>
<p><b>Mesen2 Feature</b>: Timeline view of all hardware events</p>
<p><b>Events to Track</b>:</p><ul>
<li>NMI (V-Blank)</li>
<li>IRQ (H-Blank, Timer)</li>
<li>DMA transfers</li>
<li>HDMA activations</li>
<li>PPU mode changes</li>
<li>Audio sample playback starts</li>
</ul>
<p><b>Implementation</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>EventLogger {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">enum class</span> EventType {</div>
<div class="line">    NMI, IRQ, DMA, HDMA, PPU_MODE_CHANGE, APU_SAMPLE_START</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">struct </span>Event {</div>
<div class="line">    EventType type;</div>
<div class="line">    uint64_t cycle;</div>
<div class="line">    uint32_t pc;  <span class="comment">// Where CPU was when event occurred</span></div>
<div class="line">    std::string details;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> LogEvent(EventType type, <span class="keyword">const</span> std::string&amp; details);</div>
<div class="line">  std::vector&lt;Event&gt; GetEvents(uint64_t start_cycle, uint64_t end_cycle);</div>
<div class="line">  <span class="keywordtype">void</span> Clear();</div>
<div class="line">  </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  std::deque&lt;Event&gt; event_history_;  <span class="comment">// Keep last 10,000 events</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Visualization</b>: </p><div class="fragment"><div class="line">Timeline (last 5 frames):</div>
<div class="line">Frame 1: [NMI]‚îÄ‚îÄ‚îÄ‚îÄ[DMA]‚îÄ‚îÄ[HDMA]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>
<div class="line">Frame 2: [NMI]‚îÄ‚îÄ‚îÄ‚îÄ[DMA]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[IRQ]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>
<div class="line">Frame 3: [NMI]‚îÄ‚îÄ‚îÄ‚îÄ[DMA]‚îÄ‚îÄ[HDMA]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>
<div class="line">         ^        ^      ^</div>
<div class="line">         16.67ms  18ms   20ms (timing shown)</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 8-10 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md426"></a>
üß† Phase 8: AI-Powered Debugging</h1>
<h2><a class="anchor" id="autotoc_md427"></a>
8.1 Intelligent Crash Analysis</h2>
<p><b>Feature</b>: AI analyzes emulator state when game crashes/freezes</p>
<div class="fragment"><div class="line">z3ed agent debug-crash --state latest_crash.state</div>
<div class="line"> </div>
<div class="line"># AI examines:</div>
<div class="line"># - CPU registers and flags</div>
<div class="line"># - Stack contents</div>
<div class="line"># - Recent code execution</div>
<div class="line"># - Memory watchpoint history</div>
<div class="line"># - Event timeline</div>
<div class="line"> </div>
<div class="line"># AI response:</div>
<div class="line">&quot;The game crashed because:</div>
<div class="line">1. Infinite loop detected at $00:8234</div>
<div class="line">2. This is the NMI handler</div>
<div class="line">3. It&#39;s waiting for PPU register 0x2137 to change</div>
<div class="line">4. The value hasn&#39;t changed in 10,000 cycles</div>
<div class="line">5. Likely cause: PPU is in wrong mode (Mode 0 instead of Mode 1)</div>
<div class="line"> </div>
<div class="line">Suggested fix:</div>
<div class="line">- Check PPU mode initialization at game start</div>
<div class="line">- Verify NMI handler only runs when PPU is ready&quot;</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 15-20 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md429"></a>
8.2 Automated Bug Reproduction</h2>
<p><b>Feature</b>: AI creates minimal test case from bug description</p>
<div class="fragment"><div class="line">z3ed agent repro --prompt &quot;Link takes damage when he shouldn&#39;t&quot;</div>
<div class="line"> </div>
<div class="line"># AI generates reproduction steps:</div>
<div class="line">{</div>
<div class="line">  &quot;steps&quot;: [</div>
<div class="line">    &quot;load_state: link_full_hp.sfc&quot;,</div>
<div class="line">    &quot;move: right, 50 frames&quot;,</div>
<div class="line">    &quot;assert: no damage taken&quot;,</div>
<div class="line">    &quot;expected: HP stays at 0xA0&quot;,</div>
<div class="line">    &quot;actual: HP decreased to 0x90&quot;,</div>
<div class="line">    &quot;analysis: Enemy collision box too large&quot;</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 12-15 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md431"></a>
üó∫Ô∏è Implementation Roadmap</h1>
<h2><a class="anchor" id="autotoc_md432"></a>
Sprint 1: Audio Fix (Week 1)</h2>
<p><b>Priority</b>: CRITICAL <br  />
 <b>Time</b>: 4 hours <br  />
 <b>Deliverables</b>:</p><ul>
<li>‚úÖ Investigate audio buffer size mismatch</li>
<li>‚úÖ Add audio debug logging</li>
<li>‚úÖ Fix SDL2 audio output</li>
<li>‚úÖ Verify audio plays correctly</li>
</ul>
<h2><a class="anchor" id="autotoc_md433"></a>
Sprint 2: Basic Debugger (Weeks 2-3)</h2>
<p><b>Priority</b>: HIGH <br  />
 <b>Time</b>: 20 hours <br  />
 <b>Deliverables</b>:</p><ul>
<li>‚úÖ Breakpoint manager with execute/read/write</li>
<li>‚úÖ Enhanced disassembly viewer with hotspots</li>
<li>‚úÖ Improved memory viewer with regions</li>
<li>‚úÖ z3ed CLI commands for debugging</li>
</ul>
<h2><a class="anchor" id="autotoc_md434"></a>
Sprint 3: SPC700 Debugger (Week 4)</h2>
<p><b>Priority</b>: MEDIUM <br  />
 <b>Time</b>: 15 hours <br  />
 <b>Deliverables</b>:</p><ul>
<li>‚úÖ APU inspector window</li>
<li>‚úÖ Channel waveform visualization</li>
<li>‚úÖ Audio RAM viewer</li>
<li>‚úÖ Sample export to WAV</li>
</ul>
<h2><a class="anchor" id="autotoc_md435"></a>
Sprint 4: AI Integration (Weeks 5-6)</h2>
<p><b>Priority</b>: MEDIUM <br  />
 <b>Time</b>: 25 hours <br  />
 <b>Deliverables</b>:</p><ul>
<li>‚úÖ Emulator state tools for z3ed agent</li>
<li>‚úÖ Memory map learning system</li>
<li>‚úÖ Automated test scenario generation</li>
<li>‚úÖ Crash analysis AI</li>
</ul>
<h2><a class="anchor" id="autotoc_md436"></a>
Sprint 5: Performance (Weeks 7-8)</h2>
<p><b>Priority</b>: LOW (Future) <br  />
 <b>Time</b>: 40+ hours <br  />
 <b>Deliverables</b>:</p><ul>
<li>‚úÖ Cycle-accurate timing</li>
<li>‚úÖ Dynamic recompilation</li>
<li>‚úÖ Performance profiler</li>
<li>‚úÖ Frame pacing improvements</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md438"></a>
üî¨ Technical Deep Dives</h1>
<h2><a class="anchor" id="autotoc_md439"></a>
Audio System Architecture (SDL2)</h2>
<p><b>Current Flow</b>: </p><div class="fragment"><div class="line">SPC700 ‚Üí APU::GetSamples() ‚Üí Snes::SetSamples() ‚Üí audio_buffer_</div>
<div class="line">         ‚Üí SDL_QueueAudio() ‚Üí SDL Audio Device ‚Üí System Audio</div>
</div><!-- fragment --><p><b>Debug Points</b>: </p><div class="fragment"><div class="line"><span class="comment">// 1. Check SPC700 output</span></div>
<div class="line"><span class="keywordtype">void</span> APU::GetSamples(int16_t* buffer, <span class="keywordtype">int</span> count) {</div>
<div class="line">  <span class="comment">// Are samples being generated?</span></div>
<div class="line">  LOG_IF_ZERO_SAMPLES(buffer, count);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 2. Check buffer handoff</span></div>
<div class="line"><span class="keywordtype">void</span> Snes::SetSamples(int16_t* buffer, <span class="keywordtype">int</span> count) {</div>
<div class="line">  apu_.GetSamples(buffer, count);</div>
<div class="line">  <span class="comment">// Are samples copied correctly?</span></div>
<div class="line">  VERIFY_BUFFER_NOT_SILENT(buffer, count);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3. Check SDL queue</span></div>
<div class="line"><span class="keywordflow">if</span> (SDL_QueueAudio(device, buffer, size) &lt; 0) {</div>
<div class="line">  <a class="code hl_define" href="../../d7/d7f/log_8h.html#a81229895d58d7ea5d7b6fa913cc417fc">LOG_ERROR</a>(<span class="stringliteral">&quot;SDL_QueueAudio failed: %s&quot;</span>, SDL_GetError());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 4. Check device status</span></div>
<div class="line"><span class="keywordflow">if</span> (SDL_GetAudioDeviceStatus(device) != SDL_AUDIO_PLAYING) {</div>
<div class="line">  <a class="code hl_define" href="../../d7/d7f/log_8h.html#a81229895d58d7ea5d7b6fa913cc417fc">LOG_ERROR</a>(<span class="stringliteral">&quot;Audio device not playing!&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Common Issues</b>:</p><ol type="1">
<li><b>Buffer size mismatch</b> - Fixed in Phase 1</li>
<li><b>Format mismatch</b> - SPC700 outputs float, SDL wants int16</li>
<li><b>Device paused</b> - SDL_PauseAudioDevice() called somewhere</li>
<li><b>No APU timing</b> - SPC700 not running or too slow</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md441"></a>
Memory Regions Reference</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Region   </th><th class="markdownTableHeadNone">Address Range   </th><th class="markdownTableHeadNone">Size   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WRAM   </td><td class="markdownTableBodyNone">0x7E0000-0x7FFFFF   </td><td class="markdownTableBodyNone">128KB   </td><td class="markdownTableBodyNone">Work RAM (game state)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SRAM   </td><td class="markdownTableBodyNone">0x700000-0x77FFFF   </td><td class="markdownTableBodyNone">Variable   </td><td class="markdownTableBodyNone">Save RAM (battery)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ROM   </td><td class="markdownTableBodyNone">0x000000-0x3FFFFF   </td><td class="markdownTableBodyNone">Up to 6MB   </td><td class="markdownTableBodyNone">Cartridge ROM    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VRAM   </td><td class="markdownTableBodyNone">PPU Internal   </td><td class="markdownTableBodyNone">64KB   </td><td class="markdownTableBodyNone">Video RAM (tiles, maps)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CGRAM   </td><td class="markdownTableBodyNone">PPU Internal   </td><td class="markdownTableBodyNone">512B   </td><td class="markdownTableBodyNone">Palette RAM (colors)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OAM   </td><td class="markdownTableBodyNone">PPU Internal   </td><td class="markdownTableBodyNone">544B   </td><td class="markdownTableBodyNone">Sprite RAM (objects)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ARAM   </td><td class="markdownTableBodyNone">SPC700 Internal   </td><td class="markdownTableBodyNone">64KB   </td><td class="markdownTableBodyNone">Audio RAM (samples)   </td></tr>
</table>
<p><b>Access Patterns</b>: </p><div class="fragment"><div class="line"><span class="comment">// CPU ‚Üí WRAM (direct)</span></div>
<div class="line">uint8_t value = cpu.Read(0x7E0010);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// CPU ‚Üí VRAM (through PPU registers)</span></div>
<div class="line">cpu.Write(0x2118, low_byte);   <span class="comment">// VRAM write</span></div>
<div class="line">cpu.Write(0x2119, high_byte);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// CPU ‚Üí ARAM (through APU registers)</span></div>
<div class="line">cpu.Write(0x2140, data);  <span class="comment">// APU I/O port 0</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md443"></a>
üéÆ Phase 9: Advanced Features (Mesen2 Parity)</h1>
<h2><a class="anchor" id="autotoc_md444"></a>
9.1 Rewind Feature</h2>
<p><b>User Experience</b>: Hold button to rewind gameplay</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>RewindManager {</div>
<div class="line">  <span class="keywordtype">void</span> RecordFrame();  <span class="comment">// Save state every frame</span></div>
<div class="line">  <span class="keywordtype">void</span> Rewind(<span class="keywordtype">int</span> frames);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Circular buffer (last 10 seconds = 600 frames)</span></div>
<div class="line">  std::deque&lt;SaveState&gt; frame_history_;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kMaxFrames = 600;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Memory Impact</b>: ~600 * 100KB = 60MB (acceptable)</p>
<p><b>Estimated Effort</b>: 6-8 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md446"></a>
9.2 TAS (Tool-Assisted Speedrun) Input Recording</h2>
<p><b>Feature</b>: Record and replay input sequences</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>InputRecorder {</div>
<div class="line">  <span class="keyword">struct </span>InputFrame {</div>
<div class="line">    uint16_t buttons;  <span class="comment">// SNES controller state</span></div>
<div class="line">    uint64_t frame_number;</div>
<div class="line">  };</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> StartRecording();</div>
<div class="line">  <span class="keywordtype">void</span> StopRecording();</div>
<div class="line">  <span class="keywordtype">void</span> SaveMovie(<span class="keyword">const</span> std::string&amp; filename);</div>
<div class="line">  <span class="keywordtype">void</span> PlayMovie(<span class="keyword">const</span> std::string&amp; filename);</div>
<div class="line">  </div>
<div class="line">  std::vector&lt;InputFrame&gt; recorded_inputs_;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>File Format</b> (JSON): </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;rom_hash&quot;: &quot;abc123...&quot;,</div>
<div class="line">  &quot;frames&quot;: [</div>
<div class="line">    {&quot;frame&quot;: 0, &quot;buttons&quot;: 0x0000},</div>
<div class="line">    {&quot;frame&quot;: 60, &quot;buttons&quot;: 0x0080},  // A button pressed</div>
<div class="line">    {&quot;frame&quot;: 61, &quot;buttons&quot;: 0x0000}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>z3ed Integration</b>: </p><div class="fragment"><div class="line">z3ed emu record start</div>
<div class="line"># ... play game ...</div>
<div class="line">z3ed emu record stop --output my_gameplay.json</div>
<div class="line">z3ed emu replay --input my_gameplay.json --verify</div>
<div class="line"> </div>
<div class="line"># AI can generate TAS inputs!</div>
<div class="line">z3ed agent tas --prompt &quot;Beat the first dungeon as fast as possible&quot;</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 8-10 hours</p>
<hr  />
<h2><a class="anchor" id="autotoc_md448"></a>
9.3 Comparison Mode</h2>
<p><b>Feature</b>: Run two emulator instances side-by-side</p>
<p><b>Use Case</b>: Compare vanilla vs hacked ROM, or before/after AI changes</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ComparisonEmulator {</div>
<div class="line">  Emulator emu_a_;</div>
<div class="line">  Emulator emu_b_;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> RunBothFrames();</div>
<div class="line">  <span class="keywordtype">void</span> RenderSideBySide();</div>
<div class="line">  <span class="keywordtype">void</span> HighlightDifferences();</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Visualization</b>: </p><div class="fragment"><div class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
<div class="line">‚îÇ   Vanilla ROM    ‚îÇ   Hacked ROM     ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ [Game Screen A]  ‚îÇ [Game Screen B]  ‚îÇ</div>
<div class="line">‚îÇ                  ‚îÇ                  ‚îÇ</div>
<div class="line">‚îÇ HP: 6 ‚ù§‚ù§‚ù§       ‚îÇ HP: 12 ‚ù§‚ù§‚ù§‚ù§‚ù§‚ù§   ‚îÇ ‚Üê Difference</div>
<div class="line">‚îÇ Rupees: 50       ‚îÇ Rupees: 50       ‚îÇ</div>
<div class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
<div class="line">Memory Diff: 147 bytes different</div>
</div><!-- fragment --><p><b>Estimated Effort</b>: 12-15 hours</p>
<hr  />
<h1><a class="anchor" id="autotoc_md450"></a>
üõ†Ô∏è Optimization Summary</h1>
<h2><a class="anchor" id="autotoc_md451"></a>
Quick Wins (&lt; 1 week)</h2>
<ol type="1">
<li><b>Fix audio output</b> - 4 hours</li>
<li><b>Add CPU breakpoints</b> - 6 hours</li>
<li><b>Enhanced memory viewer</b> - 6 hours</li>
<li><b>Frame pacing</b> - 3 hours</li>
</ol>
<h2><a class="anchor" id="autotoc_md452"></a>
Medium Term (1-2 months)</h2>
<ol type="1">
<li><b>Live disassembly</b> - 10 hours</li>
<li><b>APU debugger</b> - 15 hours</li>
<li><b>Event logger</b> - 8 hours</li>
<li><b>AI emulator tools</b> - 25 hours</li>
</ol>
<h2><a class="anchor" id="autotoc_md453"></a>
Long Term (3-6 months)</h2>
<ol type="1">
<li><b>Cycle accuracy</b> - 30 hours</li>
<li><b>Dynarec</b> - 60 hours</li>
<li><b>TAS recording</b> - 10 hours</li>
<li><b>Comparison mode</b> - 15 hours</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md455"></a>
ü§ñ z3ed Agent Emulator Tools</h1>
<h2><a class="anchor" id="autotoc_md456"></a>
New Tool Categories</h2>
<p><b>Emulator Control</b>: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-control&quot;,</div>
<div class="line">  &quot;actions&quot;: [&quot;start&quot;, &quot;stop&quot;, &quot;pause&quot;, &quot;reset&quot;, &quot;step&quot;],</div>
<div class="line">  &quot;description&quot;: &quot;Control emulator execution&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Memory Tools</b>: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-read-memory&quot;,</div>
<div class="line">  &quot;parameters&quot;: {</div>
<div class="line">    &quot;address&quot;: &quot;hex string (e.g., &#39;0x7E0010&#39;)&quot;,</div>
<div class="line">    &quot;count&quot;: &quot;number of bytes&quot;,</div>
<div class="line">    &quot;region&quot;: &quot;wram|sram|rom|vram|aram&quot;</div>
<div class="line">  }</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-write-memory&quot;,</div>
<div class="line">  &quot;parameters&quot;: {</div>
<div class="line">    &quot;address&quot;: &quot;hex string&quot;,</div>
<div class="line">    &quot;data&quot;: &quot;array of bytes&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>State Tools</b>: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-cpu-state&quot;,</div>
<div class="line">  &quot;returns&quot;: {</div>
<div class="line">    &quot;pc&quot;: &quot;Program Counter&quot;,</div>
<div class="line">    &quot;a&quot;: &quot;Accumulator&quot;,</div>
<div class="line">    &quot;x&quot;: &quot;X Register&quot;,</div>
<div class="line">    &quot;y&quot;: &quot;Y Register&quot;,</div>
<div class="line">    &quot;sp&quot;: &quot;Stack Pointer&quot;,</div>
<div class="line">    &quot;flags&quot;: &quot;Processor flags&quot;</div>
<div class="line">  }</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-save-state&quot;,</div>
<div class="line">  &quot;parameters&quot;: {&quot;filename&quot;: &quot;string&quot;}</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-load-state&quot;,</div>
<div class="line">  &quot;parameters&quot;: {&quot;filename&quot;: &quot;string&quot;}</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Debug Tools</b>: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-add-breakpoint&quot;,</div>
<div class="line">  &quot;parameters&quot;: {</div>
<div class="line">    &quot;address&quot;: &quot;hex string&quot;,</div>
<div class="line">    &quot;type&quot;: &quot;execute|read|write|access&quot;,</div>
<div class="line">    &quot;condition&quot;: &quot;optional expression&quot;</div>
<div class="line">  }</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;emulator-get-hotspots&quot;,</div>
<div class="line">  &quot;parameters&quot;: {&quot;top_n&quot;: &quot;integer&quot;},</div>
<div class="line">  &quot;returns&quot;: &quot;array of most-executed code addresses&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md457"></a>
Example AI Conversations</h2>
<p><b>Debugging</b>: </p><div class="fragment"><div class="line">User: &quot;Why is Link&#39;s HP decreasing randomly?&quot;</div>
<div class="line"> </div>
<div class="line">Agent: Let me investigate...</div>
<div class="line">       [calls emulator-read-memory address=0x7E0000 count=1]</div>
<div class="line">       ‚Üí Current HP: 0x60 (6 hearts)</div>
<div class="line">       </div>
<div class="line">       [calls emulator-add-breakpoint address=0x7E0000 type=write]</div>
<div class="line">       ‚Üí Breakpoint set</div>
<div class="line">       </div>
<div class="line">       [waits for breakpoint hit]</div>
<div class="line">       ‚Üí Breakpoint hit! PC=$00:8234</div>
<div class="line">       </div>
<div class="line">       [calls emulator-read-memory address=0x8234 count=10]</div>
<div class="line">       ‚Üí Disassembly shows: Enemy collision handler</div>
<div class="line">       </div>
<div class="line">Agent: &quot;Link&#39;s HP is being modified by the enemy collision code at $00:8234.</div>
<div class="line">       The collision box is checking at the wrong Y offset (+8 instead of +16).</div>
<div class="line">       This causes damage when Link is near but not touching enemies.&quot;</div>
</div><!-- fragment --><p><b>Testing</b>: </p><div class="fragment"><div class="line">User: &quot;Test that the new sword does double damage&quot;</div>
<div class="line"> </div>
<div class="line">Agent: [calls emulator-load-state file=enemy_encounter.sfc]</div>
<div class="line">       [calls emulator-read-memory address=0x7E0010 count=2]  # Link&#39;s damage</div>
<div class="line">       ‚Üí Current damage: 0x0004</div>
<div class="line">       </div>
<div class="line">       [calls emulator-write-memory address=0x7E0010 data=[0x08]]  # Set 2x</div>
<div class="line">       </div>
<div class="line">       [simulates sword swing - could use input recording]</div>
<div class="line">       </div>
<div class="line">       [calls emulator-read-memory address=0x7EF280]  # Enemy HP</div>
<div class="line">       ‚Üí Enemy lost 8 HP (was 4 before)</div>
<div class="line">       </div>
<div class="line">Agent: &quot;Confirmed! The new sword deals 8 damage instead of 4. </div>
<div class="line">       The 2x multiplier is working correctly.&quot;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md459"></a>
üìÅ File Structure for New Features</h1>
<div class="fragment"><div class="line">src/app/emu/</div>
<div class="line">‚îú‚îÄ‚îÄ debug/</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ breakpoint_manager.{h,cc}          # NEW</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ watchpoint_manager.{h,cc}          # NEW</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ disassembly_viewer.{h,cc}          # EXISTS - enhance</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ memory_viewer.{h,cc}               # NEW</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ event_logger.{h,cc}                # NEW</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ performance_profiler.{h,cc}        # NEW</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ apu_inspector.{h,cc}               # NEW</div>
<div class="line">‚îú‚îÄ‚îÄ tas/</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ input_recorder.{h,cc}              # NEW</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ movie_file.{h,cc}                  # NEW</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ rewind_manager.{h,cc}              # NEW</div>
<div class="line">‚îî‚îÄ‚îÄ emulator.{h,cc}                        # EXISTS - integrate above</div>
<div class="line"> </div>
<div class="line">src/cli/commands/agent/</div>
<div class="line">‚îú‚îÄ‚îÄ emulator_tools.{h,cc}                  # NEW - z3ed agent emulator commands</div>
<div class="line">‚îî‚îÄ‚îÄ test_scenario_runner.{h,cc}            # NEW - automated testing</div>
<div class="line"> </div>
<div class="line">src/cli/service/agent/</div>
<div class="line">‚îî‚îÄ‚îÄ tools/</div>
<div class="line">    ‚îú‚îÄ‚îÄ emulator_control_tool.cc           # NEW</div>
<div class="line">    ‚îú‚îÄ‚îÄ emulator_memory_tool.cc            # NEW</div>
<div class="line">    ‚îî‚îÄ‚îÄ emulator_debug_tool.cc             # NEW</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md461"></a>
üé® UI Mockups</h1>
<h2><a class="anchor" id="autotoc_md462"></a>
Debugger Layout (ImGui)</h2>
<div class="fragment"><div class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
<div class="line">‚îÇ YAZE Emulator - Debugging Mode                                ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ               ‚îÇ                        ‚îÇ                       ‚îÇ</div>
<div class="line">‚îÇ Disassembly   ‚îÇ   Game Display         ‚îÇ   Registers          ‚îÇ</div>
<div class="line">‚îÇ               ‚îÇ                        ‚îÇ                       ‚îÇ</div>
<div class="line">‚îÇ 00:8000 LDA   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  A: 0x00  X: 0x05    ‚îÇ</div>
<div class="line">‚îÇ 00:8002 STA   ‚îÇ  ‚îÇ                  ‚îÇ  ‚îÇ  Y: 0xFF  SP: 0xEF   ‚îÇ</div>
<div class="line">‚îÇ‚ñ∫00:8004 JMP   ‚îÇ  ‚îÇ    [Zelda 3]     ‚îÇ  ‚îÇ  PC: 0x8004          ‚îÇ</div>
<div class="line">‚îÇ 00:8007 NOP   ‚îÇ  ‚îÇ                  ‚îÇ  ‚îÇ  PB: 0x00  DB: 0x00  ‚îÇ</div>
<div class="line">‚îÇ 00:8008 RTL   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  Flags: nv--dizc     ‚îÇ</div>
<div class="line">‚îÇ               ‚îÇ                        ‚îÇ                       ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ               ‚îÇ                        ‚îÇ                       ‚îÇ</div>
<div class="line">‚îÇ Memory        ‚îÇ   Event Timeline       ‚îÇ   Stack              ‚îÇ</div>
<div class="line">‚îÇ               ‚îÇ                        ‚îÇ                       ‚îÇ</div>
<div class="line">‚îÇ 7E0000  00 05 ‚îÇ  Frame 123:            ‚îÇ  0x1FF: 0x00         ‚îÇ</div>
<div class="line">‚îÇ 7E0008  3C 00 ‚îÇ  [NMI]‚îÄ‚îÄ[DMA]‚îÄ‚îÄ[IRQ]   ‚îÇ  0x1FE: 0x80         ‚îÇ</div>
<div class="line">‚îÇ 7E0010  1F 00 ‚îÇ                        ‚îÇ  0x1FD: 0x04 ‚Üê SP    ‚îÇ</div>
<div class="line">‚îÇ               ‚îÇ                        ‚îÇ                       ‚îÇ</div>
<div class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md463"></a>
APU Debugger Layout</h2>
<div class="fragment"><div class="line">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</div>
<div class="line">‚îÇ SPC700 Audio Debugger                                          ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</div>
<div class="line">‚îÇ SPC700 Disassembly ‚îÇ DSP State                                ‚îÇ</div>
<div class="line">‚îÇ                    ‚îÇ                                           ‚îÇ</div>
<div class="line">‚îÇ 0100 MOV A,#$00    ‚îÇ Master Volume: L=127 R=127               ‚îÇ</div>
<div class="line">‚îÇ‚ñ∫0102 MOV (X),A     ‚îÇ Echo: OFF  FIR: Standard                 ‚îÇ</div>
<div class="line">‚îÇ 0104 INCX          ‚îÇ                                           ‚îÇ</div>
<div class="line">‚îÇ                    ‚îÇ Channel 0: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë (75%)            ‚îÇ</div>
<div class="line">‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   VOL: L=100 R=100  PITCH=2048           ‚îÇ</div>
<div class="line">‚îÇ Audio RAM (64KB)   ‚îÇ   ADSR: Attack=15 Decay=7 Sustain=7      ‚îÇ</div>
<div class="line">‚îÇ                    ‚îÇ   Sample: 0x0000-0x1234 (BRR)            ‚îÇ</div>
<div class="line">‚îÇ 0000  00 00 00 00  ‚îÇ                                           ‚îÇ</div>
<div class="line">‚îÇ 0010  BRR BRR ...  ‚îÇ Channel 1: ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë (0%)            ‚îÇ</div>
<div class="line">‚îÇ                    ‚îÇ   (Inactive)                              ‚îÇ</div>
<div class="line">‚îÇ [Export Samples]   ‚îÇ                                           ‚îÇ</div>
<div class="line">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md465"></a>
üöÄ Performance Targets</h1>
<h2><a class="anchor" id="autotoc_md466"></a>
Current Performance</h2>
<ul>
<li><b>Emulation Speed</b>: ~60 FPS (with frame skipping)</li>
<li><b>CPU Usage</b>: 40-60% (one core)</li>
<li><b>Memory</b>: 80MB (emulator only)</li>
<li><b>Accuracy</b>: ~85% (some timing issues)</li>
</ul>
<h2><a class="anchor" id="autotoc_md467"></a>
Target Performance (Post-Optimization)</h2>
<ul>
<li><b>Emulation Speed</b>: Solid 60 FPS (no skipping)</li>
<li><b>CPU Usage</b>: 20-30% (with dynarec)</li>
<li><b>Memory</b>: 100MB (with debug features)</li>
<li><b>Accuracy</b>: 98%+ (cycle-accurate)</li>
</ul>
<h2><a class="anchor" id="autotoc_md468"></a>
Optimization Strategy Priority</h2>
<ol type="1">
<li><b>Audio fix</b> - Enables testing with sound</li>
<li><b>Frame pacing</b> - Eliminates jitter</li>
<li><b>Hotspot profiling</b> - Identifies slow code</li>
<li><b>Cycle accuracy</b> - Fixes timing bugs</li>
<li><b>Dynarec</b> - 3x speed boost</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md470"></a>
üß™ Testing Integration</h1>
<h2><a class="anchor" id="autotoc_md471"></a>
Automated Emulator Tests (z3ed)</h2>
<p><b>Unit Tests</b>: </p><div class="fragment"><div class="line"># Test CPU instructions</div>
<div class="line">z3ed emu test cpu --test-suite 65816_opcodes.json</div>
<div class="line"> </div>
<div class="line"># Test PPU rendering</div>
<div class="line">z3ed emu test ppu --test-rom ppu_test.sfc --frames 600</div>
<div class="line"> </div>
<div class="line"># Test APU audio</div>
<div class="line">z3ed emu test apu --test-rom audio_test.sfc --export samples.wav</div>
</div><!-- fragment --><p><b>Regression Tests</b>: </p><div class="fragment"><div class="line"># Run all ROM compatibility tests</div>
<div class="line">z3ed emu test regression --rom-dir test_roms/ --report report.html</div>
<div class="line"> </div>
<div class="line"># Compare with reference emulator</div>
<div class="line">z3ed emu test compare --rom zelda3.sfc --reference bsnes --frames 1000</div>
</div><!-- fragment --><p><b>AI-Generated Tests</b>: </p><div class="fragment"><div class="line">z3ed agent test-scenario --prompt &quot;Test that bombs damage enemies&quot;</div>
<div class="line"> </div>
<div class="line"># AI generates emulator test script</div>
<div class="line">{</div>
<div class="line">  &quot;setup&quot;: {</div>
<div class="line">    &quot;load_state&quot;: &quot;link_with_bombs.sfc&quot;</div>
<div class="line">  },</div>
<div class="line">  &quot;steps&quot;: [</div>
<div class="line">    {&quot;action&quot;: &quot;place-bomb&quot;, &quot;x&quot;: 100, &quot;y&quot;: 100},</div>
<div class="line">    {&quot;action&quot;: &quot;wait-frames&quot;, &quot;count&quot;: 60},</div>
<div class="line">    {&quot;action&quot;: &quot;spawn-enemy&quot;, &quot;type&quot;: &quot;octorok&quot;, &quot;x&quot;: 110, &quot;y&quot;: 100},</div>
<div class="line">    {&quot;action&quot;: &quot;wait-frames&quot;, &quot;count&quot;: 60},</div>
<div class="line">    {&quot;action&quot;: &quot;assert-memory&quot;, &quot;address&quot;: &quot;0x7EF280&quot;, &quot;comparison&quot;: &quot;less_than&quot;, &quot;reference&quot;: &quot;initial&quot;}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md473"></a>
üîå z3ed Agent + Emulator Integration</h1>
<h2><a class="anchor" id="autotoc_md474"></a>
New Agent Tools</h2>
<p><b>Tool Registration</b> (automatic): </p><div class="fragment"><div class="line"><span class="comment">// src/cli/service/agent/tool_dispatcher.cc</span></div>
<div class="line"><span class="keywordtype">void</span> ToolDispatcher::RegisterEmulatorTools(Emulator* emulator) {</div>
<div class="line">  RegisterTool(<span class="stringliteral">&quot;emulator-start&quot;</span>, [emulator]() { <span class="comment">/* ... */</span> });</div>
<div class="line">  RegisterTool(<span class="stringliteral">&quot;emulator-stop&quot;</span>, [emulator]() { <span class="comment">/* ... */</span> });</div>
<div class="line">  RegisterTool(<span class="stringliteral">&quot;emulator-read-memory&quot;</span>, [emulator](args) { <span class="comment">/* ... */</span> });</div>
<div class="line">  RegisterTool(<span class="stringliteral">&quot;emulator-cpu-state&quot;</span>, [emulator]() { <span class="comment">/* ... */</span> });</div>
<div class="line">  RegisterTool(<span class="stringliteral">&quot;emulator-screenshot&quot;</span>, [emulator]() { <span class="comment">/* ... */</span> });</div>
<div class="line">  <span class="comment">// ... 15 more tools</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Example Conversations</b>:</p>
<p><b>1. Live Debugging</b>: </p><div class="fragment"><div class="line">User: &quot;Why does Link keep getting stuck in walls?&quot;</div>
<div class="line"> </div>
<div class="line">Agent: Let me debug this...</div>
<div class="line">       [calls emulator-load-state file=link_stuck.sfc]</div>
<div class="line">       [calls emulator-cpu-state]</div>
<div class="line">       ‚Üí PC=$00:9ABC (Link movement handler)</div>
<div class="line">       </div>
<div class="line">       [calls emulator-read-memory address=0x7E0022 count=2]</div>
<div class="line">       ‚Üí Link X: 0x0478, Y: 0x0234</div>
<div class="line">       </div>
<div class="line">       [calls emulator-read-memory address=0x7E0020 count=2]</div>
<div class="line">       ‚Üí Subpixel X: 0x0F, Y: 0x0F (stuck at boundary!)</div>
<div class="line">       </div>
<div class="line">       [calls emulator-add-breakpoint address=0x9ABC type=execute]</div>
<div class="line">       [calls emulator-step]</div>
<div class="line">       </div>
<div class="line">Agent: &quot;Found it! The collision detection at $00:9ABC is using</div>
<div class="line">       integer division instead of proper subpixel handling.</div>
<div class="line">       When Link&#39;s subpixel position is 0x0F, the boundary</div>
<div class="line">       check fails and he gets stuck.&quot;</div>
</div><!-- fragment --><p><b>2. Performance Analysis</b>: </p><div class="fragment"><div class="line">User: &quot;The overworld feels laggy after my changes&quot;</div>
<div class="line"> </div>
<div class="line">Agent: [calls emulator-start]</div>
<div class="line">       [calls emulator-profile-start]</div>
<div class="line">       [waits 300 frames = 5 seconds]</div>
<div class="line">       [calls emulator-profile-stop]</div>
<div class="line">       [calls emulator-get-hotspots top_n=10]</div>
<div class="line">       </div>
<div class="line">       ‚Üí Top hotspot: $00:8500 (45% of cycles)</div>
<div class="line">       </div>
<div class="line">       [calls emulator-disassemble address=0x8500 count=20]</div>
<div class="line">       </div>
<div class="line">Agent: &quot;Your tile drawing code at $00:8500 is running every frame</div>
<div class="line">       and taking 45% of CPU time! The original game only runs this</div>
<div class="line">       when tiles change. Consider adding a dirty flag check.&quot;</div>
</div><!-- fragment --><p><b>3. Automated ROM Testing</b>: </p><div class="fragment"><div class="line">User: &quot;Test my randomizer hack thoroughly&quot;</div>
<div class="line"> </div>
<div class="line">Agent: I&#39;ll run comprehensive tests...</div>
<div class="line">       [calls emulator-load-state file=randomizer_start.sfc]</div>
<div class="line">       </div>
<div class="line">       For each dungeon:</div>
<div class="line">         [calls emulator-teleport-link dungeon=N]</div>
<div class="line">         [calls emulator-run-frames count=3600]  # 60 seconds</div>
<div class="line">         [calls emulator-screenshot name=dungeon_N.png]</div>
<div class="line">         [calls emulator-check-crashes]</div>
<div class="line">         [calls emulator-verify-items-reachable]</div>
<div class="line">       </div>
<div class="line">       [calls emulator-generate-report]</div>
<div class="line">       </div>
<div class="line">Agent: &quot;Tested all 12 dungeons. Found issues:</div>
<div class="line">       - Dungeon 3: Softlock at room 0x34 (missing key)</div>
<div class="line">       - Dungeon 7: Crash at room 0x12 (invalid sprite ID)</div>
<div class="line">       All other dungeons: ‚úÖ PASS&quot;</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md476"></a>
üéì Learning from Mesen2</h1>
<h2><a class="anchor" id="autotoc_md477"></a>
What Makes Mesen2 Great</h2>
<ol type="1">
<li><b>Comprehensive Debugging</b><ul>
<li>Every hardware event is logged</li>
<li>Full state inspection at any time</li>
<li>Breakpoints on everything (CPU, PPU, APU, memory)</li>
</ul>
</li>
<li><b>Performance</b><ul>
<li>Cycle-accurate yet fast (dynarec)</li>
<li>60 FPS even with debugging enabled</li>
<li>Efficient state save/restore</li>
</ul>
</li>
<li><b>User Experience</b><ul>
<li>Integrated debugger in same window as game</li>
<li>Real-time visualization of state changes</li>
<li>Intuitive UI for complex operations</li>
</ul>
</li>
<li><b>Extensibility</b><ul>
<li>Lua scripting for automation</li>
<li>Event system for plugins</li>
<li>Export capabilities (traces, memory dumps)</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md478"></a>
Our Unique Advantages</h2>
<p><b>YAZE + z3ed has features Mesen2 doesn't</b>:</p>
<ol type="1">
<li><b>AI Integration</b><ul>
<li>Natural language debugging</li>
<li>Automated test generation</li>
<li>Intelligent crash analysis</li>
</ul>
</li>
<li><b>ROM Editor Integration</b><ul>
<li>Edit ROM while emulator runs</li>
<li>See changes immediately</li>
<li>Debugging informs editing</li>
</ul>
</li>
<li><b>Collaborative Debugging</b><ul>
<li>Share emulator state with team</li>
<li>Remote debugging via gRPC</li>
<li>AI agent can help multiple users</li>
</ul>
</li>
<li><b>Cross-Platform Testing</b><ul>
<li>Same emulator in CLI and GUI</li>
<li>Automated test scenarios</li>
<li>CI/CD integration</li>
</ul>
</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md480"></a>
üìä Resource Requirements</h1>
<h2><a class="anchor" id="autotoc_md481"></a>
Development Time Estimates</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Phase   </th><th class="markdownTableHeadNone">Hours   </th><th class="markdownTableHeadNone">Weeks (Part-Time)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Audio Fix   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">0.5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Basic Debugger   </td><td class="markdownTableBodyNone">20   </td><td class="markdownTableBodyNone">2.5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPC700 Debugger   </td><td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AI Integration   </td><td class="markdownTableBodyNone">25   </td><td class="markdownTableBodyNone">3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Performance Opts   </td><td class="markdownTableBodyNone">40   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Total</b>   </td><td class="markdownTableBodyNone"><b>104</b>   </td><td class="markdownTableBodyNone"><b>13</b>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md482"></a>
Memory Requirements</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">RAM Usage    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Base Emulator   </td><td class="markdownTableBodyNone">80 MB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Breakpoint Manager   </td><td class="markdownTableBodyNone">+2 MB    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Event Logger   </td><td class="markdownTableBodyNone">+5 MB (10K events)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Rewind Buffer   </td><td class="markdownTableBodyNone">+60 MB (10 seconds)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Performance Profiler   </td><td class="markdownTableBodyNone">+10 MB    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Total</b>   </td><td class="markdownTableBodyNone">**~160 MB**   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md483"></a>
CPU Requirements</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration   </th><th class="markdownTableHeadNone">CPU % (Single Core)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Interpreter Only   </td><td class="markdownTableBodyNone">40-60%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">+ Debugging   </td><td class="markdownTableBodyNone">50-70%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">+ Profiling   </td><td class="markdownTableBodyNone">60-80%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">+ Dynarec (future)   </td><td class="markdownTableBodyNone">20-30%   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md485"></a>
üõ£Ô∏è Recommended Implementation Order</h1>
<h2><a class="anchor" id="autotoc_md486"></a>
Month 1: Foundation</h2>
<p><b>Weeks 1-2</b>: Audio fix + Basic breakpoints <br  />
 <b>Weeks 3-4</b>: Memory viewer + Disassembly enhancements</p>
<h2><a class="anchor" id="autotoc_md487"></a>
Month 2: Audio &amp; Events</h2>
<p><b>Weeks 5-6</b>: SPC700 debugger + APU inspector <br  />
 <b>Weeks 7-8</b>: Event logger + Timeline view</p>
<h2><a class="anchor" id="autotoc_md488"></a>
Month 3: AI Integration</h2>
<p><b>Weeks 9-10</b>: z3ed emulator tools + Agent integration <br  />
 <b>Weeks 11-12</b>: Automated testing + Scenario runner</p>
<h2><a class="anchor" id="autotoc_md489"></a>
Month 4: Performance</h2>
<p><b>Weeks 13-14</b>: Cycle accuracy refactor <br  />
 <b>Weeks 15-16</b>: Dynarec or JIT library integration</p>
<h2><a class="anchor" id="autotoc_md490"></a>
Month 5: Polish</h2>
<p><b>Weeks 17-18</b>: UI/UX improvements <br  />
 <b>Weeks 19-20</b>: Documentation + Examples</p>
<hr  />
<h1><a class="anchor" id="autotoc_md492"></a>
üîÆ Future Vision: AI-Powered ROM Hacking</h1>
<h2><a class="anchor" id="autotoc_md493"></a>
The Ultimate Workflow</h2>
<ol type="1">
<li><b>AI Explores the Game</b> <div class="fragment"><div class="line">z3ed agent explore --rom zelda3.sfc --goal &quot;Find all heart piece locations&quot;</div>
<div class="line"> </div>
<div class="line"># Agent:</div>
<div class="line"># - Loads ROM in emulator</div>
<div class="line"># - Runs around overworld automatically</div>
<div class="line"># - Detects heart piece spawn events via memory watchpoints</div>
<div class="line"># - Screenshots each location</div>
<div class="line"># - Generates report with coordinates</div>
</div><!-- fragment --></li>
<li><b>AI Debugs Your Hack</b> <div class="fragment"><div class="line">z3ed agent debug --rom my_hack.sfc --issue &quot;Boss doesn&#39;t take damage&quot;</div>
<div class="line"> </div>
<div class="line"># Agent:</div>
<div class="line"># - Loads hack in emulator</div>
<div class="line"># - Adds breakpoints on damage handlers</div>
<div class="line"># - Simulates boss fight</div>
<div class="line"># - Identifies missing damage check</div>
<div class="line"># - Suggests code fix with hex addresses</div>
</div><!-- fragment --></li>
<li><b>AI Generates TAS</b> <div class="fragment"><div class="line">z3ed agent speedrun --rom zelda3.sfc --category &quot;any%&quot;</div>
<div class="line"> </div>
<div class="line"># Agent:</div>
<div class="line"># - Studies game mechanics via emulator</div>
<div class="line"># - Discovers optimal movement patterns</div>
<div class="line"># - Generates frame-perfect input sequence</div>
<div class="line"># - Exports TAS movie file</div>
</div><!-- fragment --></li>
<li><b>AI Validates Randomizers</b> <div class="fragment"><div class="line">z3ed agent validate --rom randomizer.sfc --seed 12345</div>
<div class="line"> </div>
<div class="line"># Agent:</div>
<div class="line"># - Generates logic graph from ROM</div>
<div class="line"># - Simulates playthrough via emulator</div>
<div class="line"># - Verifies all items are reachable</div>
<div class="line"># - Checks for softlocks</div>
<div class="line"># - Rates difficulty</div>
</div><!-- fragment --></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md495"></a>
üêõ Appendix A: Audio Debugging Checklist</h1>
<p><b>Run these checks to diagnose audio issues</b>:</p>
<h2><a class="anchor" id="autotoc_md496"></a>
Check 1: Device Status</h2>
<div class="fragment"><div class="line">SDL_AudioStatus status = SDL_GetAudioDeviceStatus(audio_device_);</div>
<div class="line">printf(<span class="stringliteral">&quot;Audio Status: %d (1=playing, 2=paused, 3=stopped)\n&quot;</span>, status);</div>
<div class="line"><span class="comment">// Expected: 1 (SDL_AUDIO_PLAYING)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md497"></a>
Check 2: Queue Size</h2>
<div class="fragment"><div class="line">uint32_t queued = SDL_GetQueuedAudioSize(audio_device_);</div>
<div class="line">printf(<span class="stringliteral">&quot;Queued Audio: %u bytes\n&quot;</span>, queued);</div>
<div class="line"><span class="comment">// Expected: 1000-8000 bytes (1-2 frames worth)</span></div>
<div class="line"><span class="comment">// If 0: Not queueing</span></div>
<div class="line"><span class="comment">// If &gt;50000: Overflowing, audio thread stalled</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md498"></a>
Check 3: Sample Validation</h2>
<div class="fragment"><div class="line">int16_t* samples = audio_buffer_;</div>
<div class="line"><span class="keywordtype">bool</span> all_zero = <span class="keyword">true</span>;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; wanted_samples_ * 2; i++) {</div>
<div class="line">  <span class="keywordflow">if</span> (samples[i] != 0) {</div>
<div class="line">    all_zero = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (all_zero) {</div>
<div class="line">  printf(<span class="stringliteral">&quot;ERROR: All audio samples are zero! SPC700 not outputting.\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md499"></a>
Check 4: Buffer Allocation</h2>
<div class="fragment"><div class="line"><span class="comment">// In window.cc:128, verify size calculation:</span></div>
<div class="line"><span class="comment">// For 48000Hz, 60 FPS, stereo:</span></div>
<div class="line"><span class="comment">// samples_per_frame = 48000 / 60 = 800</span></div>
<div class="line"><span class="comment">// stereo_samples = 800 * 2 = 1600 int16_t</span></div>
<div class="line"><span class="comment">// Size should be: 1600, NOT 3840</span></div>
<div class="line"> </div>
<div class="line">printf(<span class="stringliteral">&quot;Audio buffer size: %zu int16_t\n&quot;</span>, audio_buffer_.size());</div>
<div class="line"><span class="comment">// Expected: 1600-1920 (for 60-50Hz)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md500"></a>
Check 5: SPC700 Execution</h2>
<div class="fragment"><div class="line"><span class="comment">// Verify SPC700 is actually running</span></div>
<div class="line">uint64_t apu_cycles = snes_.apu().GetCycles();</div>
<div class="line"><span class="comment">// Should increase every frame</span></div>
<div class="line"><span class="comment">// If stuck: SPC700 deadlock or not running</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md501"></a>
Quick Fixes to Try</h2>
<p><b>Fix A: Force Unpause</b> </p><div class="fragment"><div class="line"><span class="comment">// emulator.cc, in RunFrame():</span></div>
<div class="line">SDL_PauseAudioDevice(audio_device_, 0);  <span class="comment">// Force play state</span></div>
</div><!-- fragment --><p><b>Fix B: Larger Queue</b> </p><div class="fragment"><div class="line"><span class="comment">// If buffer underruns, queue more:</span></div>
<div class="line">SDL_QueueAudio(audio_device_, audio_buffer_, wanted_samples_ * 4 * 2);  <span class="comment">// 2 frames</span></div>
</div><!-- fragment --><p><b>Fix C: Clear Stale Queue</b> </p><div class="fragment"><div class="line"><span class="comment">// If queue is stuck:</span></div>
<div class="line"><span class="keywordflow">if</span> (SDL_GetQueuedAudioSize(audio_device_) &gt; 50000) {</div>
<div class="line">  SDL_ClearQueuedAudio(audio_device_);  <span class="comment">// Reset</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md503"></a>
üìù Appendix B: Mesen2 Feature Reference</h1>
<h2><a class="anchor" id="autotoc_md504"></a>
Debugger Windows (Inspiration)</h2>
<ol type="1">
<li><b>CPU Debugger</b>: Disassembly, registers, breakpoints</li>
<li><b>Memory Tools</b>: Hex viewer, search, compare</li>
<li><b>PPU Viewer</b>: Layer toggles, VRAM, OAM, palettes</li>
<li><b>Event Viewer</b>: Timeline of all hardware events</li>
<li><b>Trace Logger</b>: Full execution log with filters</li>
<li><b>Performance Profiler</b>: Hotspot analysis</li>
<li><b>Script Window</b>: Lua scripting for automation</li>
</ol>
<h2><a class="anchor" id="autotoc_md505"></a>
Event Types Tracked</h2>
<ul>
<li><b>CPU</b>: NMI, IRQ, BRK instruction, RESET</li>
<li><b>PPU</b>: V-Blank, H-Blank, Mode change, Sprite overflow</li>
<li><b>DMA</b>: General DMA, HDMA, channels used</li>
<li><b>APU</b>: Sample playback, DSP writes, Timer IRQ</li>
<li><b>Cart</b>: Save RAM write, special chip events</li>
</ul>
<h2><a class="anchor" id="autotoc_md506"></a>
Trace Logger Format</h2>
<div class="fragment"><div class="line">Cycle    PC      Opcode  A  X  Y  SP  Flags  Event</div>
<div class="line">0        $00FFD9 SEI     00 00 00 1FF nvmxdiZc</div>
<div class="line">1        $00FFDA CLI     00 00 00 1FF nvmxdizc</div>
<div class="line">2        $00FFDB JMP     00 00 00 1FF nvmxdizc</div>
<div class="line">...</div>
<div class="line">16749    $008234 LDA     05 00 00 1EF Nvmxdizc [NMI]</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md508"></a>
üéØ Success Criteria</h1>
<h2><a class="anchor" id="autotoc_md509"></a>
Phase 1 Complete When:</h2>
<ul>
<li>‚úÖ Audio plays correctly from SDL2</li>
<li>‚úÖ Can hear game music and sound effects</li>
<li>‚úÖ No audio crackling or dropouts</li>
<li>‚úÖ Audio buffer diagnostics implemented</li>
</ul>
<h2><a class="anchor" id="autotoc_md510"></a>
Phase 2 Complete When:</h2>
<ul>
<li>‚úÖ Can set breakpoints on any address</li>
<li>‚úÖ Disassembly view shows live execution</li>
<li>‚úÖ Memory viewer has multi-region support</li>
<li>‚úÖ z3ed CLI can control debugger</li>
</ul>
<h2><a class="anchor" id="autotoc_md511"></a>
Phase 3 Complete When:</h2>
<ul>
<li>‚úÖ SPC700 debugger shows all APU state</li>
<li>‚úÖ Can visualize audio channels</li>
<li>‚úÖ Can export audio samples to WAV</li>
</ul>
<h2><a class="anchor" id="autotoc_md512"></a>
Phase 4 Complete When:</h2>
<ul>
<li>‚úÖ AI agent can read emulator memory</li>
<li>‚úÖ AI agent can control emulation</li>
<li>‚úÖ AI can generate test scenarios</li>
<li>‚úÖ Automated ROM testing works</li>
</ul>
<h2><a class="anchor" id="autotoc_md513"></a>
Phase 5 Complete When:</h2>
<ul>
<li>‚úÖ Emulator is cycle-accurate</li>
<li>‚úÖ 60 FPS maintained with debugging</li>
<li>‚úÖ Dynarec provides 3x speedup</li>
<li>‚úÖ All Mesen2 features implemented</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md515"></a>
üéì Learning Resources</h1>
<h2><a class="anchor" id="autotoc_md516"></a>
SNES Emulation</h2>
<ul>
<li><a href="https://www.romhacking.net/documents/226/">SNES Development Manual</a></li>
<li><a href="https://problemkaputt.de/fullsnes.htm">Fullsnes by nocash</a></li>
<li><a href="https://github.com/bsnes-emu/bsnes">bsnes source code</a> - Reference implementation</li>
<li><a href="https://github.com/SourMesen/Mesen2">Mesen2 source code</a> - Feature inspiration</li>
</ul>
<h2><a class="anchor" id="autotoc_md517"></a>
Audio Debugging</h2>
<ul>
<li><a href="https://wiki.superfamicom.org/spc700-reference">SPC700 Reference</a></li>
<li><a href="https://wiki.superfamicom.org/dsp-registers">DSP Register Guide</a></li>
<li><a href="https://wiki.superfamicom.org/bit-rate-reduction-brr">BRR Audio Format</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md518"></a>
Performance Optimization</h2>
<ul>
<li><a href="https://github.com/arm9/snes9x-rpi">Fast SNES Emulation</a> - ARM optimization</li>
<li><a href="https://github.com/rasky/r64emu/wiki/Dynamic-Recompilation">Dynarec Tutorial</a> - N64 but applicable</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md520"></a>
üôè Credits &amp; Acknowledgments</h1>
<p><b>Emulator Core</b>: Based on LakeSnes by elzo-d <br  />
 <b>Debugger Inspiration</b>: Mesen2 by SourMesen <br  />
 <b>AI Integration</b>: z3ed agent system <br  />
 <b>Documentation</b>: With love (and Puerto Rican soup! üç≤)</p>
<hr  />
<p><em>Document Version: 1.0</em> <br  />
 <em>Last Updated: October 8, 2025</em> <br  />
 <em>Next Review: After Audio Fix</em> <br  />
 <em>Sleep Well! üò¥</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
