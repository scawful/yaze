<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: z3ed Next Priorities - October 2, 2025</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/dd3/md_docs_2z3ed_2NEXT__PRIORITIES__OCT2.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">z3ed Next Priorities - October 2, 2025</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1808"></a> <b>Current Status</b>: IT-01 Complete âœ… | AW-03 Complete âœ… | Ready for E2E Validation</p>
<p>This document outlines the immediate next steps for the z3ed agent workflow system after completing IT-01 Phase 3 (ImGuiTestEngine integration).</p>
<hr  />
<h1><a class="anchor" id="autotoc_md1810"></a>
Priority 1: End-to-End Workflow Validation (ACTIVE) ðŸ”„</h1>
<p><b>Goal</b>: Validate the complete AI agent workflow from proposal creation through ROM commit <br  />
 <b>Time Estimate</b>: 2-3 hours <br  />
 <b>Status</b>: Ready to execute <br  />
 <b>Blocking</b>: None - all prerequisites complete</p>
<h2><a class="anchor" id="autotoc_md1811"></a>
Why This First?</h2>
<ul>
<li>Validate all systems work together in production</li>
<li>Identify any integration issues before building more features</li>
<li>Establish baseline for acceptable UX and performance</li>
<li>Document real-world usage patterns for future improvements</li>
</ul>
<h2><a class="anchor" id="autotoc_md1812"></a>
Task Breakdown</h2>
<h3><a class="anchor" id="autotoc_md1813"></a>
1.1. Automated Test Script Validation (30 min)</h3>
<p><b>Goal</b>: Verify E2E test script works correctly</p>
<div class="fragment"><div class="line"># Run the automated test script</div>
<div class="line">./scripts/test_harness_e2e.sh</div>
<div class="line"> </div>
<div class="line"># Expected: All 6 tests pass</div>
<div class="line"># - Ping (health check)</div>
<div class="line"># - Click (button interaction)</div>
<div class="line"># - Type (text input)</div>
<div class="line"># - Wait (condition polling)</div>
<div class="line"># - Assert (state validation)</div>
<div class="line"># - Screenshot (stub - not implemented message)</div>
</div><!-- fragment --><p><b>Success Criteria</b>:</p><ul>
<li>Script runs without errors</li>
<li>All RPCs return success responses</li>
<li>Server starts and stops cleanly</li>
<li>No port conflicts or hanging processes</li>
</ul>
<p><b>Troubleshooting</b>:</p><ul>
<li>If port 50052 in use: <code>killall yaze</code> or use different port</li>
<li>If grpcurl missing: <code>brew install grpcurl</code></li>
<li>If binary not found: Build with <code>cmake --build build-grpc-test</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md1814"></a>
1.2. Manual Workflow Testing (60 min)</h3>
<p><b>Goal</b>: Test complete proposal lifecycle with real GUI</p>
<p><b>Steps</b>:</p><ol type="1">
<li><b>Create Proposal via CLI</b>: <div class="fragment"><div class="line"># Build z3ed</div>
<div class="line">cmake --build build --target z3ed -j8</div>
<div class="line"> </div>
<div class="line"># Create test proposal with sandbox</div>
<div class="line">./build/bin/z3ed agent run &quot;Test proposal for validation&quot; --sandbox</div>
<div class="line"> </div>
<div class="line"># Verify proposal created</div>
<div class="line">./build/bin/z3ed agent list</div>
<div class="line">./build/bin/z3ed agent diff --proposal-id &lt;ID&gt;</div>
</div><!-- fragment --></li>
<li><b>Launch YAZE GUI</b>: <div class="fragment"><div class="line">./build/bin/yaze.app/Contents/MacOS/yaze</div>
<div class="line"> </div>
<div class="line"># Open ROM: File â†’ Open ROM â†’ assets/zelda3.sfc</div>
<div class="line"># Open drawer: Debug â†’ Agent Proposals</div>
</div><!-- fragment --></li>
<li><b>Test ProposalDrawer UI</b>:<ul>
<li>âœ… Verify proposal appears in list</li>
<li>âœ… Click proposal to select</li>
<li>âœ… Review metadata (ID, timestamp, sandbox_id)</li>
<li>âœ… Review execution log content</li>
<li>âœ… Review diff content (if any)</li>
<li>âœ… Test filtering (All/Pending/Accepted/Rejected)</li>
<li>âœ… Test Refresh button</li>
</ul>
</li>
<li><b>Test Accept Workflow</b>:<ul>
<li>âœ… Click "Accept" button</li>
<li>âœ… Confirm dialog appears</li>
<li>âœ… Verify ROM marked dirty (save prompt)</li>
<li>âœ… File â†’ Save ROM</li>
<li>âœ… Verify proposal status changes to "Accepted"</li>
</ul>
</li>
<li><b>Test Reject Workflow</b>:<ul>
<li>âœ… Create another test proposal</li>
<li>âœ… Click "Reject" button</li>
<li>âœ… Confirm dialog appears</li>
<li>âœ… Verify status changes to "Rejected"</li>
<li>âœ… Verify sandbox ROM unchanged</li>
</ul>
</li>
<li><b>Test Delete Workflow</b>:<ul>
<li>âœ… Create another test proposal</li>
<li>âœ… Click "Delete" button</li>
<li>âœ… Confirm dialog appears</li>
<li>âœ… Verify proposal removed from list</li>
<li>âœ… Verify files cleaned up from disk</li>
</ul>
</li>
</ol>
<p><b>Success Criteria</b>:</p><ul>
<li>All workflows complete without crashes</li>
<li>ROM merging works correctly</li>
<li>Status updates persist across sessions</li>
<li>UI responsive and intuitive</li>
</ul>
<p><b>Known Issues to Document</b>:</p><ul>
<li>Any UX friction points</li>
<li>Performance concerns with large diffs</li>
<li>Edge cases that need handling</li>
</ul>
<h3><a class="anchor" id="autotoc_md1815"></a>
1.3. Real Widget Testing (60 min)</h3>
<p><b>Goal</b>: Test GUI automation with actual YAZE widgets</p>
<p><b>Workflow 1: Open Overworld Editor</b>: </p><div class="fragment"><div class="line"># Start YAZE with test harness</div>
<div class="line">./build-grpc-test/bin/yaze.app/Contents/MacOS/yaze \</div>
<div class="line">  --enable_test_harness \</div>
<div class="line">  --test_harness_port=50052 \</div>
<div class="line">  --rom_file=assets/zelda3.sfc &amp;</div>
<div class="line"> </div>
<div class="line"># Wait for startup</div>
<div class="line">sleep 2</div>
<div class="line"> </div>
<div class="line"># Test workflow</div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;target&quot;:&quot;button:Overworld&quot;,&quot;type&quot;:&quot;LEFT&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Click</div>
<div class="line"> </div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;condition&quot;:&quot;window_visible:Overworld Editor&quot;,&quot;timeout_ms&quot;:5000}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Wait</div>
<div class="line"> </div>
<div class="line">grpcurl -plaintext -import-path src/app/core/proto -proto imgui_test_harness.proto \</div>
<div class="line">  -d &#39;{&quot;condition&quot;:&quot;visible:Overworld Editor&quot;}&#39; \</div>
<div class="line">  127.0.0.1:50052 yaze.test.ImGuiTestHarness/Assert</div>
</div><!-- fragment --><p><b>Workflow 2: Open Dungeon Editor</b>:</p><ul>
<li>Click "button:Dungeon"</li>
<li>Wait "window_visible:Dungeon Editor"</li>
<li>Assert "visible:Dungeon Editor"</li>
</ul>
<p><b>Workflow 3: Type in Input Field</b> (if applicable):</p><ul>
<li>Click "input:FieldName"</li>
<li>Type text with clear_first</li>
<li>Assert text_contains (partial implementation)</li>
</ul>
<p><b>Success Criteria</b>:</p><ul>
<li>All real widgets respond to automation</li>
<li>Timeouts work correctly (5s default)</li>
<li>Error messages helpful when widgets not found</li>
<li>No crashes or hangs during automation</li>
</ul>
<p><b>Document</b>:</p><ul>
<li>Widget naming conventions (button:Name, window:Name, input:Name)</li>
<li>Common timeout values needed</li>
<li>Edge cases (disabled buttons, hidden windows, etc.)</li>
</ul>
<h3><a class="anchor" id="autotoc_md1816"></a>
1.4. Documentation Updates (30 min)</h3>
<p><b>Goal</b>: Capture learnings and update guides</p>
<p><b>Files to Update</b>:</p><ol type="1">
<li><b><a class="el" href="../../d2/d82/IT-01-QUICKSTART_8md.html">IT-01-QUICKSTART.md</a></b>:<ul>
<li>Add real widget examples</li>
<li>Document common workflows</li>
<li>Add troubleshooting for real scenarios</li>
</ul>
</li>
<li><b><a class="el" href="../../df/d90/E6-z3ed-implementation-plan_8md.html">E6-z3ed-implementation-plan.md</a></b>:<ul>
<li>Mark Priority 1 as complete</li>
<li>Add lessons learned section</li>
<li>Update known limitations</li>
</ul>
</li>
<li><b><a class="el" href="../../d3/d5f/STATE__SUMMARY__2025-10-02_8md.html">STATE_SUMMARY_2025-10-02.md</a></b>:<ul>
<li>Add E2E validation results</li>
<li>Update status metrics</li>
<li>Document performance characteristics</li>
</ul>
</li>
</ol>
<p><b>Success Criteria</b>:</p><ul>
<li>New users can follow guides without getting stuck</li>
<li>Common issues documented with solutions</li>
<li>Real-world examples added</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1818"></a>
Priority 2: CLI Agent Test Command (IT-02) ðŸ“‹</h1>
<p><b>Goal</b>: Natural language prompt â†’ automated GUI test workflow <br  />
 <b>Time Estimate</b>: 4-6 hours <br  />
 <b>Status</b>: Ready to start after Priority 1 <br  />
 <b>Blocking Dependency</b>: Priority 1 completion</p>
<h2><a class="anchor" id="autotoc_md1819"></a>
Why This Next?</h2>
<ul>
<li>Enables AI agents to drive YAZE GUI automatically</li>
<li>Makes GUI automation accessible via simple CLI commands</li>
<li>Provides foundation for complex multi-step workflows</li>
<li>Demonstrates value of IT-01 infrastructure</li>
</ul>
<h2><a class="anchor" id="autotoc_md1820"></a>
Design Overview</h2>
<div class="fragment"><div class="line">User Input:</div>
<div class="line">  z3ed agent test --prompt &quot;Open Overworld editor and verify it loads&quot;</div>
<div class="line"> </div>
<div class="line">Workflow:</div>
<div class="line">  1. Parse prompt â†’ identify intent (open editor, verify visibility)</div>
<div class="line">  2. Generate RPC sequence:</div>
<div class="line">     - Click &quot;button:Overworld&quot;</div>
<div class="line">     - Wait &quot;window_visible:Overworld Editor&quot; (5s timeout)</div>
<div class="line">     - Assert &quot;visible:Overworld Editor&quot;</div>
<div class="line">  3. Execute RPCs via gRPC client</div>
<div class="line">  4. Capture results and report</div>
<div class="line">  5. Optional: Screenshot for LLM feedback</div>
<div class="line"> </div>
<div class="line">Output:</div>
<div class="line">  âœ“ Clicked button:Overworld (85ms)</div>
<div class="line">  âœ“ Waited for window:Overworld Editor (1234ms)</div>
<div class="line">  âœ“ Asserted visible:Overworld Editor (12ms)</div>
<div class="line">  </div>
<div class="line">  Test passed in 1.331s</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1821"></a>
Implementation Tasks</h2>
<h3><a class="anchor" id="autotoc_md1822"></a>
2.1. Create gRPC Client Library (2 hours)</h3>
<p><b>Files</b>:</p><ul>
<li><code><a class="el" href="../../d1/d51/gui__automation__client_8h.html">src/cli/service/gui_automation_client.h</a></code></li>
<li><code><a class="el" href="../../dd/db4/gui__automation__client_8cc.html">src/cli/service/gui_automation_client.cc</a></code></li>
</ul>
<p><b>Interface</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>GuiAutomationClient {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> GuiAutomationClient&amp; Instance();</div>
<div class="line">  </div>
<div class="line">  absl::Status Connect(<span class="keyword">const</span> std::string&amp; host, <span class="keywordtype">int</span> port);</div>
<div class="line">  absl::StatusOr&lt;PingResponse&gt; Ping(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">  absl::StatusOr&lt;ClickResponse&gt; Click(<span class="keyword">const</span> std::string&amp; target, ClickType type);</div>
<div class="line">  absl::StatusOr&lt;TypeResponse&gt; Type(<span class="keyword">const</span> std::string&amp; target, </div>
<div class="line">                                    <span class="keyword">const</span> std::string&amp; text,</div>
<div class="line">                                    <span class="keywordtype">bool</span> clear_first);</div>
<div class="line">  absl::StatusOr&lt;WaitResponse&gt; Wait(<span class="keyword">const</span> std::string&amp; condition,</div>
<div class="line">                                    <span class="keywordtype">int</span> timeout_ms,</div>
<div class="line">                                    <span class="keywordtype">int</span> poll_interval_ms);</div>
<div class="line">  absl::StatusOr&lt;AssertResponse&gt; Assert(<span class="keyword">const</span> std::string&amp; condition);</div>
<div class="line">  absl::StatusOr&lt;ScreenshotResponse&gt; Screenshot(<span class="keyword">const</span> std::string&amp; region,</div>
<div class="line">                                                 <span class="keyword">const</span> std::string&amp; format);</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  std::unique_ptr&lt;yaze::test::ImGuiTestHarness::Stub&gt; stub_;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Implementation Notes</b>:</p><ul>
<li>Use gRPC C++ client API</li>
<li>Handle connection errors gracefully</li>
<li>Support timeout configuration</li>
<li>Return structured results (not raw proto messages)</li>
</ul>
<h3><a class="anchor" id="autotoc_md1823"></a>
2.2. Create Test Workflow Generator (1.5 hours)</h3>
<p><b>Files</b>:</p><ul>
<li><code><a class="el" href="../../d8/dfb/test__workflow__generator_8h.html">src/cli/service/test_workflow_generator.h</a></code></li>
<li><code><a class="el" href="../../db/d09/test__workflow__generator_8cc.html">src/cli/service/test_workflow_generator.cc</a></code></li>
</ul>
<p><b>Interface</b>: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>TestStep {</div>
<div class="line">  <span class="keyword">enum</span> Type { kClick, kType, kWait, kAssert, kScreenshot };</div>
<div class="line">  Type type;</div>
<div class="line">  std::string target;</div>
<div class="line">  std::string value;</div>
<div class="line">  <span class="keywordtype">int</span> timeout_ms = 5000;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>TestWorkflow {</div>
<div class="line">  std::string description;</div>
<div class="line">  std::vector&lt;TestStep&gt; steps;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>TestWorkflowGenerator {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> absl::StatusOr&lt;TestWorkflow&gt; GenerateFromPrompt(</div>
<div class="line">      <span class="keyword">const</span> std::string&amp; prompt);</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">static</span> absl::StatusOr&lt;TestWorkflow&gt; ParseSimplePrompt(</div>
<div class="line">      <span class="keyword">const</span> std::string&amp; prompt);</div>
<div class="line">  <span class="keyword">static</span> absl::StatusOr&lt;TestWorkflow&gt; ParseComplexPrompt(</div>
<div class="line">      <span class="keyword">const</span> std::string&amp; prompt);</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Supported Prompt Patterns</b>:</p><ol type="1">
<li><b>Simple Open</b>: "Open Overworld editor"<ul>
<li>Click "button:Overworld"</li>
<li>Wait "window_visible:Overworld Editor"</li>
</ul>
</li>
<li><b>Open and Verify</b>: "Open Dungeon editor and verify it loads"<ul>
<li>Click "button:Dungeon"</li>
<li>Wait "window_visible:Dungeon Editor"</li>
<li>Assert "visible:Dungeon Editor"</li>
</ul>
</li>
<li><b>Type and Validate</b>: "Type 'zelda3.sfc' in filename input"<ul>
<li>Click "input:Filename"</li>
<li>Type "zelda3.sfc" with clear_first</li>
<li>Assert "text_contains:Filename:zelda3.sfc"</li>
</ul>
</li>
<li><b>Multi-Step</b>: "Open Overworld, click tile, verify properties panel"<ul>
<li>Click "button:Overworld"</li>
<li>Wait "window_visible:Overworld Editor"</li>
<li>Click "canvas:Overworld" (x, y coordinates)</li>
<li>Wait "window_visible:Properties"</li>
</ul>
</li>
</ol>
<p><b>Implementation Strategy</b>:</p><ul>
<li>Start with simple regex/pattern matching</li>
<li>Add more complex patterns iteratively</li>
<li>Return error for unsupported prompts</li>
<li>Suggest valid alternatives</li>
</ul>
<h3><a class="anchor" id="autotoc_md1824"></a>
2.3. Implement &lt;tt&gt;z3ed agent test&lt;/tt&gt; Command (1.5 hours)</h3>
<p><b>Files</b>:</p><ul>
<li><code><a class="el" href="../../d2/d0e/agent_8cc.html">src/cli/handlers/agent.cc</a></code> (add <code>HandleTestCommand</code>)</li>
<li>Update <code><a class="el" href="../../dc/d8b/modern__cli_8cc.html">src/cli/modern_cli.cc</a></code> routing</li>
</ul>
<p><b>Command Interface</b>: </p><div class="fragment"><div class="line">z3ed agent test --prompt &quot;...&quot; [--host localhost] [--port 50052] [--timeout 30s]</div>
</div><!-- fragment --><p><b>Implementation</b>: </p><div class="fragment"><div class="line">absl::Status HandleTestCommand(<span class="keyword">const</span> AgentOptions&amp; options) {</div>
<div class="line">  <span class="comment">// 1. Parse prompt â†’ workflow</span></div>
<div class="line">  <span class="keyword">auto</span> workflow_result = TestWorkflowGenerator::GenerateFromPrompt(</div>
<div class="line">      options.prompt);</div>
<div class="line">  <span class="keywordflow">if</span> (!workflow_result.ok()) {</div>
<div class="line">    <span class="keywordflow">return</span> workflow_result.status();</div>
<div class="line">  }</div>
<div class="line">  TestWorkflow workflow = std::move(*workflow_result);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// 2. Connect to test harness</span></div>
<div class="line">  <span class="keyword">auto</span>&amp; client = GuiAutomationClient::Instance();</div>
<div class="line">  <span class="keyword">auto</span> status = client.Connect(options.host, options.port);</div>
<div class="line">  <span class="keywordflow">if</span> (!status.ok()) {</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// 3. Execute workflow steps</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; step : workflow.steps) {</div>
<div class="line">    <span class="keyword">auto</span> result = ExecuteStep(client, step);</div>
<div class="line">    <span class="keywordflow">if</span> (!result.ok()) {</div>
<div class="line">      <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line">    PrintStepResult(step, *result);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nTest passed!\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">return</span> absl::OkStatus();</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Output Format</b>:</p><ul>
<li>Progress indicators for each step</li>
<li>Execution time per step</li>
<li>Success/failure status</li>
<li>Error messages with context</li>
<li>Final summary</li>
</ul>
<h3><a class="anchor" id="autotoc_md1825"></a>
2.4. Testing and Documentation (1 hour)</h3>
<p><b>Test Cases</b>:</p><ol type="1">
<li>Simple open editor test</li>
<li>Multi-step workflow test</li>
<li>Timeout handling test</li>
<li>Connection error test</li>
<li>Invalid widget test</li>
</ol>
<p><b>Documentation</b>:</p><ul>
<li>Add IT-02 completion doc</li>
<li>Update implementation plan</li>
<li>Add examples to <a class="el" href="../../d2/d82/IT-01-QUICKSTART_8md.html">IT-01-QUICKSTART.md</a></li>
<li>Update resource catalog with <code>agent test</code> command</li>
</ul>
<p><b>Success Criteria</b>:</p><ul>
<li><code>z3ed agent test</code> works with 5+ different prompts</li>
<li>Error messages helpful for debugging</li>
<li>Documentation complete with examples</li>
<li>Ready for AI agent integration</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1827"></a>
Priority 3: Policy Evaluation Framework (AW-04) ðŸ“‹</h1>
<p><b>Goal</b>: YAML-based constraint system for gating proposal acceptance <br  />
 <b>Time Estimate</b>: 6-8 hours <br  />
 <b>Status</b>: Can work in parallel with Priority 2 <br  />
 <b>Blocking Dependency</b>: None (UI integration requires AW-03)</p>
<h2><a class="anchor" id="autotoc_md1828"></a>
Why This Matters?</h2>
<ul>
<li>Prevents dangerous/unwanted changes from being accepted</li>
<li>Enforces project-specific constraints (byte limits, bank restrictions)</li>
<li>Requires test coverage before acceptance</li>
<li>Provides audit trail for policy violations</li>
</ul>
<h2><a class="anchor" id="autotoc_md1829"></a>
Design Overview</h2>
<p><b>Policy Configuration</b> (<code>.yaze/policies/agent.yaml</code>): </p><div class="fragment"><div class="line">version: 1.0</div>
<div class="line">policies:</div>
<div class="line">  # Test Requirements</div>
<div class="line">  - name: require_tests</div>
<div class="line">    type: test_requirement</div>
<div class="line">    enabled: true</div>
<div class="line">    severity: critical  # critical | warning | info</div>
<div class="line">    rules:</div>
<div class="line">      - test_suite: &quot;overworld_rendering&quot;</div>
<div class="line">        min_pass_rate: 0.95</div>
<div class="line">      - test_suite: &quot;palette_integrity&quot;</div>
<div class="line">        min_pass_rate: 1.0</div>
<div class="line">  </div>
<div class="line">  # Change Constraints</div>
<div class="line">  - name: limit_change_scope</div>
<div class="line">    type: change_constraint</div>
<div class="line">    enabled: true</div>
<div class="line">    severity: critical</div>
<div class="line">    rules:</div>
<div class="line">      - max_bytes_changed: 10240  # 10KB limit</div>
<div class="line">      - allowed_banks: [0x00, 0x01, 0x0E]  # Graphics banks only</div>
<div class="line">      - forbidden_ranges:</div>
<div class="line">          - start: 0xFFB0  # ROM header</div>
<div class="line">            end: 0xFFFF</div>
<div class="line">          - start: 0x0000  # System RAM</div>
<div class="line">            end: 0x1FFF</div>
<div class="line">  </div>
<div class="line">  # Review Requirements</div>
<div class="line">  - name: human_review_required</div>
<div class="line">    type: review_requirement</div>
<div class="line">    enabled: true</div>
<div class="line">    severity: warning</div>
<div class="line">    rules:</div>
<div class="line">      - if: bytes_changed &gt; 1024</div>
<div class="line">        then: require_diff_review</div>
<div class="line">      - if: commands_executed &gt; 10</div>
<div class="line">        then: require_log_review</div>
<div class="line">      - if: new_files_created</div>
<div class="line">        then: require_approval</div>
<div class="line">  </div>
<div class="line">  # CVE Checks</div>
<div class="line">  - name: security_validation</div>
<div class="line">    type: security_check</div>
<div class="line">    enabled: true</div>
<div class="line">    severity: critical</div>
<div class="line">    rules:</div>
<div class="line">      - check: no_known_cves</div>
<div class="line">        message: &quot;Dependencies must not have known CVEs&quot;</div>
<div class="line">      - check: checksum_valid</div>
<div class="line">        message: &quot;ROM checksum must be valid after changes&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1830"></a>
Implementation Tasks</h2>
<h3><a class="anchor" id="autotoc_md1831"></a>
3.1. Policy Schema and Parser (2 hours)</h3>
<p><b>Files</b>:</p><ul>
<li><code>src/cli/service/policy_evaluator.h</code></li>
<li><code>src/cli/service/policy_evaluator.cc</code></li>
<li><code>.yaze/policies/agent.yaml</code> (example)</li>
</ul>
<p><b>Data Structures</b>: </p><div class="fragment"><div class="line"><span class="keyword">enum class</span> PolicySeverity { kCritical, kWarning, kInfo };</div>
<div class="line"><span class="keyword">enum class</span> PolicyType {</div>
<div class="line">  kTestRequirement,</div>
<div class="line">  kChangeConstraint,</div>
<div class="line">  kReviewRequirement,</div>
<div class="line">  kSecurityCheck</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PolicyRule {</div>
<div class="line">  std::string condition;</div>
<div class="line">  std::string action;</div>
<div class="line">  std::map&lt;std::string, std::string&gt; parameters;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Policy {</div>
<div class="line">  std::string name;</div>
<div class="line">  PolicyType type;</div>
<div class="line">  PolicySeverity severity;</div>
<div class="line">  <span class="keywordtype">bool</span> enabled;</div>
<div class="line">  std::vector&lt;PolicyRule&gt; rules;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PolicyViolation {</div>
<div class="line">  std::string policy_name;</div>
<div class="line">  PolicySeverity severity;</div>
<div class="line">  std::string message;</div>
<div class="line">  std::string actual_value;</div>
<div class="line">  std::string expected_value;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>PolicyResult {</div>
<div class="line">  <span class="keywordtype">bool</span> passed;</div>
<div class="line">  std::vector&lt;PolicyViolation&gt; violations;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">bool</span> HasCriticalViolations() <span class="keyword">const</span>;</div>
<div class="line">  <span class="keywordtype">bool</span> HasWarnings() <span class="keyword">const</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>YAML Parsing</b>:</p><ul>
<li>Use <code>yaml-cpp</code> library (already in vcpkg)</li>
<li>Parse policy file on startup</li>
<li>Validate schema (version, required fields)</li>
<li>Cache parsed policies in memory</li>
</ul>
<h3><a class="anchor" id="autotoc_md1832"></a>
3.2. Policy Evaluation Engine (2.5 hours)</h3>
<p><b>Interface</b>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>PolicyEvaluator {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">static</span> PolicyEvaluator&amp; Instance();</div>
<div class="line">  </div>
<div class="line">  absl::Status LoadPolicies(<span class="keyword">const</span> std::string&amp; policy_dir = <span class="stringliteral">&quot;.yaze/policies&quot;</span>);</div>
<div class="line">  absl::StatusOr&lt;PolicyResult&gt; EvaluateProposal(<span class="keyword">const</span> std::string&amp; proposal_id);</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  absl::StatusOr&lt;PolicyResult&gt; EvaluateTestRequirements(</div>
<div class="line">      <span class="keyword">const</span> ProposalMetadata&amp; proposal);</div>
<div class="line">  absl::StatusOr&lt;PolicyResult&gt; EvaluateChangeConstraints(</div>
<div class="line">      <span class="keyword">const</span> ProposalMetadata&amp; proposal);</div>
<div class="line">  absl::StatusOr&lt;PolicyResult&gt; EvaluateReviewRequirements(</div>
<div class="line">      <span class="keyword">const</span> ProposalMetadata&amp; proposal);</div>
<div class="line">  absl::StatusOr&lt;PolicyResult&gt; EvaluateSecurityChecks(</div>
<div class="line">      <span class="keyword">const</span> ProposalMetadata&amp; proposal);</div>
<div class="line">  </div>
<div class="line">  std::vector&lt;Policy&gt; policies_;</div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Evaluation Logic</b>:</p><ol type="1">
<li>Load proposal metadata (bytes changed, commands executed, etc.)</li>
<li>Load proposal diff (for bank/range analysis)</li>
<li>For each enabled policy:<ul>
<li>Evaluate all rules</li>
<li>Collect violations</li>
<li>Determine overall pass/fail</li>
</ul>
</li>
<li>Return structured result</li>
</ol>
<p><b>Example Evaluations</b>:</p><ul>
<li><b>Test Requirements</b>: Check if test results exist and meet thresholds</li>
<li><b>Change Constraints</b>: Analyze diff for byte count, bank ranges, forbidden areas</li>
<li><b>Review Requirements</b>: Check metadata (bytes, commands, files)</li>
<li><b>Security Checks</b>: Run ROM validation, checksum verification</li>
</ul>
<h3><a class="anchor" id="autotoc_md1833"></a>
3.3. ProposalDrawer Integration (2 hours)</h3>
<p><b>Files</b>:</p><ul>
<li><code><a class="el" href="../../d1/d96/proposal__drawer_8cc.html">src/app/editor/system/proposal_drawer.cc</a></code> (update)</li>
</ul>
<p><b>UI Changes</b>:</p><ol type="1">
<li><b>Add Policy Status Section</b> (in detail view): <div class="fragment"><div class="line">Policy Status: [âœ“ Passed | âš  Warnings | â›” Failed]</div>
<div class="line"> </div>
<div class="line">Critical Issues:</div>
<div class="line">  â›” Test pass rate 85% &lt; 95% (overworld_rendering)</div>
<div class="line">  â›” Forbidden range modified: 0xFFB0-0xFFFF (ROM header)</div>
<div class="line"> </div>
<div class="line">Warnings:</div>
<div class="line">  âš  2048 bytes changed &gt; 1024 (requires diff review)</div>
</div><!-- fragment --></li>
<li><b>Gate Accept Button</b>:<ul>
<li>Disable if critical violations exist</li>
<li>Show tooltip: "Accept blocked: 2 critical policy violations"</li>
<li>Enable override button (with confirmation + logging)</li>
</ul>
</li>
<li><b>Policy Override Dialog</b>: <div class="fragment"><div class="line">Override Policy Violations?</div>
<div class="line"> </div>
<div class="line">This action will be logged for audit purposes.</div>
<div class="line"> </div>
<div class="line">Violations:</div>
<div class="line">  â€¢ Test pass rate below threshold</div>
<div class="line">  â€¢ ROM header modified</div>
<div class="line"> </div>
<div class="line">Reason (required): [___________________________]</div>
<div class="line"> </div>
<div class="line">[Cancel] [Override and Accept]</div>
</div><!-- fragment --></li>
</ol>
<p><b>Integration Points</b>: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> ProposalDrawer::DrawProposalDetail(<span class="keyword">const</span> ProposalMetadata&amp; proposal) {</div>
<div class="line">  <span class="comment">// ... existing metadata, diff, log sections ...</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Add policy section</span></div>
<div class="line">  ImGui::Separator();</div>
<div class="line">  <span class="keywordflow">if</span> (ImGui::CollapsingHeader(<span class="stringliteral">&quot;Policy Status&quot;</span>, ImGuiTreeNodeFlags_DefaultOpen)) {</div>
<div class="line">    DrawPolicyStatus(proposal.id);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ProposalDrawer::DrawPolicyStatus(<span class="keyword">const</span> std::string&amp; proposal_id) {</div>
<div class="line">  <span class="keyword">auto</span>&amp; evaluator = PolicyEvaluator::Instance();</div>
<div class="line">  <span class="keyword">auto</span> result = evaluator.EvaluateProposal(proposal_id);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (!result.ok()) {</div>
<div class="line">    ImGui::TextColored(ImVec4(1, 0, 0, 1), <span class="stringliteral">&quot;Error evaluating policies&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; policy_result = *result;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Show overall status</span></div>
<div class="line">  <span class="keywordflow">if</span> (policy_result.passed) {</div>
<div class="line">    ImGui::TextColored(ImVec4(0, 1, 0, 1), <span class="stringliteral">&quot;âœ“ All policies passed&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (policy_result.HasCriticalViolations()) {</div>
<div class="line">    ImGui::TextColored(ImVec4(1, 0, 0, 1), <span class="stringliteral">&quot;â›” Critical violations&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    ImGui::TextColored(ImVec4(1, 1, 0, 1), <span class="stringliteral">&quot;âš  Warnings present&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// List violations</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; violation : policy_result.violations) {</div>
<div class="line">    DrawViolation(violation);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ProposalDrawer::AcceptProposal(<span class="keyword">const</span> std::string&amp; proposal_id) {</div>
<div class="line">  <span class="comment">// Evaluate policies before accepting</span></div>
<div class="line">  <span class="keyword">auto</span>&amp; evaluator = PolicyEvaluator::Instance();</div>
<div class="line">  <span class="keyword">auto</span> result = evaluator.EvaluateProposal(proposal_id);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (result.ok() &amp;&amp; result-&gt;HasCriticalViolations()) {</div>
<div class="line">    <span class="comment">// Show override dialog instead of accepting directly</span></div>
<div class="line">    show_policy_override_dialog_ = <span class="keyword">true</span>;</div>
<div class="line">    pending_accept_proposal_id_ = proposal_id;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// ... existing accept logic ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1834"></a>
3.4. Testing and Documentation (1.5 hours)</h3>
<p><b>Test Cases</b>:</p><ol type="1">
<li>Valid proposal (all policies pass)</li>
<li>Test requirement violation</li>
<li>Change constraint violation</li>
<li>Multiple violations</li>
<li>Policy override workflow</li>
</ol>
<p><b>Documentation</b>:</p><ul>
<li>Create AW-04-POLICY-FRAMEWORK.md with:<ul>
<li>Policy schema reference</li>
<li>Built-in policy examples</li>
<li>How to write custom policies</li>
<li>Override audit trail</li>
</ul>
</li>
<li>Update implementation plan</li>
<li>Update ProposalDrawer documentation</li>
</ul>
<p><b>Success Criteria</b>:</p><ul>
<li>Policies loaded and evaluated correctly</li>
<li>UI clearly shows policy status</li>
<li>Accept button gated on critical violations</li>
<li>Override workflow functional with logging</li>
<li>Documentation complete</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1836"></a>
Timeline Summary</h1>
<p><b>Week of Oct 2-8, 2025</b>:</p><ul>
<li>Days 1-2: Priority 1 (E2E Validation)</li>
<li>Days 3-4: Priority 2 (CLI Agent Test)</li>
<li>Days 5-7: Priority 3 (Policy Framework)</li>
</ul>
<p><b>Expected Completion</b>: October 8, 2025</p>
<p><b>Next After This</b>:</p><ul>
<li>Windows cross-platform testing</li>
<li>Screenshot implementation</li>
<li>Production telemetry (opt-in)</li>
<li>Advanced policy features</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1838"></a>
Success Metrics</h1>
<p><b>By End of Week</b>:</p><ul>
<li>âœ… Complete proposal workflow validated end-to-end</li>
<li>âœ… <code>z3ed agent test</code> command operational with 5+ prompt patterns</li>
<li>âœ… Policy framework implemented and integrated</li>
<li>âœ… Documentation updated for all new features</li>
<li>âœ… Zero known blockers for production use</li>
</ul>
<p><b>Quality Bar</b>:</p><ul>
<li>All code builds cleanly on macOS ARM64</li>
<li>No crashes or hangs in normal workflows</li>
<li>Error messages helpful and actionable</li>
<li>Documentation sufficient for new contributors</li>
<li>Ready for Windows testing phase</li>
</ul>
<hr  />
<p><b>Last Updated</b>: October 2, 2025 <br  />
 <b>Contributors</b>: @scawful, GitHub Copilot <br  />
 <b>License</b>: Same as YAZE (see ../../LICENSE) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
