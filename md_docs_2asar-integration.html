<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Asar 65816 Assembler Integration Guide</title>
<link rel="icon" href="yaze.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.2.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2asar-integration.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Asar 65816 Assembler Integration Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<p>Yaze v0.3.0 includes complete integration with the Asar 65816 assembler, enabling cross-platform ROM patching, symbol extraction, and assembly validation for SNES development.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>The Asar integration provides:</p><ul>
<li><b>ROM Patching</b>: Apply 65816 assembly patches directly to SNES ROMs</li>
<li><b>Symbol Extraction</b>: Extract labels, addresses, and opcodes from assembly files</li>
<li><b>Assembly Validation</b>: Comprehensive syntax checking and error reporting</li>
<li><b>Cross-Platform</b>: Full support for Windows, macOS, and Linux</li>
<li><b>Modern APIs</b>: Both CLI tools and C++ programming interface</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick Examples</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Command Line Usage</h2>
<div class="fragment"><div class="line"># Apply assembly patch to ROM</div>
<div class="line">z3ed asar my_patch.asm --rom=zelda3.sfc</div>
<div class="line">‚úÖ Asar patch applied successfully!</div>
<div class="line">üìÅ Output: zelda3_patched.sfc</div>
<div class="line">üè∑Ô∏è  Extracted 6 symbols:</div>
<div class="line">  main_routine @ $008000</div>
<div class="line">  data_table @ $008020</div>
<div class="line"> </div>
<div class="line"># Extract symbols without patching</div>
<div class="line">z3ed extract my_patch.asm</div>
<div class="line"> </div>
<div class="line"># Validate assembly syntax</div>
<div class="line">z3ed validate my_patch.asm</div>
<div class="line">‚úÖ Assembly file is valid</div>
<div class="line"> </div>
<div class="line"># Launch interactive TUI</div>
<div class="line">z3ed --tui</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
C++ API Usage</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="asar__wrapper_8h.html">app/core/asar_wrapper.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize Asar</span></div>
<div class="line"><a class="code hl_class" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html">yaze::app::core::AsarWrapper</a> wrapper;</div>
<div class="line">wrapper.<a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a2a62a0b6a9aeb2116b20bb7a2a716fdb">Initialize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Apply patch to ROM</span></div>
<div class="line">std::vector&lt;uint8_t&gt; rom_data = LoadRom(<span class="stringliteral">&quot;zelda3.sfc&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> result = wrapper.<a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ab2583f55b85ce00f473fbff231e94c4b">ApplyPatch</a>(<span class="stringliteral">&quot;patch.asm&quot;</span>, rom_data);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (result.ok() &amp;&amp; result-&gt;success) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; result-&gt;symbols.size() &lt;&lt; <span class="stringliteral">&quot; symbols:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; symbol : result-&gt;symbols) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; symbol.name &lt;&lt; <span class="stringliteral">&quot; @ $&quot;</span> </div>
<div class="line">                  &lt;&lt; std::hex &lt;&lt; symbol.address &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Extract symbols independently</span></div>
<div class="line"><span class="keyword">auto</span> symbols = wrapper.<a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a63133a75451a212ece7886eacf46fa8b">ExtractSymbols</a>(<span class="stringliteral">&quot;source.asm&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> main_symbol = wrapper.<a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a6d91d66dcff6efc153a6cb6278dc00f5">FindSymbol</a>(<span class="stringliteral">&quot;main_routine&quot;</span>);</div>
<div class="ttc" id="aasar__wrapper_8h_html"><div class="ttname"><a href="asar__wrapper_8h.html">asar_wrapper.h</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html">yaze::app::core::AsarWrapper</a></div><div class="ttdoc">Modern C++ wrapper for Asar 65816 assembler integration.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8h_source.html#l00049">asar_wrapper.h:49</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a2a62a0b6a9aeb2116b20bb7a2a716fdb"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a2a62a0b6a9aeb2116b20bb7a2a716fdb">yaze::app::core::AsarWrapper::Initialize</a></div><div class="ttdeci">absl::Status Initialize()</div><div class="ttdoc">Initialize the Asar library.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00025">asar_wrapper.cc:25</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a63133a75451a212ece7886eacf46fa8b"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a63133a75451a212ece7886eacf46fa8b">yaze::app::core::AsarWrapper::ExtractSymbols</a></div><div class="ttdeci">absl::StatusOr&lt; std::vector&lt; AsarSymbol &gt; &gt; ExtractSymbols(const std::string &amp;asm_path, const std::vector&lt; std::string &gt; &amp;include_paths={})</div><div class="ttdoc">Extract symbols from an assembly file without patching.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00157">asar_wrapper.cc:157</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a6d91d66dcff6efc153a6cb6278dc00f5"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a6d91d66dcff6efc153a6cb6278dc00f5">yaze::app::core::AsarWrapper::FindSymbol</a></div><div class="ttdeci">std::optional&lt; AsarSymbol &gt; FindSymbol(const std::string &amp;name) const</div><div class="ttdoc">Find a symbol by name.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00180">asar_wrapper.cc:180</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_ab2583f55b85ce00f473fbff231e94c4b"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ab2583f55b85ce00f473fbff231e94c4b">yaze::app::core::AsarWrapper::ApplyPatch</a></div><div class="ttdeci">absl::StatusOr&lt; AsarPatchResult &gt; ApplyPatch(const std::string &amp;patch_path, std::vector&lt; uint8_t &gt; &amp;rom_data, const std::vector&lt; std::string &gt; &amp;include_paths={})</div><div class="ttdoc">Apply an assembly patch to a ROM.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00068">asar_wrapper.cc:68</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Assembly Patch Examples</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Basic Hook</h2>
<div class="fragment"><div class="line">; Simple code hook</div>
<div class="line">org $008000</div>
<div class="line">custom_hook:</div>
<div class="line">    sei                 ; Disable interrupts</div>
<div class="line">    rep #$30            ; 16-bit A and X/Y</div>
<div class="line">    </div>
<div class="line">    ; Your custom code</div>
<div class="line">    lda #$1234</div>
<div class="line">    sta $7E0000</div>
<div class="line">    </div>
<div class="line">    rts</div>
<div class="line"> </div>
<div class="line">; Data section</div>
<div class="line">custom_data:</div>
<div class="line">    db &quot;YAZE&quot;, $00</div>
<div class="line">    dw $1234, $5678</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Advanced Features</h2>
<div class="fragment"><div class="line">; Constants and macros</div>
<div class="line">!player_health = $7EF36C</div>
<div class="line">!custom_ram = $7E2000</div>
<div class="line"> </div>
<div class="line">macro save_context()</div>
<div class="line">    pha : phx : phy</div>
<div class="line">endmacro</div>
<div class="line"> </div>
<div class="line">macro restore_context()</div>
<div class="line">    ply : plx : pla</div>
<div class="line">endmacro</div>
<div class="line"> </div>
<div class="line">; Main code</div>
<div class="line">org $008000</div>
<div class="line">advanced_hook:</div>
<div class="line">    %save_context()</div>
<div class="line">    </div>
<div class="line">    ; Modify gameplay</div>
<div class="line">    sep #$20</div>
<div class="line">    lda #$A0            ; Full health</div>
<div class="line">    sta !player_health</div>
<div class="line">    </div>
<div class="line">    %restore_context()</div>
<div class="line">    rtl</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8"></a>
Testing Infrastructure</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
ROM-Dependent Tests</h2>
<p>Yaze includes comprehensive testing that handles ROM files properly:</p>
<div class="fragment"><div class="line"><span class="comment">// ROM tests are automatically skipped in CI</span></div>
<div class="line"><a class="code hl_define" href="test__utils_8h.html#acde8466936427e1b1ba331bccb124a9e">YAZE_ROM_TEST</a>(AsarIntegration, RealRomPatching) {</div>
<div class="line">    <span class="keyword">auto</span> rom_data = TestRomManager::LoadTestRom();</div>
<div class="line">    AsarWrapper wrapper;</div>
<div class="line">    wrapper.<a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a2a62a0b6a9aeb2116b20bb7a2a716fdb">Initialize</a>();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> result = wrapper.ApplyPatch(<span class="stringliteral">&quot;test.asm&quot;</span>, rom_data);</div>
<div class="line">    EXPECT_TRUE(result.ok());</div>
<div class="line">}</div>
<div class="ttc" id="atest__utils_8h_html_acde8466936427e1b1ba331bccb124a9e"><div class="ttname"><a href="test__utils_8h.html#acde8466936427e1b1ba331bccb124a9e">YAZE_ROM_TEST</a></div><div class="ttdeci">#define YAZE_ROM_TEST(test_case_name, test_name)</div><div class="ttdoc">Test macro for ROM-dependent tests.</div><div class="ttdef"><b>Definition</b> <a href="test__utils_8h_source.html#l00132">test_utils.h:132</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
CI/CD Compatibility</h2>
<ul>
<li>ROM-dependent tests are labeled with <code>ROM_DEPENDENT</code></li>
<li>CI automatically excludes these tests: <code>--label-exclude ROM_DEPENDENT</code></li>
<li>Development builds can enable ROM testing with <code>YAZE_ENABLE_ROM_TESTS=ON</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Cross-Platform Support</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
Build Configuration</h2>
<p>The Asar integration works across all supported platforms:</p>
<div class="fragment"><div class="line"># Modern CMake target</div>
<div class="line">target_link_libraries(my_target PRIVATE yaze::asar)</div>
<div class="line"> </div>
<div class="line"># Cross-platform definitions automatically handled</div>
<div class="line"># Windows: _CRT_SECURE_NO_WARNINGS, strcasecmp=_stricmp</div>
<div class="line"># Linux:   linux, stricmp=strcasecmp  </div>
<div class="line"># macOS:   MACOS, stricmp=strcasecmp</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
Platform-Specific Notes</h2>
<ul>
<li><b>Windows</b>: Uses static linking with proper MSVC runtime</li>
<li><b>macOS</b>: Universal binaries support both Intel and Apple Silicon</li>
<li><b>Linux</b>: Compatible with both GCC and Clang compilers</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
API Reference</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
AsarWrapper Class</h2>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceyaze_1_1app_1_1core.html">yaze::app::core</a> {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>AsarWrapper {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Initialization</span></div>
<div class="line">    absl::Status <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a2a62a0b6a9aeb2116b20bb7a2a716fdb">Initialize</a>();</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a414e18d4fead6a4475f5be27b560f2a0">Shutdown</a>();</div>
<div class="line">    <span class="keywordtype">bool</span> <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ae498f302f27cf4adbea74c5c2883cb28">IsInitialized</a>() <span class="keyword">const</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Core functionality</span></div>
<div class="line">    absl::StatusOr&lt;AsarPatchResult&gt; <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ab2583f55b85ce00f473fbff231e94c4b">ApplyPatch</a>(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; patch_path,</div>
<div class="line">        std::vector&lt;uint8_t&gt;&amp; rom_data,</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; include_paths = {});</div>
<div class="line">    </div>
<div class="line">    absl::StatusOr&lt;std::vector&lt;AsarSymbol&gt;&gt; <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a63133a75451a212ece7886eacf46fa8b">ExtractSymbols</a>(</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; asm_path,</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; include_paths = {});</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Symbol management</span></div>
<div class="line">    std::optional&lt;AsarSymbol&gt; <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a6d91d66dcff6efc153a6cb6278dc00f5">FindSymbol</a>(<span class="keyword">const</span> std::string&amp; name);</div>
<div class="line">    std::vector&lt;AsarSymbol&gt; <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a3c30ad3d584933b2701a860dd33e3ca8">GetSymbolsAtAddress</a>(uint32_t address);</div>
<div class="line">    std::map&lt;std::string, AsarSymbol&gt; <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ad99850d9680a2ddabb3db1d04554bad6">GetSymbolTable</a>();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Utility functions</span></div>
<div class="line">    absl::Status <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a5537cab2fa4270062bcc9b9316a207e0">ValidateAssembly</a>(<span class="keyword">const</span> std::string&amp; asm_path);</div>
<div class="line">    std::string <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a13cd290bb32a2f277bcb2f95aa940690">GetVersion</a>();</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#af4330124d86e8bdd833b77439eb47057">Reset</a>();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a13cd290bb32a2f277bcb2f95aa940690"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a13cd290bb32a2f277bcb2f95aa940690">yaze::app::core::AsarWrapper::GetVersion</a></div><div class="ttdeci">std::string GetVersion() const</div><div class="ttdoc">Get Asar version information.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00048">asar_wrapper.cc:48</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a3c30ad3d584933b2701a860dd33e3ca8"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a3c30ad3d584933b2701a860dd33e3ca8">yaze::app::core::AsarWrapper::GetSymbolsAtAddress</a></div><div class="ttdeci">std::vector&lt; AsarSymbol &gt; GetSymbolsAtAddress(uint32_t address) const</div><div class="ttdoc">Get symbols at a specific address.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00188">asar_wrapper.cc:188</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a414e18d4fead6a4475f5be27b560f2a0"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a414e18d4fead6a4475f5be27b560f2a0">yaze::app::core::AsarWrapper::Shutdown</a></div><div class="ttdeci">void Shutdown()</div><div class="ttdoc">Clean up and close the Asar library.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00041">asar_wrapper.cc:41</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_a5537cab2fa4270062bcc9b9316a207e0"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#a5537cab2fa4270062bcc9b9316a207e0">yaze::app::core::AsarWrapper::ValidateAssembly</a></div><div class="ttdeci">absl::Status ValidateAssembly(const std::string &amp;asm_path)</div><div class="ttdoc">Validate an assembly file for syntax errors.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00222">asar_wrapper.cc:222</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_ad99850d9680a2ddabb3db1d04554bad6"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ad99850d9680a2ddabb3db1d04554bad6">yaze::app::core::AsarWrapper::GetSymbolTable</a></div><div class="ttdeci">std::map&lt; std::string, AsarSymbol &gt; GetSymbolTable() const</div><div class="ttdoc">Get all available symbols from the last patch operation.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00176">asar_wrapper.cc:176</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_ae498f302f27cf4adbea74c5c2883cb28"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#ae498f302f27cf4adbea74c5c2883cb28">yaze::app::core::AsarWrapper::IsInitialized</a></div><div class="ttdeci">bool IsInitialized() const</div><div class="ttdoc">Check if Asar is initialized and ready.</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8h_source.html#l00077">asar_wrapper.h:77</a></div></div>
<div class="ttc" id="aclassyaze_1_1app_1_1core_1_1AsarWrapper_html_af4330124d86e8bdd833b77439eb47057"><div class="ttname"><a href="classyaze_1_1app_1_1core_1_1AsarWrapper.html#af4330124d86e8bdd833b77439eb47057">yaze::app::core::AsarWrapper::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdoc">Reset the Asar state (clear errors, warnings, symbols)</div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00198">asar_wrapper.cc:198</a></div></div>
<div class="ttc" id="anamespaceyaze_1_1app_1_1core_html"><div class="ttname"><a href="namespaceyaze_1_1app_1_1core.html">yaze::app::core</a></div><div class="ttdef"><b>Definition</b> <a href="asar__wrapper_8cc_source.html#l00015">asar_wrapper.cc:15</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Data Structures</h2>
<div class="fragment"><div class="line"><span class="keyword">struct </span>AsarSymbol {</div>
<div class="line">    std::string name;           <span class="comment">// Symbol name</span></div>
<div class="line">    uint32_t address;          <span class="comment">// Memory address  </span></div>
<div class="line">    std::string opcode;        <span class="comment">// Associated opcode</span></div>
<div class="line">    std::string file;          <span class="comment">// Source file</span></div>
<div class="line">    <span class="keywordtype">int</span> line;                  <span class="comment">// Line number</span></div>
<div class="line">    std::string comment;       <span class="comment">// Optional comment</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>AsarPatchResult {</div>
<div class="line">    <span class="keywordtype">bool</span> success;              <span class="comment">// Whether patch succeeded</span></div>
<div class="line">    std::vector&lt;std::string&gt; errors;     <span class="comment">// Error messages</span></div>
<div class="line">    std::vector&lt;std::string&gt; warnings;   <span class="comment">// Warning messages  </span></div>
<div class="line">    std::vector&lt;AsarSymbol&gt; symbols;     <span class="comment">// Extracted symbols</span></div>
<div class="line">    uint32_t rom_size;         <span class="comment">// Final ROM size</span></div>
<div class="line">    uint32_t crc32;            <span class="comment">// CRC32 checksum</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md17"></a>
Error Handling</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Common Errors and Solutions</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Error   </th><th class="markdownTableHeadNone">Cause   </th><th class="markdownTableHeadNone">Solution    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Unknown command</code>   </td><td class="markdownTableBodyNone">Invalid opcode   </td><td class="markdownTableBodyNone">Check 65816 instruction reference    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Label not found</code>   </td><td class="markdownTableBodyNone">Undefined label   </td><td class="markdownTableBodyNone">Define the label or check spelling    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Invalid hex value</code>   </td><td class="markdownTableBodyNone">Bad hex format   </td><td class="markdownTableBodyNone">Use <code>$1234</code> format, not <code>$GOOD</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Buffer too small</code>   </td><td class="markdownTableBodyNone">ROM needs expansion   </td><td class="markdownTableBodyNone">Check if ROM needs to be larger   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md19"></a>
Error Handling Pattern</h2>
<div class="fragment"><div class="line"><span class="keyword">auto</span> result = wrapper.ApplyPatch(<span class="stringliteral">&quot;patch.asm&quot;</span>, rom_data);</div>
<div class="line"><span class="keywordflow">if</span> (!result.ok()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Patch failed: &quot;</span> &lt;&lt; result.status().message() &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!result-&gt;success) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Assembly errors:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; error : result-&gt;errors) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; error &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md20"></a>
Development Workflow</h1>
<h2><a class="anchor" id="autotoc_md21"></a>
CMake Presets</h2>
<div class="fragment"><div class="line"># Development build with ROM testing</div>
<div class="line">cmake --preset dev</div>
<div class="line">cmake --build --preset dev</div>
<div class="line">ctest --preset dev</div>
<div class="line"> </div>
<div class="line"># CI-compatible build (no ROM tests)</div>
<div class="line">cmake --preset ci </div>
<div class="line">cmake --build --preset ci</div>
<div class="line">ctest --preset ci</div>
<div class="line"> </div>
<div class="line"># Release build with packaging</div>
<div class="line">cmake --preset macos-release</div>
<div class="line">cmake --build --preset macos-release</div>
<div class="line">cmake --build --preset macos-release --target package</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Testing Workflow</h2>
<ol type="1">
<li><b>Write assembly patch</b></li>
<li><b>Validate syntax</b>: <code>z3ed validate patch.asm</code></li>
<li><b>Extract symbols</b>: <code>z3ed extract patch.asm</code></li>
<li><b>Apply to test ROM</b>: <code>z3ed asar patch.asm --rom=test.sfc</code></li>
<li><b>Test in emulator</b></li>
</ol>
<h1><a class="anchor" id="autotoc_md23"></a>
Integration with Yaze Editor</h1>
<p>The Asar integration is built into the main yaze editor:</p>
<ul>
<li><b>Assembly Editor</b>: Real-time syntax validation</li>
<li><b>Project System</b>: Save/load assembly patches with projects</li>
<li><b>Symbol Browser</b>: Navigate symbols with address lookup</li>
<li><b>Patch Management</b>: Apply and manage multiple patches</li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
Performance and Memory</h1>
<ul>
<li><b>Large ROM Support</b>: Handles ROMs up to 16MB</li>
<li><b>Efficient Symbol Storage</b>: Hash-based symbol lookup</li>
<li><b>Memory Safety</b>: RAII and smart pointer usage</li>
<li><b>Cross-Platform Optimization</b>: Platform-specific optimizations</li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
Future Enhancements</h1>
<p>Planned improvements for future versions:</p>
<ul>
<li><b>Real-time Assembly</b>: Live compilation and testing</li>
<li><b>Visual Debugging</b>: Assembly debugging tools</li>
<li><b>Patch Management</b>: GUI for managing multiple patches</li>
<li><b>Symbol Navigation</b>: Enhanced symbol browser with search</li>
</ul>
<h1><a class="anchor" id="autotoc_md26"></a>
Assembly Patch Templates</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
Basic Assembly Structure</h2>
<div class="fragment"><div class="line">; Header comment explaining the patch</div>
<div class="line">; Author: Your Name</div>
<div class="line">; Purpose: Brief description</div>
<div class="line"> </div>
<div class="line">; Constants section</div>
<div class="line">!player_health = $7EF36C</div>
<div class="line">!custom_ram = $7E2000</div>
<div class="line"> </div>
<div class="line">; Code section</div>
<div class="line">org $008000</div>
<div class="line">main_hook:</div>
<div class="line">    ; Save context</div>
<div class="line">    pha : phx : phy</div>
<div class="line">    </div>
<div class="line">    ; Your custom code here</div>
<div class="line">    sep #$20            ; 8-bit A</div>
<div class="line">    lda #$A0            ; Full health</div>
<div class="line">    sta !player_health</div>
<div class="line">    </div>
<div class="line">    ; Restore context</div>
<div class="line">    ply : plx : pla</div>
<div class="line">    rts</div>
<div class="line"> </div>
<div class="line">; Data section</div>
<div class="line">data_table:</div>
<div class="line">    dw $1234, $5678, $9ABC</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
Advanced Features</h2>
<div class="fragment"><div class="line">; Macro definitions</div>
<div class="line">macro save_registers()</div>
<div class="line">    pha : phx : phy</div>
<div class="line">endmacro</div>
<div class="line"> </div>
<div class="line">macro restore_registers()</div>
<div class="line">    ply : plx : pla</div>
<div class="line">endmacro</div>
<div class="line"> </div>
<div class="line">; Conditional assembly</div>
<div class="line">if !version == 3</div>
<div class="line">    ; ZSCustomOverworld v3 specific code</div>
<div class="line">    org $C08000</div>
<div class="line">else</div>
<div class="line">    ; Vanilla ROM code</div>
<div class="line">    org $008000</div>
<div class="line">endif</div>
<div class="line"> </div>
<div class="line">advanced_routine:</div>
<div class="line">    %save_registers()</div>
<div class="line">    </div>
<div class="line">    ; Complex logic here</div>
<div class="line">    </div>
<div class="line">    %restore_registers()</div>
<div class="line">    rtl</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md29"></a>
Testing Your Patches</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
Development Workflow</h2>
<ol type="1">
<li><b>Write Assembly</b>: Create your <code>.asm</code> patch file</li>
<li><b>Validate</b>: <code>z3ed validate patch.asm</code></li>
<li><b>Extract Symbols</b>: <code>z3ed extract patch.asm</code></li>
<li><b>Apply Patch</b>: <code>z3ed asar patch.asm --rom=test.sfc</code></li>
<li><b>Test in Emulator</b>: Verify functionality</li>
</ol>
<h2><a class="anchor" id="autotoc_md31"></a>
Best Practices</h2>
<ul>
<li>Always backup ROMs before patching</li>
<li>Use test ROMs for development</li>
<li>Validate assembly before applying</li>
<li>Start with simple patches and build complexity</li>
<li>Document your patches with clear comments</li>
</ul>
<h1><a class="anchor" id="autotoc_md32"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md33"></a>
Common Issues</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Issue   </th><th class="markdownTableHeadNone">Solution    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">"Unknown command"   </td><td class="markdownTableBodyNone">Check 65816 instruction reference    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">"Label not found"   </td><td class="markdownTableBodyNone">Define the label or check spelling    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">"Invalid hex value"   </td><td class="markdownTableBodyNone">Use <code>$1234</code> format, not <code>$GOOD</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">"Buffer too small"   </td><td class="markdownTableBodyNone">ROM may need expansion   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md34"></a>
Getting Help</h2>
<ul>
<li><b>CLI Help</b>: <code>z3ed help asar</code></li>
<li><b>Community</b>: <a href="https://discord.gg/MBFkMTPEmk">Oracle of Secrets Discord</a></li>
<li><b>Documentation</b>: <a class="el" href="md_docs_2index.html">Complete guide</a></li>
</ul>
<hr  />
<p>For complete API reference and advanced usage, see the <a class="el" href="md_docs_2index.html">documentation index</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
