<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: YAZE Dependency Architecture &amp; Build Optimization</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d4/d17/md_docs_2A1-yaze-dependency-architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">YAZE Dependency Architecture &amp; Build Optimization</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md24"></a> <b>Author</b>: Claude (Anthropic AI Assistant) <b>Date</b>: 2025-10-13 <b>Status</b>: Reference Document <b>Related Docs</b>: <a class="el" href="../../d9/dbf/md_docs_2C4-z3ed-refactoring.html">C4-z3ed-refactoring.md</a>, <a class="el" href="../../d8/d91/md_docs_2B6-zelda3-library-refactoring.html">B6-zelda3-library-refactoring.md</a>, <a class="el" href="../../d4/dc0/md_docs_2A2-test-dashboard-refactoring.html">A2-test-dashboard-refactoring.md</a></p>
<hr  />
<h1><a class="anchor" id="autotoc_md26"></a>
Executive Summary</h1>
<p>This document provides a comprehensive analysis of YAZE's dependency architecture, identifies optimization opportunities, and proposes a roadmap for reducing build times and improving maintainability.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Key Findings</h2>
<ul>
<li><b>Current State</b>: 25+ static libraries with complex interdependencies</li>
<li><b>Main Issues</b>: Circular dependencies, over-linking, misplaced components</li>
<li><b>Build Impact</b>: Changes to foundation libraries trigger rebuilds of 10-15+ dependent libraries</li>
<li><b>Opportunity</b>: 40-60% faster incremental builds through proposed refactorings</li>
</ul>
<h2><a class="anchor" id="autotoc_md28"></a>
Quick Stats</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Metric   </th><th class="markdownTableHeadNone">Current   </th><th class="markdownTableHeadNone">After Refactoring    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Total Libraries   </td><td class="markdownTableBodyNone">28   </td><td class="markdownTableBodyNone">35 (more granular)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Circular Dependencies   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Average Link Depth   </td><td class="markdownTableBodyNone">5-7 layers   </td><td class="markdownTableBodyNone">3-4 layers    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Incremental Build Time   </td><td class="markdownTableBodyNone">Baseline   </td><td class="markdownTableBodyNone"><b>40-60% faster</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Test Isolation   </td><td class="markdownTableBodyNone">Poor   </td><td class="markdownTableBodyNone">Excellent   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md30"></a>
1. Complete Dependency Graph</h1>
<h2><a class="anchor" id="autotoc_md31"></a>
1.1 Foundation Layer</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ External Dependencies                                           │</div>
<div class="line">│ • SDL2 (graphics, input, audio)                                 │</div>
<div class="line">│ • ImGui (UI framework)                                          │</div>
<div class="line">│ • Abseil (utilities, status, flags)                             │</div>
<div class="line">│ • GoogleTest/GoogleMock (testing)                               │</div>
<div class="line">│ • gRPC (optional - networking)                                  │</div>
<div class="line">│ • nlohmann_json (optional - JSON)                               │</div>
<div class="line">│ • yaml-cpp (configuration)                                      │</div>
<div class="line">│ • FTXUI (terminal UI)                                           │</div>
<div class="line">│ • Asar (65816 assembler)                                        │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
<div class="line">                              ↓</div>
<div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_common                                                     │</div>
<div class="line">│ • Common platform definitions                                   │</div>
<div class="line">│ • No dependencies                                               │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
<div class="line">                              ↓</div>
<div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_util                                                       │</div>
<div class="line">│ • Logging, file I/O, SDL utilities                              │</div>
<div class="line">│ • Depends on: yaze_common, absl, SDL2                           │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md32"></a>
1.2 Graphics Tier (Refactored)</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_gfx (INTERFACE - aggregates all gfx sub-libraries)        │</div>
<div class="line">└────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                         │</div>
<div class="line">      ┌──────────────────┼──────────────────┐</div>
<div class="line">      │                  │                  │</div>
<div class="line">      ▼                  ▼                  ▼</div>
<div class="line">┌──────────┐     ┌──────────────┐    ┌─────────────┐</div>
<div class="line">│ gfx_debug│─────│ gfx_render   │    │ gfx_util    │</div>
<div class="line">└──────────┘     └──────┬───────┘    └─────┬───────┘</div>
<div class="line">                        │                   │</div>
<div class="line">                        └─────────┬─────────┘</div>
<div class="line">                                  ▼</div>
<div class="line">                          ┌──────────────┐</div>
<div class="line">                          │  gfx_core    │</div>
<div class="line">                          │  (Bitmap)    │</div>
<div class="line">                          └──────┬───────┘</div>
<div class="line">                                 │</div>
<div class="line">                    ┌────────────┼────────────┐</div>
<div class="line">                    ▼            ▼            ▼</div>
<div class="line">            ┌────────────┐ ┌──────────┐ ┌──────────┐</div>
<div class="line">            │ gfx_types  │ │gfx_resource│ │gfx_backend│</div>
<div class="line">            │ (SNES data)│ │  (Arena)   │ │  (SDL2)   │</div>
<div class="line">            └────────────┘ └──────────┘ └──────────┘</div>
<div class="line"> </div>
<div class="line">Dependencies:</div>
<div class="line">• gfx_types      → (none - foundation)</div>
<div class="line">• gfx_backend    → SDL2</div>
<div class="line">• gfx_resource   → gfx_backend</div>
<div class="line">• gfx_core       → gfx_types + gfx_resource</div>
<div class="line">• gfx_render     → gfx_core + gfx_backend</div>
<div class="line">• gfx_util       → gfx_core</div>
<div class="line">• gfx_debug      → gfx_util + gfx_render</div>
</div><!-- fragment --><p><b>Note</b>: <code>gfx_resource</code> (Arena) depends on <code>gfx_render</code> (BackgroundBuffer) but this is acceptable as both are low-level resource management. Not circular because gfx_render doesn't depend back on gfx_resource.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
1.3 GUI Tier (Refactored)</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_gui (INTERFACE - aggregates all gui sub-libraries)        │</div>
<div class="line">└────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                         │</div>
<div class="line">          ┌──────────────┼──────────────┐</div>
<div class="line">          │              │              │</div>
<div class="line">          ▼              ▼              ▼</div>
<div class="line">    ┌──────────┐  ┌────────────┐  ┌────────────┐</div>
<div class="line">    │ gui_app  │  │gui_automation│ │gui_widgets │</div>
<div class="line">    └────┬─────┘  └─────┬──────┘  └─────┬──────┘</div>
<div class="line">         │              │               │</div>
<div class="line">         └──────────────┼───────────────┘</div>
<div class="line">                        ▼</div>
<div class="line">              ┌──────────────────┐</div>
<div class="line">              │   gui_canvas     │</div>
<div class="line">              └─────────┬────────┘</div>
<div class="line">                        ▼</div>
<div class="line">              ┌──────────────────┐</div>
<div class="line">              │   gui_core       │</div>
<div class="line">              │ (Theme, Input)   │</div>
<div class="line">              └──────────────────┘</div>
<div class="line"> </div>
<div class="line">Dependencies:</div>
<div class="line">• gui_core       → yaze_util + ImGui + nlohmann_json</div>
<div class="line">• gui_canvas     → gui_core + yaze_gfx</div>
<div class="line">• gui_widgets    → gui_core + yaze_gfx</div>
<div class="line">• gui_automation → gui_core</div>
<div class="line">• gui_app        → gui_core + gui_widgets + gui_automation</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md34"></a>
1.4 Zelda3 Library (Current - Monolithic)</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_zelda3 (MONOLITHIC - needs refactoring per B6)            │</div>
<div class="line">│ • Overworld (maps, tiles, warps)                                │</div>
<div class="line">│ • Dungeon (rooms, objects, layouts)                             │</div>
<div class="line">│ • Sprites (entities, overlords)                                 │</div>
<div class="line">│ • Screens (title, inventory, dungeon map)                       │</div>
<div class="line">│ • Music (tracker - legacy Hyrule Magic code)                    │</div>
<div class="line">│ • Labels &amp; constants                                            │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_gfx, yaze_util, yaze_common, absl             │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">Warning: ISSUE: Located at src/app/zelda3/ but used by both app AND cli</div>
<div class="line">Warning: ISSUE: Monolithic - any change rebuilds entire library</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md35"></a>
1.5 Zelda3 Library (Proposed - Tiered)</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_zelda3 (INTERFACE - aggregates sub-libraries)             │</div>
<div class="line">└────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                         │</div>
<div class="line">       ┌─────────────────┼─────────────────┐</div>
<div class="line">       │                 │                 │</div>
<div class="line">       ▼                 ▼                 ▼</div>
<div class="line">┌────────────┐    ┌────────────┐    ┌────────────┐</div>
<div class="line">│zelda3_screen│───│zelda3_dungeon│──│zelda3_overworld│</div>
<div class="line">└────────────┘    └──────┬─────┘    └──────┬──────┘</div>
<div class="line">                         │                 │</div>
<div class="line">       ┌─────────────────┼─────────────────┘</div>
<div class="line">       │                 │</div>
<div class="line">       ▼                 ▼</div>
<div class="line">┌────────────┐    ┌────────────┐</div>
<div class="line">│zelda3_music│    │zelda3_sprite│</div>
<div class="line">└──────┬─────┘    └──────┬─────┘</div>
<div class="line">       │                 │</div>
<div class="line">       └────────┬────────┘</div>
<div class="line">                ▼</div>
<div class="line">        ┌───────────────┐</div>
<div class="line">        │ zelda3_core   │</div>
<div class="line">        │ (Labels,      │</div>
<div class="line">        │  constants)   │</div>
<div class="line">        └───────────────┘</div>
<div class="line"> </div>
<div class="line">Benefits:</div>
<div class="line"> Location: src/zelda3/ (proper top-level shared lib)</div>
<div class="line"> Granular: Change dungeon logic → only rebuilds dungeon + dependents</div>
<div class="line"> Clear boundaries: Separate overworld/dungeon/sprite concerns</div>
<div class="line"> Legacy isolation: Music tracker separated from modern code</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
1.6 Core Libraries</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_core_lib (Warning: CIRCULAR DEPENDENCY RISK)                   │</div>
<div class="line">│ • ROM management (rom.cc)                                       │</div>
<div class="line">│ • Window/input (window.cc)                                      │</div>
<div class="line">│ • Asar wrapper (asar_wrapper.cc)                                │</div>
<div class="line">│ • Platform utilities (file dialogs, fonts, clipboard)          │</div>
<div class="line">│ • Project management (project.cc)                               │</div>
<div class="line">│ • Controller (controller.cc)                                    │</div>
<div class="line">│ • gRPC services (optional - test harness, ROM service)          │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_util, yaze_gfx, yaze_zelda3, yaze_common,     │</div>
<div class="line">│             ImGui, asar-static, SDL2, (gRPC)                    │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
<div class="line">                              ↓</div>
<div class="line">Warning: CIRCULAR: yaze_gfx → depends on gfx_resource (Arena)</div>
<div class="line">            Arena.h includes background_buffer.h (from gfx_render)</div>
<div class="line">            gfx_render → gfx_core → gfx_resource</div>
<div class="line">            BUT yaze_core_lib → yaze_gfx</div>
<div class="line"> </div>
<div class="line">            If anything in core_lib needs gfx_resource internals,</div>
<div class="line">            we get: core_lib → gfx → gfx_resource → (potentially) core_lib</div>
<div class="line"> </div>
<div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_emulator                                                   │</div>
<div class="line">│ • CPU (65C816)                                                  │</div>
<div class="line">│ • PPU (graphics)                                                │</div>
<div class="line">│ • APU (audio - SPC700 + DSP)                                    │</div>
<div class="line">│ • Memory, DMA                                                   │</div>
<div class="line">│ • Input management                                              │</div>
<div class="line">│ • Debugger UI components                                        │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_util, yaze_common, yaze_core_lib, absl, SDL2  │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_net                                                        │</div>
<div class="line">│ • ROM version management                                        │</div>
<div class="line">│ • WebSocket client                                              │</div>
<div class="line">│ • Collaboration service                                         │</div>
<div class="line">│ • ROM service (gRPC - disabled)                                 │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_util, yaze_common, absl, (OpenSSL), (gRPC)    │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37"></a>
1.7 Application Layer</h2>
<div class="fragment"><div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_test_support (Warning: CIRCULAR WITH yaze_editor)              │</div>
<div class="line">│ • TestManager (core test infrastructure)                        │</div>
<div class="line">│ • z3ed test suite                                               │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_editor, yaze_core_lib, yaze_gui, yaze_zelda3, │</div>
<div class="line">│             yaze_gfx, yaze_util, yaze_common, yaze_agent        │</div>
<div class="line">└────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                         │</div>
<div class="line">                         │ Warning: CIRCULAR DEPENDENCY</div>
<div class="line">                         ↓</div>
<div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_editor                                                     │</div>
<div class="line">│ • Dungeon editor                                                │</div>
<div class="line">│ • Overworld editor                                              │</div>
<div class="line">│ • Sprite editor                                                 │</div>
<div class="line">│ • Graphics/palette editors                                      │</div>
<div class="line">│ • Message editor                                                │</div>
<div class="line">│ • Assembly editor                                               │</div>
<div class="line">│ • System editors (settings, commands)                           │</div>
<div class="line">│ • Agent integration (AI features)                               │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_core_lib, yaze_gfx, yaze_gui, yaze_zelda3,    │</div>
<div class="line">│             yaze_emulator, yaze_util, yaze_common, ImGui,       │</div>
<div class="line">│             [yaze_agent], [yaze_test_support] (conditional)     │</div>
<div class="line">└────────────────────────┬────────────────────────────────────────┘</div>
<div class="line">                         │</div>
<div class="line">                         │ Links back to test_support when YAZE_BUILD_TESTS=ON</div>
<div class="line">                         └───────────────────────────────────────────┐</div>
<div class="line">                                                                     │</div>
<div class="line">                                                                     ▼</div>
<div class="line">                                                    Warning: CIRCULAR DEPENDENCY</div>
<div class="line"> </div>
<div class="line">┌─────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_agent (Warning: LINKS TO ALMOST EVERYTHING)                    │</div>
<div class="line">│ • Command handlers (resource, dungeon, overworld, graphics)     │</div>
<div class="line">│ • AI services (Ollama, Gemini)                                  │</div>
<div class="line">│ • GUI automation client                                         │</div>
<div class="line">│ • TUI system (enhanced terminal UI)                             │</div>
<div class="line">│ • Planning/proposal system                                      │</div>
<div class="line">│ • Test generation                                               │</div>
<div class="line">│ • Conversation management                                       │</div>
<div class="line">│                                                                 │</div>
<div class="line">│ Depends on: yaze_common, yaze_util, yaze_gfx, yaze_gui,        │</div>
<div class="line">│             yaze_core_lib, yaze_zelda3, yaze_emulator, absl,    │</div>
<div class="line">│             yaml-cpp, ftxui, (gRPC), (nlohmann_json), (OpenSSL) │</div>
<div class="line">└─────────────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">Warning: ISSUE: yaze_agent is massive and pulls in the entire application stack</div>
<div class="line">   Even simple CLI commands link against graphics, GUI, emulator, etc.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
1.8 Executables</h2>
<div class="fragment"><div class="line">┌────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze (Main Application)                                        │</div>
<div class="line">│                                                                │</div>
<div class="line">│ Links: yaze_editor, yaze_emulator, yaze_core_lib, yaze_agent, │</div>
<div class="line">│        [yaze_test_support] (conditional), ImGui, SDL2          │</div>
<div class="line">│                                                                │</div>
<div class="line">│ Transitively gets: All libraries through yaze_editor           │</div>
<div class="line">└────────────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">┌────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ z3ed (CLI Tool)                                                │</div>
<div class="line">│                                                                │</div>
<div class="line">│ Links: yaze_agent, yaze_core_lib, yaze_zelda3, ftxui          │</div>
<div class="line">│                                                                │</div>
<div class="line">│ Transitively gets: All libraries through yaze_agent (!)        │</div>
<div class="line">│ Warning: ISSUE: CLI tool rebuilds if GUI/graphics/emulator changes  │</div>
<div class="line">└────────────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">┌────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ yaze_emu (Standalone Emulator)                                 │</div>
<div class="line">│                                                                │</div>
<div class="line">│ Links: yaze_emulator, yaze_core_lib, ImGui, SDL2              │</div>
<div class="line">│                                                                │</div>
<div class="line">│ Warning: Conditionally built with YAZE_BUILD_EMU=ON                 │</div>
<div class="line">└────────────────────────────────────────────────────────────────┘</div>
<div class="line"> </div>
<div class="line">┌────────────────────────────────────────────────────────────────┐</div>
<div class="line">│ Test Executables                                               │</div>
<div class="line">│                                                                │</div>
<div class="line">│ yaze_test_stable:                                              │</div>
<div class="line">│   - Unit tests (asar, rom, gfx, gui, zelda3, cli)             │</div>
<div class="line">│   - Integration tests (dungeon, overworld, editor)             │</div>
<div class="line">│   - Links: yaze_test_support, gmock_main, gtest_main          │</div>
<div class="line">│                                                                │</div>
<div class="line">│ yaze_test_gui:                                                 │</div>
<div class="line">│   - E2E GUI tests with ImGuiTestEngine                         │</div>
<div class="line">│   - Links: yaze_test_support, ImGuiTestEngine                  │</div>
<div class="line">│                                                                │</div>
<div class="line">│ yaze_test_rom_dependent:                                       │</div>
<div class="line">│   - Tests requiring actual ROM file                            │</div>
<div class="line">│   - Only built when YAZE_ENABLE_ROM_TESTS=ON                   │</div>
<div class="line">│                                                                │</div>
<div class="line">│ yaze_test_experimental:                                        │</div>
<div class="line">│   - AI integration tests (vision, tile placement)              │</div>
<div class="line">│                                                                │</div>
<div class="line">│ yaze_test_benchmark:                                           │</div>
<div class="line">│   - Performance benchmarks                                     │</div>
<div class="line">└────────────────────────────────────────────────────────────────┘</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md40"></a>
2. Current Dependency Issues</h1>
<h2><a class="anchor" id="autotoc_md41"></a>
2.1 Circular Dependencies</h2>
<h3><a class="anchor" id="autotoc_md42"></a>
Issue 1: yaze_test_support ↔ yaze_editor</h3>
<div class="fragment"><div class="line">yaze_test_support</div>
<div class="line">    ├─→ yaze_editor (for EditorManager, Canvas, etc.)</div>
<div class="line">    └─→ yaze_core_lib, yaze_gui, yaze_zelda3, ...</div>
<div class="line"> </div>
<div class="line">yaze_editor (when YAZE_BUILD_TESTS=ON)</div>
<div class="line">    └─→ yaze_test_support (for TestManager)</div>
<div class="line"> </div>
<div class="line">Result: Neither can be built first, causes linking issues</div>
</div><!-- fragment --><p><b>Impact</b>:</p><ul>
<li>Confusing build order</li>
<li>Test dashboard cannot be excluded from release builds cleanly</li>
<li>Changes to test infrastructure force editor rebuilds</li>
</ul>
<p><b>Solution</b> (from <a class="el" href="../../d4/d37/A2-test-dashboard-refactoring_8md.html">A2-test-dashboard-refactoring.md</a>): </p><div class="fragment"><div class="line">test_framework (core logic only)</div>
<div class="line">    ├─→ yaze_util, absl (no app dependencies)</div>
<div class="line"> </div>
<div class="line">test_suites (actual tests)</div>
<div class="line">    ├─→ test_framework</div>
<div class="line">    └─→ yaze_zelda3, yaze_gfx (only what&#39;s needed)</div>
<div class="line"> </div>
<div class="line">test_dashboard (GUI component - OPTIONAL)</div>
<div class="line">    ├─→ test_framework</div>
<div class="line">    ├─→ yaze_gui</div>
<div class="line">    └─→ Conditionally linked to yaze app</div>
<div class="line"> </div>
<div class="line">yaze_editor</div>
<div class="line">    └─→ (no test dependencies)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md43"></a>
Issue 2: Potential yaze_core_lib ↔ yaze_gfx Cycle</h3>
<div class="fragment"><div class="line">yaze_core_lib</div>
<div class="line">    └─→ yaze_gfx (for graphics operations)</div>
<div class="line"> </div>
<div class="line">yaze_gfx</div>
<div class="line">    └─→ gfx_resource (Arena)</div>
<div class="line"> </div>
<div class="line">gfx_resource (Arena)</div>
<div class="line">    └─→ Includes background_buffer.h (from gfx_render)</div>
<div class="line">    └─→ Has BackgroundBuffer members (bg1_, bg2_)</div>
<div class="line"> </div>
<div class="line">If yaze_core_lib internals ever need gfx_resource specifics:</div>
<div class="line">    yaze_core_lib → yaze_gfx → gfx_resource → (back to) core_lib ❌</div>
</div><!-- fragment --><p><b>Current Status</b>: Not a problem yet, but risky <b>Solution</b>: Split yaze_core_lib into foundation vs services</p>
<h2><a class="anchor" id="autotoc_md44"></a>
2.2 Over-Linking Problems</h2>
<h3><a class="anchor" id="autotoc_md45"></a>
Problem 1: yaze_test_support Links to Everything</h3>
<div class="fragment"><div class="line">yaze_test_support dependencies:</div>
<div class="line">├─→ yaze_editor (Warning: Brings in entire app stack)</div>
<div class="line">├─→ yaze_core_lib</div>
<div class="line">├─→ yaze_gui (Warning: Brings in all GUI widgets)</div>
<div class="line">├─→ yaze_zelda3</div>
<div class="line">├─→ yaze_gfx (Warning: All 7 gfx libraries)</div>
<div class="line">├─→ yaze_util</div>
<div class="line">├─→ yaze_common</div>
<div class="line">└─→ yaze_agent (Warning: Brings in AI services, emulator, etc.)</div>
<div class="line"> </div>
<div class="line">Result: Test executables link against THE ENTIRE APPLICATION</div>
</div><!-- fragment --><p><b>Impact</b>:</p><ul>
<li>Test binaries are massive (100+ MB)</li>
<li>Any change to any library forces test relink</li>
<li>Slow CI/CD pipeline</li>
<li>Cannot build minimal test suites</li>
</ul>
<p><b>Solution</b>:</p><ul>
<li>Separate test framework from test suites</li>
<li>Each test suite links only to what it tests</li>
<li>Remove yaze_editor from test framework</li>
</ul>
<h3><a class="anchor" id="autotoc_md46"></a>
Problem 2: yaze_agent Links to Everything</h3>
<div class="fragment"><div class="line">yaze_agent dependencies:</div>
<div class="line">├─→ yaze_common</div>
<div class="line">├─→ yaze_util</div>
<div class="line">├─→ yaze_gfx (all 7 libs)</div>
<div class="line">├─→ yaze_gui (all 5 libs)</div>
<div class="line">├─→ yaze_core_lib</div>
<div class="line">├─→ yaze_zelda3</div>
<div class="line">├─→ yaze_emulator</div>
<div class="line">├─→ absl</div>
<div class="line">├─→ yaml-cpp</div>
<div class="line">├─→ ftxui</div>
<div class="line">├─→ [gRPC]</div>
<div class="line">├─→ [nlohmann_json]</div>
<div class="line">└─→ [OpenSSL]</div>
<div class="line"> </div>
<div class="line">Result: z3ed CLI tool rebuilds if GUI changes!</div>
</div><!-- fragment --><p><b>Impact</b>:</p><ul>
<li>CLI tool (<code>z3ed</code>) is 80+ MB</li>
<li>Any GUI/graphics change forces CLI rebuild</li>
<li>Cannot build minimal agent for server deployment</li>
<li>Tight coupling between CLI and GUI</li>
</ul>
<p><b>Solution</b>: </p><div class="fragment"><div class="line">yaze_agent_core (minimal)</div>
<div class="line">    ├─→ Command handling abstractions</div>
<div class="line">    ├─→ TUI system (FTXUI)</div>
<div class="line">    ├─→ yaze_util, yaze_common</div>
<div class="line">    └─→ NO graphics, NO gui, NO emulator</div>
<div class="line"> </div>
<div class="line">yaze_agent_services (full stack)</div>
<div class="line">    ├─→ yaze_agent_core</div>
<div class="line">    ├─→ yaze_gfx, yaze_gui (for GUI automation)</div>
<div class="line">    ├─→ yaze_emulator (for emulator commands)</div>
<div class="line">    └─→ yaze_zelda3 (for game logic queries)</div>
<div class="line"> </div>
<div class="line">z3ed executable</div>
<div class="line">    └─→ yaze_agent_core (minimal build)</div>
<div class="line">    └─→ Optional: yaze_agent_services (full features)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md47"></a>
Problem 3: yaze_editor Links to 8+ Major Libraries</h3>
<div class="fragment"><div class="line">yaze_editor dependencies:</div>
<div class="line">├─→ yaze_core_lib</div>
<div class="line">├─→ yaze_gfx (7 libs transitively)</div>
<div class="line">├─→ yaze_gui (5 libs transitively)</div>
<div class="line">├─→ yaze_zelda3</div>
<div class="line">├─→ yaze_emulator</div>
<div class="line">├─→ yaze_util</div>
<div class="line">├─→ yaze_common</div>
<div class="line">├─→ ImGui</div>
<div class="line">├─→ [yaze_agent] (conditional)</div>
<div class="line">└─→ [yaze_test_support] (conditional)</div>
<div class="line"> </div>
<div class="line">Result: Changes to ANY of these trigger editor rebuild</div>
</div><!-- fragment --><p><b>Impact</b>:</p><ul>
<li>60+ second editor rebuilds on gfx changes</li>
<li>Tight coupling across entire application</li>
<li>Difficult to isolate editor features</li>
<li>Hard to test individual editors</li>
</ul>
<p><b>Mitigation</b> (already done for gfx/gui):</p><ul>
<li>gfx refactored into 7 granular libs</li>
<li>gui refactored into 5 granular libs</li>
<li>Next: Refactor zelda3 into 6 granular libs</li>
<li>Next: Split editor into editor modules</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
2.3 Misplaced Components</h2>
<h3><a class="anchor" id="autotoc_md49"></a>
Issue 1: zelda3 Library Location</h3>
<div class="fragment"><div class="line">Current:  src/app/zelda3/</div>
<div class="line">          └─→ Implies it&#39;s part of GUI application</div>
<div class="line"> </div>
<div class="line">Reality:  Used by both yaze app AND z3ed CLI</div>
<div class="line">          └─→ Should be top-level shared library</div>
<div class="line"> </div>
<div class="line">Problem:  cli/ cannot depend on app/ (architectural violation)</div>
</div><!-- fragment --><p><b>Solution</b> (from <a class="el" href="../../de/d43/B6-zelda3-library-refactoring_8md.html">B6-zelda3-library-refactoring.md</a>):</p><ul>
<li>Move: <code>src/app/zelda3/</code> → <code>src/zelda3/</code></li>
<li>Update all includes: <code>#include "app/zelda3/...&lt;/tt&gt; → &lt;tt&gt;\#include "zelda3/...</code></li>
<li>Establish as proper shared core component</li>
</ul>
<h3><a class="anchor" id="autotoc_md50"></a>
Issue 2: Test Infrastructure Mixed into App</h3>
<div class="fragment"><div class="line">Current:  src/app/test/</div>
<div class="line">          └─→ test_manager.cc (core logic + GUI dashboard)</div>
<div class="line">          └─→ z3ed_test_suite.cc (test implementation)</div>
<div class="line"> </div>
<div class="line">Problem:  Cannot exclude test dashboard from release builds</div>
<div class="line">          Cannot build minimal test framework</div>
</div><!-- fragment --><p><b>Solution</b> (from <a class="el" href="../../d4/d37/A2-test-dashboard-refactoring_8md.html">A2-test-dashboard-refactoring.md</a>):</p><ul>
<li>Move: <code>src/app/test/</code> → <code>src/test/framework/</code> + <code>src/test/suites/</code></li>
<li>Separate: <code>TestManager</code> (core) from <code>TestDashboard</code> (GUI)</li>
<li>Make: <code>test_dashboard</code> conditionally compiled</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md52"></a>
3. Build Time Impact Analysis</h1>
<h2><a class="anchor" id="autotoc_md53"></a>
3.1 Current Rebuild Cascades</h2>
<h3><a class="anchor" id="autotoc_md54"></a>
Scenario 1: Change snes_tile.cc (gfx_types)</h3>
<div class="fragment"><div class="line">snes_tile.cc (gfx_types)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gfx_core (depends on gfx_types)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gfx_util + yaze_gfx_render (depend on gfx_core)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gfx_debug (depends on gfx_util + gfx_render)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gfx (INTERFACE - aggregates all)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gui_core + yaze_canvas + yaze_gui_widgets (depend on yaze_gfx)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gui (INTERFACE - aggregates all)</div>
<div class="line">    ↓</div>
<div class="line">yaze_core_lib (depends on yaze_gfx + yaze_gui)</div>
<div class="line">    ↓</div>
<div class="line">yaze_editor + yaze_agent + yaze_net (depend on core_lib)</div>
<div class="line">    ↓</div>
<div class="line">yaze_test_support (depends on yaze_editor)</div>
<div class="line">    ↓</div>
<div class="line">All test executables (depend on yaze_test_support)</div>
<div class="line">    ↓</div>
<div class="line">yaze + z3ed + yaze_emu (main executables)</div>
<div class="line"> </div>
<div class="line">TOTAL: 20+ libraries rebuilt, 6+ executables relinked</div>
<div class="line">TIME: 5-10 minutes on CI, 2-3 minutes locally</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md55"></a>
Scenario 2: Change overworld_map.cc (zelda3)</h3>
<div class="fragment"><div class="line">overworld_map.cc (yaze_zelda3 - monolithic)</div>
<div class="line">    ↓</div>
<div class="line">yaze_zelda3 (ENTIRE library rebuilt)</div>
<div class="line">    ↓</div>
<div class="line">yaze_core_lib (depends on yaze_zelda3)</div>
<div class="line">    ↓</div>
<div class="line">yaze_editor + yaze_agent (depend on core_lib)</div>
<div class="line">    ↓</div>
<div class="line">yaze_test_support (depends on yaze_editor + yaze_agent)</div>
<div class="line">    ↓</div>
<div class="line">All test executables</div>
<div class="line">    ↓</div>
<div class="line">yaze + z3ed executables</div>
<div class="line"> </div>
<div class="line">TOTAL: 8+ libraries rebuilt, 6+ executables relinked</div>
<div class="line">TIME: 3-5 minutes on CI, 1-2 minutes locally</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md56"></a>
Scenario 3: Change test_manager.cc</h3>
<div class="fragment"><div class="line">test_manager.cc (yaze_test_support)</div>
<div class="line">    ↓</div>
<div class="line">yaze_test_support</div>
<div class="line">    ↓</div>
<div class="line">yaze_editor (links to test_support when YAZE_BUILD_TESTS=ON)</div>
<div class="line">    ↓</div>
<div class="line">yaze + z3ed (link to yaze_editor)</div>
<div class="line">    ↓</div>
<div class="line">All test executables (link to yaze_test_support)</div>
<div class="line"> </div>
<div class="line">TOTAL: 3 libraries rebuilt, 8+ executables relinked</div>
<div class="line">TIME: 1-2 minutes</div>
<div class="line"> </div>
<div class="line">Warning: CIRCULAR: Editor change forces test rebuild,</div>
<div class="line">             Test change forces editor rebuild</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md57"></a>
3.2 Optimized Rebuild Cascades (After Refactoring)</h2>
<h3><a class="anchor" id="autotoc_md58"></a>
Scenario 1: Change snes_tile.cc (gfx_types) - Optimized</h3>
<div class="fragment"><div class="line">snes_tile.cc (gfx_types)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gfx_core (depends on gfx_types)</div>
<div class="line">    ↓</div>
<div class="line">yaze_gfx_util + yaze_gfx_render (depend on gfx_core)</div>
<div class="line"> </div>
<div class="line"> STOP: Changes don&#39;t affect gfx_backend or gfx_resource</div>
<div class="line"> STOP: gui libraries still use old gfx INTERFACE</div>
<div class="line"> </div>
<div class="line">Only rebuilt if consumers explicitly use changed APIs:</div>
<div class="line">    - yaze_zelda3 (if it uses modified tile functions)</div>
<div class="line">    - Specific editor modules (if they use modified functions)</div>
<div class="line"> </div>
<div class="line">TOTAL: 3-5 libraries rebuilt, 1-2 executables relinked</div>
<div class="line">TIME: 30-60 seconds on CI, 15-30 seconds locally</div>
<div class="line">SAVINGS: 80% faster! </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md59"></a>
Scenario 2: Change overworld_map.cc (zelda3) - Optimized</h3>
<div class="fragment"><div class="line">With refactored zelda3:</div>
<div class="line"> </div>
<div class="line">overworld_map.cc (zelda3_overworld sub-library)</div>
<div class="line">    ↓</div>
<div class="line">yaze_zelda3_overworld (only this sub-library rebuilt)</div>
<div class="line"> </div>
<div class="line"> STOP: zelda3_dungeon, zelda3_sprite unchanged</div>
<div class="line"> STOP: zelda3_screen depends on overworld but may not need rebuild</div>
<div class="line"> </div>
<div class="line">Only rebuilt if consumers use changed APIs:</div>
<div class="line">    - yaze_editor_overworld_module</div>
<div class="line">    - Specific overworld tests</div>
<div class="line">    - z3ed overworld commands</div>
<div class="line"> </div>
<div class="line">TOTAL: 2-3 libraries rebuilt, 1-2 executables relinked</div>
<div class="line">TIME: 30-45 seconds on CI, 15-20 seconds locally</div>
<div class="line">SAVINGS: 70% faster! </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md60"></a>
Scenario 3: Change test_manager.cc - Optimized</h3>
<div class="fragment"><div class="line">With separated test infrastructure:</div>
<div class="line"> </div>
<div class="line">test_manager.cc (test_framework)</div>
<div class="line">    ↓</div>
<div class="line">test_framework</div>
<div class="line"> </div>
<div class="line"> STOP: test_suites may not need rebuild (depends on interface changes)</div>
<div class="line"> STOP: test_dashboard is separate, doesn&#39;t rebuild</div>
<div class="line"> STOP: yaze_editor has NO dependency on test system</div>
<div class="line"> </div>
<div class="line">Only rebuilt:</div>
<div class="line">    - test_framework</div>
<div class="line">    - Test executables (yaze_test_*)</div>
<div class="line"> </div>
<div class="line">TOTAL: 1 library rebuilt, 5 test executables relinked</div>
<div class="line">TIME: 20-30 seconds on CI, 10-15 seconds locally</div>
<div class="line">SAVINGS: 60% faster! </div>
<div class="line"> </div>
<div class="line">Warning: BONUS: Release builds exclude test_dashboard entirely</div>
<div class="line">          → Smaller binary, faster builds, cleaner architecture</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
3.3 Build Time Savings Summary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Change Type   </th><th class="markdownTableHeadNone">Current Time   </th><th class="markdownTableHeadNone">After Refactoring   </th><th class="markdownTableHeadNone">Savings    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gfx_types change   </td><td class="markdownTableBodyNone">5-10 min   </td><td class="markdownTableBodyNone">30-60 sec   </td><td class="markdownTableBodyNone"><b>80%</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">zelda3 change   </td><td class="markdownTableBodyNone">3-5 min   </td><td class="markdownTableBodyNone">30-45 sec   </td><td class="markdownTableBodyNone"><b>70%</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Test infrastructure   </td><td class="markdownTableBodyNone">1-2 min   </td><td class="markdownTableBodyNone">20-30 sec   </td><td class="markdownTableBodyNone"><b>60%</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GUI widget change   </td><td class="markdownTableBodyNone">4-6 min   </td><td class="markdownTableBodyNone">45-90 sec   </td><td class="markdownTableBodyNone"><b>65%</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Agent change   </td><td class="markdownTableBodyNone">2-3 min   </td><td class="markdownTableBodyNone">30-45 sec   </td><td class="markdownTableBodyNone"><b>50%</b>   </td></tr>
</table>
<p><b>Overall Incremental Build Improvement</b>: <b>40-60% faster</b> across common development scenarios</p>
<hr  />
<h1><a class="anchor" id="autotoc_md63"></a>
4. Proposed Refactoring Initiatives</h1>
<h2><a class="anchor" id="autotoc_md64"></a>
4.1 Priority 1: Execute Existing Proposals</h2>
<h3><a class="anchor" id="autotoc_md65"></a>
A. Test Dashboard Separation (A2)</h3>
<p><b>Status</b>: Proposed <b>Priority</b>: HIGH <b>Effort</b>: Medium (2-3 days) <b>Impact</b>: 60% faster test builds, cleaner release builds</p>
<p><b>Implementation</b>:</p><ol type="1">
<li>Create <code>src/test/framework/</code> directory<ul>
<li>Move <code><a class="el" href="../../d6/d5c/test__manager_8h.html">test_manager.h</a>/cc</code> (core logic only)</li>
<li>Remove UI code from TestManager</li>
<li>Library: <code>yaze_test_framework</code></li>
<li>Dependencies: <code>yaze_util</code>, <code>absl</code></li>
</ul>
</li>
<li>Create <code>src/test/suites/</code> directory<ul>
<li>Move all <code>*_test_suite.h</code> files</li>
<li>Move <code><a class="el" href="../../d0/d00/z3ed__test__suite_8cc.html">z3ed_test_suite.cc</a></code></li>
<li>Library: <code>yaze_test_suites</code></li>
<li>Dependencies: <code>yaze_test_framework</code>, specific yaze libs</li>
</ul>
</li>
<li>Create <code>src/app/gui/testing/</code> directory<ul>
<li>New <code>TestDashboard</code> class</li>
<li>Move <code>DrawTestDashboard</code> from TestManager</li>
<li>Library: <code>yaze_test_dashboard</code></li>
<li>Dependencies: <code>yaze_test_framework</code>, <code>yaze_gui</code></li>
<li>Conditional: <code>YAZE_WITH_TEST_DASHBOARD=ON</code></li>
</ul>
</li>
<li>Update build system<ul>
<li>Root CMake: Add <code>option(YAZE_WITH_TEST_DASHBOARD "..." ON)</code></li>
<li>app.cmake: Conditionally link <code>yaze_test_dashboard</code></li>
<li>Remove circular dependency</li>
</ul>
</li>
</ol>
<p><b>Benefits</b>:</p><ul>
<li>No circular dependencies</li>
<li>Release builds exclude test dashboard</li>
<li>Test changes don't rebuild editor</li>
<li>Cleaner architecture</li>
</ul>
<h3><a class="anchor" id="autotoc_md66"></a>
B. Zelda3 Library Refactoring (B6)</h3>
<p><b>Status</b>: Proposed <b>Priority</b>: HIGH <b>Effort</b>: Large (4-5 days) <b>Impact</b>: 70% faster zelda3 builds, proper shared library</p>
<p><b>Phase 1: Physical Move</b> </p><div class="fragment"><div class="line"># Move directory</div>
<div class="line">mv src/app/zelda3 src/zelda3</div>
<div class="line"> </div>
<div class="line"># Update CMakeLists.txt</div>
<div class="line">sed -i &#39;s|include(zelda3/zelda3_library.cmake)|include(zelda3/zelda3_library.cmake)|&#39; src/CMakeLists.txt</div>
<div class="line"> </div>
<div class="line"># Global include update</div>
<div class="line">find . -type f \&zwj;( -name &quot;*.cc&quot; -o -name &quot;*.h&quot; \&zwj;) -exec sed -i &#39;s|#include &quot;app/zelda3/|#include &quot;zelda3/|g&#39; {} +</div>
<div class="line"> </div>
<div class="line"># Test build</div>
<div class="line">cmake --preset mac-dev &amp;&amp; cmake --build --preset mac-dev</div>
</div><!-- fragment --><p><b>Phase 2: Decompose into Sub-Libraries</b></p>
<div class="fragment"><div class="line"># src/zelda3/zelda3_library.cmake</div>
<div class="line"> </div>
<div class="line"># 1. Foundation</div>
<div class="line">set(ZELDA3_CORE_SRC</div>
<div class="line">  zelda3/common.h</div>
<div class="line">  zelda3/zelda3_labels.cc</div>
<div class="line">  zelda3/palette_constants.cc</div>
<div class="line">  zelda3/dungeon/dungeon_rom_addresses.h</div>
<div class="line">)</div>
<div class="line">add_library(yaze_zelda3_core STATIC ${ZELDA3_CORE_SRC})</div>
<div class="line">target_link_libraries(yaze_zelda3_core PUBLIC yaze_util)</div>
<div class="line"> </div>
<div class="line"># 2. Sprite (shared by dungeon + overworld)</div>
<div class="line">set(ZELDA3_SPRITE_SRC</div>
<div class="line">  zelda3/sprite/sprite.cc</div>
<div class="line">  zelda3/sprite/sprite_builder.cc</div>
<div class="line">  zelda3/sprite/overlord.h</div>
<div class="line">)</div>
<div class="line">add_library(yaze_zelda3_sprite STATIC ${ZELDA3_SPRITE_SRC})</div>
<div class="line">target_link_libraries(yaze_zelda3_sprite PUBLIC yaze_zelda3_core)</div>
<div class="line"> </div>
<div class="line"># 3. Dungeon</div>
<div class="line">set(ZELDA3_DUNGEON_SRC</div>
<div class="line">  zelda3/dungeon/room.cc</div>
<div class="line">  zelda3/dungeon/room_layout.cc</div>
<div class="line">  zelda3/dungeon/room_object.cc</div>
<div class="line">  zelda3/dungeon/object_parser.cc</div>
<div class="line">  zelda3/dungeon/object_drawer.cc</div>
<div class="line">  zelda3/dungeon/dungeon_editor_system.cc</div>
<div class="line">  zelda3/dungeon/dungeon_object_editor.cc</div>
<div class="line">)</div>
<div class="line">add_library(yaze_zelda3_dungeon STATIC ${ZELDA3_DUNGEON_SRC})</div>
<div class="line">target_link_libraries(yaze_zelda3_dungeon PUBLIC</div>
<div class="line">  yaze_zelda3_core</div>
<div class="line">  yaze_zelda3_sprite</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># 4. Overworld</div>
<div class="line">set(ZELDA3_OVERWORLD_SRC</div>
<div class="line">  zelda3/overworld/overworld.cc</div>
<div class="line">  zelda3/overworld/overworld_map.cc</div>
<div class="line">)</div>
<div class="line">add_library(yaze_zelda3_overworld STATIC ${ZELDA3_OVERWORLD_SRC})</div>
<div class="line">target_link_libraries(yaze_zelda3_overworld PUBLIC</div>
<div class="line">  yaze_zelda3_core</div>
<div class="line">  yaze_zelda3_sprite</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># 5. Screen</div>
<div class="line">set(ZELDA3_SCREEN_SRC</div>
<div class="line">  zelda3/screen/title_screen.cc</div>
<div class="line">  zelda3/screen/inventory.cc</div>
<div class="line">  zelda3/screen/dungeon_map.cc</div>
<div class="line">  zelda3/screen/overworld_map_screen.cc</div>
<div class="line">)</div>
<div class="line">add_library(yaze_zelda3_screen STATIC ${ZELDA3_SCREEN_SRC})</div>
<div class="line">target_link_libraries(yaze_zelda3_screen PUBLIC</div>
<div class="line">  yaze_zelda3_dungeon</div>
<div class="line">  yaze_zelda3_overworld</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># 6. Music (legacy isolation)</div>
<div class="line">set(ZELDA3_MUSIC_SRC</div>
<div class="line">  zelda3/music/tracker.cc</div>
<div class="line">)</div>
<div class="line">add_library(yaze_zelda3_music STATIC ${ZELDA3_MUSIC_SRC})</div>
<div class="line">target_link_libraries(yaze_zelda3_music PUBLIC yaze_zelda3_core)</div>
<div class="line"> </div>
<div class="line"># Aggregate INTERFACE library</div>
<div class="line">add_library(yaze_zelda3 INTERFACE)</div>
<div class="line">target_link_libraries(yaze_zelda3 INTERFACE</div>
<div class="line">  yaze_zelda3_core</div>
<div class="line">  yaze_zelda3_sprite</div>
<div class="line">  yaze_zelda3_dungeon</div>
<div class="line">  yaze_zelda3_overworld</div>
<div class="line">  yaze_zelda3_screen</div>
<div class="line">  yaze_zelda3_music</div>
<div class="line">)</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Proper top-level shared library</li>
<li>Granular rebuilds (change dungeon → only dungeon + screen rebuild)</li>
<li>Clear domain boundaries</li>
<li>Legacy code isolated</li>
</ul>
<h3><a class="anchor" id="autotoc_md67"></a>
C. z3ed Command Abstraction (C4)</h3>
<p><b>Status</b>: <b>COMPLETED</b> <b>Priority</b>: N/A (already done) <b>Impact</b>: 1300+ lines eliminated, 50-60% smaller command implementations</p>
<p><b>Achievements</b>:</p><ul>
<li>Command abstraction layer (<code>CommandContext</code>, <code>ArgumentParser</code>, <code>OutputFormatter</code>)</li>
<li>Enhanced TUI with themes and autocomplete</li>
<li>Comprehensive test coverage</li>
<li>AI-friendly predictable structure</li>
</ul>
<p><b>Next Steps</b>: None required, refactoring complete</p>
<h2><a class="anchor" id="autotoc_md68"></a>
4.2 Priority 2: New Refactoring Proposals</h2>
<h3><a class="anchor" id="autotoc_md69"></a>
D. Split yaze_core_lib to Prevent Cycles</h3>
<p><b>Status</b>: Proposed (New) <b>Priority</b>: MEDIUM <b>Effort</b>: Medium (2-3 days) <b>Impact</b>: Prevents future circular dependencies, cleaner separation</p>
<p><b>Problem</b>: </p><div class="fragment"><div class="line">yaze_core_lib currently contains:</div>
<div class="line">├─→ ROM management (rom.cc)</div>
<div class="line">├─→ Window/input (window.cc)</div>
<div class="line">├─→ Asar wrapper (asar_wrapper.cc)</div>
<div class="line">├─→ Platform utilities (file_dialog, fonts)</div>
<div class="line">├─→ Project management (project.cc)</div>
<div class="line">├─→ Controller (controller.cc)</div>
<div class="line">└─→ gRPC services (test_harness, rom_service)</div>
<div class="line"> </div>
<div class="line">All mixed together in one library</div>
<div class="line">If core_lib needs gfx internals → potential cycle</div>
</div><!-- fragment --><p><b>Solution</b>: </p><div class="fragment"><div class="line">yaze_core_foundation:</div>
<div class="line">├─→ ROM management (rom.cc)</div>
<div class="line">├─→ Window basics (window.cc)</div>
<div class="line">├─→ Asar wrapper (asar_wrapper.cc)</div>
<div class="line">├─→ Platform utilities (file_dialog, fonts)</div>
<div class="line">└─→ Dependencies: yaze_util, yaze_common, asar, SDL2</div>
<div class="line">    (NO yaze_gfx, NO yaze_zelda3)</div>
<div class="line"> </div>
<div class="line">yaze_core_services:</div>
<div class="line">├─→ Project management (project.cc) - needs zelda3 for labels</div>
<div class="line">├─→ Controller (controller.cc) - coordinates editors</div>
<div class="line">├─→ gRPC services (test_harness, rom_service)</div>
<div class="line">└─→ Dependencies: yaze_core_foundation, yaze_gfx, yaze_zelda3</div>
<div class="line"> </div>
<div class="line">yaze_core_lib (INTERFACE):</div>
<div class="line">└─→ Aggregates: yaze_core_foundation + yaze_core_services</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Clear separation: foundation vs services</li>
<li>Prevents cycles: gfx → core_foundation → gfx ❌ (no longer possible)</li>
<li>Selective linking: CLI can use foundation only</li>
<li>Better testability</li>
</ul>
<p><b>Migration</b>: </p><div class="fragment"><div class="line"># src/app/core/core_library.cmake</div>
<div class="line"> </div>
<div class="line">set(CORE_FOUNDATION_SRC</div>
<div class="line">  core/asar_wrapper.cc</div>
<div class="line">  app/core/window.cc</div>
<div class="line">  app/rom.cc</div>
<div class="line">  app/platform/font_loader.cc</div>
<div class="line">  app/platform/asset_loader.cc</div>
<div class="line">  app/platform/file_dialog_nfd.cc  # or .mm for macOS</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_library(yaze_core_foundation STATIC ${CORE_FOUNDATION_SRC})</div>
<div class="line">target_link_libraries(yaze_core_foundation PUBLIC</div>
<div class="line">  yaze_util</div>
<div class="line">  yaze_common</div>
<div class="line">  asar-static</div>
<div class="line">  SDL2</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">set(CORE_SERVICES_SRC</div>
<div class="line">  app/core/project.cc</div>
<div class="line">  app/core/controller.cc</div>
<div class="line">  # gRPC services if enabled</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_library(yaze_core_services STATIC ${CORE_SERVICES_SRC})</div>
<div class="line">target_link_libraries(yaze_core_services PUBLIC</div>
<div class="line">  yaze_core_foundation</div>
<div class="line">  yaze_gfx</div>
<div class="line">  yaze_zelda3</div>
<div class="line">  ImGui</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Aggregate</div>
<div class="line">add_library(yaze_core_lib INTERFACE)</div>
<div class="line">target_link_libraries(yaze_core_lib INTERFACE</div>
<div class="line">  yaze_core_foundation</div>
<div class="line">  yaze_core_services</div>
<div class="line">)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md70"></a>
E. Split yaze_agent for Minimal CLI</h3>
<p><b>Status</b>: Proposed (New) <b>Priority</b>: MEDIUM-LOW <b>Effort</b>: Medium (3-4 days) <b>Impact</b>: 50% smaller z3ed builds, faster CLI development</p>
<p><b>Problem</b>: </p><div class="fragment"><div class="line">yaze_agent currently links to EVERYTHING:</div>
<div class="line">├─→ yaze_gfx (all 7 libs)</div>
<div class="line">├─→ yaze_gui (all 5 libs)</div>
<div class="line">├─→ yaze_core_lib</div>
<div class="line">├─→ yaze_zelda3</div>
<div class="line">├─→ yaze_emulator</div>
<div class="line">└─→ Result: 80+ MB z3ed binary, slow rebuilds</div>
</div><!-- fragment --><p><b>Solution</b>: </p><div class="fragment"><div class="line">yaze_agent_core (minimal):</div>
<div class="line">├─→ Command registry &amp; dispatcher</div>
<div class="line">├─→ TUI system (FTXUI)</div>
<div class="line">├─→ Argument parsing (from C4 refactoring)</div>
<div class="line">├─→ Output formatting (from C4 refactoring)</div>
<div class="line">├─→ Command context (from C4 refactoring)</div>
<div class="line">├─→ Dependencies: yaze_util, yaze_common, ftxui, yaml-cpp</div>
<div class="line">└─→ Size: ~15 MB binary</div>
<div class="line"> </div>
<div class="line">yaze_agent_services (full stack):</div>
<div class="line">├─→ yaze_agent_core</div>
<div class="line">├─→ AI services (Ollama, Gemini)</div>
<div class="line">├─→ GUI automation client</div>
<div class="line">├─→ Emulator commands</div>
<div class="line">├─→ Proposal system</div>
<div class="line">├─→ Dependencies: ALL yaze libraries</div>
<div class="line">└─→ Size: +65 MB (total 80+ MB)</div>
<div class="line"> </div>
<div class="line">z3ed executable:</div>
<div class="line">└─→ Links: yaze_agent_core (default)</div>
<div class="line">└─→ Optional: yaze_agent_services (with --enable-full-features)</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>80% smaller CLI binary for basic commands</li>
<li>Faster CLI development (no GUI rebuilds)</li>
<li>Server deployments can use minimal agent</li>
<li>Clear separation: core vs services</li>
</ul>
<p><b>Implementation</b>: </p><div class="fragment"><div class="line"># src/cli/agent.cmake</div>
<div class="line"> </div>
<div class="line">set(AGENT_CORE_SRC</div>
<div class="line">  cli/flags.cc</div>
<div class="line">  cli/handlers/command_handlers.cc</div>
<div class="line">  cli/service/command_registry.cc</div>
<div class="line">  cli/service/agent/tool_dispatcher.cc</div>
<div class="line">  cli/service/agent/enhanced_tui.cc</div>
<div class="line">  cli/service/resources/command_context.cc</div>
<div class="line">  cli/service/resources/command_handler.cc</div>
<div class="line">  cli/service/resources/resource_catalog.cc</div>
<div class="line">  # Minimal command handlers (resource queries, basic ROM ops)</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_library(yaze_agent_core STATIC ${AGENT_CORE_SRC})</div>
<div class="line">target_link_libraries(yaze_agent_core PUBLIC</div>
<div class="line">  yaze_common</div>
<div class="line">  yaze_util</div>
<div class="line">  ftxui::component</div>
<div class="line">  yaml-cpp</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">set(AGENT_SERVICES_SRC</div>
<div class="line">  # All AI, GUI automation, emulator integration</div>
<div class="line">  cli/service/ai/ai_service.cc</div>
<div class="line">  cli/service/ai/ollama_ai_service.cc</div>
<div class="line">  cli/service/ai/gemini_ai_service.cc</div>
<div class="line">  cli/service/gui/gui_automation_client.cc</div>
<div class="line">  cli/handlers/tools/emulator_commands.cc</div>
<div class="line">  # ... all other advanced features</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_library(yaze_agent_services STATIC ${AGENT_SERVICES_SRC})</div>
<div class="line">target_link_libraries(yaze_agent_services PUBLIC</div>
<div class="line">  yaze_agent_core</div>
<div class="line">  yaze_gfx</div>
<div class="line">  yaze_gui</div>
<div class="line">  yaze_core_lib</div>
<div class="line">  yaze_zelda3</div>
<div class="line">  yaze_emulator</div>
<div class="line">  # ... all dependencies</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># z3ed can choose which to link</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
4.3 Priority 3: Future Optimizations</h2>
<h3><a class="anchor" id="autotoc_md72"></a>
F. Editor Modularization</h3>
<p><b>Status</b>: Future <b>Priority</b>: LOW <b>Effort</b>: Large (1-2 weeks) <b>Impact</b>: Parallel development, isolated testing</p>
<p><b>Concept</b>: </p><div class="fragment"><div class="line">yaze_editor_dungeon:</div>
<div class="line">└─→ Only dungeon editor code</div>
<div class="line"> </div>
<div class="line">yaze_editor_overworld:</div>
<div class="line">└─→ Only overworld editor code</div>
<div class="line"> </div>
<div class="line">yaze_editor_system:</div>
<div class="line">└─→ Settings, commands, workspace</div>
<div class="line"> </div>
<div class="line">yaze_editor (INTERFACE):</div>
<div class="line">└─→ Aggregates all editor modules</div>
</div><!-- fragment --><p><b>Benefits</b>:</p><ul>
<li>Parallel development on different editors</li>
<li>Isolated testing per editor</li>
<li>Faster incremental builds</li>
</ul>
<p><b>Defer</b>: After zelda3 refactoring, test separation complete</p>
<h3><a class="anchor" id="autotoc_md73"></a>
G. Precompiled Headers Optimization</h3>
<p><b>Status</b>: Future <b>Priority</b>: LOW <b>Effort</b>: Small (1 day) <b>Impact</b>: 10-20% faster full rebuilds</p>
<p><b>Current</b>: PCH in <code><a class="el" href="../../d9/d21/yaze__pch_8h.html">src/yaze_pch.h</a></code> but not fully optimized</p>
<p><b>Improvements</b>:</p><ul>
<li>Split into foundation PCH and app PCH</li>
<li>More aggressive PCH usage</li>
<li>Benchmark impact</li>
</ul>
<h3><a class="anchor" id="autotoc_md74"></a>
H. Unity Builds for Third-Party Code</h3>
<p><b>Status</b>: Future <b>Priority</b>: LOW <b>Effort</b>: Small (1 day) <b>Impact</b>: Faster clean builds</p>
<p><b>Concept</b>: Combine multiple translation units for faster compilation</p>
<hr  />
<h1><a class="anchor" id="autotoc_md76"></a>
5. Conditional Compilation Matrix</h1>
<h2><a class="anchor" id="autotoc_md77"></a>
Build Configurations</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration   </th><th class="markdownTableHeadNone">Purpose   </th><th class="markdownTableHeadNone">Test Dashboard   </th><th class="markdownTableHeadNone">Agent   </th><th class="markdownTableHeadNone">gRPC   </th><th class="markdownTableHeadNone">ROM Tests    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Debug</b>   </td><td class="markdownTableBodyNone">Local development   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">❌ OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Debug-AI</b>   </td><td class="markdownTableBodyNone">AI feature development   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">❌ OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Release</b>   </td><td class="markdownTableBodyNone">Production   </td><td class="markdownTableBodyNone">❌ OFF   </td><td class="markdownTableBodyNone">❌ OFF   </td><td class="markdownTableBodyNone">❌ OFF   </td><td class="markdownTableBodyNone">❌ OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>CI-Linux</b>   </td><td class="markdownTableBodyNone">Ubuntu CI/CD   </td><td class="markdownTableBodyNone">❌ OFF   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">❌ OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>CI-Windows</b>   </td><td class="markdownTableBodyNone">Windows CI/CD   </td><td class="markdownTableBodyNone">❌ OFF   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">❌ OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>CI-macOS</b>   </td><td class="markdownTableBodyNone">macOS CI/CD   </td><td class="markdownTableBodyNone">❌ OFF   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">❌ OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Dev-ROM</b>   </td><td class="markdownTableBodyNone">ROM testing   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">ON   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md78"></a>
Feature Flags</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Flag   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Effect    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>YAZE_BUILD_APP</code>   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">Build main application    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>YAZE_BUILD_Z3ED</code>   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">Build CLI tool    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>YAZE_BUILD_EMU</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Build standalone emulator    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>YAZE_BUILD_TESTS</code>   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">Build test suites    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>YAZE_BUILD_LIB</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Build C API library    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>YAZE_WITH_GRPC</code>   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">Enable gRPC (networking)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>YAZE_WITH_JSON</code>   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">Enable JSON (AI services)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>YAZE_WITH_TEST_DASHBOARD</code>   </td><td class="markdownTableBodyNone">ON   </td><td class="markdownTableBodyNone">Include test dashboard in app    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>YAZE_ENABLE_ROM_TESTS</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Enable ROM-dependent tests    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>YAZE_MINIMAL_BUILD</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Minimal build (no agent/tests)   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md79"></a>
Library Availability Matrix</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Library   </th><th class="markdownTableHeadNone">Always Built   </th><th class="markdownTableHeadNone">Conditional   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_util   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Foundation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_common   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Foundation    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_gfx   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Core graphics    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_gui   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Core GUI    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_zelda3   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Game logic    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_core_lib   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">ROM management    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_emulator   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">SNES emulation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_net   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">JSON/gRPC   </td><td class="markdownTableBodyNone">Networking    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_editor   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">APP   </td><td class="markdownTableBodyNone">Main editor    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_agent   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Z3ED   </td><td class="markdownTableBodyNone">CLI features    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_test_support   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">TESTS   </td><td class="markdownTableBodyNone">Test infrastructure    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_test_dashboard   </td><td class="markdownTableBodyNone">❌   </td><td class="markdownTableBodyNone">TEST_DASHBOARD   </td><td class="markdownTableBodyNone">GUI test dashboard   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md80"></a>
Executable Build Matrix</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Executable   </th><th class="markdownTableHeadNone">Build Condition   </th><th class="markdownTableHeadNone">Dependencies    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze   </td><td class="markdownTableBodyNone"><code>YAZE_BUILD_APP=ON</code>   </td><td class="markdownTableBodyNone">editor, emulator, core_lib, [agent], [test_dashboard]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">z3ed   </td><td class="markdownTableBodyNone"><code>YAZE_BUILD_Z3ED=ON</code>   </td><td class="markdownTableBodyNone">agent, core_lib, zelda3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_emu   </td><td class="markdownTableBodyNone"><code>YAZE_BUILD_EMU=ON</code>   </td><td class="markdownTableBodyNone">emulator, core_lib    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_test_stable   </td><td class="markdownTableBodyNone"><code>YAZE_BUILD_TESTS=ON</code>   </td><td class="markdownTableBodyNone">test_support, all libs    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yaze_test_gui   </td><td class="markdownTableBodyNone"><code>YAZE_BUILD_TESTS=ON</code>   </td><td class="markdownTableBodyNone">test_support, ImGuiTestEngine    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yaze_test_rom_dependent   </td><td class="markdownTableBodyNone"><code>YAZE_ENABLE_ROM_TESTS=ON</code>   </td><td class="markdownTableBodyNone">test_support + ROM   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md82"></a>
6. Migration Roadmap</h1>
<h2><a class="anchor" id="autotoc_md83"></a>
Phase 1: Foundation Fixes ( This PR)</h2>
<p><b>Timeline</b>: Immediate <b>Status</b>: In Progress</p>
<p><b>Tasks</b>:</p><ol type="1">
<li>Fix <code>BackgroundBuffer</code> constructor in <code>Arena::Arena()</code></li>
<li>Add <code>yaze_core_lib</code> dependency to <code>yaze_emulator</code></li>
<li>Document current architecture in this file</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>Ubuntu CI passes</li>
<li>No build regressions</li>
<li>Complete architectural documentation</li>
</ul>
<h2><a class="anchor" id="autotoc_md84"></a>
Phase 2: Test Separation (Next Sprint)</h2>
<p><b>Timeline</b>: 1 week <b>Status</b>: Proposed <b>Reference</b>: <a class="el" href="../../d4/d37/A2-test-dashboard-refactoring_8md.html">A2-test-dashboard-refactoring.md</a></p>
<p><b>Tasks</b>:</p><ol type="1">
<li>Create <code>src/test/framework/</code> directory structure</li>
<li>Split <code>TestManager</code> into core + dashboard</li>
<li>Move test suites to <code>src/test/suites/</code></li>
<li>Create <code>test_dashboard</code> conditional library</li>
<li>Update CMake build system</li>
<li>Update all test executables</li>
<li>Verify clean release builds</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>No circular dependencies</li>
<li>60% faster test builds</li>
<li>Cleaner release binaries</li>
<li>Isolated test framework</li>
</ul>
<h2><a class="anchor" id="autotoc_md85"></a>
Phase 3: Zelda3 Refactoring (Week 2-3)</h2>
<p><b>Timeline</b>: 1.5-2 weeks <b>Status</b>: Proposed <b>Reference</b>: <a class="el" href="../../de/d43/B6-zelda3-library-refactoring_8md.html">B6-zelda3-library-refactoring.md</a></p>
<p><b>Tasks</b>:</p><ol type="1">
<li><b>Week 1</b>: Physical move<ul>
<li>Move <code>src/app/zelda3/</code> → <code>src/zelda3/</code></li>
<li>Update all <code>#include</code> directives (300+ files)</li>
<li>Update CMake paths</li>
<li>Verify builds</li>
</ul>
</li>
<li><b>Week 2</b>: Decomposition<ul>
<li>Create 6 sub-libraries (core, sprite, dungeon, overworld, screen, music)</li>
<li>Establish dependency graph</li>
<li>Update consumers</li>
<li>Verify incremental builds</li>
</ul>
</li>
<li><b>Week 3</b>: Testing &amp; Documentation<ul>
<li>Update test suite organization</li>
<li>Benchmark build times</li>
<li>Update documentation</li>
<li>Migration guide</li>
</ul>
</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>Proper top-level shared library</li>
<li>70% faster zelda3 incremental builds</li>
<li>Clear domain boundaries</li>
<li>Legacy code isolated</li>
</ul>
<h2><a class="anchor" id="autotoc_md86"></a>
Phase 4: Core Library Split (Week 4)</h2>
<p><b>Timeline</b>: 1 week <b>Status</b>: Proposed <b>Reference</b>: Section 4.2.D (this document)</p>
<p><b>Tasks</b>:</p><ol type="1">
<li>Create <code>yaze_core_foundation</code> library<ul>
<li>Move ROM, window, asar, platform utilities</li>
<li>Dependencies: util, common, SDL2, asar</li>
</ul>
</li>
<li>Create <code>yaze_core_services</code> library<ul>
<li>Move project, controller, gRPC services</li>
<li>Dependencies: core_foundation, gfx, zelda3</li>
</ul>
</li>
<li>Update <code>yaze_core_lib</code> INTERFACE<ul>
<li>Aggregate foundation + services</li>
</ul>
</li>
<li>Update all consumers<ul>
<li>Verify dependency chains</li>
<li>No circular dependencies</li>
</ul>
</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>Prevents future circular dependencies</li>
<li>Cleaner separation of concerns</li>
<li>Minimal CLI can use foundation only</li>
</ul>
<h2><a class="anchor" id="autotoc_md87"></a>
Phase 5: Agent Split (Week 5)</h2>
<p><b>Timeline</b>: 1 week <b>Status</b>: Proposed <b>Reference</b>: Section 4.2.E (this document)</p>
<p><b>Tasks</b>:</p><ol type="1">
<li>Create <code>yaze_agent_core</code> library<ul>
<li>Command registry, TUI, parsers</li>
<li>Dependencies: util, common, ftxui</li>
</ul>
</li>
<li>Create <code>yaze_agent_services</code> library<ul>
<li>AI services, GUI automation, emulator integration</li>
<li>Dependencies: agent_core, all yaze libs</li>
</ul>
</li>
<li>Update <code>z3ed</code> executable<ul>
<li>Link minimal agent_core by default</li>
<li>Optional full services</li>
</ul>
</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>80% smaller CLI binary</li>
<li>50% faster CLI development</li>
<li>Server-friendly minimal agent</li>
</ul>
<h2><a class="anchor" id="autotoc_md88"></a>
Phase 6: Benchmarking &amp; Optimization (Week 6)</h2>
<p><b>Timeline</b>: 3-4 days <b>Status</b>: Future</p>
<p><b>Tasks</b>:</p><ol type="1">
<li>Benchmark build times<ul>
<li>Before vs after comparisons</li>
<li>Common development scenarios</li>
<li>CI/CD pipeline times</li>
</ul>
</li>
<li>Profile bottlenecks<ul>
<li>Identify remaining slow builds</li>
<li>Measure header include costs</li>
<li>Analyze link times</li>
</ul>
</li>
<li>Optimize as needed<ul>
<li>PCH improvements</li>
<li>Unity builds for third-party</li>
<li>Parallel build tuning</li>
</ul>
</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>Data-driven optimization</li>
<li>Documented build time improvements</li>
<li>Tuned build system</li>
</ul>
<h2><a class="anchor" id="autotoc_md89"></a>
Phase 7: Documentation &amp; Polish (Week 7)</h2>
<p><b>Timeline</b>: 2-3 days <b>Status</b>: Future</p>
<p><b>Tasks</b>:</p><ol type="1">
<li>Update all documentation<ul>
<li>Architecture diagrams</li>
<li>Build guides</li>
<li>Migration guides</li>
</ul>
</li>
<li>Create developer onboarding<ul>
<li>Quick start guide</li>
<li>Common workflows</li>
<li>Troubleshooting</li>
</ul>
</li>
<li>CI/CD optimization<ul>
<li>Parallel build strategies</li>
<li>Caching improvements</li>
<li>Test parallelization</li>
</ul>
</li>
</ol>
<p><b>Expected Outcome</b>:</p><ul>
<li>Complete documentation</li>
<li>Smooth onboarding</li>
<li>Optimized CI/CD</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md91"></a>
7. Expected Build Time Improvements</h1>
<h2><a class="anchor" id="autotoc_md92"></a>
Baseline Measurements (Current)</h2>
<p>Measured on Apple M1 Max, 32 GB RAM, macOS 14.0</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Scenario   </th><th class="markdownTableHeadNone">Current Time   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clean build (all features)   </td><td class="markdownTableBodyNone">8-10 min   </td><td class="markdownTableBodyNone">Debug, gRPC, JSON, Tests    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Clean build (minimal)   </td><td class="markdownTableBodyNone">5-6 min   </td><td class="markdownTableBodyNone">No tests, no agent    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Incremental (gfx change)   </td><td class="markdownTableBodyNone">2-3 min   </td><td class="markdownTableBodyNone">Rebuilds 20+ libs    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Incremental (zelda3 change)   </td><td class="markdownTableBodyNone">1-2 min   </td><td class="markdownTableBodyNone">Rebuilds 8+ libs    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Incremental (test change)   </td><td class="markdownTableBodyNone">45-60 sec   </td><td class="markdownTableBodyNone">Circular rebuild    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Incremental (editor change)   </td><td class="markdownTableBodyNone">1-2 min   </td><td class="markdownTableBodyNone">Many dependents   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md93"></a>
Projected Improvements (After All Refactoring)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Scenario   </th><th class="markdownTableHeadNone">Projected Time   </th><th class="markdownTableHeadNone">Savings   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Clean build (all features)   </td><td class="markdownTableBodyNone">7-8 min   </td><td class="markdownTableBodyNone">15-20%   </td><td class="markdownTableBodyNone">Better parallelization    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Clean build (minimal)   </td><td class="markdownTableBodyNone">3-4 min   </td><td class="markdownTableBodyNone">35-40%   </td><td class="markdownTableBodyNone">Fewer conditional libs    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Incremental (gfx change)   </td><td class="markdownTableBodyNone">30-45 sec   </td><td class="markdownTableBodyNone"><b>75-80%</b>   </td><td class="markdownTableBodyNone">Isolated gfx changes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Incremental (zelda3 change)   </td><td class="markdownTableBodyNone">20-30 sec   </td><td class="markdownTableBodyNone"><b>70-75%</b>   </td><td class="markdownTableBodyNone">Sub-library isolation    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Incremental (test change)   </td><td class="markdownTableBodyNone">15-20 sec   </td><td class="markdownTableBodyNone"><b>65-70%</b>   </td><td class="markdownTableBodyNone">No circular rebuild    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Incremental (editor change)   </td><td class="markdownTableBodyNone">30-45 sec   </td><td class="markdownTableBodyNone"><b>60-65%</b>   </td><td class="markdownTableBodyNone">Modular editors   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md94"></a>
CI/CD Improvements</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pipeline   </th><th class="markdownTableHeadNone">Current   </th><th class="markdownTableHeadNone">Projected   </th><th class="markdownTableHeadNone">Savings    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Ubuntu stable tests   </td><td class="markdownTableBodyNone">12-15 min   </td><td class="markdownTableBodyNone">8-10 min   </td><td class="markdownTableBodyNone"><b>30-35%</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">macOS stable tests   </td><td class="markdownTableBodyNone">15-18 min   </td><td class="markdownTableBodyNone">10-12 min   </td><td class="markdownTableBodyNone"><b>30-35%</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows stable tests   </td><td class="markdownTableBodyNone">18-22 min   </td><td class="markdownTableBodyNone">12-15 min   </td><td class="markdownTableBodyNone"><b>30-35%</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Full matrix (3 platforms)   </td><td class="markdownTableBodyNone">45-55 min   </td><td class="markdownTableBodyNone">30-37 min   </td><td class="markdownTableBodyNone"><b>30-35%</b>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md95"></a>
Developer Experience Improvements</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Workflow   </th><th class="markdownTableHeadNone">Current   </th><th class="markdownTableHeadNone">Projected   </th><th class="markdownTableHeadNone">Impact    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Fix gfx bug → test   </td><td class="markdownTableBodyNone">3-4 min   </td><td class="markdownTableBodyNone">45-60 sec   </td><td class="markdownTableBodyNone"><b>Much faster iteration</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Add zelda3 feature → test   </td><td class="markdownTableBodyNone">2-3 min   </td><td class="markdownTableBodyNone">30-45 sec   </td><td class="markdownTableBodyNone"><b>Rapid prototyping</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Modify test → verify   </td><td class="markdownTableBodyNone">60-90 sec   </td><td class="markdownTableBodyNone">20-30 sec   </td><td class="markdownTableBodyNone"><b>Tight feedback loop</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CLI-only development   </td><td class="markdownTableBodyNone">Rebuilds GUI!   </td><td class="markdownTableBodyNone">No GUI rebuild   </td><td class="markdownTableBodyNone"><b>Isolated development</b>   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md97"></a>
8. Detailed Library Specifications</h1>
<h2><a class="anchor" id="autotoc_md98"></a>
8.1 Foundation Libraries</h2>
<h3><a class="anchor" id="autotoc_md99"></a>
yaze_common</h3>
<p><b>Purpose</b>: Platform definitions, common macros <b>Location</b>: <code>src/common/</code> <b>Source Files</b>: (header-only) <b>Dependencies</b>: None <b>Dependents</b>: All libraries (foundation) <b>Build Impact</b>: Header-only, minimal <b>Priority</b>: N/A (stable)</p>
<h3><a class="anchor" id="autotoc_md100"></a>
yaze_util</h3>
<p><b>Purpose</b>: Logging, file I/O, SDL utilities <b>Location</b>: <code>src/util/</code> <b>Source Files</b>: 8-10 .cc files <b>Dependencies</b>: yaze_common, absl, SDL2 <b>Dependents</b>: All libraries <b>Build Impact</b>: Changes trigger rebuild of EVERYTHING <b>Priority</b>: N/A (stable, rarely changes)</p>
<h2><a class="anchor" id="autotoc_md101"></a>
8.2 Graphics Libraries</h2>
<h3><a class="anchor" id="autotoc_md102"></a>
yaze_gfx_types</h3>
<p><b>Purpose</b>: SNES color/palette/tile data structures <b>Location</b>: <code>src/app/gfx/types/</code> <b>Source Files</b>: 3 .cc files <b>Dependencies</b>: None (foundation) <b>Dependents</b>: gfx_core, gfx_util <b>Build Impact</b>: Medium (4-6 libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md103"></a>
yaze_gfx_backend</h3>
<p><b>Purpose</b>: SDL2 renderer abstraction <b>Location</b>: <code>src/app/gfx/backend/</code> <b>Source Files</b>: 1 .cc file <b>Dependencies</b>: SDL2 <b>Dependents</b>: gfx_resource, gfx_render <b>Build Impact</b>: Low (2-3 libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md104"></a>
yaze_gfx_resource</h3>
<p><b>Purpose</b>: Memory management (Arena) <b>Location</b>: <code>src/app/gfx/resource/</code> <b>Source Files</b>: 2 .cc files <b>Dependencies</b>: gfx_backend, gfx_render (BackgroundBuffer) <b>Dependents</b>: gfx_core <b>Build Impact</b>: Medium (3-4 libs) <b>Priority</b>: DONE (refactored) <b>Note</b>: Fixed BackgroundBuffer constructor issue in this PR</p>
<h3><a class="anchor" id="autotoc_md105"></a>
yaze_gfx_core</h3>
<p><b>Purpose</b>: Bitmap class <b>Location</b>: <code>src/app/gfx/core/</code> <b>Source Files</b>: 1 .cc file <b>Dependencies</b>: gfx_types, gfx_resource <b>Dependents</b>: gfx_util, gfx_render, gui_canvas <b>Build Impact</b>: High (8+ libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md106"></a>
yaze_gfx_render</h3>
<p><b>Purpose</b>: Advanced rendering (Atlas, BackgroundBuffer) <b>Location</b>: <code>src/app/gfx/render/</code> <b>Source Files</b>: 4 .cc files <b>Dependencies</b>: gfx_core, gfx_backend <b>Dependents</b>: gfx_debug, zelda3 <b>Build Impact</b>: Medium (5-7 libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md107"></a>
yaze_gfx_util</h3>
<p><b>Purpose</b>: Compression, format conversion <b>Location</b>: <code>src/app/gfx/util/</code> <b>Source Files</b>: 4 .cc files <b>Dependencies</b>: gfx_core <b>Dependents</b>: gfx_debug, editor <b>Build Impact</b>: Medium (4-6 libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md108"></a>
yaze_gfx_debug</h3>
<p><b>Purpose</b>: Performance profiling, optimization <b>Location</b>: <code>src/app/gfx/debug/</code> <b>Source Files</b>: 3 .cc files <b>Dependencies</b>: gfx_util, gfx_render <b>Dependents</b>: editor (optional) <b>Build Impact</b>: Low (1-2 libs) <b>Priority</b>: DONE (refactored)</p>
<h2><a class="anchor" id="autotoc_md109"></a>
8.3 GUI Libraries</h2>
<h3><a class="anchor" id="autotoc_md110"></a>
yaze_gui_core</h3>
<p><b>Purpose</b>: Theme, input, style management <b>Location</b>: <code>src/app/gui/core/</code> <b>Source Files</b>: 7 .cc files <b>Dependencies</b>: yaze_util, <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a>, nlohmann_json <b>Dependents</b>: All other GUI libs <b>Build Impact</b>: High (8+ libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md111"></a>
yaze_gui_canvas</h3>
<p><b>Purpose</b>: Drawable canvas with pan/zoom <b>Location</b>: <code>src/app/gui/canvas/</code> <b>Source Files</b>: 9 .cc files <b>Dependencies</b>: gui_core, yaze_gfx <b>Dependents</b>: editor (all editors use Canvas) <b>Build Impact</b>: Very High (10+ libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md112"></a>
yaze_gui_widgets</h3>
<p><b>Purpose</b>: Reusable UI widgets <b>Location</b>: <code>src/app/gui/widgets/</code> <b>Source Files</b>: 6 .cc files <b>Dependencies</b>: gui_core, yaze_gfx <b>Dependents</b>: editor <b>Build Impact</b>: Medium (5-7 libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md113"></a>
yaze_gui_automation</h3>
<p><b>Purpose</b>: Widget discovery, state capture, testing <b>Location</b>: <code>src/app/gui/automation/</code> <b>Source Files</b>: 4 .cc files <b>Dependencies</b>: gui_core <b>Dependents</b>: gui_app, agent (GUI automation) <b>Build Impact</b>: Low (2-3 libs) <b>Priority</b>: DONE (refactored)</p>
<h3><a class="anchor" id="autotoc_md114"></a>
yaze_gui_app</h3>
<p><b>Purpose</b>: High-level app components (chat, collaboration) <b>Location</b>: <code>src/app/gui/app/</code> <b>Source Files</b>: 4 .cc files <b>Dependencies</b>: gui_core, gui_widgets, gui_automation <b>Dependents</b>: editor <b>Build Impact</b>: Low (1-2 libs) <b>Priority</b>: DONE (refactored)</p>
<h2><a class="anchor" id="autotoc_md115"></a>
8.4 Game Logic Libraries</h2>
<h3><a class="anchor" id="autotoc_md116"></a>
yaze_zelda3 (Current)</h3>
<p><b>Purpose</b>: All Zelda3 game logic <b>Location</b>: <code>src/app/zelda3/</code> Warning: (wrong location) <b>Source Files</b>: 21 .cc files (monolithic) <b>Dependencies</b>: yaze_gfx, yaze_util <b>Dependents</b>: core_lib, editor, agent <b>Build Impact</b>: Very High (any change rebuilds 8+ libs) <b>Priority</b>: HIGH (refactor per B6) 🔴 <b>Issues</b>:</p><ul>
<li>Wrong location (should be <code>src/zelda3/</code>)</li>
<li>Monolithic (should be 6 sub-libraries)</li>
</ul>
<h3><a class="anchor" id="autotoc_md117"></a>
yaze_zelda3_core (Proposed)</h3>
<p><b>Purpose</b>: Labels, constants, common data <b>Location</b>: <code>src/zelda3/</code> (after move) <b>Source Files</b>: 3-4 .cc files <b>Dependencies</b>: yaze_util <b>Dependents</b>: All other zelda3 libs <b>Build Impact</b>: High (if changed, rebuilds all zelda3) <b>Priority</b>: HIGH (implement B6) 🔴</p>
<h3><a class="anchor" id="autotoc_md118"></a>
yaze_zelda3_sprite (Proposed)</h3>
<p><b>Purpose</b>: Sprite management <b>Location</b>: <code>src/zelda3/sprite/</code> <b>Source Files</b>: 3 .cc files <b>Dependencies</b>: zelda3_core <b>Dependents</b>: zelda3_dungeon, <a class="el" href="../../d4/dbf/structzelda3__overworld.html" title="Complete overworld data.">zelda3_overworld</a> <b>Build Impact</b>: Medium (2-3 libs) <b>Priority</b>: HIGH (implement B6) 🔴</p>
<h3><a class="anchor" id="autotoc_md119"></a>
yaze_zelda3_dungeon (Proposed)</h3>
<p><b>Purpose</b>: Dungeon system <b>Location</b>: <code>src/zelda3/dungeon/</code> <b>Source Files</b>: 7 .cc files <b>Dependencies</b>: zelda3_core, zelda3_sprite <b>Dependents</b>: zelda3_screen, editor_dungeon <b>Build Impact</b>: Low (1-2 libs) <b>Priority</b>: HIGH (implement B6) 🔴</p>
<h3><a class="anchor" id="autotoc_md120"></a>
yaze_zelda3_overworld (Proposed)</h3>
<p><b>Purpose</b>: Overworld system <b>Location</b>: <code>src/zelda3/overworld/</code> <b>Source Files</b>: 2 .cc files <b>Dependencies</b>: zelda3_core, zelda3_sprite <b>Dependents</b>: zelda3_screen, editor_overworld <b>Build Impact</b>: Low (1-2 libs) <b>Priority</b>: HIGH (implement B6) 🔴</p>
<h3><a class="anchor" id="autotoc_md121"></a>
yaze_zelda3_screen (Proposed)</h3>
<p><b>Purpose</b>: Game screens (title, inventory, map) <b>Location</b>: <code>src/zelda3/screen/</code> <b>Source Files</b>: 4 .cc files <b>Dependencies</b>: zelda3_dungeon, <a class="el" href="../../d4/dbf/structzelda3__overworld.html" title="Complete overworld data.">zelda3_overworld</a> <b>Dependents</b>: editor_screen <b>Build Impact</b>: Very Low (1 lib) <b>Priority</b>: HIGH (implement B6) 🔴</p>
<h3><a class="anchor" id="autotoc_md122"></a>
yaze_zelda3_music (Proposed)</h3>
<p><b>Purpose</b>: Legacy music tracker <b>Location</b>: <code>src/zelda3/music/</code> <b>Source Files</b>: 1 .cc file (legacy C code) <b>Dependencies</b>: zelda3_core <b>Dependents</b>: editor_music <b>Build Impact</b>: Very Low (1 lib) <b>Priority</b>: HIGH (implement B6) 🔴</p>
<h2><a class="anchor" id="autotoc_md123"></a>
8.5 Core System Libraries</h2>
<h3><a class="anchor" id="autotoc_md124"></a>
yaze_core_lib (Current)</h3>
<p><b>Purpose</b>: ROM, window, asar, project, services <b>Location</b>: <code>src/app/core/</code> <b>Source Files</b>: 10+ .cc files (mixed concerns) Warning: <b>Dependencies</b>: yaze_util, yaze_gfx, yaze_zelda3, <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a>, asar, SDL2, [gRPC] <b>Dependents</b>: editor, agent, emulator, net <b>Build Impact</b>: Very High (10+ libs) <b>Priority</b>: MEDIUM (split into foundation + services) 🟡 <b>Issues</b>:</p><ul>
<li>Mixed concerns (foundation vs services)</li>
<li>Potential circular dependency with gfx</li>
</ul>
<h3><a class="anchor" id="autotoc_md125"></a>
yaze_core_foundation (Proposed)</h3>
<p><b>Purpose</b>: ROM, window, asar, platform utilities <b>Location</b>: <code>src/app/core/</code> <b>Source Files</b>: 6-7 .cc files <b>Dependencies</b>: yaze_util, yaze_common, asar, SDL2 <b>Dependents</b>: core_services, emulator, agent_core <b>Build Impact</b>: Medium (5-7 libs) <b>Priority</b>: MEDIUM (implement section 4.2.D) 🟡</p>
<h3><a class="anchor" id="autotoc_md126"></a>
yaze_core_services (Proposed)</h3>
<p><b>Purpose</b>: Project, controller, gRPC services <b>Location</b>: <code>src/app/core/</code> <b>Source Files</b>: 4-5 .cc files <b>Dependencies</b>: core_foundation, yaze_gfx, yaze_zelda3, <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a>, [gRPC] <b>Dependents</b>: editor, agent_services <b>Build Impact</b>: Medium (4-6 libs) <b>Priority</b>: MEDIUM (implement section 4.2.D) 🟡</p>
<h3><a class="anchor" id="autotoc_md127"></a>
yaze_emulator</h3>
<p><b>Purpose</b>: SNES emulation (CPU, PPU, APU) <b>Location</b>: <code>src/app/emu/</code> <b>Source Files</b>: 30+ .cc files <b>Dependencies</b>: yaze_util, yaze_common, yaze_core_lib, absl, SDL2 <b>Dependents</b>: editor, agent (emulator commands) <b>Build Impact</b>: Medium (3-5 libs) <b>Priority</b>: LOW (stable) <b>Note</b>: Fixed missing core_lib dependency in this PR</p>
<h3><a class="anchor" id="autotoc_md128"></a>
yaze_net</h3>
<p><b>Purpose</b>: Networking, collaboration <b>Location</b>: <code>src/app/net/</code> <b>Source Files</b>: 3 .cc files <b>Dependencies</b>: yaze_util, yaze_common, absl, [OpenSSL], [gRPC] <b>Dependents</b>: gui (collaboration panel) <b>Build Impact</b>: Low (1-2 libs) <b>Priority</b>: LOW (stable)</p>
<h2><a class="anchor" id="autotoc_md129"></a>
8.6 Application Layer Libraries</h2>
<h3><a class="anchor" id="autotoc_md130"></a>
yaze_editor</h3>
<p><b>Purpose</b>: All editor functionality <b>Location</b>: <code>src/app/editor/</code> <b>Source Files</b>: 45+ .cc files (large, complex) <b>Dependencies</b>: core_lib, gfx, gui, zelda3, emulator, util, common, <a class="el" href="../../df/de4/namespaceImGui.html">ImGui</a>, [agent], [test_support] <b>Dependents</b>: test_support, yaze app <b>Build Impact</b>: Very High (ANY change affects main app + tests) <b>Priority</b>: LOW-FUTURE (modularize per section 4.3.F) 🔵 <b>Issues</b>:</p><ul>
<li>Too many dependencies (8+ major libs)</li>
<li>Circular dependency with test_support</li>
</ul>
<h3><a class="anchor" id="autotoc_md131"></a>
yaze_agent (Current)</h3>
<p><b>Purpose</b>: CLI functionality, AI services <b>Location</b>: <code>src/cli/</code> <b>Source Files</b>: 60+ .cc files (massive) Warning: <b>Dependencies</b>: common, util, gfx, gui, core_lib, zelda3, emulator, absl, yaml, ftxui, [gRPC], [JSON], [OpenSSL] <b>Dependents</b>: editor (agent integration), z3ed <b>Build Impact</b>: Very High (15+ libs) <b>Priority</b>: MEDIUM (split into core + services) 🟡 <b>Issues</b>:</p><ul>
<li>Links to entire application stack</li>
<li>CLI tool rebuilds on GUI changes</li>
</ul>
<h3><a class="anchor" id="autotoc_md132"></a>
yaze_agent_core (Proposed)</h3>
<p><b>Purpose</b>: Minimal CLI (commands, TUI, parsing) <b>Location</b>: <code>src/cli/</code> <b>Source Files</b>: 20-25 .cc files <b>Dependencies</b>: common, util, ftxui, yaml <b>Dependents</b>: agent_services, z3ed <b>Build Impact</b>: Low (2-3 libs) <b>Priority</b>: MEDIUM (implement section 4.2.E) 🟡</p>
<h3><a class="anchor" id="autotoc_md133"></a>
yaze_agent_services (Proposed)</h3>
<p><b>Purpose</b>: Full CLI features (AI, GUI automation, emulator) <b>Location</b>: <code>src/cli/</code> <b>Source Files</b>: 35-40 .cc files <b>Dependencies</b>: agent_core, gfx, gui, core_lib, zelda3, emulator, [gRPC], [JSON], [OpenSSL] <b>Dependents</b>: editor (agent integration), z3ed (optional) <b>Build Impact</b>: High (10+ libs) <b>Priority</b>: MEDIUM (implement section 4.2.E) 🟡</p>
<h3><a class="anchor" id="autotoc_md134"></a>
yaze_test_support (Current)</h3>
<p><b>Purpose</b>: Test manager + test suites <b>Location</b>: <code>src/app/test/</code> <b>Source Files</b>: 2 .cc files (mixed concerns) Warning: <b>Dependencies</b>: editor, core_lib, gui, zelda3, gfx, util, common, agent <b>Dependents</b>: editor (CIRCULAR Warning:), all test executables <b>Build Impact</b>: Very High (10+ libs) <b>Priority</b>: HIGH (separate per A2) 🔴 <b>Issues</b>:</p><ul>
<li>Circular dependency with editor</li>
<li>Cannot exclude from release builds</li>
<li>Mixes core logic with GUI</li>
</ul>
<h3><a class="anchor" id="autotoc_md135"></a>
yaze_test_framework (Proposed)</h3>
<p><b>Purpose</b>: Core test infrastructure (no GUI) <b>Location</b>: <code>src/test/framework/</code> <b>Source Files</b>: 1 .cc file <b>Dependencies</b>: yaze_util, absl <b>Dependents</b>: test_suites, test_dashboard <b>Build Impact</b>: Low (2-3 libs) <b>Priority</b>: HIGH (implement A2) 🔴</p>
<h3><a class="anchor" id="autotoc_md136"></a>
yaze_test_suites (Proposed)</h3>
<p><b>Purpose</b>: Actual test implementations <b>Location</b>: <code>src/test/suites/</code> <b>Source Files</b>: 1 .cc file <b>Dependencies</b>: test_framework, specific yaze libs (what's being tested) <b>Dependents</b>: test executables <b>Build Impact</b>: Low (1-2 libs per suite) <b>Priority</b>: HIGH (implement A2) 🔴</p>
<h3><a class="anchor" id="autotoc_md137"></a>
yaze_test_dashboard (Proposed)</h3>
<p><b>Purpose</b>: In-app test GUI (optional) <b>Location</b>: <code>src/app/gui/testing/</code> <b>Source Files</b>: 1-2 .cc files <b>Dependencies</b>: test_framework, yaze_gui <b>Dependents</b>: yaze app (conditionally) <b>Build Impact</b>: Low (1 lib) <b>Priority</b>: HIGH (implement A2) 🔴 <b>Conditional</b>: <code>YAZE_WITH_TEST_DASHBOARD=ON</code></p>
<hr  />
<h1><a class="anchor" id="autotoc_md139"></a>
9. References &amp; Related Documents</h1>
<h2><a class="anchor" id="autotoc_md140"></a>
Primary Documents</h2>
<ul>
<li><b><a class="el" href="../../d2/d2a/C4-z3ed-refactoring_8md.html">C4-z3ed-refactoring.md</a></b>: CLI command abstraction (COMPLETED )</li>
<li><b><a class="el" href="../../de/d43/B6-zelda3-library-refactoring_8md.html">B6-zelda3-library-refactoring.md</a></b>: Zelda3 move &amp; decomposition (PROPOSED 🔴)</li>
<li><b><a class="el" href="../../d4/d37/A2-test-dashboard-refactoring_8md.html">A2-test-dashboard-refactoring.md</a></b>: Test infrastructure separation (PROPOSED 🔴)</li>
<li><b>This Document (A1)</b>: Comprehensive dependency analysis (NEW 📄)</li>
</ul>
<h2><a class="anchor" id="autotoc_md141"></a>
Related Refactoring Documents</h2>
<ul>
<li><b>docs/gfx-refactor.md</b>: Graphics tier decomposition (COMPLETED )</li>
<li><b>docs/gui-refactor.md</b>: GUI tier decomposition (COMPLETED )</li>
<li><b><a class="el" href="../../dd/de3/G3-renderer-migration-complete_8md.html">docs/G3-renderer-migration-complete.md</a></b>: Renderer abstraction (COMPLETED )</li>
</ul>
<h2><a class="anchor" id="autotoc_md142"></a>
Build System Documentation</h2>
<ul>
<li><b>Root CMakeLists.txt</b>: Main build configuration</li>
<li><b>src/CMakeLists.txt</b>: Library orchestration</li>
<li><b>test/CMakeLists.txt</b>: Test suite configuration</li>
<li><b><a class="el" href="../../d6/d2d/build__cleaner_8py.html">scripts/build_cleaner.py</a></b>: Automated source list maintenance</li>
</ul>
<h2><a class="anchor" id="autotoc_md143"></a>
Architecture Documentation</h2>
<ul>
<li><b>docs/CLAUDE.md</b>: Project overview and guidelines</li>
<li><b><a class="el" href="../../dd/df6/B2-platform-compatibility_8md.html">docs/B2-platform-compatibility.md</a></b>: Platform notes, Windows Clang workarounds, and CI/CD guidance</li>
<li><b><a class="el" href="../../d6/da4/B4-git-workflow_8md.html">docs/B4-git-workflow.md</a></b>: Git workflow and branching</li>
</ul>
<h2><a class="anchor" id="autotoc_md144"></a>
External Resources</h2>
<ul>
<li><a href="https://cmake.org/documentation/">CMake Documentation</a></li>
<li><a href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide</a></li>
<li><a href="https://abseil.io/">Abseil C++ Libraries</a></li>
<li><a href="https://wiki.libsdl.org/">SDL2 Documentation</a></li>
<li><a href="https://github.com/ocornut/imgui">ImGui Documentation</a></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md146"></a>
10. Conclusion</h1>
<p>This document provides a comprehensive analysis of YAZE's dependency architecture and proposes a clear roadmap for optimization. The key takeaways are:</p>
<ol type="1">
<li><b>Current State</b>: Complex interdependencies causing slow builds</li>
<li><b>Root Causes</b>: Circular dependencies, over-linking, misplaced components</li>
<li><b>Solution</b>: Execute existing proposals (A2, B6) + new splits (core_lib, agent)</li>
<li><b>Expected Impact</b>: 40-60% faster incremental builds, cleaner architecture</li>
<li><b>Timeline</b>: 6-7 weeks for complete refactoring</li>
</ol>
<p>By following this roadmap, YAZE will achieve:</p><ul>
<li>Faster development iteration</li>
<li>Cleaner architecture</li>
<li>Better testability</li>
<li>Easier maintenance</li>
<li>Improved CI/CD performance</li>
</ul>
<p>The proposed changes are backwards-compatible and can be implemented incrementally without disrupting ongoing development.</p>
<hr  />
<p><b>Document Version</b>: 1.0 <b>Last Updated</b>: 2025-10-13 <b>Maintainer</b>: YAZE Development Team <b>Status</b>: Living Document (update as architecture evolves) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
