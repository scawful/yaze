<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Dungeon Object System</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.1</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d11/md_docs_2E5-dungeon-object-system.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Dungeon Object System</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md739"></a> </p>
<h1><a class="anchor" id="autotoc_md740"></a>
Overview</h1>
<p>The Dungeon Object System provides a comprehensive framework for editing and managing dungeon rooms, objects, and layouts in The Legend of Zelda: A Link to the Past. This system combines real-time visual editing with precise data manipulation to create a powerful dungeon creation and modification toolkit.</p>
<h1><a class="anchor" id="autotoc_md741"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md742"></a>
Core Components</h2>
<p>The dungeon system is built around several key components that work together to provide a seamless editing experience:</p>
<h3><a class="anchor" id="autotoc_md743"></a>
1. DungeonEditor (&lt;tt&gt;src/app/editor/dungeon/dungeon_editor.h&lt;/tt&gt;)</h3>
<p>The main interface that orchestrates all dungeon editing functionality. It provides:</p><ul>
<li><b>Windowed Canvas System</b>: Fixed-size canvas that prevents UI layout disruption</li>
<li><b>Tabbed Room Interface</b>: Multiple rooms can be open simultaneously for easy comparison and editing</li>
<li><b>Integrated Object Placement</b>: Direct object placement from selector to canvas</li>
<li><b>Real-time Preview</b>: Live object preview follows mouse cursor during placement</li>
</ul>
<h3><a class="anchor" id="autotoc_md744"></a>
2. DungeonObjectSelector (&lt;tt&gt;src/app/editor/dungeon/dungeon_object_selector.h&lt;/tt&gt;)</h3>
<p>Combines object browsing and editing in a unified interface:</p><ul>
<li><b>Object Browser</b>: Visual grid of all available objects with real-time previews</li>
<li><b>Object Editor</b>: Integrated editing panels for sprites, items, entrances, doors, and chests</li>
<li><b>Callback System</b>: Notifies main editor when objects are selected for placement</li>
</ul>
<h3><a class="anchor" id="autotoc_md745"></a>
3. DungeonCanvasViewer (&lt;tt&gt;src/app/editor/dungeon/dungeon_canvas_viewer.h&lt;/tt&gt;)</h3>
<p>Specialized canvas for rendering dungeon rooms:</p><ul>
<li><b>Background Layer Rendering</b>: Proper BG1/BG2 layer composition</li>
<li><b>Object Rendering</b>: Cached object rendering with palette support</li>
<li><b>Coordinate System</b>: Seamless translation between room and canvas coordinates</li>
</ul>
<h3><a class="anchor" id="autotoc_md746"></a>
4. Room Management System (&lt;tt&gt;src/app/zelda3/dungeon/room.h&lt;/tt&gt;)</h3>
<p>Core data structures for room representation:</p><ul>
<li><b>Room Objects</b>: Tile-based objects (walls, floors, decorations)</li>
<li><b>Room Layout</b>: Structural elements and collision data</li>
<li><b>Sprites</b>: Enemy and NPC placement</li>
<li><b>Entrances/Exits</b>: Room connections and transitions</li>
</ul>
<h1><a class="anchor" id="autotoc_md747"></a>
Object Types and Hierarchies</h1>
<h2><a class="anchor" id="autotoc_md748"></a>
Room Objects</h2>
<p>Room objects are the fundamental building blocks of dungeon rooms. They follow a hierarchical structure:</p>
<h3><a class="anchor" id="autotoc_md749"></a>
Type 1 Objects (0x00-0xFF)</h3>
<p>Basic structural elements:</p><ul>
<li><b>0x10-0x1F</b>: Wall objects (various types and orientations)</li>
<li><b>0x20-0x2F</b>: Floor tiles (stone, wood, carpet, etc.)</li>
<li><b>0x30-0x3F</b>: Decorative elements (torches, statues, pillars)</li>
<li><b>0x40-0x4F</b>: Interactive elements (switches, blocks)</li>
</ul>
<h3><a class="anchor" id="autotoc_md750"></a>
Type 2 Objects (0x100-0x1FF)</h3>
<p>Complex multi-tile objects:</p><ul>
<li><b>0x100-0x10F</b>: Large wall sections</li>
<li><b>0x110-0x11F</b>: Complex floor patterns</li>
<li><b>0x120-0x12F</b>: Multi-tile decorations</li>
</ul>
<h3><a class="anchor" id="autotoc_md751"></a>
Type 3 Objects (0x200+)</h3>
<p>Special dungeon-specific objects:</p><ul>
<li><b>0x200-0x20F</b>: Boss room elements</li>
<li><b>0x210-0x21F</b>: Puzzle-specific objects</li>
<li><b>0xF9-0xFA</b>: Chests (small and large)</li>
</ul>
<h2><a class="anchor" id="autotoc_md752"></a>
Object Properties</h2>
<p>Each object has several key properties:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>RoomObject {</div>
<div class="line">  <span class="keywordtype">int</span> id_;           <span class="comment">// Object type identifier</span></div>
<div class="line">  <span class="keywordtype">int</span> x_, y_;        <span class="comment">// Position in room (16x16 tile units)</span></div>
<div class="line">  <span class="keywordtype">int</span> size_;         <span class="comment">// Size modifier (affects rendering)</span></div>
<div class="line">  LayerType layer_; <span class="comment">// Rendering layer (0=BG, 1=MID, 2=FG)</span></div>
<div class="line">  <span class="comment">// ... additional properties</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md753"></a>
How Object Placement Works</h1>
<h2><a class="anchor" id="autotoc_md754"></a>
Selection Process</h2>
<ol type="1">
<li><b>Object Browser</b>: User selects an object from the visual grid</li>
<li><b>Preview Generation</b>: Object is rendered with current room palette</li>
<li><b>Callback Trigger</b>: Selection notifies main editor via callback</li>
<li><b>Preview Update</b>: Main editor receives object and enables placement mode</li>
</ol>
<h2><a class="anchor" id="autotoc_md755"></a>
Placement Process</h2>
<ol type="1">
<li><b>Mouse Tracking</b>: Preview object follows mouse cursor on canvas</li>
<li><b>Coordinate Translation</b>: Mouse position converted to room coordinates</li>
<li><b>Visual Feedback</b>: Semi-transparent preview shows placement position</li>
<li><b>Click Placement</b>: Left-click places object at current position</li>
<li><b>Room Update</b>: Object added to room data and cache cleared for redraw</li>
</ol>
<h2><a class="anchor" id="autotoc_md756"></a>
Code Flow</h2>
<div class="fragment"><div class="line"><span class="comment">// Object selection in DungeonObjectSelector</span></div>
<div class="line"><span class="keywordflow">if</span> (ImGui::Selectable(<span class="stringliteral">&quot;&quot;</span>, is_selected)) {</div>
<div class="line">  preview_object_ = selected_object;</div>
<div class="line">  object_loaded_ = <span class="keyword">true</span>;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Notify main editor</span></div>
<div class="line">  <span class="keywordflow">if</span> (object_selected_callback_) {</div>
<div class="line">    object_selected_callback_(preview_object_);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Object placement in DungeonEditor</span></div>
<div class="line"><span class="keywordtype">void</span> PlaceObjectAtPosition(<span class="keywordtype">int</span> room_x, <span class="keywordtype">int</span> room_y) {</div>
<div class="line">  <span class="keyword">auto</span> new_object = preview_object_;</div>
<div class="line">  new_object.x_ = room_x;</div>
<div class="line">  new_object.y_ = room_y;</div>
<div class="line">  new_object.set_rom(rom_);</div>
<div class="line">  new_object.EnsureTilesLoaded();</div>
<div class="line">  </div>
<div class="line">  room.AddTileObject(new_object);</div>
<div class="line">  object_render_cache_.clear(); <span class="comment">// Force redraw</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md757"></a>
Rendering Pipeline</h1>
<h2><a class="anchor" id="autotoc_md758"></a>
Object Rendering</h2>
<p>The system uses a sophisticated rendering pipeline:</p>
<ol type="1">
<li><b>Tile Loading</b>: Object tiles loaded from ROM based on object ID</li>
<li><b>Palette Application</b>: Room-specific palette applied to object</li>
<li><b>Bitmap Generation</b>: Object rendered to bitmap with proper composition</li>
<li><b>Caching</b>: Rendered objects cached for performance</li>
<li><b>Canvas Drawing</b>: Bitmap drawn to canvas at correct position</li>
</ol>
<h2><a class="anchor" id="autotoc_md759"></a>
Performance Optimizations</h2>
<ul>
<li><b>Render Caching</b>: Objects cached based on ID, position, size, and palette hash</li>
<li><b>Bounds Checking</b>: Only objects within canvas bounds are rendered</li>
<li><b>Lazy Loading</b>: Graphics and objects loaded on-demand</li>
<li><b>Palette Hashing</b>: Efficient cache invalidation when palettes change</li>
</ul>
<h1><a class="anchor" id="autotoc_md760"></a>
User Interface Components</h1>
<h2><a class="anchor" id="autotoc_md761"></a>
Three-Column Layout</h2>
<p>The dungeon editor uses a carefully designed three-column layout:</p>
<h3><a class="anchor" id="autotoc_md762"></a>
Column 1: Room Control Panel (280px fixed)</h3>
<ul>
<li><b>Room Selector</b>: Browse and select rooms</li>
<li><b>Debug Controls</b>: Room properties in table format</li>
<li><b>Object Statistics</b>: Live object counts and cache status</li>
</ul>
<h3><a class="anchor" id="autotoc_md763"></a>
Column 2: Windowed Canvas (800px fixed)</h3>
<ul>
<li><b>Tabbed Interface</b>: Multiple rooms open simultaneously</li>
<li><b>Fixed Dimensions</b>: Prevents UI layout disruption</li>
<li><b>Real-time Preview</b>: Object placement preview follows cursor</li>
<li><b>Layer Visualization</b>: Proper background/foreground rendering</li>
</ul>
<h3><a class="anchor" id="autotoc_md764"></a>
Column 3: Object Selector/Editor (stretch)</h3>
<ul>
<li><b>Object Browser Tab</b>: Visual grid of available objects</li>
<li><b>Object Editor Tab</b>: Integrated editing for sprites, items, etc.</li>
<li><b>Placement Tools</b>: Object property editing and placement controls</li>
</ul>
<h2><a class="anchor" id="autotoc_md765"></a>
Debug and Control Features</h2>
<h3><a class="anchor" id="autotoc_md766"></a>
Room Properties Table</h3>
<p>Real-time editing of room attributes: </p><div class="fragment"><div class="line">Property    | Value</div>
<div class="line">------------|--------</div>
<div class="line">Room ID     | 0x001 (1)</div>
<div class="line">Layout      | [Hex Input]</div>
<div class="line">Blockset    | [Hex Input]</div>
<div class="line">Spriteset   | [Hex Input]</div>
<div class="line">Palette     | [Hex Input]</div>
<div class="line">Floor 1     | [Hex Input]</div>
<div class="line">Floor 2     | [Hex Input]</div>
<div class="line">Message ID  | [Hex Input]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md767"></a>
Object Statistics</h3>
<p>Live feedback on room contents:</p><ul>
<li>Total objects count</li>
<li>Layout objects count</li>
<li>Sprites count</li>
<li>Chests count</li>
<li>Cache status and controls</li>
</ul>
<h1><a class="anchor" id="autotoc_md768"></a>
Integration with ROM Data</h1>
<h2><a class="anchor" id="autotoc_md769"></a>
Data Sources</h2>
<p>The system integrates with multiple ROM data sources:</p>
<h3><a class="anchor" id="autotoc_md770"></a>
Room Headers (&lt;tt&gt;0x1F8000&lt;/tt&gt;)</h3>
<ul>
<li>Room layout index</li>
<li>Blockset and spriteset references</li>
<li>Palette assignments</li>
<li>Floor type definitions</li>
</ul>
<h3><a class="anchor" id="autotoc_md771"></a>
Object Data</h3>
<ul>
<li>Object definitions and tile mappings</li>
<li>Size and layer information</li>
<li>Interaction properties</li>
</ul>
<h3><a class="anchor" id="autotoc_md772"></a>
Graphics Data</h3>
<ul>
<li>Tile graphics (4bpp SNES format)</li>
<li>Palette data (15-color palettes)</li>
<li>Blockset compositions</li>
</ul>
<h2><a class="anchor" id="autotoc_md773"></a>
Assembly Integration</h2>
<p>The system references the US disassembly (<code>assets/asm/usdasm/</code>) for:</p><ul>
<li>Room data structure validation</li>
<li>Object type definitions</li>
<li>Memory layout verification</li>
<li>Data pointer validation</li>
</ul>
<h1><a class="anchor" id="autotoc_md774"></a>
Comparison with ZScream</h1>
<h2><a class="anchor" id="autotoc_md775"></a>
Architectural Differences</h2>
<p>YAZE's approach differs from ZScream in several key ways:</p>
<h3><a class="anchor" id="autotoc_md776"></a>
Component-Based Architecture</h3>
<ul>
<li><b>YAZE</b>: Modular components with clear separation of concerns</li>
<li><b>ZScream</b>: More monolithic approach with integrated functionality</li>
</ul>
<h3><a class="anchor" id="autotoc_md777"></a>
Real-time Rendering</h3>
<ul>
<li><b>YAZE</b>: Live object preview with mouse tracking</li>
<li><b>ZScream</b>: Static preview with separate placement step</li>
</ul>
<h3><a class="anchor" id="autotoc_md778"></a>
UI Organization</h3>
<ul>
<li><b>YAZE</b>: Fixed-width columns prevent layout disruption</li>
<li><b>ZScream</b>: Resizable panels that can affect overall layout</li>
</ul>
<h3><a class="anchor" id="autotoc_md779"></a>
Caching Strategy</h3>
<ul>
<li><b>YAZE</b>: Sophisticated object render caching with hash-based invalidation</li>
<li><b>ZScream</b>: Simpler caching approach</li>
</ul>
<h2><a class="anchor" id="autotoc_md780"></a>
Shared Concepts</h2>
<p>Both systems share fundamental concepts:</p><ul>
<li>Object-based room construction</li>
<li>Layer-based rendering</li>
<li>ROM data integration</li>
<li>Visual object browsing</li>
</ul>
<h1><a class="anchor" id="autotoc_md781"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md782"></a>
Performance</h2>
<ol type="1">
<li><b>Use Render Caching</b>: Don't clear cache unnecessarily</li>
<li><b>Bounds Checking</b>: Only render visible objects</li>
<li><b>Lazy Loading</b>: Load graphics and objects on-demand</li>
<li><b>Efficient Callbacks</b>: Minimize callback frequency</li>
</ol>
<h2><a class="anchor" id="autotoc_md783"></a>
Code Organization</h2>
<ol type="1">
<li><b>Separation of Concerns</b>: Keep UI, data, and rendering separate</li>
<li><b>Clear Interfaces</b>: Use callbacks for component communication</li>
<li><b>Error Handling</b>: Validate ROM data and handle errors gracefully</li>
<li><b>Memory Management</b>: Clean up resources properly</li>
</ol>
<h2><a class="anchor" id="autotoc_md784"></a>
User Experience</h2>
<ol type="1">
<li><b>Visual Feedback</b>: Provide clear object placement preview</li>
<li><b>Consistent Layout</b>: Use fixed dimensions for stable UI</li>
<li><b>Contextual Information</b>: Show relevant object properties</li>
<li><b>Efficient Workflow</b>: Minimize clicks for common operations</li>
</ol>
<h1><a class="anchor" id="autotoc_md785"></a>
Future Enhancements</h1>
<h2><a class="anchor" id="autotoc_md786"></a>
Planned Features</h2>
<ol type="1">
<li><b>Drag and Drop</b>: Direct object dragging from selector to canvas</li>
<li><b>Multi-Selection</b>: Select and manipulate multiple objects</li>
<li><b>Copy/Paste</b>: Copy object configurations between rooms</li>
<li><b>Undo/Redo</b>: Full edit history management</li>
<li><b>Template System</b>: Save and load room templates</li>
</ol>
<h2><a class="anchor" id="autotoc_md787"></a>
Technical Improvements</h2>
<ol type="1">
<li><b>GPU Acceleration</b>: Move rendering to GPU for better performance</li>
<li><b>Advanced Caching</b>: Predictive loading and intelligent cache management</li>
<li><b>Background Processing</b>: Asynchronous ROM data loading</li>
<li><b>Memory Optimization</b>: Reduce memory footprint for large dungeons</li>
</ol>
<p>This documentation provides a comprehensive understanding of how the YAZE dungeon object system works, from high-level architecture to low-level implementation details. The system is designed to be both powerful for advanced users and accessible for newcomers to dungeon editing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
