<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yaze: Canvas System Overview</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../yaze.ico"/></td>
  <td id="projectalign">
   <div id="projectname">yaze<span id="projectnumber">&#160;0.3.2</span>
   </div>
   <div id="projectbrief">Link to the Past ROM Editor</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d1/dc6/md_docs_2G1-canvas-guide.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Canvas System Overview</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md762"></a> </p>
<h1><a class="anchor" id="autotoc_md763"></a>
Canvas Architecture</h1>
<ul>
<li><b>Canvas States</b>: track <code>canvas</code>, <code>content</code>, and <code>draw</code> rectangles independently; expose size/scale through <code>CanvasState</code> inspection panel</li>
<li><b>Layer Stack</b>: background ➝ bitmaps ➝ entity overlays ➝ selection/tooltip layers</li>
<li><b>Interaction Modes</b>: Tile Paint, Tile Select, Rectangle Select, Entity Manipulation, Palette Editing, Diagnostics</li>
<li><b>Context Menu</b>: persistent menu with material icon sections (Mode, View, Info, Bitmap, Palette, BPP, Performance, Layout, Custom)</li>
</ul>
<h1><a class="anchor" id="autotoc_md764"></a>
Core API Patterns</h1>
<ul>
<li>Modern usage: <code>Begin/End</code> (auto grid/overlay, persistent context menu)</li>
<li>Legacy helpers still available (<code>DrawBackground</code>, <code>DrawGrid</code>, <code>DrawSelectRect</code>, etc.)</li>
<li>Unified state snapshot: <code>CanvasState</code> exposes geometry, zoom, scroll</li>
<li>Interaction handler manages mode-specific tools (tile brush, select rect, entity gizmo)</li>
</ul>
<h1><a class="anchor" id="autotoc_md765"></a>
Context Menu Sections</h1>
<ul>
<li><b>Mode Selector</b>: switch modes with icons (Brush, Select, Rect, Bitmap, Palette, BPP, Perf)</li>
<li><b>View &amp; Grid</b>: reset/zoom, toggle grid/labels, advanced/scaling dialogs</li>
<li><b>Canvas Info</b>: real-time canvas/content size, scale, scroll, mouse position</li>
<li><b>Bitmap/Palette/BPP</b>: format conversion, palette analysis, BPP workflows with persistent modals</li>
<li><b>Performance</b>: profiler metrics, dashboard, usage report</li>
<li><b>Layout</b>: draggable toggle, auto resize, grid step</li>
<li><b>Custom Actions</b>: consumer-provided menu items</li>
</ul>
<h1><a class="anchor" id="autotoc_md766"></a>
Interaction Modes &amp; Capabilities</h1>
<ul>
<li><b>Tile Painting</b>: tile16 painter, brush size, finish stroke callbacks<ul>
<li>Operations: finish_paint, reset_view, zoom, grid, scaling</li>
</ul>
</li>
<li><b>Tile Selection</b>: multi-select rectangle, copy/paste selection<ul>
<li>Operations: select_all, clear_selection, reset_view, zoom, grid, scaling</li>
</ul>
</li>
<li><b>Rectangle Selection</b>: drag-select area, clear selection<ul>
<li>Operations: clear_selection, reset_view, zoom, grid, scaling</li>
</ul>
</li>
<li><b>Bitmap Editing</b>: format conversion, bitmap manipulation<ul>
<li>Operations: bitmap_convert, palette_edit, bpp_analysis, reset_view, zoom, grid, scaling</li>
</ul>
</li>
<li><b>Palette Editing</b>: inline palette editor, ROM palette picker, color analysis<ul>
<li>Operations: palette_edit, palette_analysis, reset_palette, reset_view, zoom, grid, scaling</li>
</ul>
</li>
<li><b>BPP Conversion</b>: format analysis, conversion workflows<ul>
<li>Operations: bpp_analysis, bpp_conversion, bitmap_convert, reset_view, zoom, grid, scaling</li>
</ul>
</li>
<li><b>Performance Mode</b>: diagnostics, texture queue, performance overlays<ul>
<li>Operations: performance, usage_report, copy_metrics, reset_view, zoom, grid, scaling</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md767"></a>
Debug &amp; Diagnostics</h1>
<ul>
<li>Persistent modals (<code>View→Advanced</code>, <code>View→Scaling</code>, <code>Palette</code>, <code>BPP</code>) stay open until closed</li>
<li>Texture inspector shows current bitmap, VRAM sheet, palette group, usage stats</li>
<li>State overlay: canvas size, content size, global scale, scroll, highlight entity</li>
<li>Performance HUD: operation counts, timing graphs, usage recommendations</li>
</ul>
<h1><a class="anchor" id="autotoc_md768"></a>
Automation API</h1>
<ul>
<li>CanvasAutomationAPI: tile operations (<code>SetTileAt</code>, <code>SelectRect</code>), view control (<code>ScrollToTile</code>, <code>SetZoom</code>), entity manipulation hooks</li>
<li>Exposed through CLI (<code>z3ed</code>) and gRPC service, matching UI modes</li>
</ul>
<h1><a class="anchor" id="autotoc_md769"></a>
Integration Steps for Editors</h1>
<ol type="1">
<li>Construct <code>Canvas</code>, set renderer (optional) and ID</li>
<li>Call <code>InitializePaletteEditor</code> and <code>SetUsageMode</code></li>
<li>Configure available modes: <code>SetAvailableModes({kTilePainting, kTileSelecting})</code></li>
<li>Register mode callbacks (tile paint finish, selection clear, etc.)</li>
<li>During frame: <code>canvas.Begin(size)</code> → draw bitmaps/entities → <code>canvas.End()</code></li>
<li>Provide custom menu items via <code>AddMenuItem</code>/<code>AddMenuItem(item, usage)</code></li>
<li>Use <code>GetConfig()</code>/<code>GetSelection()</code> for state; respond to context menu commands via callback lambda in <code>Render</code></li>
</ol>
<h1><a class="anchor" id="autotoc_md770"></a>
Migration Checklist</h1>
<ul>
<li>Replace direct <code>DrawContextMenu</code> logic with new render callback signature</li>
<li>Move palette/BPP helpers into <code>canvas/</code> module; update includes</li>
<li>Ensure persistent modals wired (advanced/scaling/palette/bpp/perf)</li>
<li>Update usage tracker integrations to record mode switches</li>
<li>Validate overworld/tile16/dungeon editors in tile paint, select, entity modes</li>
</ul>
<h1><a class="anchor" id="autotoc_md771"></a>
Testing Notes</h1>
<ul>
<li>Manual regression: overworld paint/select, tile16 painter, dungeon entity drag</li>
<li>Verify context menu persists and modals remain until closed</li>
<li>Ensure palette/BPP modals populate with correct bitmap/palette data</li>
<li>Automation: run CanvasAutomation API tests/end-to-end scripts for overworld edits </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
